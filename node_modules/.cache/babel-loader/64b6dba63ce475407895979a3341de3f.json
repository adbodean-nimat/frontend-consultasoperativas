{"ast":null,"code":"require(\"core-js/modules/es.error.cause.js\");\n\n/******/\n(function () {\n  // webpackBootstrap\n\n  /******/\n  var __webpack_modules__ = {\n    /***/\n    92660:\n    /***/\n    function (module, exports, __webpack_require__) {\n      var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\n      (function (f, define) {\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(69089), __webpack_require__(60824), __webpack_require__(77261), __webpack_require__(30006), __webpack_require__(87722), __webpack_require__(10239), __webpack_require__(32549), __webpack_require__(80396), __webpack_require__(48643), __webpack_require__(13224), __webpack_require__(39725)], __WEBPACK_AMD_DEFINE_FACTORY__ = f, __WEBPACK_AMD_DEFINE_RESULT__ = typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? __WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__) : __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n      })(function () {\n        (function ($, undefined) {\n          // Imports ================================================================\n          var dataviz = kendo.dataviz,\n              draw = kendo.drawing,\n              geom = kendo.geometry,\n              diagram = dataviz.diagram,\n              Widget = kendo.ui.Widget,\n              Class = kendo.Class,\n              deepExtend = kendo.deepExtend,\n              outerWidth = kendo._outerWidth,\n              outerHeight = kendo._outerHeight,\n              extend = $.extend,\n              HierarchicalDataSource = kendo.data.HierarchicalDataSource,\n              Canvas = diagram.Canvas,\n              Group = diagram.Group,\n              Rectangle = diagram.Rectangle,\n              Circle = diagram.Circle,\n              CompositeTransform = diagram.CompositeTransform,\n              Rect = diagram.Rect,\n              Path = diagram.Path,\n              DeleteShapeUnit = diagram.DeleteShapeUnit,\n              DeleteConnectionUnit = diagram.DeleteConnectionUnit,\n              TextBlock = diagram.TextBlock,\n              Image = diagram.Image,\n              Point = diagram.Point,\n              Intersect = diagram.Intersect,\n              ConnectionEditAdorner = diagram.ConnectionEditAdorner,\n              UndoRedoService = diagram.UndoRedoService,\n              ToolService = diagram.ToolService,\n              Selector = diagram.Selector,\n              ResizingAdorner = diagram.ResizingAdorner,\n              ConnectorsAdorner = diagram.ConnectorsAdorner,\n              Cursors = diagram.Cursors,\n              Utils = diagram.Utils,\n              Observable = kendo.Observable,\n              ToBackUnit = diagram.ToBackUnit,\n              ToFrontUnit = diagram.ToFrontUnit,\n              PolylineRouter = diagram.PolylineRouter,\n              CascadingRouter = diagram.CascadingRouter,\n              isUndefined = Utils.isUndefined,\n              isDefined = Utils.isDefined,\n              defined = draw.util.defined,\n              isArray = Array.isArray,\n              isFunction = kendo.isFunction,\n              isString = Utils.isString,\n              isPlainObject = $.isPlainObject,\n              math = Math; // Constants ==============================================================\n\n          var NS = \".kendoDiagram\",\n              CASCADING = \"cascading\",\n              ITEMBOUNDSCHANGE = \"itemBoundsChange\",\n              CHANGE = \"change\",\n              CLICK = \"click\",\n              DRAG = \"drag\",\n              DRAG_END = \"dragEnd\",\n              DRAG_START = \"dragStart\",\n              MOUSE_ENTER = \"mouseEnter\",\n              MOUSE_LEAVE = \"mouseLeave\",\n              ERROR = \"error\",\n              AUTO = \"Auto\",\n              TOP = \"Top\",\n              RIGHT = \"Right\",\n              LEFT = \"Left\",\n              BOTTOM = \"Bottom\",\n              MAXINT = 9007199254740992,\n              SELECT = \"select\",\n              ITEMROTATE = \"itemRotate\",\n              PAN = \"pan\",\n              ZOOM_START = \"zoomStart\",\n              ZOOM_END = \"zoomEnd\",\n              NONE = \"none\",\n              DEFAULT_CANVAS_WIDTH = 600,\n              DEFAULT_CANVAS_HEIGHT = 600,\n              DEFAULT_SHAPE_TYPE = \"rectangle\",\n              DEFAULT_SHAPE_WIDTH = 100,\n              DEFAULT_SHAPE_HEIGHT = 100,\n              DEFAULT_SHAPE_MINWIDTH = 20,\n              DEFAULT_SHAPE_MINHEIGHT = 20,\n              DEFAULT_SHAPE_POSITION = 0,\n              DEFAULT_CONNECTION_BACKGROUND = \"Yellow\",\n              MAX_VALUE = Number.MAX_VALUE,\n              MIN_VALUE = -Number.MAX_VALUE,\n              ABSOLUTE = \"absolute\",\n              TRANSFORMED = \"transformed\",\n              ROTATED = \"rotated\",\n              TRANSPARENT = \"transparent\",\n              WIDTH = \"width\",\n              HEIGHT = \"height\",\n              X = \"x\",\n              Y = \"y\",\n              MOUSEWHEEL_NS = \"DOMMouseScroll\" + NS + \" mousewheel\" + NS,\n              MOBILE_ZOOM_RATE = 0.05,\n              MOBILE_PAN_DISTANCE = 5,\n              BUTTON_TEMPLATE = '<a class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base #=className#\" href=\"\\\\#\">' + '<span class=\"k-button-icon #=iconClass# #=imageClass#\"></span>' + '<span class=\"k-button-text\">#=text#</span>' + '</a>',\n              CONNECTION_CONTENT_OFFSET = 5;\n          diagram.DefaultConnectors = [{\n            name: TOP\n          }, {\n            name: BOTTOM\n          }, {\n            name: LEFT\n          }, {\n            name: RIGHT\n          }, {\n            name: AUTO,\n            position: function (shape) {\n              return shape.getPosition(\"center\");\n            }\n          }];\n          var defaultButtons = {\n            cancel: {\n              text: \"Cancel\",\n              imageClass: \"k-i-cancel\",\n              className: \"k-diagram-cancel\",\n              iconClass: \"k-icon\"\n            },\n            update: {\n              text: \"Update\",\n              imageClass: \"k-i-checkmark\",\n              className: \"k-diagram-update\",\n              iconClass: \"k-icon\"\n            }\n          };\n\n          diagram.shapeDefaults = function (extra) {\n            var defaults = {\n              type: DEFAULT_SHAPE_TYPE,\n              path: \"\",\n              autoSize: true,\n              visual: null,\n              x: DEFAULT_SHAPE_POSITION,\n              y: DEFAULT_SHAPE_POSITION,\n              minWidth: DEFAULT_SHAPE_MINWIDTH,\n              minHeight: DEFAULT_SHAPE_MINHEIGHT,\n              width: DEFAULT_SHAPE_WIDTH,\n              height: DEFAULT_SHAPE_HEIGHT,\n              hover: {},\n              editable: {\n                connect: true,\n                tools: []\n              },\n              connectors: diagram.DefaultConnectors,\n              rotation: {\n                angle: 0\n              }\n            };\n            Utils.simpleExtend(defaults, extra);\n            return defaults;\n          };\n\n          function mwDelta(e) {\n            var origEvent = e.originalEvent,\n                delta = 0;\n\n            if (origEvent.wheelDelta) {\n              delta = -origEvent.wheelDelta / 40;\n              delta = delta > 0 ? math.ceil(delta) : math.floor(delta);\n            } else if (origEvent.detail) {\n              delta = origEvent.detail;\n            }\n\n            return delta;\n          }\n\n          function isAutoConnector(connector) {\n            return connector.options.name.toLowerCase() === AUTO.toLowerCase();\n          }\n\n          function closestConnector(point, connectors) {\n            var minimumDistance = MAXINT,\n                resCtr,\n                connector;\n\n            for (var i = 0; i < connectors.length; i++) {\n              connector = connectors[i];\n\n              if (!isAutoConnector(connector)) {\n                var dist = point.distanceTo(connector.position());\n\n                if (dist < minimumDistance) {\n                  minimumDistance = dist;\n                  resCtr = connector;\n                }\n              }\n            }\n\n            return resCtr;\n          }\n\n          function indicesOfItems(group, visuals) {\n            var i,\n                indices = [],\n                visual;\n            var children = group.drawingContainer().children;\n            var length = children.length;\n\n            for (i = 0; i < visuals.length; i++) {\n              visual = visuals[i];\n\n              for (var j = 0; j < length; j++) {\n                if (children[j] == visual.drawingContainer()) {\n                  indices.push(j);\n                  break;\n                }\n              }\n            }\n\n            return indices;\n          }\n\n          var DiagramElement = Observable.extend({\n            init: function (options) {\n              var that = this;\n              that.dataItem = (options || {}).dataItem;\n              Observable.fn.init.call(that);\n              that.options = deepExtend({\n                id: diagram.randomId()\n              }, that.options, options);\n              that.isSelected = false;\n              that.visual = new Group({\n                id: that.options.id,\n                autoSize: that.options.autoSize\n              });\n              that.id = that.options.id;\n\n              that._template();\n            },\n            options: {\n              hover: {},\n              cursor: Cursors.grip,\n              content: {\n                align: \"center middle\"\n              },\n              selectable: true,\n              serializable: true,\n              enable: true\n            },\n            _getCursor: function (point) {\n              if (this.adorner) {\n                return this.adorner._getCursor(point);\n              }\n\n              return this.options.cursor;\n            },\n            visible: function (value) {\n              if (isUndefined(value)) {\n                return this.visual.visible();\n              } else {\n                this.visual.visible(value);\n              }\n            },\n            bounds: function () {},\n            refresh: function () {\n              this.visual.redraw();\n            },\n            position: function (point) {\n              this.options.x = point.x;\n              this.options.y = point.y;\n              this.visual.position(point);\n            },\n            toString: function () {\n              return this.options.id;\n            },\n            serialize: function () {\n              // the options json object describes the shape perfectly. So this object can serve as shape serialization.\n              var json = deepExtend({}, {\n                options: this.options\n              });\n\n              if (this.dataItem) {\n                json.dataItem = this.dataItem.toString();\n              }\n\n              return json;\n            },\n            _content: function (content) {\n              if (content !== undefined) {\n                var options = this.options;\n\n                if (diagram.Utils.isString(content)) {\n                  options.content.text = content;\n                } else {\n                  deepExtend(options.content, content);\n                }\n\n                var contentOptions = options.content;\n                var contentVisual = this._contentVisual;\n\n                if (!contentVisual) {\n                  this._createContentVisual(contentOptions);\n                } else {\n                  this._updateContentVisual(contentOptions);\n                }\n              }\n\n              return this.options.content.text;\n            },\n            _createContentVisual: function (options) {\n              if (options.text) {\n                this._contentVisual = new TextBlock(options);\n                this._contentVisual._includeInBBox = false;\n                this.visual.append(this._contentVisual);\n              }\n            },\n            _updateContentVisual: function (options) {\n              this._contentVisual.redraw(options);\n            },\n            _hitTest: function (point) {\n              var bounds = this.bounds();\n              return this.visible() && bounds.contains(point) && this.options.enable;\n            },\n            _template: function () {\n              var that = this;\n\n              if (that.options.content.template) {\n                var data = that.dataItem || {},\n                    elementTemplate = kendo.template(that.options.content.template, {\n                  paramName: \"dataItem\"\n                });\n                that.options.content.text = elementTemplate(data);\n              }\n            },\n            _canSelect: function () {\n              return this.options.selectable !== false;\n            },\n            toJSON: function () {\n              return {\n                id: this.options.id\n              };\n            }\n          });\n          var Connector = Class.extend({\n            init: function (shape, options) {\n              this.options = deepExtend({}, this.options, options);\n              this.connections = [];\n              this.shape = shape;\n            },\n            options: {\n              width: 7,\n              height: 7,\n              fill: {\n                color: DEFAULT_CONNECTION_BACKGROUND\n              },\n              hover: {}\n            },\n            position: function () {\n              if (this.options.position) {\n                return this.options.position(this.shape);\n              } else {\n                return this.shape.getPosition(this.options.name);\n              }\n            },\n            toJSON: function () {\n              return {\n                shapeId: this.shape.toString(),\n                connector: this.options.name\n              };\n            }\n          });\n\n          Connector.parse = function (diagram, str) {\n            var tempStr = str.split(\":\"),\n                id = tempStr[0],\n                name = tempStr[1] || AUTO;\n\n            for (var i = 0; i < diagram.shapes.length; i++) {\n              var shape = diagram.shapes[i];\n\n              if (shape.options.id == id) {\n                return shape.getConnector(name.trim());\n              }\n            }\n          };\n\n          var Shape = DiagramElement.extend({\n            init: function (options, diagram) {\n              var that = this;\n              DiagramElement.fn.init.call(that, options);\n              this.diagram = diagram;\n              this.updateOptionsFromModel();\n              options = that.options;\n              that.connectors = [];\n              that.type = options.type;\n              that.createShapeVisual();\n              that.updateBounds();\n              that.content(that.content());\n\n              that._createConnectors();\n            },\n            options: diagram.shapeDefaults(),\n            _setOptionsFromModel: function (model) {\n              var modelOptions = filterShapeDataItem(model || this.dataItem);\n              this.options = deepExtend({}, this.options, modelOptions);\n              this.redrawVisual();\n            },\n            updateOptionsFromModel: function (model, field) {\n              if (this.diagram && this.diagram._isEditable) {\n                var modelOptions = filterShapeDataItem(model || this.dataItem);\n\n                if (model && field) {\n                  if (!dataviz.inArray(field, [\"x\", \"y\", \"width\", \"height\"])) {\n                    if (this.options.visual) {\n                      this._redrawVisual();\n                    } else if (modelOptions.type) {\n                      this.options = deepExtend({}, this.options, modelOptions);\n\n                      this._redrawVisual();\n                    }\n\n                    if (this.options.content) {\n                      this._template();\n\n                      this.content(this.options.content);\n                    }\n                  } else {\n                    var bounds = this.bounds();\n                    bounds[field] = model[field];\n                    this.bounds(bounds);\n                  }\n                } else {\n                  this.options = deepExtend({}, this.options, modelOptions);\n                }\n              }\n            },\n            _redrawVisual: function () {\n              this.visual.clear();\n              this._contentVisual = null;\n              this.options.dataItem = this.dataItem;\n              this.createShapeVisual();\n              this.updateBounds();\n            },\n            redrawVisual: function () {\n              this._redrawVisual();\n\n              if (this.options.content) {\n                this._template();\n\n                this.content(this.options.content);\n              }\n            },\n            updateModel: function (syncChanges) {\n              var diagram = this.diagram;\n\n              if (diagram && diagram._isEditable) {\n                var bounds = this._bounds;\n                var model = this.dataItem;\n\n                if (model) {\n                  diagram._suspendModelRefresh();\n\n                  if (defined(model.x) && bounds.x !== model.x) {\n                    model.set(\"x\", bounds.x);\n                  }\n\n                  if (defined(model.y) && bounds.y !== model.y) {\n                    model.set(\"y\", bounds.y);\n                  }\n\n                  if (defined(model.width) && bounds.width !== model.width) {\n                    model.set(\"width\", bounds.width);\n                  }\n\n                  if (defined(model.height) && bounds.height !== model.height) {\n                    model.set(\"height\", bounds.height);\n                  }\n\n                  this.dataItem = model;\n\n                  diagram._resumeModelRefresh();\n\n                  if (syncChanges) {\n                    diagram._syncShapeChanges();\n                  }\n                }\n              }\n            },\n            updateBounds: function () {\n              var bounds = this.visual._measure(true);\n\n              var options = this.options;\n              this.bounds(new Rect(options.x, options.y, bounds.width, bounds.height));\n\n              this._rotate();\n\n              this._alignContent();\n            },\n            content: function (content) {\n              var result = this._content(content);\n\n              this._alignContent();\n\n              return result;\n            },\n            _alignContent: function () {\n              var contentOptions = this.options.content || {};\n              var contentVisual = this._contentVisual;\n\n              if (contentVisual && contentOptions.align) {\n                var containerRect = this.visual._measure();\n\n                var aligner = new diagram.RectAlign(containerRect);\n                var contentBounds = contentVisual.drawingElement.bbox(null);\n                var contentRect = new Rect(0, 0, contentBounds.width(), contentBounds.height());\n                var alignedBounds = aligner.align(contentRect, contentOptions.align);\n                contentVisual.position(alignedBounds.topLeft());\n              }\n            },\n            _createConnectors: function () {\n              var options = this.options,\n                  length = options.connectors.length,\n                  connectorDefaults = options.connectorDefaults,\n                  connector,\n                  i;\n\n              for (i = 0; i < length; i++) {\n                connector = new Connector(this, deepExtend({}, connectorDefaults, options.connectors[i]));\n                this.connectors.push(connector);\n              }\n            },\n            bounds: function (value) {\n              var bounds;\n\n              if (value) {\n                if (isString(value)) {\n                  switch (value) {\n                    case TRANSFORMED:\n                      bounds = this._transformedBounds();\n                      break;\n\n                    case ABSOLUTE:\n                      bounds = this._transformedBounds();\n                      var pan = this.diagram._pan;\n                      bounds.x += pan.x;\n                      bounds.y += pan.y;\n                      break;\n\n                    case ROTATED:\n                      bounds = this._rotatedBounds();\n                      break;\n\n                    default:\n                      bounds = this._bounds;\n                  }\n                } else {\n                  this._setBounds(value);\n\n                  this._triggerBoundsChange();\n\n                  if (!(this.diagram && this.diagram._layouting)) {\n                    this.refreshConnections();\n                  }\n                }\n              } else {\n                bounds = this._bounds;\n              }\n\n              return bounds;\n            },\n            _setBounds: function (rect) {\n              var options = this.options;\n              var topLeft = rect.topLeft();\n              var x = options.x = topLeft.x;\n              var y = options.y = topLeft.y;\n              var width = options.width = math.max(rect.width, options.minWidth);\n              var height = options.height = math.max(rect.height, options.minHeight);\n              this._bounds = new Rect(x, y, width, height);\n              this.visual.redraw({\n                x: x,\n                y: y,\n                width: width,\n                height: height\n              });\n            },\n            position: function (point) {\n              if (point) {\n                this.bounds(new Rect(point.x, point.y, this._bounds.width, this._bounds.height));\n              } else {\n                return this._bounds.topLeft();\n              }\n            },\n\n            /**\n             * Returns a clone of this shape.\n             * @returns {Shape}\n             */\n            clone: function () {\n              var json = this.serialize();\n              json.options.id = diagram.randomId();\n\n              if (this.diagram && this.diagram._isEditable && defined(this.dataItem)) {\n                json.options.dataItem = cloneDataItem(this.dataItem);\n              }\n\n              return new Shape(json.options);\n            },\n            select: function (value) {\n              var diagram = this.diagram,\n                  selected,\n                  deselected;\n\n              if (isUndefined(value)) {\n                value = true;\n              }\n\n              if (this._canSelect()) {\n                if (this.isSelected != value) {\n                  selected = [];\n                  deselected = [];\n                  this.isSelected = value;\n\n                  if (this.isSelected) {\n                    diagram._selectedItems.push(this);\n\n                    selected.push(this);\n                  } else {\n                    Utils.remove(diagram._selectedItems, this);\n                    deselected.push(this);\n                  }\n\n                  if (!diagram._internalSelection) {\n                    diagram._selectionChanged(selected, deselected);\n                  }\n\n                  return true;\n                }\n              }\n            },\n            rotate: function (angle, center, undoable) {\n              // we assume the center is always the center of the shape.\n              var rotate = this.visual.rotate();\n\n              if (angle !== undefined) {\n                if (undoable !== false && this.diagram && this.diagram.undoRedoService && angle !== rotate.angle) {\n                  this.diagram.undoRedoService.add(new diagram.RotateUnit(this.diagram._resizingAdorner, [this], [rotate.angle]), false);\n                }\n\n                var b = this.bounds(),\n                    sc = new Point(b.width / 2, b.height / 2),\n                    deltaAngle,\n                    newPosition;\n\n                if (center) {\n                  deltaAngle = angle - rotate.angle;\n                  newPosition = b.center().rotate(center, 360 - deltaAngle).minus(sc);\n                  this._rotationOffset = this._rotationOffset.plus(newPosition.minus(b.topLeft()));\n                  this.position(newPosition);\n                }\n\n                this.visual.rotate(angle, sc);\n                this.options.rotation.angle = angle;\n\n                if (this.diagram && this.diagram._connectorsAdorner) {\n                  this.diagram._connectorsAdorner.refresh();\n                }\n\n                this.refreshConnections();\n\n                if (this.diagram) {\n                  this.diagram.trigger(ITEMROTATE, {\n                    item: this\n                  });\n                }\n              }\n\n              return rotate;\n            },\n            connections: function (type) {\n              // in, out, undefined = both\n              var result = [],\n                  i,\n                  j,\n                  con,\n                  cons,\n                  ctr;\n\n              for (i = 0; i < this.connectors.length; i++) {\n                ctr = this.connectors[i];\n                cons = ctr.connections;\n\n                for (j = 0, cons; j < cons.length; j++) {\n                  con = cons[j];\n\n                  if (type == \"out\") {\n                    var source = con.source();\n\n                    if (source.shape && source.shape == this) {\n                      result.push(con);\n                    }\n                  } else if (type == \"in\") {\n                    var target = con.target();\n\n                    if (target.shape && target.shape == this) {\n                      result.push(con);\n                    }\n                  } else {\n                    result.push(con);\n                  }\n                }\n              }\n\n              return result;\n            },\n            refreshConnections: function () {\n              $.each(this.connections(), function () {\n                this.refresh();\n              });\n            },\n\n            /**\n             * Gets a connector of this shape either by the connector's supposed name or\n             * via a Point in which case the closest connector will be returned.\n             * @param nameOrPoint The name of a Connector or a Point.\n             * @returns {Connector}\n             */\n            getConnector: function (nameOrPoint) {\n              var i, ctr;\n\n              if (isString(nameOrPoint)) {\n                nameOrPoint = nameOrPoint.toLocaleLowerCase();\n\n                for (i = 0; i < this.connectors.length; i++) {\n                  ctr = this.connectors[i];\n\n                  if (ctr.options.name.toLocaleLowerCase() == nameOrPoint) {\n                    return ctr;\n                  }\n                }\n              } else if (nameOrPoint instanceof Point) {\n                return closestConnector(nameOrPoint, this.connectors);\n              } else {\n                return this.connectors.length ? this.connectors[0] : null;\n              }\n            },\n            getPosition: function (side) {\n              var b = this.bounds(),\n                  fnName = side.charAt(0).toLowerCase() + side.slice(1);\n\n              if (isFunction(b[fnName])) {\n                return this._transformPoint(b[fnName]());\n              }\n\n              return b.center();\n            },\n            redraw: function (options) {\n              if (options) {\n                var shapeOptions = this.options;\n                var boundsChange;\n                this.shapeVisual.redraw(this._visualOptions(options));\n\n                if (this._diffNumericOptions(options, [WIDTH, HEIGHT, X, Y])) {\n                  this.bounds(new Rect(shapeOptions.x, shapeOptions.y, shapeOptions.width, shapeOptions.height));\n                  boundsChange = true;\n                }\n\n                if (options.connectors) {\n                  shapeOptions.connectors = options.connectors;\n\n                  this._updateConnectors();\n                }\n\n                shapeOptions = deepExtend(shapeOptions, options);\n\n                if (options.rotation || boundsChange) {\n                  this._rotate();\n                }\n\n                if (shapeOptions.content) {\n                  this.content(shapeOptions.content);\n                }\n              }\n            },\n            _updateConnectors: function () {\n              var connections = this.connections();\n              this.connectors = [];\n\n              this._createConnectors();\n\n              var connection;\n              var source;\n              var target;\n\n              for (var idx = 0; idx < connections.length; idx++) {\n                connection = connections[idx];\n                source = connection.source();\n                target = connection.target();\n\n                if (source.shape && source.shape === this) {\n                  connection.source(this.getConnector(source.options.name) || null);\n                } else if (target.shape && target.shape === this) {\n                  connection.target(this.getConnector(target.options.name) || null);\n                }\n\n                connection.updateModel();\n              }\n            },\n            _diffNumericOptions: diagram.diffNumericOptions,\n            _visualOptions: function (options) {\n              return {\n                data: options.path,\n                source: options.source,\n                hover: options.hover,\n                fill: options.fill,\n                stroke: options.stroke\n              };\n            },\n            _triggerBoundsChange: function () {\n              if (this.diagram) {\n                this.diagram.trigger(ITEMBOUNDSCHANGE, {\n                  item: this,\n                  bounds: this._bounds.clone()\n                }); // the trigger modifies the arguments internally.\n              }\n            },\n            _transformPoint: function (point) {\n              var rotate = this.rotate(),\n                  bounds = this.bounds(),\n                  tl = bounds.topLeft();\n\n              if (rotate.angle) {\n                point.rotate(rotate.center().plus(tl), 360 - rotate.angle);\n              }\n\n              return point;\n            },\n            _transformedBounds: function () {\n              var bounds = this.bounds(),\n                  tl = bounds.topLeft(),\n                  br = bounds.bottomRight();\n              return Rect.fromPoints(this.diagram.modelToView(tl), this.diagram.modelToView(br));\n            },\n            _rotatedBounds: function () {\n              var bounds = this.bounds().rotatedBounds(this.rotate().angle),\n                  tl = bounds.topLeft(),\n                  br = bounds.bottomRight();\n              return Rect.fromPoints(tl, br);\n            },\n            _rotate: function () {\n              var rotation = this.options.rotation;\n\n              if (rotation && rotation.angle) {\n                this.rotate(rotation.angle);\n              }\n\n              this._rotationOffset = new Point();\n            },\n            _hover: function (value) {\n              var options = this.options,\n                  hover = options.hover,\n                  stroke = options.stroke,\n                  fill = options.fill;\n\n              if (value && isDefined(hover.stroke)) {\n                stroke = deepExtend({}, stroke, hover.stroke);\n              }\n\n              if (value && isDefined(hover.fill)) {\n                fill = hover.fill;\n              }\n\n              this.shapeVisual.redraw({\n                stroke: stroke,\n                fill: fill\n              });\n\n              if (options.editable && options.editable.connect) {\n                this.diagram._showConnectors(this, value);\n              }\n            },\n            _hitTest: function (value) {\n              if (this.visible()) {\n                var bounds = this.bounds(),\n                    rotatedPoint,\n                    angle = this.rotate().angle;\n\n                if (value.isEmpty && !value.isEmpty()) {\n                  // rect selection\n                  return Intersect.rects(value, bounds, angle ? angle : 0);\n                } else {\n                  // point\n                  rotatedPoint = value.clone().rotate(bounds.center(), angle); // cloning is important because rotate modifies the point inline.\n\n                  if (bounds.contains(rotatedPoint)) {\n                    return this;\n                  }\n                }\n              }\n            },\n            toJSON: function () {\n              return {\n                shapeId: this.options.id\n              };\n            },\n            createShapeVisual: function () {\n              var options = this.options;\n\n              var visualOptions = this._visualOptions(options);\n\n              var visualTemplate = options.visual;\n              var type = (options.type + \"\").toLocaleLowerCase();\n              var shapeVisual;\n              visualOptions.width = options.width;\n              visualOptions.height = options.height;\n\n              if (isFunction(visualTemplate)) {\n                // custom template\n                shapeVisual = visualTemplate.call(this, options);\n              } else if (visualOptions.data) {\n                shapeVisual = new Path(visualOptions);\n                translateToOrigin(shapeVisual);\n              } else if (type == \"rectangle\") {\n                shapeVisual = new Rectangle(visualOptions);\n              } else if (type == \"circle\") {\n                shapeVisual = new Circle(visualOptions);\n              } else if (type == \"text\") {\n                shapeVisual = new TextBlock(visualOptions);\n              } else if (type == \"image\") {\n                shapeVisual = new Image(visualOptions);\n              } else {\n                shapeVisual = new Path(visualOptions);\n              }\n\n              this.shapeVisual = shapeVisual;\n              this.visual.append(this.shapeVisual);\n            }\n          });\n          /**\n           * The visual link between two Shapes through the intermediate of Connectors.\n           */\n\n          var Connection = DiagramElement.extend({\n            init: function (from, to, options) {\n              var that = this;\n              DiagramElement.fn.init.call(that, options);\n              this.updateOptionsFromModel();\n\n              this._initRouter();\n\n              that.path = new diagram.Polyline(that.options);\n              that.path.fill(TRANSPARENT);\n              that.visual.append(that.path);\n              that._sourcePoint = that._targetPoint = new Point();\n\n              that._setSource(from);\n\n              that._setTarget(to);\n\n              that.content(that.options.content);\n              that.definers = [];\n\n              if (defined(options) && options.points) {\n                that.points(options.points);\n              }\n            },\n            options: {\n              hover: {\n                stroke: {}\n              },\n              startCap: NONE,\n              endCap: NONE,\n              points: [],\n              selectable: true,\n              fromConnector: AUTO,\n              toConnector: AUTO\n            },\n            _setOptionsFromModel: function (model) {\n              this.updateOptionsFromModel(model || this.dataItem);\n            },\n            updateOptionsFromModel: function (model) {\n              if (this.diagram && this.diagram._isEditable) {\n                var dataMap = this.diagram._dataMap;\n                var options = filterConnectionDataItem(model || this.dataItem);\n\n                if (model) {\n                  if (defined(options.from)) {\n                    var from = dataMap[options.from];\n\n                    if (from && defined(options.fromConnector)) {\n                      from = from.getConnector(options.fromConnector);\n                    }\n\n                    this.source(from);\n                  } else if (defined(options.fromX) && defined(options.fromY)) {\n                    this.source(new Point(options.fromX, options.fromY));\n                  }\n\n                  if (defined(options.to)) {\n                    var to = dataMap[options.to];\n\n                    if (to && defined(options.toConnector)) {\n                      to = to.getConnector(options.toConnector);\n                    }\n\n                    this.target(to);\n                  } else if (defined(options.toX) && defined(options.toY)) {\n                    this.target(new Point(options.toX, options.toY));\n                  }\n\n                  if (defined(options.type) && this.type() !== options.type) {\n                    this.points([]);\n                    this.type(options.type);\n                  }\n\n                  this.dataItem = model;\n\n                  this._template();\n\n                  this.redraw(this.options);\n                } else {\n                  this.options = deepExtend({}, options, this.options);\n                }\n              }\n            },\n            updateModel: function (syncChanges) {\n              if (this.diagram && this.diagram._isEditable) {\n                if (this.diagram.connectionsDataSource) {\n                  var model = this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);\n\n                  if (model) {\n                    this.diagram._suspendModelRefresh();\n\n                    if (defined(this.options.fromX) && this.options.fromX !== null) {\n                      clearField(\"from\", model);\n                      clearField(\"fromConnector\", model);\n                      model.set(\"fromX\", this.options.fromX);\n                      model.set(\"fromY\", this.options.fromY);\n                    } else {\n                      model.set(\"from\", this.options.from);\n\n                      if (defined(model.fromConnector)) {\n                        model.set(\"fromConnector\", this.sourceConnector ? this.sourceConnector.options.name : null);\n                      }\n\n                      clearField(\"fromX\", model);\n                      clearField(\"fromY\", model);\n                    }\n\n                    if (defined(this.options.toX) && this.options.toX !== null) {\n                      clearField(\"to\", model);\n                      clearField(\"toConnector\", model);\n                      model.set(\"toX\", this.options.toX);\n                      model.set(\"toY\", this.options.toY);\n                    } else {\n                      model.set(\"to\", this.options.to);\n\n                      if (defined(model.toConnector)) {\n                        model.set(\"toConnector\", this.targetConnector ? this.targetConnector.options.name : null);\n                      }\n\n                      clearField(\"toX\", model);\n                      clearField(\"toY\", model);\n                    }\n\n                    if (defined(this.options.type) && defined(model.type)) {\n                      model.set(\"type\", this.options.type);\n                    }\n\n                    this.dataItem = model;\n\n                    this.diagram._resumeModelRefresh();\n\n                    if (syncChanges) {\n                      this.diagram._syncConnectionChanges();\n                    }\n                  }\n                }\n              }\n            },\n\n            /**\n             * Gets the Point where the source of the connection resides.\n             * If the endpoint in Auto-connector the location of the resolved connector will be returned.\n             * If the endpoint is floating the location of the endpoint is returned.\n             */\n            sourcePoint: function () {\n              return this._resolvedSourceConnector ? this._resolvedSourceConnector.position() : this._sourcePoint;\n            },\n            _setSource: function (source) {\n              var shapeSource = source instanceof Shape;\n              var defaultConnector = this.options.fromConnector || AUTO;\n              var dataItem;\n\n              if (shapeSource && !source.getConnector(defaultConnector)) {\n                return;\n              }\n\n              if (source !== undefined) {\n                this.from = source;\n              }\n\n              this._removeFromSourceConnector();\n\n              if (source === null) {\n                // detach\n                if (this.sourceConnector) {\n                  this._sourcePoint = (this._resolvedSourceConnector || this.sourceConnector).position();\n\n                  this._clearSourceConnector();\n\n                  this._setFromOptions(null, this._sourcePoint);\n                }\n              } else if (source instanceof Connector) {\n                dataItem = source.shape.dataItem;\n\n                if (dataItem) {\n                  this._setFromOptions(dataItem.id);\n                }\n\n                this.sourceConnector = source;\n                this.sourceConnector.connections.push(this);\n              } else if (source instanceof Point) {\n                this._setFromOptions(null, source);\n\n                this._sourcePoint = source;\n\n                if (this.sourceConnector) {\n                  this._clearSourceConnector();\n                }\n              } else if (shapeSource) {\n                dataItem = source.dataItem;\n\n                if (dataItem) {\n                  this._setFromOptions(dataItem.id);\n                }\n\n                this.sourceConnector = source.getConnector(defaultConnector);\n                this.sourceConnector.connections.push(this);\n              }\n            },\n            source: function (source, undoable) {\n              if (isDefined(source)) {\n                if (undoable && this.diagram) {\n                  this.diagram.undoRedoService.addCompositeItem(new diagram.ConnectionEditUnit(this, source));\n                }\n\n                this._setSource(source);\n\n                this.refresh();\n              }\n\n              return this.sourceConnector ? this.sourceConnector : this._sourcePoint;\n            },\n            _setFromOptions: function (from, fromPoint) {\n              this.options.from = from;\n\n              if (fromPoint) {\n                this.options.fromX = fromPoint.x;\n                this.options.fromY = fromPoint.y;\n              } else {\n                this.options.fromX = null;\n                this.options.fromY = null;\n              }\n            },\n\n            /**\n             * Gets or sets the PathDefiner of the sourcePoint.\n             * The left part of this definer is always null since it defines the source tangent.\n             * @param value\n             * @returns {*}\n             */\n            sourceDefiner: function (value) {\n              if (value) {\n                if (value instanceof diagram.PathDefiner) {\n                  value.left = null;\n                  this._sourceDefiner = value;\n                  this.source(value.point); // refresh implicit here\n                } else {\n                  throw \"The sourceDefiner needs to be a PathDefiner.\";\n                }\n              } else {\n                if (!this._sourceDefiner) {\n                  this._sourceDefiner = new diagram.PathDefiner(this.sourcePoint(), null, null);\n                }\n\n                return this._sourceDefiner;\n              }\n            },\n\n            /**\n             * Gets  the Point where the target of the connection resides.\n             */\n            targetPoint: function () {\n              return this._resolvedTargetConnector ? this._resolvedTargetConnector.position() : this._targetPoint;\n            },\n            _setTarget: function (target) {\n              var shapeTarget = target instanceof Shape;\n              var defaultConnector = this.options.toConnector || AUTO;\n              var dataItem;\n\n              if (shapeTarget && !target.getConnector(defaultConnector)) {\n                return;\n              }\n\n              if (target !== undefined) {\n                this.to = target;\n              }\n\n              this._removeFromTargetConnector();\n\n              if (target === null) {\n                // detach\n                if (this.targetConnector) {\n                  this._targetPoint = (this._resolvedTargetConnector || this.targetConnector).position();\n\n                  this._clearTargetConnector();\n\n                  this._setToOptions(null, this._targetPoint);\n                }\n              } else if (target instanceof Connector) {\n                dataItem = target.shape.dataItem;\n\n                if (dataItem) {\n                  this._setToOptions(dataItem.id);\n                }\n\n                this.targetConnector = target;\n                this.targetConnector.connections.push(this);\n              } else if (target instanceof Point) {\n                this._setToOptions(null, target);\n\n                this._targetPoint = target;\n\n                if (this.targetConnector) {\n                  this._clearTargetConnector();\n                }\n              } else if (shapeTarget) {\n                dataItem = target.dataItem;\n\n                if (dataItem) {\n                  this._setToOptions(dataItem.id);\n                }\n\n                this.targetConnector = target.getConnector(defaultConnector);\n                this.targetConnector.connections.push(this);\n              }\n            },\n            target: function (target, undoable) {\n              if (isDefined(target)) {\n                if (undoable && this.diagram) {\n                  this.diagram.undoRedoService.addCompositeItem(new diagram.ConnectionEditUnit(this, undefined, target));\n                }\n\n                this._setTarget(target);\n\n                this.refresh();\n              }\n\n              return this.targetConnector ? this.targetConnector : this._targetPoint;\n            },\n            _setToOptions: function (to, toPoint) {\n              this.options.to = to;\n\n              if (toPoint) {\n                this.options.toX = toPoint.x;\n                this.options.toY = toPoint.y;\n              } else {\n                this.options.toX = null;\n                this.options.toY = null;\n              }\n            },\n\n            /**\n             * Gets or sets the PathDefiner of the targetPoint.\n             * The right part of this definer is always null since it defines the target tangent.\n             * @param value\n             * @returns {*}\n             */\n            targetDefiner: function (value) {\n              if (value) {\n                if (value instanceof diagram.PathDefiner) {\n                  value.right = null;\n                  this._targetDefiner = value;\n                  this.target(value.point); // refresh implicit here\n                } else {\n                  throw \"The sourceDefiner needs to be a PathDefiner.\";\n                }\n              } else {\n                if (!this._targetDefiner) {\n                  this._targetDefiner = new diagram.PathDefiner(this.targetPoint(), null, null);\n                }\n\n                return this._targetDefiner;\n              }\n            },\n            _updateConnectors: function () {\n              this._updateConnector(this.source(), \"source\");\n\n              this._updateConnector(this.target(), \"target\");\n            },\n            _updateConnector: function (instance, name) {\n              var that = this;\n              var diagram = that.diagram;\n\n              if (instance instanceof Connector && !diagram.getShapeById(instance.shape.id)) {\n                var dataItem = instance.shape.dataItem;\n                var connectorName = instance.options.name;\n\n                var setNewTarget = function () {\n                  var shape = diagram._dataMap[dataItem.id];\n                  instance = shape.getConnector(connectorName);\n                  that[name](instance, false);\n                  that.updateModel();\n                };\n\n                if (diagram._dataMap[dataItem.id]) {\n                  setNewTarget();\n                } else {\n                  var inactiveItem = diagram._inactiveShapeItems.getByUid(dataItem.uid);\n\n                  if (inactiveItem) {\n                    diagram._deferredConnectionUpdates.push(inactiveItem.onActivate(setNewTarget));\n                  }\n                }\n              } else {\n                that[name](instance, false);\n              }\n            },\n            content: function (content) {\n              var result = this._content(content);\n\n              if (defined(content)) {\n                this._alignContent();\n              }\n\n              return result;\n            },\n            _createContentVisual: function (options) {\n              var visual;\n\n              if (isFunction(options.visual)) {\n                visual = options.visual.call(this, options);\n              } else if (options.text) {\n                visual = new TextBlock(options);\n              }\n\n              if (visual) {\n                this._contentVisual = visual;\n                visual._includeInBBox = false;\n                this.visual.append(visual);\n              }\n\n              return visual;\n            },\n            _updateContentVisual: function (options) {\n              if (isFunction(options.visual)) {\n                this.visual.remove(this._contentVisual);\n\n                this._createContentVisual(options);\n              } else {\n                this._contentVisual.redraw(options);\n              }\n            },\n            _alignContent: function () {\n              if (this._contentVisual) {\n                var offset = CONNECTION_CONTENT_OFFSET;\n                var points = this.allPoints();\n                var endIdx = math.floor(points.length / 2);\n                var startIdx = endIdx - 1;\n\n                while (startIdx > 0 && points[startIdx].equals(points[endIdx])) {\n                  startIdx--;\n                  endIdx++;\n                }\n\n                var endPoint = points[endIdx];\n                var startPoint = points[startIdx];\n\n                var boundingBox = this._contentVisual._measure();\n\n                var width = boundingBox.width;\n                var height = boundingBox.height;\n                var alignToPath = points.length % 2 === 0;\n                var distance = startPoint.distanceTo(endPoint);\n\n                if (alignToPath && points.length > 2 && distance > 0 && (startPoint.y === endPoint.y && distance < width || startPoint.x === endPoint.x && distance < height)) {\n                  alignToPath = false;\n                  offset = 0;\n                }\n\n                var point;\n\n                if (alignToPath) {\n                  var angle = draw.util.deg(math.atan2(endPoint.y - startPoint.y, endPoint.x - startPoint.x));\n                  point = new Point((endPoint.x - startPoint.x) / 2 + startPoint.x, (endPoint.y - startPoint.y) / 2 + startPoint.y);\n\n                  if (math.abs(angle) === 90) {\n                    point.x += offset;\n                    point.y -= height / 2;\n                  } else if (angle % 180 === 0) {\n                    point.x -= width / 2;\n                    point.y -= height + offset;\n                  } else if (angle < -90 || 0 < angle && angle < 90) {\n                    point.y -= height;\n                  } else if (angle < 0 || angle > 90) {\n                    point.x -= width;\n                    point.y -= height;\n                  }\n                } else {\n                  var midIdx = math.floor(points.length / 2);\n                  point = points[midIdx].clone();\n                  startPoint = points[midIdx - 1];\n                  endPoint = points[midIdx + 1];\n                  var offsetX = startPoint.x <= point.x && endPoint.x <= point.x ? offset : -boundingBox.width - offset;\n                  var offsetY = startPoint.y <= point.y && endPoint.y <= point.y ? offset : -boundingBox.height - offset;\n                  point.x += offsetX;\n                  point.y += offsetY;\n                }\n\n                this._contentVisual.position(point);\n              }\n            },\n\n            /**\n             * Selects or unselects this connections.\n             * @param value True to select, false to unselect.\n             */\n            select: function (value) {\n              var diagram = this.diagram,\n                  selected,\n                  deselected;\n\n              if (this._canSelect()) {\n                if (this.isSelected !== value) {\n                  this.isSelected = value;\n                  selected = [];\n                  deselected = [];\n\n                  if (this.isSelected) {\n                    this.adorner = new ConnectionEditAdorner(this, this.options.selection);\n\n                    diagram._adorn(this.adorner, true);\n\n                    diagram._selectedItems.push(this);\n\n                    selected.push(this);\n                  } else {\n                    if (this.adorner) {\n                      diagram._adorn(this.adorner, false);\n\n                      Utils.remove(diagram._selectedItems, this);\n                      this.adorner = undefined;\n                      deselected.push(this);\n                    }\n                  }\n\n                  if (this.adorner) {\n                    this.adorner.refresh();\n                  }\n\n                  if (!diagram._internalSelection) {\n                    diagram._selectionChanged(selected, deselected);\n                  }\n\n                  return true;\n                }\n              }\n            },\n\n            /**\n             * Gets or sets the bounds of this connection.\n             * @param value A Rect object.\n             * @remark This is automatically set in the refresh().\n             * @returns {Rect}\n             */\n            bounds: function (value) {\n              if (value && !isString(value)) {\n                this._bounds = value;\n              } else {\n                return this._bounds;\n              }\n            },\n\n            /**\n             * Gets or sets the connection type (see ConnectionType enumeration).\n             * @param value A ConnectionType value.\n             * @returns {ConnectionType}\n             */\n            type: function (value) {\n              var options = this.options;\n\n              if (value) {\n                if (value !== options.type) {\n                  options.type = value;\n\n                  this._initRouter();\n\n                  this.refresh();\n                }\n              } else {\n                return options.type;\n              }\n            },\n            _initRouter: function () {\n              var type = (this.options.type || \"\").toLowerCase();\n\n              if (type == CASCADING) {\n                this._router = new CascadingRouter(this);\n              } else {\n                this._router = new PolylineRouter(this);\n              }\n            },\n\n            /**\n             * Gets or sets the collection of *intermediate* points.\n             * The 'allPoints()' property will return all the points.\n             * The 'definers' property returns the definers of the intermediate points.\n             * The 'sourceDefiner' and 'targetDefiner' return the definers of the endpoints.\n             * @param value\n             */\n            points: function (value) {\n              if (value) {\n                this.definers = [];\n\n                for (var i = 0; i < value.length; i++) {\n                  var definition = value[i];\n\n                  if (definition instanceof diagram.Point) {\n                    this.definers.push(new diagram.PathDefiner(definition));\n                  } else if (definition.hasOwnProperty(\"x\") && definition.hasOwnProperty(\"y\")) {\n                    // e.g. Clipboard does not preserve the Point definition and tunred into an Object\n                    this.definers.push(new diagram.PathDefiner(new Point(definition.x, definition.y)));\n                  } else {\n                    throw \"A Connection point needs to be a Point or an object with x and y properties.\";\n                  }\n                }\n              } else {\n                var pts = [];\n\n                if (isDefined(this.definers)) {\n                  for (var k = 0; k < this.definers.length; k++) {\n                    pts.push(this.definers[k].point);\n                  }\n                }\n\n                return pts;\n              }\n            },\n\n            /**\n             * Gets all the points of this connection. This is the combination of the sourcePoint, the points and the targetPoint.\n             * @returns {Array}\n             */\n            allPoints: function () {\n              var pts = [this.sourcePoint()];\n\n              if (this.definers) {\n                for (var k = 0; k < this.definers.length; k++) {\n                  pts.push(this.definers[k].point);\n                }\n              }\n\n              pts.push(this.targetPoint());\n              return pts;\n            },\n            refresh: function () {\n              this._resolveConnectors();\n\n              this._refreshPath();\n\n              this._alignContent();\n\n              if (this.adorner) {\n                this.adorner.refresh();\n              }\n            },\n            _resolveConnectors: function () {\n              var connection = this,\n                  sourcePoint,\n                  targetPoint,\n                  sourceConnectors,\n                  targetConnectors,\n                  source = connection.source(),\n                  target = connection.target();\n\n              if (source instanceof Point) {\n                sourcePoint = source;\n              } else if (source instanceof Connector) {\n                if (isAutoConnector(source)) {\n                  sourceConnectors = source.shape.connectors;\n                } else {\n                  sourceConnectors = [source];\n                }\n              }\n\n              if (target instanceof Point) {\n                targetPoint = target;\n              } else if (target instanceof Connector) {\n                if (isAutoConnector(target)) {\n                  targetConnectors = target.shape.connectors;\n                } else {\n                  targetConnectors = [target];\n                }\n              }\n\n              if (sourcePoint) {\n                if (targetConnectors) {\n                  connection._resolvedTargetConnector = closestConnector(sourcePoint, targetConnectors);\n                }\n              } else if (sourceConnectors) {\n                if (targetPoint) {\n                  connection._resolvedSourceConnector = closestConnector(targetPoint, sourceConnectors);\n                } else if (targetConnectors) {\n                  this._resolveAutoConnectors(sourceConnectors, targetConnectors);\n                }\n              }\n            },\n            _resolveAutoConnectors: function (sourceConnectors, targetConnectors) {\n              var minNonConflict = MAXINT;\n              var minDist = MAXINT;\n              var minNonConflictSource, minNonConflictTarget;\n              var sourcePoint, targetPoint;\n              var minSource, minTarget;\n              var sourceConnector, targetConnector;\n              var sourceIdx, targetIdx;\n              var dist;\n\n              for (sourceIdx = 0; sourceIdx < sourceConnectors.length; sourceIdx++) {\n                sourceConnector = sourceConnectors[sourceIdx];\n\n                if (!isAutoConnector(sourceConnector)) {\n                  sourcePoint = sourceConnector.position();\n\n                  for (targetIdx = 0; targetIdx < targetConnectors.length; targetIdx++) {\n                    targetConnector = targetConnectors[targetIdx];\n\n                    if (!isAutoConnector(targetConnector)) {\n                      targetPoint = targetConnector.position();\n                      dist = math.round(sourcePoint.distanceTo(targetPoint));\n\n                      if (dist < minNonConflict && this.diagram && this._testRoutePoints(sourcePoint, targetPoint, sourceConnector, targetConnector)) {\n                        minNonConflict = dist;\n                        minNonConflictSource = sourceConnector;\n                        minNonConflictTarget = targetConnector;\n                      }\n\n                      if (dist < minDist) {\n                        minSource = sourceConnector;\n                        minTarget = targetConnector;\n                        minDist = dist;\n                      }\n                    }\n                  }\n                }\n              }\n\n              if (minNonConflictSource) {\n                minSource = minNonConflictSource;\n                minTarget = minNonConflictTarget;\n              }\n\n              this._resolvedSourceConnector = minSource;\n              this._resolvedTargetConnector = minTarget;\n            },\n            _testRoutePoints: function (sourcePoint, targetPoint, sourceConnector, targetConnector) {\n              var router = this._router;\n              var passRoute = true;\n\n              if (router instanceof CascadingRouter) {\n                var points = router.routePoints(sourcePoint, targetPoint, sourceConnector, targetConnector),\n                    start,\n                    end,\n                    rect,\n                    exclude;\n                exclude = this._getRouteExclude(sourcePoint, targetPoint, sourceConnector.shape, targetConnector.shape);\n                points.unshift(sourcePoint);\n                points.push(targetPoint);\n\n                for (var idx = 1; idx < points.length; idx++) {\n                  start = points[idx - 1];\n                  end = points[idx];\n                  rect = new Rect(math.min(start.x, end.x), math.min(start.y, end.y), math.abs(start.x - end.x), math.abs(start.y - end.y));\n\n                  if (rect.width > 0) {\n                    rect.x++;\n                    rect.width -= 2;\n                  }\n\n                  if (rect.height > 0) {\n                    rect.y++;\n                    rect.height -= 2;\n                  }\n\n                  if (!rect.isEmpty() && this.diagram._shapesQuadTree.hitTestRect(rect, exclude)) {\n                    passRoute = false;\n                    break;\n                  }\n                }\n              }\n\n              return passRoute;\n            },\n            _getRouteExclude: function (sourcePoint, targetPoint, sourceShape, targetShape) {\n              var exclude = [];\n\n              if (this._isPointInsideShape(sourcePoint, sourceShape)) {\n                exclude.push(sourceShape);\n              }\n\n              if (this._isPointInsideShape(targetPoint, targetShape)) {\n                exclude.push(targetShape);\n              }\n\n              return exclude;\n            },\n            _isPointInsideShape: function (point, shape) {\n              var bounds = shape.bounds(),\n                  rotatedPoint,\n                  angle = shape.rotate().angle,\n                  pointX,\n                  pointY,\n                  boundsX = bounds.x,\n                  boundsY = bounds.y;\n              rotatedPoint = point.clone().rotate(bounds.center(), angle);\n              pointX = rotatedPoint.x;\n              pointY = rotatedPoint.y;\n              return pointX > boundsX && pointX < boundsX + bounds.width && pointY > boundsY && pointY < boundsY + bounds.height;\n            },\n            redraw: function (options) {\n              if (options) {\n                this.options = deepExtend({}, this.options, options);\n                var points = this.options.points;\n\n                if (defined(points) && points.length > 0) {\n                  this.points(points);\n\n                  this._refreshPath();\n                }\n\n                if (options && options.content || options.text) {\n                  this.content(options.content);\n                }\n\n                this.path.redraw({\n                  fill: options.fill,\n                  stroke: options.stroke,\n                  startCap: options.startCap,\n                  endCap: options.endCap\n                });\n              }\n            },\n\n            /**\n             * Returns a clone of this connection.\n             * @returns {Connection}\n             */\n            clone: function () {\n              var json = this.serialize();\n\n              if (this.diagram && this.diagram._isEditable && defined(this.dataItem)) {\n                json.options.dataItem = cloneDataItem(this.dataItem);\n              }\n\n              return new Connection(this.from, this.to, json.options);\n            },\n\n            /**\n             * Returns a serialized connection in json format. Consist of the options and the dataItem.\n             * @returns {Connection}\n             */\n            serialize: function () {\n              var from = this.from.toJSON ? this.from.toJSON : this.from.toString(),\n                  to = this.to.toJSON ? this.to.toJSON : this.to.toString();\n              var json = deepExtend({}, {\n                options: this.options,\n                from: from,\n                to: to\n              });\n\n              if (defined(this.dataItem)) {\n                json.dataItem = this.dataItem.toString();\n              }\n\n              json.options.points = this.points();\n              return json;\n            },\n\n            /**\n             * Returns whether the given Point or Rect hits this connection.\n             * @param value\n             * @returns {Connection}\n             * @private\n             */\n            _hitTest: function (value) {\n              if (this.visible()) {\n                var p = new Point(value.x, value.y),\n                    from = this.sourcePoint(),\n                    to = this.targetPoint();\n\n                if (value.isEmpty && !value.isEmpty() && value.contains(from) && value.contains(to)) {\n                  return this;\n                }\n\n                if (this._router.hitTest(p)) {\n                  return this;\n                }\n              }\n            },\n            _hover: function (value) {\n              var color = (this.options.stroke || {}).color;\n\n              if (value && isDefined(this.options.hover.stroke.color)) {\n                color = this.options.hover.stroke.color;\n              }\n\n              this.path.redraw({\n                stroke: {\n                  color: color\n                }\n              });\n            },\n            _refreshPath: function () {\n              if (!defined(this.path)) {\n                return;\n              }\n\n              this._drawPath();\n\n              this.bounds(this._router.getBounds());\n            },\n            _drawPath: function () {\n              if (this._router) {\n                this._router.route(); // sets the intermediate points\n\n              }\n\n              var source = this.sourcePoint();\n              var target = this.targetPoint();\n              var points = this.points();\n              this.path.redraw({\n                points: [source].concat(points, [target])\n              });\n            },\n            _clearSourceConnector: function () {\n              this.sourceConnector = undefined;\n              this._resolvedSourceConnector = undefined;\n            },\n            _clearTargetConnector: function () {\n              this.targetConnector = undefined;\n              this._resolvedTargetConnector = undefined;\n            },\n            _removeFromSourceConnector: function () {\n              if (this.sourceConnector) {\n                Utils.remove(this.sourceConnector.connections, this);\n              }\n            },\n            _removeFromTargetConnector: function () {\n              if (this.targetConnector) {\n                Utils.remove(this.targetConnector.connections, this);\n              }\n            },\n            toJSON: function () {\n              var connection = this;\n              var from, to, point;\n\n              if (connection.from && connection.from.toJSON) {\n                from = connection.from.toJSON();\n              } else {\n                point = connection._sourcePoint;\n                from = {\n                  x: point.x,\n                  y: point.y\n                };\n              }\n\n              if (connection.to && connection.to.toJSON) {\n                to = connection.to.toJSON();\n              } else {\n                point = connection._targetPoint;\n                to = {\n                  x: point.x,\n                  y: point.y\n                };\n              }\n\n              return {\n                from: from,\n                to: to\n              };\n            }\n          });\n          var Diagram = Widget.extend({\n            init: function (element, userOptions) {\n              var that = this;\n              kendo.destroy(element);\n              Widget.fn.init.call(that, element, userOptions);\n\n              that._initTheme();\n\n              that._initElements();\n\n              that._extendLayoutOptions(that.options);\n\n              that._initDefaults(userOptions);\n\n              that._interactionDefaults();\n\n              that._initCanvas();\n\n              that.mainLayer = new Group({\n                id: \"main-layer\"\n              });\n              that.canvas.append(that.mainLayer);\n              that._shapesQuadTree = new ShapesQuadTree(that);\n              that._pan = new Point();\n              that._adorners = [];\n              that.adornerLayer = new Group({\n                id: \"adorner-layer\"\n              });\n              that.canvas.append(that.adornerLayer);\n\n              that._createHandlers();\n\n              that._initialize();\n\n              that._resizingAdorner = new ResizingAdorner(that, {\n                editable: that.options.editable\n              });\n              that._connectorsAdorner = new ConnectorsAdorner(that);\n\n              that._adorn(that._resizingAdorner, true);\n\n              that._adorn(that._connectorsAdorner, true);\n\n              that.selector = new Selector(that); // TODO: We may consider using real Clipboard API once is supported by the standard.\n\n              that._clipboard = [];\n              that.pauseMouseHandlers = false;\n\n              that._fetchFreshData();\n\n              that._createGlobalToolBar();\n\n              that._createOptionElements();\n\n              that.zoom(that.options.zoom);\n              that.canvas.draw();\n            },\n            options: {\n              name: \"Diagram\",\n              theme: \"default\",\n              layout: \"\",\n              zoomRate: 0.1,\n              zoom: 1,\n              zoomMin: 0,\n              zoomMax: 2,\n              dataSource: {},\n              draggable: true,\n              template: \"\",\n              autoBind: true,\n              editable: {\n                rotate: {},\n                resize: {},\n                text: true,\n                tools: [],\n                drag: {\n                  snap: {\n                    size: 10,\n                    angle: 10\n                  }\n                },\n                remove: true\n              },\n              pannable: {},\n              selectable: {\n                key: \"none\"\n              },\n              tooltip: {\n                enabled: true,\n                format: \"{0}\"\n              },\n              copy: {\n                enabled: true,\n                offsetX: 20,\n                offsetY: 20\n              },\n              shapeDefaults: diagram.shapeDefaults({\n                undoable: true\n              }),\n              connectionDefaults: {\n                editable: {\n                  tools: []\n                },\n                type: CASCADING\n              },\n              shapes: [],\n              connections: []\n            },\n            events: [ZOOM_END, ZOOM_START, PAN, SELECT, ITEMROTATE, ITEMBOUNDSCHANGE, CHANGE, CLICK, MOUSE_ENTER, MOUSE_LEAVE, \"toolBarClick\", \"save\", \"cancel\", \"edit\", \"remove\", \"add\", \"dataBound\", DRAG_START, DRAG, DRAG_END],\n            items: function () {\n              return $();\n            },\n            _createGlobalToolBar: function () {\n              var editable = this.options.editable;\n\n              if (editable) {\n                var tools = editable.tools;\n\n                if (this._isEditable && tools !== false && (!tools || tools.length === 0)) {\n                  tools = [\"createShape\", \"undo\", \"redo\", \"rotateClockwise\", \"rotateAnticlockwise\"];\n                }\n\n                if (tools && tools.length) {\n                  this.toolBar = new DiagramToolBar(this, {\n                    tools: tools || {},\n                    click: this._toolBarClick.bind(this),\n                    modal: false\n                  });\n                  this.toolBar.element.css({\n                    textAlign: \"left\"\n                  });\n                  this.element.prepend(this.toolBar.element);\n\n                  this._resize();\n                }\n              }\n            },\n            createShape: function () {\n              if (this.editor && this.editor.end() || !this.editor) {\n                var dataSource = this.dataSource;\n                var view = dataSource.view() || [];\n                var index = view.length;\n                var model = createModel(dataSource, {});\n\n                var shape = this._createShape(model, {});\n\n                if (!this.trigger(\"add\", {\n                  shape: shape\n                })) {\n                  dataSource.insert(index, model);\n\n                  var inactiveItem = this._inactiveShapeItems.getByUid(model.uid);\n\n                  inactiveItem.element = shape;\n                  this.edit(shape);\n                }\n              }\n            },\n            _createShape: function (dataItem, options) {\n              options = deepExtend({}, this.options.shapeDefaults, options);\n              options.dataItem = dataItem;\n              var shape = new Shape(options, this);\n              return shape;\n            },\n            createConnection: function () {\n              if (this.editor && this.editor.end() || !this.editor) {\n                var connectionsDataSource = this.connectionsDataSource;\n                var view = connectionsDataSource.view() || [];\n                var index = view.length;\n                var model = createModel(connectionsDataSource, {});\n\n                var connection = this._createConnection(model);\n\n                if (!this.trigger(\"add\", {\n                  connection: connection\n                })) {\n                  this._connectionsDataMap[model.uid] = connection;\n                  connectionsDataSource.insert(index, model);\n                  this.addConnection(connection, false);\n                  this.edit(connection);\n                }\n              }\n            },\n            _createConnection: function (dataItem, source, target) {\n              var options = deepExtend({}, this.options.connectionDefaults);\n              options.dataItem = dataItem;\n              var connection = new Connection(source || new Point(), target || new Point(), options);\n              return connection;\n            },\n            editModel: function (dataItem, editorType) {\n              this.cancelEdit();\n              var editors, template;\n              var editable = this.options.editable;\n\n              if (editorType == \"shape\") {\n                editors = editable.shapeEditors;\n                template = editable.shapeTemplate;\n              } else if (editorType == \"connection\") {\n                var connectionSelectorHandler = connectionSelector.bind(this);\n                editors = deepExtend({}, {\n                  from: connectionSelectorHandler,\n                  to: connectionSelectorHandler\n                }, editable.connectionEditors);\n                template = editable.connectionTemplate;\n              } else {\n                return;\n              }\n\n              this.editor = new PopupEditor(this.element, {\n                update: this._update.bind(this),\n                cancel: this._cancel.bind(this),\n                model: dataItem,\n                type: editorType,\n                target: this,\n                editors: editors,\n                template: template\n              });\n              this.trigger(\"edit\", this._editArgs());\n            },\n            edit: function (item) {\n              if (item.dataItem) {\n                var editorType = item instanceof Shape ? \"shape\" : \"connection\";\n                this.editModel(item.dataItem, editorType);\n              }\n            },\n            cancelEdit: function () {\n              if (this.editor) {\n                this._getEditDataSource().cancelChanges(this.editor.model);\n\n                this._destroyEditor();\n              }\n            },\n            saveEdit: function () {\n              if (this.editor && this.editor.end() && !this.trigger(\"save\", this._editArgs())) {\n                this._getEditDataSource().sync();\n              }\n            },\n            _update: function () {\n              if (this.editor && this.editor.end() && !this.trigger(\"save\", this._editArgs())) {\n                this._getEditDataSource().sync();\n\n                this._destroyEditor();\n              }\n            },\n            _cancel: function () {\n              if (this.editor && !this.trigger(\"cancel\", this._editArgs())) {\n                var model = this.editor.model;\n\n                this._getEditDataSource().cancelChanges(model);\n\n                var element = this._connectionsDataMap[model.uid] || this._dataMap[model.id];\n\n                if (element) {\n                  element._setOptionsFromModel(model);\n                }\n\n                this._destroyEditor();\n              }\n            },\n            _getEditDataSource: function () {\n              return this.editor.options.type === \"shape\" ? this.dataSource : this.connectionsDataSource;\n            },\n            _editArgs: function () {\n              var result = {\n                container: this.editor.wrapper\n              };\n              result[this.editor.options.type] = this.editor.model;\n              return result;\n            },\n            _destroyEditor: function () {\n              if (this.editor) {\n                this.editor.close();\n                this.editor = null;\n              }\n            },\n            _initElements: function () {\n              this.wrapper = this.element.empty().css(\"position\", \"relative\").attr(\"tabindex\", 0).addClass(\"k-widget k-diagram\");\n              this.scrollable = $(\"<div />\").appendTo(this.element);\n            },\n            _initDefaults: function (userOptions) {\n              var options = this.options;\n              var editable = options.editable;\n              var shapeDefaults = options.shapeDefaults;\n              var connectionDefaults = options.connectionDefaults;\n              var userShapeDefaults = (userOptions || {}).shapeDefaults;\n\n              if (editable === false) {\n                shapeDefaults.editable = false;\n                connectionDefaults.editable = false;\n              } else {\n                copyDefaultOptions(editable, shapeDefaults.editable, [\"drag\", \"remove\", \"connect\"]);\n                copyDefaultOptions(editable, connectionDefaults.editable, [\"drag\", \"remove\"]);\n              }\n\n              if (userShapeDefaults && userShapeDefaults.connectors) {\n                options.shapeDefaults.connectors = userShapeDefaults.connectors;\n              }\n            },\n            _interactionDefaults: function () {\n              var options = this.options;\n              var selectable = options.selectable;\n              var pannable = options.pannable;\n              var mobile = kendo.support.mobileOS;\n\n              if (selectable && !defined(selectable.multiple)) {\n                options.selectable = deepExtend({\n                  multiple: mobile ? false : true\n                }, options.selectable);\n              }\n\n              if (pannable && !defined(pannable.key)) {\n                options.pannable = deepExtend({\n                  key: mobile ? \"none\" : \"ctrl\"\n                }, options.pannable);\n              }\n            },\n            _initCanvas: function () {\n              var canvasContainer = $(\"<div class='k-layer'></div>\").appendTo(this.scrollable)[0];\n              var viewPort = this.viewport();\n              this.canvas = new Canvas(canvasContainer, {\n                width: viewPort.width || DEFAULT_CANVAS_WIDTH,\n                height: viewPort.height || DEFAULT_CANVAS_HEIGHT\n              });\n            },\n            _createHandlers: function () {\n              var that = this;\n              var element = that.element;\n              element.on(MOUSEWHEEL_NS, that._wheel.bind(that)).on(\"keydown\" + NS, that._keydown.bind(that));\n              that._userEvents = new kendo.UserEvents(this.scrollable, {\n                multiTouch: true,\n                fastTap: true,\n                tap: that._tap.bind(that),\n                start: that._dragStart.bind(that),\n                move: that._drag.bind(that),\n                end: that._dragEnd.bind(that),\n                gesturestart: that._gestureStart.bind(that),\n                gesturechange: that._gestureChange.bind(that),\n                gestureend: that._gestureEnd.bind(that),\n                doubleTap: that._doubleTap.bind(that),\n                supportDoubleTap: true\n              });\n              that.toolService = new ToolService(that);\n              this.scrollable.on(\"mouseover\" + NS, that._mouseover.bind(that)).on(\"mouseout\" + NS, that._mouseout.bind(that)).on(\"mousemove\" + NS, that._mouseMove.bind(that)).on(\"mousedown\" + NS, that._mouseDown.bind(that)).on(\"mouseup\" + NS, that._mouseUp.bind(that));\n              this._syncHandler = that._syncChanges.bind(that);\n              that._resizeHandler = that.resize.bind(that, false);\n              kendo.onResize(that._resizeHandler);\n              this.bind(ZOOM_START, that._destroyToolBar.bind(that));\n              this.bind(PAN, that._destroyToolBar.bind(that));\n            },\n            _dragStart: function (e) {\n              this._pauseMouseHandlers = true;\n\n              var point = this._eventPositions(e, true);\n\n              var event = e.event;\n\n              if (this.toolService.start(point, this._meta(event))) {\n                this._destroyToolBar();\n\n                event.preventDefault();\n              }\n            },\n            _drag: function (e) {\n              var p = this._eventPositions(e);\n\n              var event = e.event;\n\n              if (this.toolService.move(p, this._meta(event))) {\n                event.preventDefault();\n              }\n            },\n            _dragEnd: function (e) {\n              this._pauseMouseHandlers = false;\n\n              var p = this._eventPositions(e);\n\n              var event = e.event;\n\n              if (this.toolService.end(p, this._meta(event))) {\n                this._createToolBar();\n\n                event.preventDefault();\n              }\n            },\n            _mouseMove: function (e) {\n              if (!this._pauseMouseHandlers) {\n                var p = this._eventPositions(e);\n\n                this.toolService._updateHoveredItem(p);\n\n                this.toolService._updateCursor(p);\n              }\n            },\n            _mouseDown: function () {\n              this._pauseMouseHandlers = true;\n            },\n            _mouseUp: function () {\n              this._pauseMouseHandlers = false;\n            },\n            _tap: function (e) {\n              var toolService = this.toolService;\n              var selectable = this.options.selectable;\n\n              var point = this._eventPositions(e);\n\n              var focused = this.focus();\n\n              toolService._updateHoveredItem(point);\n\n              if (toolService.hoveredItem) {\n                var item = toolService.hoveredItem;\n                this.trigger(\"click\", {\n                  item: item,\n                  point: point,\n                  meta: this._meta(e.event)\n                });\n\n                if (selectable && item.options.selectable !== false) {\n                  var multiple = selectable.multiple !== false;\n\n                  var ctrlPressed = kendo.support.mobileOS || this._meta(e.event).ctrlKey;\n\n                  if (item.isSelected) {\n                    if (ctrlPressed) {\n                      this._destroyToolBar();\n\n                      item.select(false);\n                    } else {\n                      this._createToolBar(focused);\n                    }\n                  } else {\n                    this._destroyToolBar();\n\n                    this.select(item, {\n                      addToSelection: multiple && ctrlPressed\n                    });\n\n                    this._createToolBar(focused);\n                  }\n                }\n              } else if (selectable) {\n                this._destroyToolBar();\n\n                this.deselect();\n              }\n            },\n            _keydown: function (e) {\n              if (this.toolService.keyDown(e.keyCode, this._meta(e))) {\n                e.preventDefault();\n              }\n            },\n            _wheel: function (e) {\n              var delta = mwDelta(e),\n                  p = this._eventPositions(e),\n                  meta = deepExtend(this._meta(e), {\n                delta: delta\n              });\n\n              if (this.toolService.wheel(p, meta)) {\n                e.preventDefault();\n              }\n            },\n            _meta: function (e) {\n              return {\n                ctrlKey: e.ctrlKey,\n                metaKey: e.metaKey,\n                altKey: e.altKey,\n                shiftKey: e.shiftKey,\n                type: e.type\n              };\n            },\n            _eventPositions: function (e, start) {\n              var point;\n\n              if (e.touch) {\n                var field = start ? \"startLocation\" : \"location\";\n                point = new Point(e.x[field], e.y[field]);\n              } else {\n                var event = e.originalEvent;\n                point = new Point(event.pageX, event.pageY);\n              }\n\n              return this.documentToModel(point);\n            },\n            _gestureStart: function (e) {\n              this._destroyToolBar();\n\n              this.scroller.disable();\n              var initialCenter = this.documentToModel(new Point(e.center.x, e.center.y));\n              var eventArgs = {\n                point: initialCenter,\n                zoom: this.zoom()\n              };\n\n              if (this.trigger(ZOOM_START, eventArgs)) {\n                return;\n              }\n\n              this._gesture = e;\n              this._initialCenter = initialCenter;\n            },\n            _gestureChange: function (e) {\n              var previousGesture = this._gesture;\n              var initialCenter = this._initialCenter;\n              var center = this.documentToView(new Point(e.center.x, e.center.y));\n              var scaleDelta = e.distance / previousGesture.distance;\n              var zoom = this._zoom;\n              var updateZoom = false;\n\n              if (math.abs(scaleDelta - 1) >= MOBILE_ZOOM_RATE) {\n                this._zoom = zoom = this._getValidZoom(zoom * scaleDelta);\n                this.options.zoom = zoom;\n                this._gesture = e;\n                updateZoom = true;\n              }\n\n              var zoomedPoint = initialCenter.times(zoom);\n              var pan = center.minus(zoomedPoint);\n\n              if (updateZoom || this._pan.distanceTo(pan) >= MOBILE_PAN_DISTANCE) {\n                this._panTransform(pan);\n\n                this._updateAdorners();\n              }\n\n              e.preventDefault();\n            },\n            _doubleTap: function (e) {\n              var diagram = this;\n\n              var pointPosition = this._eventPositions(e);\n\n              var options = diagram.options;\n              var zoomRate = options.zoomRate;\n              var zoom = diagram.zoom() + zoomRate;\n\n              var meta = this._meta(e);\n\n              var zoomOptions = {\n                point: pointPosition,\n                meta: meta,\n                zoom: zoom\n              };\n\n              if (diagram.trigger(ZOOM_START, zoomOptions)) {\n                return;\n              }\n\n              zoom = kendo.dataviz.round(Math.max(options.zoomMin, Math.min(options.zoomMax, zoom)), 2);\n              zoomOptions.zoom = zoom;\n              diagram.zoom(zoom, zoomOptions);\n              diagram.trigger(ZOOM_END, zoomOptions);\n            },\n            _gestureEnd: function () {\n              if (this.options.pannable !== false) {\n                this.scroller.enable();\n              }\n\n              this.trigger(ZOOM_END, {\n                point: this._initialCenter,\n                zoom: this.zoom()\n              });\n            },\n            _resize: function () {\n              var viewport = this.viewport();\n\n              if (this.canvas) {\n                this.canvas.size(viewport);\n              }\n\n              if (this.scrollable && this.toolBar) {\n                this.scrollable.height(viewport.height);\n              }\n            },\n            _mouseover: function (e) {\n              var node = e.target._kendoNode;\n\n              if (node && node.srcElement._hover) {\n                node.srcElement._hover(true, node.srcElement);\n              }\n            },\n            _mouseout: function (e) {\n              var node = e.target._kendoNode;\n\n              if (node && node.srcElement._hover) {\n                node.srcElement._hover(false, node.srcElement);\n              }\n            },\n            _initTheme: function () {\n              var that = this;\n              var themeName = ((that.options || {}).theme || \"\").toLowerCase();\n              var themes = dataviz.ui.themes || {};\n              var themeOptions;\n\n              if (dataviz.SASS_THEMES.indexOf(themeName) != -1) {\n                themeOptions = dataviz.autoTheme().diagram;\n              } else {\n                themeOptions = (themes[themeName] || {}).diagram;\n              }\n\n              that.options = deepExtend({}, themeOptions, that.options);\n\n              if (that.options.editable === true) {\n                deepExtend(that.options, {\n                  editable: (themeOptions || {}).editable\n                });\n              }\n            },\n            _createOptionElements: function () {\n              var options = this.options;\n              var shapesLength = options.shapes.length;\n\n              if (shapesLength) {\n                this._createShapes();\n              }\n\n              if (options.connections.length) {\n                this._createConnections();\n              }\n\n              if (shapesLength && options.layout) {\n                this.layout(options.layout);\n              }\n            },\n            _createShapes: function () {\n              var that = this,\n                  options = that.options,\n                  shapes = options.shapes,\n                  shape,\n                  i;\n\n              for (i = 0; i < shapes.length; i++) {\n                shape = shapes[i];\n                that.addShape(shape);\n              }\n            },\n            _createConnections: function () {\n              var diagram = this,\n                  options = diagram.options,\n                  defaults = options.connectionDefaults,\n                  connections = options.connections,\n                  conn,\n                  source,\n                  target,\n                  i;\n\n              for (i = 0; i < connections.length; i++) {\n                conn = connections[i];\n                source = diagram._findConnectionTarget(conn.from);\n                target = diagram._findConnectionTarget(conn.to);\n                diagram.connect(source, target, deepExtend({}, defaults, conn));\n              }\n            },\n            _findConnectionTarget: function (options) {\n              options = options || {};\n              var diagram = this;\n              var shapeId = isString(options) ? options : options.shapeId || options.id;\n              var target;\n\n              if (shapeId) {\n                target = diagram.getShapeById(shapeId);\n\n                if (options.connector) {\n                  target = target.getConnector(options.connector);\n                }\n              } else {\n                target = new Point(options.x || 0, options.y || 0);\n              }\n\n              return target;\n            },\n            destroy: function () {\n              var that = this;\n              Widget.fn.destroy.call(that);\n\n              if (this._userEvents) {\n                this._userEvents.destroy();\n              }\n\n              kendo.unbindResize(that._resizeHandler);\n              that.clear();\n              that.element.off(NS);\n              that.scroller.wrapper.off(NS);\n              that.canvas.destroy(true);\n              that.canvas = undefined;\n\n              that._destroyEditor();\n\n              that.destroyScroller();\n\n              that._destroyGlobalToolBar();\n\n              that._destroyToolBar();\n            },\n            destroyScroller: function () {\n              var scroller = this.scroller;\n\n              if (!scroller) {\n                return;\n              }\n\n              scroller.destroy();\n              scroller.element.remove();\n              this.scroller = null;\n            },\n            save: function () {\n              var json = {\n                shapes: [],\n                connections: []\n              };\n              var i, connection, shape;\n\n              for (i = 0; i < this.shapes.length; i++) {\n                shape = this.shapes[i];\n\n                if (shape.options.serializable) {\n                  json.shapes.push(shape.options);\n                }\n              }\n\n              for (i = 0; i < this.connections.length; i++) {\n                connection = this.connections[i];\n                json.connections.push(deepExtend({}, connection.options, connection.toJSON()));\n              }\n\n              return json;\n            },\n            focus: function () {\n              if (!this.element.is(kendo._activeElement())) {\n                var element = this.element,\n                    scrollContainer = element[0],\n                    containers = [],\n                    offsets = [],\n                    documentElement = document.documentElement,\n                    i;\n\n                do {\n                  scrollContainer = scrollContainer.parentNode;\n\n                  if (scrollContainer.scrollHeight > scrollContainer.clientHeight) {\n                    containers.push(scrollContainer);\n                    offsets.push(scrollContainer.scrollTop);\n                  }\n                } while (scrollContainer != documentElement);\n\n                element.trigger(\"focus\");\n\n                for (i = 0; i < containers.length; i++) {\n                  containers[i].scrollTop = offsets[i];\n                }\n\n                return true;\n              }\n            },\n            load: function (options) {\n              this.clear();\n              this.setOptions(options);\n\n              this._createShapes();\n\n              this._createConnections();\n            },\n            setOptions: function (options) {\n              deepExtend(this.options, options);\n            },\n            clear: function () {\n              var that = this;\n              that.select(false);\n              that.mainLayer.clear();\n\n              that._shapesQuadTree.clear();\n\n              that._initialize();\n            },\n\n            /**\n             * Connects two items.\n             * @param source Shape, Connector, Point.\n             * @param target Shape, Connector, Point.\n             * @param options Connection options that will be passed to the newly created connection.\n             * @returns The newly created connection.\n             */\n            connect: function (source, target, options) {\n              var connection;\n\n              if (this.connectionsDataSource && this._isEditable) {\n                var dataItem = this.connectionsDataSource.add({});\n                connection = this._connectionsDataMap[dataItem.uid];\n                connection.source(source);\n                connection.target(target);\n                connection.redraw(options);\n                connection.updateModel();\n              } else {\n                connection = new Connection(source, target, deepExtend({}, this.options.connectionDefaults, options));\n                this.addConnection(connection);\n              }\n\n              return connection;\n            },\n\n            /**\n             * Determines whether the the two items are connected.\n             * @param source Shape, Connector, Point.\n             * @param target Shape, Connector, Point.\n             * @returns true if the two items are connected.\n             */\n            connected: function (source, target) {\n              for (var i = 0; i < this.connections.length; i++) {\n                var c = this.connections[i];\n\n                if (c.from == source && c.to == target) {\n                  return true;\n                }\n              }\n\n              return false;\n            },\n\n            /**\n             * Adds connection to the diagram.\n             * @param connection Connection.\n             * @param undoable Boolean.\n             * @returns The newly created connection.\n             */\n            addConnection: function (connection, undoable) {\n              if (undoable !== false) {\n                this.undoRedoService.add(new diagram.AddConnectionUnit(connection, this), false);\n              }\n\n              connection.diagram = this;\n\n              connection._setOptionsFromModel();\n\n              connection.refresh();\n              this.mainLayer.append(connection.visual);\n              this.connections.push(connection);\n              this.trigger(CHANGE, {\n                added: [connection],\n                removed: []\n              });\n              return connection;\n            },\n            _addConnection: function (connection, undoable) {\n              var connectionsDataSource = this.connectionsDataSource;\n              var dataItem;\n\n              if (connectionsDataSource && this._isEditable) {\n                dataItem = createModel(connectionsDataSource, cloneDataItem(connection.dataItem));\n                connection.dataItem = dataItem;\n                connection.updateModel();\n\n                if (!this.trigger(\"add\", {\n                  connection: connection\n                })) {\n                  this._connectionsDataMap[dataItem.uid] = connection;\n                  connectionsDataSource.add(dataItem);\n                  this.addConnection(connection, undoable);\n\n                  connection._updateConnectors();\n\n                  return connection;\n                }\n              } else if (!this.trigger(\"add\", {\n                connection: connection\n              })) {\n                this.addConnection(connection, undoable);\n\n                connection._updateConnectors();\n\n                return connection;\n              }\n            },\n\n            /**\n             * Adds shape to the diagram.\n             * @param item Shape, Point. If point is passed it will be created new Shape and positioned at that point.\n             * @param options. The options to be passed to the newly created Shape.\n             * @returns The newly created shape.\n             */\n            addShape: function (item, undoable) {\n              var shape,\n                  shapeDefaults = this.options.shapeDefaults;\n\n              if (item instanceof Shape) {\n                shape = item;\n\n                this._parseBounds(shape.bounds());\n              } else if (!(item instanceof kendo.Class)) {\n                shapeDefaults = deepExtend({}, shapeDefaults, item || {});\n                shape = new Shape(shapeDefaults, this);\n\n                this._parseBounds(shape.bounds());\n              } else {\n                return;\n              }\n\n              if (undoable !== false) {\n                this.undoRedoService.add(new diagram.AddShapeUnit(shape, this), false);\n              }\n\n              this.shapes.push(shape);\n\n              if (shape.diagram !== this) {\n                this._shapesQuadTree.insert(shape);\n\n                shape.diagram = this;\n              }\n\n              this.mainLayer.append(shape.visual);\n              this.trigger(CHANGE, {\n                added: [shape],\n                removed: []\n              });\n              return shape;\n            },\n            _addShape: function (shape, undoable) {\n              var that = this;\n              var dataSource = that.dataSource;\n              var dataItem;\n\n              if (dataSource && this._isEditable) {\n                dataItem = createModel(dataSource, cloneDataItem(shape.dataItem));\n                shape.dataItem = dataItem;\n                shape.updateModel();\n\n                if (!this.trigger(\"add\", {\n                  shape: shape\n                })) {\n                  this.dataSource.add(dataItem);\n\n                  var inactiveItem = this._inactiveShapeItems.getByUid(dataItem.uid);\n\n                  inactiveItem.element = shape;\n                  inactiveItem.undoable = undoable;\n                  return shape;\n                }\n              } else if (!this.trigger(\"add\", {\n                shape: shape\n              })) {\n                return this.addShape(shape, undoable);\n              }\n            },\n            _parseBounds: function (bounds) {\n              bounds.x = typeof bounds.x == \"string\" ? parseFloat(bounds.x) : bounds.x;\n              bounds.y = typeof bounds.y == \"string\" ? parseFloat(bounds.y) : bounds.y;\n            },\n\n            /**\n             * Removes items (or single item) from the diagram.\n             * @param items DiagramElement, Array of Items.\n             * @param undoable.\n             */\n            remove: function (items, undoable) {\n              items = isArray(items) ? items.slice(0) : [items];\n              var elements = splitDiagramElements(items);\n              var shapes = elements.shapes;\n              var connections = elements.connections;\n              var i;\n\n              if (!defined(undoable)) {\n                undoable = true;\n              }\n\n              if (undoable) {\n                this.undoRedoService.begin();\n              }\n\n              this._suspendModelRefresh();\n\n              for (i = shapes.length - 1; i >= 0; i--) {\n                this._removeItem(shapes[i], undoable, connections);\n              }\n\n              for (i = connections.length - 1; i >= 0; i--) {\n                this._removeItem(connections[i], undoable);\n              }\n\n              this._resumeModelRefresh();\n\n              if (undoable) {\n                this.undoRedoService.commit(false);\n              }\n\n              this.trigger(CHANGE, {\n                added: [],\n                removed: items\n              });\n            },\n            _removeShapeDataItem: function (item) {\n              if (this._isEditable) {\n                this.dataSource.remove(item.dataItem);\n                delete this._dataMap[item.dataItem.id];\n              }\n            },\n            _removeConnectionDataItem: function (item) {\n              if (this._isEditable) {\n                this.connectionsDataSource.remove(item.dataItem);\n                delete this._connectionsDataMap[item.dataItem.uid];\n              }\n            },\n            _triggerRemove: function (items) {\n              var toRemove = [];\n              var item, args, editable;\n\n              for (var idx = 0; idx < items.length; idx++) {\n                item = items[idx];\n                editable = item.options.editable;\n\n                if (item instanceof Shape) {\n                  args = {\n                    shape: item\n                  };\n                } else {\n                  args = {\n                    connection: item\n                  };\n                }\n\n                if (editable && editable.remove !== false && !this.trigger(\"remove\", args)) {\n                  toRemove.push(item);\n                }\n              }\n\n              return toRemove;\n            },\n\n            /**\n             * Executes the next undoable action on top of the undo stack if any.\n             */\n            undo: function () {\n              this.undoRedoService.undo();\n            },\n\n            /**\n             * Executes the previous undoable action on top of the redo stack if any.\n             */\n            redo: function () {\n              this.undoRedoService.redo();\n            },\n\n            /**\n             * Selects items on the basis of the given input or returns the current selection if none.\n             * @param itemsOrRect DiagramElement, Array of elements, \"All\", false or Rect. A value 'false' will deselect everything.\n             * @param options\n             * @returns {Array}\n             */\n            select: function (item, options) {\n              if (isDefined(item)) {\n                options = deepExtend({\n                  addToSelection: false\n                }, options);\n                var addToSelection = options.addToSelection,\n                    items = [],\n                    selected = [],\n                    i,\n                    element;\n\n                if (!addToSelection) {\n                  this.deselect();\n                }\n\n                this._internalSelection = true;\n\n                if (item instanceof Array) {\n                  items = item;\n                } else if (item instanceof DiagramElement) {\n                  items = [item];\n                }\n\n                for (i = 0; i < items.length; i++) {\n                  element = items[i];\n\n                  if (element.select(true)) {\n                    selected.push(element);\n                  }\n                }\n\n                this._selectionChanged(selected, []);\n\n                this._internalSelection = false;\n              } else {\n                return this._selectedItems;\n              }\n            },\n            selectAll: function () {\n              this.select(this.shapes.concat(this.connections));\n            },\n            selectArea: function (rect) {\n              var i, items, item;\n              this._internalSelection = true;\n              var selected = [];\n\n              if (rect instanceof Rect) {\n                items = this.shapes.concat(this.connections);\n\n                for (i = 0; i < items.length; i++) {\n                  item = items[i];\n\n                  if ((!rect || item._hitTest(rect)) && item.options.enable) {\n                    if (item.select(true)) {\n                      selected.push(item);\n                    }\n                  }\n                }\n              }\n\n              this._selectionChanged(selected, []);\n\n              this._internalSelection = false;\n            },\n            deselect: function (item) {\n              this._internalSelection = true;\n              var deselected = [],\n                  items = [],\n                  element,\n                  i;\n\n              if (item instanceof Array) {\n                items = item;\n              } else if (item instanceof DiagramElement) {\n                items.push(item);\n              } else if (!isDefined(item)) {\n                items = this._selectedItems.slice(0);\n              }\n\n              for (i = 0; i < items.length; i++) {\n                element = items[i];\n\n                if (element.select(false)) {\n                  deselected.push(element);\n                }\n              }\n\n              this._selectionChanged([], deselected);\n\n              this._internalSelection = false;\n            },\n\n            /**\n             * Brings to front the passed items.\n             * @param items DiagramElement, Array of Items.\n             * @param undoable. By default the action is undoable.\n             */\n            toFront: function (items, undoable) {\n              if (!items) {\n                items = this._selectedItems.slice();\n              }\n\n              var result = this._getDiagramItems(items),\n                  indices;\n\n              if (!defined(undoable) || undoable) {\n                indices = indicesOfItems(this.mainLayer, result.visuals);\n                var unit = new ToFrontUnit(this, items, indices);\n                this.undoRedoService.add(unit);\n              } else {\n                this.mainLayer.toFront(result.visuals);\n\n                this._fixOrdering(result, true);\n              }\n            },\n\n            /**\n             * Sends to back the passed items.\n             * @param items DiagramElement, Array of Items.\n             * @param undoable. By default the action is undoable.\n             */\n            toBack: function (items, undoable) {\n              if (!items) {\n                items = this._selectedItems.slice();\n              }\n\n              var result = this._getDiagramItems(items),\n                  indices;\n\n              if (!defined(undoable) || undoable) {\n                indices = indicesOfItems(this.mainLayer, result.visuals);\n                var unit = new ToBackUnit(this, items, indices);\n                this.undoRedoService.add(unit);\n              } else {\n                this.mainLayer.toBack(result.visuals);\n\n                this._fixOrdering(result, false);\n              }\n            },\n\n            /**\n             * Bring into view the passed item(s) or rectangle.\n             * @param items DiagramElement, Array of Items, Rect.\n             * @param options. align - controls the position of the calculated rectangle relative to the viewport.\n             * \"Center middle\" will position the items in the center. animate - controls if the pan should be animated.\n             */\n            bringIntoView: function (item, options) {\n              // jQuery|Item|Array|Rect\n              var viewport = this.viewport();\n              var aligner = new diagram.RectAlign(viewport);\n              var current, rect, original, newPan;\n\n              if (viewport.width === 0 || viewport.height === 0) {\n                return;\n              }\n\n              options = deepExtend({\n                animate: false,\n                align: \"center middle\"\n              }, options);\n\n              if (options.align == \"none\") {\n                options.align = \"center middle\";\n              }\n\n              if (item instanceof DiagramElement) {\n                rect = item.bounds(TRANSFORMED);\n              } else if (isArray(item)) {\n                rect = this.boundingBox(item);\n              } else if (item instanceof Rect) {\n                rect = item.clone();\n              }\n\n              original = rect.clone();\n              rect.zoom(this._zoom);\n\n              if (rect.width > viewport.width || rect.height > viewport.height) {\n                this._zoom = this._getValidZoom(math.min(viewport.width / original.width, viewport.height / original.height));\n                rect = original.clone().zoom(this._zoom);\n              }\n\n              this._zoomMainLayer();\n\n              current = rect.clone();\n              aligner.align(rect, options.align);\n              newPan = rect.topLeft().minus(current.topLeft());\n              this.pan(newPan.times(-1), options.animate);\n            },\n            alignShapes: function (direction) {\n              if (isUndefined(direction)) {\n                direction = \"Left\";\n              }\n\n              var items = this.select(),\n                  val,\n                  item,\n                  i;\n\n              if (items.length === 0) {\n                return;\n              }\n\n              switch (direction.toLowerCase()) {\n                case \"left\":\n                case \"top\":\n                  val = MAX_VALUE;\n                  break;\n\n                case \"right\":\n                case \"bottom\":\n                  val = MIN_VALUE;\n                  break;\n              }\n\n              for (i = 0; i < items.length; i++) {\n                item = items[i];\n\n                if (item instanceof Shape) {\n                  switch (direction.toLowerCase()) {\n                    case \"left\":\n                      val = math.min(val, item.options.x);\n                      break;\n\n                    case \"top\":\n                      val = math.min(val, item.options.y);\n                      break;\n\n                    case \"right\":\n                      val = math.max(val, item.options.x);\n                      break;\n\n                    case \"bottom\":\n                      val = math.max(val, item.options.y);\n                      break;\n                  }\n                }\n              }\n\n              var undoStates = [];\n              var shapes = [];\n\n              for (i = 0; i < items.length; i++) {\n                item = items[i];\n\n                if (item instanceof Shape) {\n                  shapes.push(item);\n                  undoStates.push(item.bounds());\n\n                  switch (direction.toLowerCase()) {\n                    case \"left\":\n                    case \"right\":\n                      item.position(new Point(val, item.options.y));\n                      break;\n\n                    case \"top\":\n                    case \"bottom\":\n                      item.position(new Point(item.options.x, val));\n                      break;\n                  }\n                }\n              }\n\n              var unit = new diagram.TransformUnit(shapes, undoStates);\n              this.undoRedoService.add(unit, false);\n            },\n            zoom: function (zoom, options) {\n              if (zoom) {\n                var staticPoint = options ? options.point : new diagram.Point(0, 0); // var meta = options ? options.meta : 0;\n\n                zoom = this._zoom = this._getValidZoom(zoom);\n\n                if (!isUndefined(staticPoint)) {\n                  //Viewpoint vector is constant\n                  staticPoint = new diagram.Point(math.round(staticPoint.x), math.round(staticPoint.y));\n                  var zoomedPoint = staticPoint.times(zoom);\n                  var viewportVector = this.modelToView(staticPoint);\n                  var raw = viewportVector.minus(zoomedPoint); //pan + zoomed point = viewpoint vector\n\n                  this._storePan(new diagram.Point(math.round(raw.x), math.round(raw.y)));\n                }\n\n                if (options) {\n                  options.zoom = zoom;\n                }\n\n                this._panTransform();\n\n                this.canvas.surface.hideTooltip();\n\n                this._updateAdorners();\n              }\n\n              return this._zoom;\n            },\n            _getPan: function (pan) {\n              var canvas = this.canvas;\n\n              if (!canvas.translate) {\n                pan = pan.plus(this._pan);\n              }\n\n              return pan;\n            },\n            pan: function (pan, animate) {\n              if (pan instanceof Point) {\n                var that = this;\n                var scroller = that.scroller;\n                pan = that._getPan(pan);\n                pan = pan.times(-1);\n\n                if (animate) {\n                  scroller.animatedScrollTo(pan.x, pan.y, function () {\n                    that._updateAdorners();\n                  });\n                } else {\n                  scroller.scrollTo(pan.x, pan.y);\n\n                  that._updateAdorners();\n                }\n              } else {\n                return this._pan.times(-1);\n              }\n            },\n            viewport: function () {\n              var element = this.element;\n              var width = element.width();\n              var height = element.height();\n\n              if (this.toolBar) {\n                height -= outerHeight(this.toolBar.element);\n              }\n\n              return new Rect(0, 0, width, height);\n            },\n            copy: function () {\n              if (this.options.copy.enabled) {\n                this._clipboard = [];\n                this._copyOffset = 1;\n\n                for (var i = 0; i < this._selectedItems.length; i++) {\n                  var item = this._selectedItems[i];\n\n                  this._clipboard.push(item);\n                }\n              }\n            },\n            cut: function () {\n              if (this.options.copy.enabled) {\n                this._clipboard = [];\n                this._copyOffset = 0;\n\n                for (var i = 0; i < this._selectedItems.length; i++) {\n                  var item = this._selectedItems[i];\n\n                  this._clipboard.push(item);\n                }\n\n                this.remove(this._clipboard, true);\n              }\n            },\n            paste: function () {\n              if (this._clipboard.length > 0) {\n                var item, copied, i;\n                var mapping = {};\n                var elements = splitDiagramElements(this._clipboard);\n                var connections = elements.connections;\n                var shapes = elements.shapes;\n                var offset = {\n                  x: this._copyOffset * this.options.copy.offsetX,\n                  y: this._copyOffset * this.options.copy.offsetY\n                };\n                this.deselect(); // first the shapes\n\n                for (i = 0; i < shapes.length; i++) {\n                  item = shapes[i];\n                  copied = item.clone();\n                  mapping[item.id] = copied;\n                  copied.position(new Point(item.options.x + offset.x, item.options.y + offset.y));\n                  copied.diagram = this;\n                  copied = this._addShape(copied);\n\n                  if (copied) {\n                    copied.select();\n                  }\n                } // then the connections\n\n\n                for (i = 0; i < connections.length; i++) {\n                  item = connections[i];\n                  copied = this._addConnection(item.clone());\n\n                  if (copied) {\n                    this._updateCopiedConnection(copied, item, \"source\", mapping, offset);\n\n                    this._updateCopiedConnection(copied, item, \"target\", mapping, offset);\n\n                    copied.select(true);\n                    copied.updateModel();\n                  }\n                }\n\n                this._syncChanges();\n\n                this._copyOffset += 1;\n              }\n            },\n            _updateCopiedConnection: function (connection, sourceConnection, connectorName, mapping, offset) {\n              var onActivate, inactiveItem, targetShape;\n              var target = sourceConnection[connectorName]();\n              var diagram = this;\n\n              if (target instanceof Connector && mapping[target.shape.id]) {\n                targetShape = mapping[target.shape.id];\n\n                if (diagram.getShapeById(targetShape.id)) {\n                  connection[connectorName](targetShape.getConnector(target.options.name));\n                } else {\n                  inactiveItem = diagram._inactiveShapeItems.getByUid(targetShape.dataItem.uid);\n\n                  if (inactiveItem) {\n                    onActivate = function (item) {\n                      targetShape = diagram._dataMap[item.id];\n                      connection[connectorName](targetShape.getConnector(target.options.name));\n                      connection.updateModel();\n                    };\n\n                    diagram._deferredConnectionUpdates.push(inactiveItem.onActivate(onActivate));\n                  }\n                }\n              } else {\n                connection[connectorName](new Point(sourceConnection[connectorName + \"Point\"]().x + offset.x, sourceConnection[connectorName + \"Point\"]().y + offset.y));\n              }\n            },\n\n            /**\n             * Gets the bounding rectangle of the given items.\n             * @param items DiagramElement, Array of elements.\n             * @param origin Boolean. Pass 'true' if you need to get the bounding box of the shapes without their rotation offset.\n             * @returns {Rect}\n             */\n            boundingBox: function (items, origin) {\n              var rect = Rect.empty(),\n                  temp,\n                  di = isDefined(items) ? this._getDiagramItems(items) : {\n                shapes: this.shapes\n              };\n\n              if (di.shapes.length > 0) {\n                var item = di.shapes[0];\n                rect = item.bounds(ROTATED);\n\n                for (var i = 1; i < di.shapes.length; i++) {\n                  item = di.shapes[i];\n                  temp = item.bounds(ROTATED);\n\n                  if (origin === true) {\n                    temp.x -= item._rotationOffset.x;\n                    temp.y -= item._rotationOffset.y;\n                  }\n\n                  rect = rect.union(temp);\n                }\n              }\n\n              return rect;\n            },\n            _containerOffset: function () {\n              var containerOffset = this.element.offset();\n\n              if (this.toolBar) {\n                containerOffset.top += outerHeight(this.toolBar.element);\n              }\n\n              return containerOffset;\n            },\n            documentToView: function (point) {\n              var containerOffset = this._containerOffset();\n\n              return new Point(point.x - containerOffset.left, point.y - containerOffset.top);\n            },\n            viewToDocument: function (point) {\n              var containerOffset = this._containerOffset();\n\n              return new Point(point.x + containerOffset.left, point.y + containerOffset.top);\n            },\n            viewToModel: function (point) {\n              return this._transformWithMatrix(point, this._matrixInvert);\n            },\n            modelToView: function (point) {\n              return this._transformWithMatrix(point, this._matrix);\n            },\n            modelToLayer: function (point) {\n              return this._transformWithMatrix(point, this._layerMatrix);\n            },\n            layerToModel: function (point) {\n              return this._transformWithMatrix(point, this._layerMatrixInvert);\n            },\n            documentToModel: function (point) {\n              var viewPoint = this.documentToView(point);\n\n              if (!this.canvas.translate) {\n                viewPoint.x = viewPoint.x + this.scroller.scrollLeft;\n                viewPoint.y = viewPoint.y + this.scroller.scrollTop;\n              }\n\n              return this.viewToModel(viewPoint);\n            },\n            modelToDocument: function (point) {\n              return this.viewToDocument(this.modelToView(point));\n            },\n            _transformWithMatrix: function (point, matrix) {\n              var result = point;\n\n              if (point instanceof Point) {\n                if (matrix) {\n                  result = matrix.apply(point);\n                }\n              } else {\n                var tl = this._transformWithMatrix(point.topLeft(), matrix),\n                    br = this._transformWithMatrix(point.bottomRight(), matrix);\n\n                result = Rect.fromPoints(tl, br);\n              }\n\n              return result;\n            },\n            setDataSource: function (dataSource) {\n              this.options.dataSource = dataSource;\n\n              this._dataSource();\n\n              if (this.options.autoBind) {\n                this.dataSource.fetch();\n              }\n            },\n            setConnectionsDataSource: function (dataSource) {\n              this.options.connectionsDataSource = dataSource;\n\n              this._connectionDataSource();\n\n              if (this.options.autoBind) {\n                this.connectionsDataSource.fetch();\n              }\n            },\n\n            /**\n             * Performs a diagram layout of the given type.\n             * @param layoutType The layout algorithm to be applied (TreeLayout, LayeredLayout, SpringLayout).\n             * @param options Layout-specific options.\n             */\n            layout: function (options) {\n              this._layouting = true; // TODO: raise layout event?\n\n              var type;\n\n              if (isUndefined(options)) {\n                options = this.options.layout;\n              }\n\n              if (isUndefined(options) || isUndefined(options.type)) {\n                type = \"Tree\";\n              } else {\n                type = options.type;\n              }\n\n              var l;\n\n              switch (type.toLowerCase()) {\n                case \"tree\":\n                  l = new diagram.TreeLayout(this);\n                  break;\n\n                case \"layered\":\n                  l = new diagram.LayeredLayout(this);\n                  break;\n\n                case \"forcedirected\":\n                case \"force\":\n                case \"spring\":\n                case \"springembedder\":\n                  l = new diagram.SpringLayout(this);\n                  break;\n\n                default:\n                  throw \"Layout algorithm '\" + type + \"' is not supported.\";\n              }\n\n              var initialState = new diagram.LayoutState(this);\n              var finalState = l.layout(options);\n\n              if (finalState) {\n                var unit = new diagram.LayoutUndoUnit(initialState, finalState, options ? options.animate : null);\n                this.undoRedoService.add(unit);\n              }\n\n              this._layouting = false;\n\n              this._redrawConnections();\n            },\n\n            /**\n             * Gets a shape on the basis of its identifier.\n             * @param id (string) the identifier of a shape.\n             * @returns {Shape}\n             */\n            getShapeById: function (id) {\n              var found;\n              found = Utils.first(this.shapes, function (s) {\n                return s.visual.id === id;\n              });\n\n              if (found) {\n                return found;\n              }\n\n              found = Utils.first(this.connections, function (c) {\n                return c.visual.id === id;\n              });\n              return found;\n            },\n            getShapeByModelId: function (id) {\n              var shape;\n\n              if (this._isEditable) {\n                shape = this._dataMap[id];\n              } else {\n                shape = Utils.first(this.shapes, function (shape) {\n                  return (shape.dataItem || {}).id === id;\n                });\n              }\n\n              return shape;\n            },\n            getShapeByModelUid: function (uid) {\n              var shape;\n\n              if (this._isEditable) {\n                shape = Utils.first(this.shapes, function (shape) {\n                  return (shape.dataItem || {}).uid === uid;\n                });\n              } else {\n                shape = this._dataMap[uid];\n              }\n\n              return shape;\n            },\n            getConnectionByModelId: function (id) {\n              var connection;\n\n              if (this.connectionsDataSource) {\n                connection = Utils.first(this.connections, function (connection) {\n                  return (connection.dataItem || {}).id === id;\n                });\n              }\n\n              return connection;\n            },\n            getConnectionByModelUid: function (uid) {\n              var connection;\n\n              if (this.connectionsDataSource) {\n                connection = this._connectionsDataMap[uid];\n              }\n\n              return connection;\n            },\n            _extendLayoutOptions: function (options) {\n              if (options.layout) {\n                options.layout = deepExtend({}, diagram.LayoutBase.fn.defaultOptions || {}, options.layout);\n              }\n            },\n            _selectionChanged: function (selected, deselected) {\n              if (selected.length || deselected.length) {\n                this.trigger(SELECT, {\n                  selected: selected,\n                  deselected: deselected\n                });\n              }\n            },\n            _getValidZoom: function (zoom) {\n              return math.min(math.max(zoom, this.options.zoomMin), this.options.zoomMax);\n            },\n            _panTransform: function (pos) {\n              var diagram = this,\n                  pan = pos || diagram._pan;\n\n              if (diagram.canvas.translate) {\n                diagram.scroller.scrollTo(pan.x, pan.y);\n\n                diagram._zoomMainLayer();\n              } else {\n                diagram._storePan(pan);\n\n                diagram._transformMainLayer();\n              }\n            },\n            _finishPan: function () {\n              this.trigger(PAN, {\n                total: this._pan,\n                delta: Number.NaN\n              });\n            },\n            _storePan: function (pan) {\n              this._pan = pan;\n\n              this._storeViewMatrix();\n            },\n            _zoomMainLayer: function () {\n              var zoom = this._zoom;\n              var transform = new CompositeTransform(0, 0, zoom, zoom);\n              transform.render(this.mainLayer);\n\n              this._storeLayerMatrix(transform);\n\n              this._storeViewMatrix();\n            },\n            _transformMainLayer: function () {\n              var pan = this._pan,\n                  zoom = this._zoom;\n              var transform = new CompositeTransform(pan.x, pan.y, zoom, zoom);\n              transform.render(this.mainLayer);\n\n              this._storeLayerMatrix(transform);\n\n              this._storeViewMatrix();\n            },\n            _storeLayerMatrix: function (canvasTransform) {\n              this._layerMatrix = canvasTransform.toMatrix();\n              this._layerMatrixInvert = canvasTransform.invert().toMatrix();\n            },\n            _storeViewMatrix: function () {\n              var pan = this._pan,\n                  zoom = this._zoom;\n              var transform = new CompositeTransform(pan.x, pan.y, zoom, zoom);\n              this._matrix = transform.toMatrix();\n              this._matrixInvert = transform.invert().toMatrix();\n            },\n            _toIndex: function (items, indices) {\n              var result = this._getDiagramItems(items);\n\n              this.mainLayer.toIndex(result.visuals, indices);\n\n              this._fixOrdering(result, false);\n            },\n            _fixOrdering: function (result, toFront) {\n              var shapePos = toFront ? this.shapes.length - 1 : 0,\n                  conPos = toFront ? this.connections.length - 1 : 0,\n                  i,\n                  item;\n\n              for (i = 0; i < result.shapes.length; i++) {\n                item = result.shapes[i];\n                Utils.remove(this.shapes, item);\n                Utils.insert(this.shapes, item, shapePos);\n              }\n\n              for (i = 0; i < result.cons.length; i++) {\n                item = result.cons[i];\n                Utils.remove(this.connections, item);\n                Utils.insert(this.connections, item, conPos);\n              }\n            },\n            _getDiagramItems: function (items) {\n              var i,\n                  result = {},\n                  args = items;\n              result.visuals = [];\n              result.shapes = [];\n              result.cons = [];\n\n              if (!items) {\n                args = this._selectedItems.slice();\n              } else if (!isArray(items)) {\n                args = [items];\n              }\n\n              for (i = 0; i < args.length; i++) {\n                var item = args[i];\n\n                if (item instanceof Shape) {\n                  result.shapes.push(item);\n                  result.visuals.push(item.visual);\n                } else if (item instanceof Connection) {\n                  result.cons.push(item);\n                  result.visuals.push(item.visual);\n                }\n              }\n\n              return result;\n            },\n            _removeItem: function (item, undoable, removedConnections) {\n              item.select(false);\n\n              if (item instanceof Shape) {\n                this._removeShapeDataItem(item);\n\n                this._removeShape(item, undoable, removedConnections);\n              } else if (item instanceof Connection) {\n                this._removeConnectionDataItem(item);\n\n                this._removeConnection(item, undoable);\n              }\n\n              this.mainLayer.remove(item.visual);\n            },\n            _removeShape: function (shape, undoable, removedConnections) {\n              var i,\n                  connection,\n                  connector,\n                  sources = [],\n                  targets = [];\n\n              this.toolService._removeHover();\n\n              if (undoable) {\n                this.undoRedoService.addCompositeItem(new DeleteShapeUnit(shape));\n              }\n\n              Utils.remove(this.shapes, shape);\n\n              this._shapesQuadTree.remove(shape);\n\n              for (i = 0; i < shape.connectors.length; i++) {\n                connector = shape.connectors[i];\n\n                for (var j = 0; j < connector.connections.length; j++) {\n                  connection = connector.connections[j];\n\n                  if (!removedConnections || !dataviz.inArray(connection, removedConnections)) {\n                    if (connection.sourceConnector == connector) {\n                      sources.push(connection);\n                    } else if (connection.targetConnector == connector) {\n                      targets.push(connection);\n                    }\n                  }\n                }\n              }\n\n              for (i = 0; i < sources.length; i++) {\n                sources[i].source(null, undoable);\n                sources[i].updateModel();\n              }\n\n              for (i = 0; i < targets.length; i++) {\n                targets[i].target(null, undoable);\n                targets[i].updateModel();\n              }\n            },\n            _removeConnection: function (connection, undoable) {\n              if (connection.sourceConnector) {\n                Utils.remove(connection.sourceConnector.connections, connection);\n              }\n\n              if (connection.targetConnector) {\n                Utils.remove(connection.targetConnector.connections, connection);\n              }\n\n              if (undoable) {\n                this.undoRedoService.addCompositeItem(new DeleteConnectionUnit(connection));\n              }\n\n              Utils.remove(this.connections, connection);\n            },\n            _removeDataItems: function (items, recursive) {\n              var item, children, shape, idx;\n              items = isArray(items) ? items : [items];\n\n              while (items.length) {\n                item = items.shift();\n                shape = this._dataMap[item.uid];\n\n                if (shape) {\n                  this._removeShapeConnections(shape);\n\n                  this._removeItem(shape, false);\n\n                  delete this._dataMap[item.uid];\n\n                  if (recursive && item.hasChildren && item.loaded()) {\n                    children = item.children.data();\n\n                    for (idx = 0; idx < children.length; idx++) {\n                      items.push(children[idx]);\n                    }\n                  }\n                }\n              }\n            },\n            _removeShapeConnections: function (shape) {\n              var connections = shape.connections();\n              var idx;\n\n              if (connections) {\n                for (idx = 0; idx < connections.length; idx++) {\n                  this._removeItem(connections[idx], false);\n                }\n              }\n            },\n            _addDataItem: function (dataItem, undoable) {\n              if (!defined(dataItem)) {\n                return;\n              }\n\n              var shape = this._dataMap[dataItem.id];\n\n              if (shape) {\n                return shape;\n              }\n\n              var options = deepExtend({}, this.options.shapeDefaults);\n              options.dataItem = dataItem;\n              shape = new Shape(options, this);\n              this.addShape(shape, undoable !== false);\n              this._dataMap[dataItem.id] = shape;\n              return shape;\n            },\n            _addDataItemByUid: function (dataItem) {\n              if (!defined(dataItem)) {\n                return;\n              }\n\n              var shape = this._dataMap[dataItem.uid];\n\n              if (shape) {\n                return shape;\n              }\n\n              var options = deepExtend({}, this.options.shapeDefaults);\n              options.dataItem = dataItem;\n              shape = new Shape(options, this);\n              this.addShape(shape);\n              this._dataMap[dataItem.uid] = shape;\n              return shape;\n            },\n            _addDataItems: function (items, parent) {\n              var item, idx, shape, parentShape, connection;\n\n              for (idx = 0; idx < items.length; idx++) {\n                item = items[idx];\n                shape = this._addDataItemByUid(item);\n                parentShape = this._addDataItemByUid(parent);\n\n                if (parentShape && !this.connected(parentShape, shape)) {\n                  // check if connected to not duplicate connections.\n                  connection = this.connect(parentShape, shape);\n                }\n              }\n            },\n            _refreshSource: function (e) {\n              var that = this,\n                  node = e.node,\n                  action = e.action,\n                  items = e.items,\n                  options = that.options,\n                  idx,\n                  dataBound;\n\n              if (e.field) {\n                for (idx = 0; idx < items.length; idx++) {\n                  if (this._dataMap[items[idx].uid]) {\n                    this._dataMap[items[idx].uid].redrawVisual();\n                  }\n                }\n\n                return;\n              }\n\n              if (action == \"remove\") {\n                this._removeDataItems(e.items, true);\n              } else {\n                if ((!action || action === \"itemloaded\") && !this._bindingRoots) {\n                  this._bindingRoots = true;\n                  dataBound = true;\n                }\n\n                if (!action && !node) {\n                  that.clear();\n                }\n\n                this._addDataItems(items, node);\n\n                for (idx = 0; idx < items.length; idx++) {\n                  items[idx].load();\n                }\n              }\n\n              if (options.layout && (dataBound || action == \"remove\" || action == \"add\")) {\n                that.layout(options.layout);\n              }\n\n              if (dataBound) {\n                this.trigger(\"dataBound\");\n                this._bindingRoots = false;\n              }\n            },\n            _addItem: function (item) {\n              if (item instanceof Shape) {\n                this.addShape(item);\n              } else if (item instanceof Connection) {\n                this.addConnection(item);\n              }\n            },\n            _createToolBar: function (preventClosing) {\n              var diagram = this.toolService.diagram;\n\n              if (!this.singleToolBar && diagram.select().length === 1) {\n                var element = diagram.select()[0];\n\n                if (element && element.options.editable !== false) {\n                  var editable = element.options.editable;\n                  var tools = editable.tools;\n\n                  if (this._isEditable && tools.length === 0) {\n                    if (element instanceof Shape) {\n                      tools = [\"edit\", \"rotateClockwise\", \"rotateAnticlockwise\"];\n                    } else if (element instanceof Connection) {\n                      tools = [\"edit\"];\n                    }\n\n                    if (editable && editable.remove !== false) {\n                      tools.push(\"delete\");\n                    }\n                  }\n\n                  if (tools && tools.length) {\n                    var padding = 20;\n                    var point;\n                    this.singleToolBar = new DiagramToolBar(diagram, {\n                      tools: tools,\n                      click: this._toolBarClick.bind(this),\n                      modal: true,\n                      popupZIndex: parseInt(diagram.element.closest(\".k-window\").css(\"zIndex\"), 10) + 10\n                    });\n                    var popupWidth = outerWidth(this.singleToolBar._popup.element);\n                    var popupHeight = outerHeight(this.singleToolBar._popup.element);\n\n                    if (element instanceof Shape) {\n                      var shapeBounds = this.modelToView(element.bounds(ROTATED));\n                      point = new Point(shapeBounds.x, shapeBounds.y).minus(new Point((popupWidth - shapeBounds.width) / 2, popupHeight + padding));\n                    } else if (element instanceof Connection) {\n                      var connectionBounds = this.modelToView(element.bounds());\n                      point = new Point(connectionBounds.x, connectionBounds.y).minus(new Point((popupWidth - connectionBounds.width - 20) / 2, popupHeight + padding));\n                    }\n\n                    if (point) {\n                      if (!this.canvas.translate) {\n                        point = point.minus(new Point(this.scroller.scrollLeft, this.scroller.scrollTop));\n                      }\n\n                      point = this.viewToDocument(point);\n                      point = new Point(math.max(point.x, 0), math.max(point.y, 0));\n                      this.singleToolBar.showAt(point);\n\n                      if (preventClosing) {\n                        this.singleToolBar._popup.one(\"close\", preventDefault);\n                      }\n                    } else {\n                      this._destroyToolBar();\n                    }\n                  }\n                }\n              }\n            },\n            _toolBarClick: function (e) {\n              this.trigger(\"toolBarClick\", e);\n\n              this._destroyToolBar();\n            },\n            _normalizePointZoom: function (point) {\n              return point.times(1 / this.zoom());\n            },\n            _initialize: function () {\n              this.shapes = [];\n              this._selectedItems = [];\n              this.connections = [];\n              this._dataMap = {};\n              this._connectionsDataMap = {};\n              this._inactiveShapeItems = new InactiveItemsCollection();\n              this._deferredConnectionUpdates = [];\n              this.undoRedoService = new UndoRedoService({\n                undone: this._syncHandler,\n                redone: this._syncHandler\n              });\n              this.id = diagram.randomId();\n            },\n            _fetchFreshData: function () {\n              var that = this;\n\n              that._dataSource();\n\n              if (that._isEditable) {\n                that._connectionDataSource();\n              }\n\n              if (that.options.autoBind) {\n                if (that._isEditable) {\n                  this._loadingShapes = true;\n                  this._loadingConnections = true;\n                  that.dataSource.fetch();\n                  that.connectionsDataSource.fetch();\n                } else {\n                  that.dataSource.fetch();\n                }\n              }\n            },\n            _dataSource: function () {\n              if (defined(this.options.connectionsDataSource)) {\n                this._isEditable = true;\n                var dsOptions = this.options.dataSource || {};\n                var ds = isArray(dsOptions) ? {\n                  data: dsOptions\n                } : dsOptions;\n\n                if (this.dataSource && this._shapesRefreshHandler) {\n                  this.dataSource.unbind(\"change\", this._shapesRefreshHandler).unbind(\"requestStart\", this._shapesRequestStartHandler).unbind(\"error\", this._shapesErrorHandler);\n                } else {\n                  this._shapesRefreshHandler = this._refreshShapes.bind(this);\n                  this._shapesRequestStartHandler = this._shapesRequestStart.bind(this);\n                  this._shapesErrorHandler = this._error.bind(this);\n                }\n\n                this.dataSource = kendo.data.DataSource.create(ds).bind(\"change\", this._shapesRefreshHandler).bind(\"requestStart\", this._shapesRequestStartHandler).bind(\"error\", this._shapesErrorHandler);\n              } else {\n                this._treeDataSource();\n\n                this._isEditable = false;\n              }\n            },\n            _connectionDataSource: function () {\n              var dsOptions = this.options.connectionsDataSource;\n\n              if (dsOptions) {\n                var ds = isArray(dsOptions) ? {\n                  data: dsOptions\n                } : dsOptions;\n\n                if (this.connectionsDataSource && this._connectionsRefreshHandler) {\n                  this.connectionsDataSource.unbind(\"change\", this._connectionsRefreshHandler).unbind(\"requestStart\", this._connectionsRequestStartHandler).unbind(\"error\", this._connectionsErrorHandler);\n                } else {\n                  this._connectionsRefreshHandler = this._refreshConnections.bind(this);\n                  this._connectionsRequestStartHandler = this._connectionsRequestStart.bind(this);\n                  this._connectionsErrorHandler = this._connectionsError.bind(this);\n                }\n\n                this.connectionsDataSource = kendo.data.DataSource.create(ds).bind(\"change\", this._connectionsRefreshHandler).bind(\"requestStart\", this._connectionsRequestStartHandler).bind(\"error\", this._connectionsErrorHandler);\n              }\n            },\n            _shapesRequestStart: function (e) {\n              if (e.type == \"read\") {\n                this._loadingShapes = true;\n              }\n            },\n            _connectionsRequestStart: function (e) {\n              if (e.type == \"read\") {\n                this._loadingConnections = true;\n              }\n            },\n            _error: function () {\n              this._loadingShapes = false;\n            },\n            _connectionsError: function () {\n              this._loadingConnections = false;\n            },\n            _refreshShapes: function (e) {\n              if (e.action === \"remove\") {\n                if (this._shouldRefresh()) {\n                  this._removeShapes(e.items);\n                }\n              } else if (e.action === \"itemchange\") {\n                if (this._shouldRefresh()) {\n                  this._updateShapes(e.items, e.field);\n                }\n              } else if (e.action === \"add\") {\n                this._inactiveShapeItems.add(e.items);\n              } else if (e.action === \"sync\") {\n                this._syncShapes(e.items);\n              } else {\n                this.refresh();\n              }\n            },\n            _shouldRefresh: function () {\n              return !this._suspended;\n            },\n            _suspendModelRefresh: function () {\n              this._suspended = (this._suspended || 0) + 1;\n            },\n            _resumeModelRefresh: function () {\n              this._suspended = math.max((this._suspended || 0) - 1, 0);\n            },\n            refresh: function () {\n              this._loadingShapes = false;\n\n              if (!this._loadingConnections) {\n                this._rebindShapesAndConnections();\n              }\n            },\n            _rebindShapesAndConnections: function () {\n              this.clear();\n\n              this._addShapes(this.dataSource.view());\n\n              if (this.connectionsDataSource) {\n                this._addConnections(this.connectionsDataSource.view(), false);\n              }\n\n              if (this.options.layout) {\n                this.layout(this.options.layout);\n              } else {\n                this._redrawConnections();\n              }\n\n              this.trigger(\"dataBound\");\n            },\n            refreshConnections: function () {\n              this._loadingConnections = false;\n\n              if (!this._loadingShapes) {\n                this._rebindShapesAndConnections();\n              }\n            },\n            _redrawConnections: function () {\n              var connections = this.connections;\n\n              for (var idx = 0; idx < connections.length; idx++) {\n                connections[idx].refresh();\n              }\n            },\n            _removeShapes: function (items) {\n              var dataMap = this._dataMap;\n              var item, i;\n\n              for (i = 0; i < items.length; i++) {\n                item = items[i];\n\n                if (dataMap[item.id]) {\n                  this.remove(dataMap[item.id], false);\n                  dataMap[item.id] = null;\n                }\n              }\n            },\n            _syncShapes: function () {\n              var diagram = this;\n              var inactiveItems = diagram._inactiveShapeItems;\n              inactiveItems.forEach(function (inactiveItem) {\n                var dataItem = inactiveItem.dataItem;\n                var shape = inactiveItem.element;\n\n                if (!dataItem.isNew()) {\n                  if (shape) {\n                    shape._setOptionsFromModel();\n\n                    diagram.addShape(shape, inactiveItem.undoable);\n                    diagram._dataMap[dataItem.id] = shape;\n                  } else {\n                    diagram._addDataItem(dataItem);\n                  }\n\n                  inactiveItem.activate();\n                  inactiveItems.remove(dataItem);\n                }\n              });\n            },\n            _updateShapes: function (items, field) {\n              for (var i = 0; i < items.length; i++) {\n                var dataItem = items[i];\n                var shape = this._dataMap[dataItem.id];\n\n                if (shape) {\n                  shape.updateOptionsFromModel(dataItem, field);\n                }\n              }\n            },\n            _addShapes: function (dataItems) {\n              for (var i = 0; i < dataItems.length; i++) {\n                this._addDataItem(dataItems[i], false);\n              }\n            },\n            _refreshConnections: function (e) {\n              if (e.action === \"remove\") {\n                if (this._shouldRefresh()) {\n                  this._removeConnections(e.items);\n                }\n              } else if (e.action === \"add\") {\n                this._addConnections(e.items);\n              } else if (e.action === \"sync\") {//TO DO: include logic to update the connections with different values returned from the server.\n              } else if (e.action === \"itemchange\") {\n                if (this._shouldRefresh()) {\n                  this._updateConnections(e.items);\n                }\n              } else {\n                this.refreshConnections();\n              }\n            },\n            _removeConnections: function (items) {\n              for (var i = 0; i < items.length; i++) {\n                this.remove(this._connectionsDataMap[items[i].uid], false);\n                this._connectionsDataMap[items[i].uid] = null;\n              }\n            },\n            _updateConnections: function (items) {\n              for (var i = 0; i < items.length; i++) {\n                var dataItem = items[i];\n                var connection = this._connectionsDataMap[dataItem.uid];\n                connection.updateOptionsFromModel(dataItem);\n              }\n            },\n            _addConnections: function (connections, undoable) {\n              var length = connections.length;\n\n              for (var i = 0; i < length; i++) {\n                var dataItem = connections[i];\n\n                this._addConnectionDataItem(dataItem, undoable);\n              }\n            },\n            _addConnectionDataItem: function (dataItem, undoable) {\n              if (!this._connectionsDataMap[dataItem.uid]) {\n                var from = this._validateConnector(dataItem.from);\n\n                if (!defined(from) || from === null) {\n                  from = new Point(dataItem.fromX, dataItem.fromY);\n                }\n\n                var to = this._validateConnector(dataItem.to);\n\n                if (!defined(to) || to === null) {\n                  to = new Point(dataItem.toX, dataItem.toY);\n                }\n\n                if (defined(from) && defined(to)) {\n                  var options = deepExtend({}, this.options.connectionDefaults);\n                  options.dataItem = dataItem;\n                  var connection = new Connection(from, to, options);\n                  this._connectionsDataMap[dataItem.uid] = connection;\n                  this.addConnection(connection, undoable);\n                }\n              }\n            },\n            _validateConnector: function (value) {\n              var connector;\n\n              if (defined(value) && value !== null) {\n                connector = this._dataMap[value];\n              }\n\n              return connector;\n            },\n            _treeDataSource: function () {\n              var that = this,\n                  options = that.options,\n                  dataSource = options.dataSource;\n              dataSource = isArray(dataSource) ? {\n                data: dataSource\n              } : dataSource;\n\n              if (dataSource instanceof kendo.data.DataSource && !(dataSource instanceof kendo.data.HierarchicalDataSource)) {\n                throw new Error(\"Incorrect DataSource type. If a single dataSource instance is set to the diagram then it should be a HierarchicalDataSource. You should set only the options instead of an instance or a HierarchicalDataSource instance or supply connectionsDataSource as well.\");\n              }\n\n              if (!dataSource.fields) {\n                dataSource.fields = [{\n                  field: \"text\"\n                }, {\n                  field: \"url\"\n                }, {\n                  field: \"spriteCssClass\"\n                }, {\n                  field: \"imageUrl\"\n                }];\n              }\n\n              if (that.dataSource && that._refreshHandler) {\n                that._unbindDataSource();\n              }\n\n              that._refreshHandler = that._refreshSource.bind(that);\n              that._errorHandler = that._error.bind(that);\n              that.dataSource = HierarchicalDataSource.create(dataSource).bind(CHANGE, that._refreshHandler).bind(ERROR, that._errorHandler);\n            },\n            _unbindDataSource: function () {\n              var that = this;\n              that.dataSource.unbind(CHANGE, that._refreshHandler).unbind(ERROR, that._errorHandler);\n            },\n            _adorn: function (adorner, isActive) {\n              if (isActive !== undefined && adorner) {\n                if (isActive) {\n                  this._adorners.push(adorner);\n\n                  this.adornerLayer.append(adorner.visual);\n                } else {\n                  Utils.remove(this._adorners, adorner);\n                  this.adornerLayer.remove(adorner.visual);\n                }\n              }\n            },\n            _showConnectors: function (shape, value) {\n              if (value) {\n                this._connectorsAdorner.show(shape);\n              } else {\n                this._connectorsAdorner.destroy();\n              }\n            },\n            _updateAdorners: function () {\n              var adorners = this._adorners;\n\n              for (var i = 0; i < adorners.length; i++) {\n                var adorner = adorners[i];\n\n                if (adorner.refreshBounds) {\n                  adorner.refreshBounds();\n                }\n\n                adorner.refresh();\n              }\n            },\n            _refresh: function () {\n              for (var i = 0; i < this.connections.length; i++) {\n                this.connections[i].refresh();\n              }\n            },\n            _destroyToolBar: function () {\n              if (this.singleToolBar) {\n                this.singleToolBar.hide();\n                this.singleToolBar.destroy();\n                this.singleToolBar = null;\n              }\n            },\n            _destroyGlobalToolBar: function () {\n              if (this.toolBar) {\n                this.toolBar.hide();\n                this.toolBar.destroy();\n                this.toolBar = null;\n              }\n            },\n            exportDOMVisual: function () {\n              var viewBox = this.canvas._viewBox;\n              var scrollOffset = geom.transform().translate(-viewBox.x, -viewBox.y);\n              var viewRect = new geom.Rect([0, 0], [viewBox.width, viewBox.height]);\n              var clipPath = draw.Path.fromRect(viewRect);\n              var wrap = new draw.Group({\n                transform: scrollOffset\n              });\n              var clipWrap = new draw.Group({\n                clip: clipPath\n              });\n              var root = this.canvas.drawingElement.children[0];\n              clipWrap.append(wrap); // Don't reparent the root\n\n              wrap.children.push(root);\n              return clipWrap;\n            },\n            exportVisual: function () {\n              var scale = geom.transform().scale(1 / this._zoom);\n              var wrap = new draw.Group({\n                transform: scale\n              });\n              var root = this.mainLayer.drawingElement;\n              wrap.children.push(root);\n              return wrap;\n            },\n            _syncChanges: function () {\n              this._syncShapeChanges();\n\n              this._syncConnectionChanges();\n            },\n            _syncShapeChanges: function () {\n              if (this.dataSource && this._isEditable) {\n                this.dataSource.sync();\n              }\n            },\n            _syncConnectionChanges: function () {\n              var that = this;\n\n              if (that.connectionsDataSource && that._isEditable) {\n                $.when.apply($, that._deferredConnectionUpdates).then(function () {\n                  that.connectionsDataSource.sync();\n                });\n                that.deferredConnectionUpdates = [];\n              }\n            }\n          });\n          dataviz.ExportMixin.extend(Diagram.fn, true);\n\n          if (kendo.PDFMixin) {\n            kendo.PDFMixin.extend(Diagram.fn);\n          }\n\n          function filterShapeDataItem(dataItem) {\n            var result = {};\n            dataItem = dataItem || {};\n\n            if (defined(dataItem.text) && dataItem.text !== null) {\n              result.text = dataItem.text;\n            }\n\n            if (defined(dataItem.x) && dataItem.x !== null) {\n              result.x = dataItem.x;\n            }\n\n            if (defined(dataItem.y) && dataItem.y !== null) {\n              result.y = dataItem.y;\n            }\n\n            if (defined(dataItem.width) && dataItem.width !== null) {\n              result.width = dataItem.width;\n            }\n\n            if (defined(dataItem.height) && dataItem.height !== null) {\n              result.height = dataItem.height;\n            }\n\n            if (defined(dataItem.type) && dataItem.type !== null) {\n              result.type = dataItem.type;\n            }\n\n            return result;\n          }\n\n          function filterConnectionDataItem(dataItem) {\n            var result = {};\n            dataItem = dataItem || {};\n\n            if (defined(dataItem.text) && dataItem.text !== null) {\n              result.content = dataItem.text;\n            }\n\n            if (defined(dataItem.type) && dataItem.type !== null) {\n              result.type = dataItem.type;\n            }\n\n            if (defined(dataItem.from) && dataItem.from !== null) {\n              result.from = dataItem.from;\n            }\n\n            if (defined(dataItem.fromConnector) && dataItem.fromConnector !== null) {\n              result.fromConnector = dataItem.fromConnector;\n            }\n\n            if (defined(dataItem.fromX) && dataItem.fromX !== null) {\n              result.fromX = dataItem.fromX;\n            }\n\n            if (defined(dataItem.fromY) && dataItem.fromY !== null) {\n              result.fromY = dataItem.fromY;\n            }\n\n            if (defined(dataItem.to) && dataItem.to !== null) {\n              result.to = dataItem.to;\n            }\n\n            if (defined(dataItem.toConnector) && dataItem.toConnector !== null) {\n              result.toConnector = dataItem.toConnector;\n            }\n\n            if (defined(dataItem.toX) && dataItem.toX !== null) {\n              result.toX = dataItem.toX;\n            }\n\n            if (defined(dataItem.toY) && dataItem.toY !== null) {\n              result.toY = dataItem.toY;\n            }\n\n            return result;\n          }\n\n          var DiagramToolBar = kendo.Observable.extend({\n            init: function (diagram, options) {\n              kendo.Observable.fn.init.call(this);\n              this.diagram = diagram;\n              this.options = deepExtend({}, this.options, options);\n              this._tools = [];\n              this.createToolBar();\n              this.createTools();\n              this.appendTools();\n\n              if (this.options.modal) {\n                this.createPopup();\n              }\n\n              this.bind(this.events, options);\n            },\n            events: [\"click\"],\n            createPopup: function () {\n              this.container = $(\"<div/>\").append(this.element);\n              this._popup = this.container.kendoPopup({}).getKendoPopup();\n            },\n            appendTools: function () {\n              for (var i = 0; i < this._tools.length; i++) {\n                var tool = this._tools[i];\n\n                if (tool.buttons && tool.buttons.length || !defined(tool.buttons)) {\n                  this._toolBar.add(tool);\n                }\n              }\n            },\n            createToolBar: function () {\n              this.element = $(\"<div/>\");\n              this._toolBar = this.element.kendoToolBar({\n                click: this.click.bind(this),\n                resizable: false\n              }).getKendoToolBar();\n              this.element.css(\"border\", \"none\");\n            },\n            createTools: function () {\n              for (var i = 0; i < this.options.tools.length; i++) {\n                this.createTool(this.options.tools[i]);\n              }\n            },\n            createTool: function (tool) {\n              if (!isPlainObject(tool)) {\n                tool = {\n                  name: tool\n                };\n              }\n\n              var toolName = tool.name + \"Tool\";\n\n              if (this[toolName]) {\n                this[toolName](tool);\n              } else {\n                this._tools.push(deepExtend({}, tool, {\n                  attributes: this._setAttributes({\n                    action: tool.name\n                  })\n                }));\n              }\n            },\n            showAt: function (point) {\n              var popupZIndex = parseInt(this.options.popupZIndex, 10);\n\n              if (this._popup) {\n                this._popup.open(point.x, point.y);\n\n                if (popupZIndex) {\n                  this._popup.wrapper.css(\"zIndex\", popupZIndex);\n                }\n              }\n            },\n            hide: function () {\n              if (this._popup) {\n                this._popup.close();\n              }\n            },\n            newGroup: function () {\n              return {\n                type: \"buttonGroup\",\n                buttons: []\n              };\n            },\n            editTool: function () {\n              this._tools.push({\n                icon: \"edit\",\n                showText: \"overflow\",\n                type: \"button\",\n                text: \"Edit\",\n                attributes: this._setAttributes({\n                  action: \"edit\"\n                })\n              });\n            },\n            deleteTool: function () {\n              this._tools.push({\n                icon: \"close\",\n                showText: \"overflow\",\n                type: \"button\",\n                text: \"Delete\",\n                attributes: this._setAttributes({\n                  action: \"delete\"\n                })\n              });\n            },\n            rotateAnticlockwiseTool: function (options) {\n              this._appendGroup(\"rotate\");\n\n              this._rotateGroup.buttons.push({\n                icon: \"rotate-left\",\n                showText: \"overflow\",\n                text: \"RotateAnticlockwise\",\n                group: \"rotate\",\n                attributes: this._setAttributes({\n                  action: \"rotateAnticlockwise\",\n                  step: options.step\n                })\n              });\n            },\n            rotateClockwiseTool: function (options) {\n              this._appendGroup(\"rotate\");\n\n              this._rotateGroup.buttons.push({\n                icon: \"rotate-right\",\n                attributes: this._setAttributes({\n                  action: \"rotateClockwise\",\n                  step: options.step\n                }),\n                showText: \"overflow\",\n                text: \"RotateClockwise\",\n                group: \"rotate\"\n              });\n            },\n            createShapeTool: function () {\n              this._appendGroup(\"create\");\n\n              this._createGroup.buttons.push({\n                icon: \"shape\",\n                showText: \"overflow\",\n                text: \"CreateShape\",\n                group: \"create\",\n                attributes: this._setAttributes({\n                  action: \"createShape\"\n                })\n              });\n            },\n            createConnectionTool: function () {\n              this._appendGroup(\"create\");\n\n              this._createGroup.buttons.push({\n                icon: \"connector\",\n                showText: \"overflow\",\n                text: \"CreateConnection\",\n                group: \"create\",\n                attributes: this._setAttributes({\n                  action: \"createConnection\"\n                })\n              });\n            },\n            undoTool: function () {\n              this._appendGroup(\"history\");\n\n              this._historyGroup.buttons.push({\n                icon: \"undo\",\n                showText: \"overflow\",\n                text: \"Undo\",\n                group: \"history\",\n                attributes: this._setAttributes({\n                  action: \"undo\"\n                })\n              });\n            },\n            redoTool: function () {\n              this._appendGroup(\"history\");\n\n              this._historyGroup.buttons.push({\n                icon: \"redo\",\n                showText: \"overflow\",\n                text: \"Redo\",\n                group: \"history\",\n                attributes: this._setAttributes({\n                  action: \"redo\"\n                })\n              });\n            },\n            _appendGroup: function (name) {\n              var prop = \"_\" + name + \"Group\";\n\n              if (!this[prop]) {\n                this[prop] = this.newGroup();\n\n                this._tools.push(this[prop]);\n              }\n            },\n            _setAttributes: function (attributes) {\n              var attr = {};\n\n              if (attributes.action) {\n                attr[kendo.attr(\"action\")] = attributes.action;\n              }\n\n              if (attributes.step) {\n                attr[kendo.attr(\"step\")] = attributes.step;\n              }\n\n              return attr;\n            },\n            _getAttributes: function (element) {\n              var attr = {};\n              var action = element.attr(kendo.attr(\"action\"));\n\n              if (action) {\n                attr.action = action;\n              }\n\n              var step = element.attr(kendo.attr(\"step\"));\n\n              if (step) {\n                attr.step = step;\n              }\n\n              return attr;\n            },\n            click: function (e) {\n              var attributes = this._getAttributes($(e.target));\n\n              var action = attributes.action;\n\n              if (action && this[action]) {\n                this[action](attributes);\n              }\n\n              this.trigger(\"click\", this.eventData(action, e.target));\n            },\n            eventData: function (action, target) {\n              var elements = this.selectedElements(),\n                  length = elements.length,\n                  shapes = [],\n                  connections = [],\n                  element;\n\n              for (var idx = 0; idx < length; idx++) {\n                element = elements[idx];\n\n                if (element instanceof Shape) {\n                  shapes.push(element);\n                } else {\n                  connections.push(element);\n                }\n              }\n\n              return {\n                shapes: shapes,\n                connections: connections,\n                action: action,\n                target: target\n              };\n            },\n            \"delete\": function () {\n              var diagram = this.diagram;\n\n              var toRemove = diagram._triggerRemove(this.selectedElements());\n\n              if (toRemove.length) {\n                this.diagram.remove(toRemove, true);\n\n                this.diagram._syncChanges();\n              }\n            },\n            edit: function () {\n              var selectedElemens = this.selectedElements();\n\n              if (selectedElemens.length === 1) {\n                this.diagram.edit(selectedElemens[0]);\n              }\n            },\n            rotateClockwise: function (options) {\n              var angle = parseFloat(options.step || 90);\n\n              this._rotate(angle);\n            },\n            rotateAnticlockwise: function (options) {\n              var angle = parseFloat(options.step || 90);\n\n              this._rotate(-angle);\n            },\n            _rotate: function (angle) {\n              var adorner = this.diagram._resizingAdorner;\n              adorner.angle(adorner.angle() + angle);\n              adorner.rotate();\n            },\n            selectedElements: function () {\n              return this.diagram.select();\n            },\n            createShape: function () {\n              this.diagram.createShape();\n            },\n            createConnection: function () {\n              this.diagram.createConnection();\n            },\n            undo: function () {\n              this.diagram.undo();\n            },\n            redo: function () {\n              this.diagram.redo();\n            },\n            destroy: function () {\n              this.diagram = null;\n              this.element = null;\n              this.options = null;\n\n              if (this._toolBar) {\n                this._toolBar.destroy();\n              }\n\n              if (this._popup) {\n                this._popup.destroy();\n              }\n            }\n          });\n          var Editor = kendo.Observable.extend({\n            init: function (element, options) {\n              kendo.Observable.fn.init.call(this);\n              this.options = extend(true, {}, this.options, options);\n              this.element = element;\n              this.model = this.options.model;\n              this.fields = this._getFields();\n\n              this._initContainer();\n\n              this.createEditable();\n            },\n            options: {\n              editors: {}\n            },\n            _initContainer: function () {\n              this.wrapper = this.element;\n            },\n            createEditable: function () {\n              var options = this.options;\n              this.editable = new kendo.ui.Editable(this.wrapper, {\n                fields: this.fields,\n                target: options.target,\n                clearContainer: false,\n                model: this.model\n              });\n            },\n            _isEditable: function (field) {\n              return this.model.editable && this.model.editable(field);\n            },\n            _getFields: function () {\n              var fields = [];\n              var modelFields = this.model.fields;\n\n              for (var field in modelFields) {\n                var result = {};\n\n                if (this._isEditable(field)) {\n                  var editor = this.options.editors[field];\n\n                  if (editor) {\n                    result.editor = editor;\n                  }\n\n                  result.field = field;\n                  fields.push(result);\n                }\n              }\n\n              return fields;\n            },\n            end: function () {\n              return this.editable.end();\n            },\n            destroy: function () {\n              this.editable.destroy();\n              this.editable.element.find(\"[\" + kendo.attr(\"container-for\") + \"]\").empty();\n              this.model = this.wrapper = this.element = this.columns = this.editable = null;\n            }\n          });\n          var PopupEditor = Editor.extend({\n            init: function (element, options) {\n              Editor.fn.init.call(this, element, options);\n              this.bind(this.events, this.options);\n              this.open();\n            },\n            events: [\"update\", \"cancel\"],\n            options: {\n              window: {\n                modal: true,\n                resizable: false,\n                draggable: true,\n                title: \"Edit\",\n                visible: false\n              }\n            },\n            _initContainer: function () {\n              var that = this;\n              this.wrapper = $('<div class=\"k-popup-edit-form\"/>').attr(kendo.attr(\"uid\"), this.model.uid);\n              var formContent = \"\";\n\n              if (this.options.template) {\n                formContent += this._renderTemplate();\n                this.fields = [];\n              } else {\n                formContent += this._renderFields();\n              }\n\n              formContent += this._renderButtons();\n              this.wrapper.append($('<div class=\"k-edit-form-container\"/>').append(formContent));\n              this.window = new kendo.ui.Window(this.wrapper.appendTo(this.element), this.options.window);\n              this.window.bind(\"close\", function (e) {\n                //The bellow line is required due to: draggable window in IE, change event will be triggered while the window is closing\n                if (e.userTriggered) {\n                  e.sender.element.trigger(\"focus\");\n\n                  that._cancelClick(e);\n                }\n              });\n\n              this._attachButtonEvents();\n            },\n            _renderTemplate: function () {\n              var template = this.options.template;\n\n              if (typeof template === \"string\") {\n                template = kendo.unescape(template);\n              }\n\n              template = kendo.template(template)(this.model);\n              return template;\n            },\n            _renderFields: function () {\n              var form = \"\";\n\n              for (var i = 0; i < this.fields.length; i++) {\n                var field = this.fields[i];\n                form += '<div class=\"k-edit-label\"><label for=\"' + field.field + '\">' + (field.field || \"\") + '</label></div>';\n\n                if (this._isEditable(field.field)) {\n                  form += '<div ' + kendo.attr(\"container-for\") + '=\"' + field.field + '\" class=\"k-edit-field\"></div>';\n                }\n              }\n\n              return form;\n            },\n            _renderButtons: function () {\n              var form = '<div class=\"k-edit-buttons\">';\n              form += this._createButton(\"update\");\n              form += this._createButton(\"cancel\");\n              form += '</div>';\n              return form;\n            },\n            _createButton: function (name) {\n              return kendo.template(BUTTON_TEMPLATE)(defaultButtons[name]);\n            },\n            _attachButtonEvents: function () {\n              this._cancelClickHandler = this._cancelClick.bind(this);\n              this.window.element.on(CLICK + NS, \"a.k-diagram-cancel\", this._cancelClickHandler);\n              this._updateClickHandler = this._updateClick.bind(this);\n              this.window.element.on(CLICK + NS, \"a.k-diagram-update\", this._updateClickHandler);\n            },\n            _updateClick: function (e) {\n              e.preventDefault();\n              this.trigger(\"update\");\n            },\n            _cancelClick: function (e) {\n              e.preventDefault();\n              this.trigger(\"cancel\");\n            },\n            open: function () {\n              this.window.center().open();\n            },\n            close: function () {\n              this.window.bind(\"deactivate\", this.destroy.bind(this)).close();\n            },\n            destroy: function () {\n              this.window.close().destroy();\n              this.window.element.off(CLICK + NS, \"a.k-diagram-cancel\", this._cancelClickHandler);\n              this.window.element.off(CLICK + NS, \"a.k-diagram-update\", this._updateClickHandler);\n              this._cancelClickHandler = null;\n              this._editUpdateClickHandler = null;\n              this.window = null;\n              Editor.fn.destroy.call(this);\n            }\n          });\n\n          function connectionSelector(container, options) {\n            var model = this.dataSource.reader.model;\n\n            if (model) {\n              var textField = model.fn.fields.text ? \"text\" : model.idField;\n              $(\"<input name='\" + options.field + \"' />\").appendTo(container).kendoDropDownList({\n                dataValueField: model.idField,\n                dataTextField: textField,\n                dataSource: this.dataSource.data().toJSON(),\n                optionLabel: \" \",\n                valuePrimitive: true\n              });\n            }\n          }\n\n          function InactiveItem(dataItem) {\n            this.dataItem = dataItem;\n            this.callbacks = [];\n          }\n\n          InactiveItem.fn = InactiveItem.prototype = {\n            onActivate: function (callback) {\n              var deffered = $.Deferred();\n              this.callbacks.push({\n                callback: callback,\n                deferred: deffered\n              });\n              return deffered;\n            },\n            activate: function () {\n              var callbacks = this.callbacks;\n              var item;\n\n              for (var idx = 0; idx < callbacks.length; idx++) {\n                item = this.callbacks[idx];\n                item.callback(this.dataItem);\n                item.deferred.resolve();\n              }\n\n              this.callbacks = [];\n            }\n          };\n\n          function InactiveItemsCollection() {\n            this.items = {};\n          }\n\n          InactiveItemsCollection.fn = InactiveItemsCollection.prototype = {\n            add: function (items) {\n              for (var idx = 0; idx < items.length; idx++) {\n                this.items[items[idx].uid] = new InactiveItem(items[idx]);\n              }\n            },\n            forEach: function (callback) {\n              for (var uid in this.items) {\n                callback(this.items[uid]);\n              }\n            },\n            getByUid: function (uid) {\n              return this.items[uid];\n            },\n            remove: function (item) {\n              delete this.items[item.uid];\n            }\n          };\n          var QuadRoot = Class.extend({\n            init: function () {\n              this.shapes = [];\n            },\n            _add: function (shape, bounds) {\n              this.shapes.push({\n                bounds: bounds,\n                shape: shape\n              });\n              shape._quadNode = this;\n            },\n            insert: function (shape, bounds) {\n              this._add(shape, bounds);\n            },\n            remove: function (shape) {\n              var shapes = this.shapes;\n              var length = shapes.length;\n\n              for (var idx = 0; idx < length; idx++) {\n                if (shapes[idx].shape === shape) {\n                  shapes.splice(idx, 1);\n                  break;\n                }\n              }\n            },\n            hitTestRect: function (rect, exclude) {\n              var shapes = this.shapes;\n              var length = shapes.length;\n\n              for (var i = 0; i < length; i++) {\n                if (this._testRect(shapes[i].shape, rect) && !dataviz.inArray(shapes[i].shape, exclude)) {\n                  return true;\n                }\n              }\n            },\n            _testRect: function (shape, rect) {\n              var angle = shape.rotate().angle;\n              var bounds = shape.bounds();\n              var hit;\n\n              if (!angle) {\n                hit = bounds.overlaps(rect);\n              } else {\n                hit = Intersect.rects(rect, bounds, -angle);\n              }\n\n              return hit;\n            }\n          });\n          var QuadNode = QuadRoot.extend({\n            init: function (rect) {\n              QuadRoot.fn.init.call(this);\n              this.children = [];\n              this.rect = rect;\n            },\n            inBounds: function (rect) {\n              var nodeRect = this.rect;\n              var nodeBottomRight = nodeRect.bottomRight();\n              var bottomRight = rect.bottomRight();\n              var inBounds = nodeRect.x <= rect.x && nodeRect.y <= rect.y && bottomRight.x <= nodeBottomRight.x && bottomRight.y <= nodeBottomRight.y;\n              return inBounds;\n            },\n            overlapsBounds: function (rect) {\n              return this.rect.overlaps(rect);\n            },\n            insert: function (shape, bounds) {\n              var inserted = false;\n              var children = this.children;\n              var length = children.length;\n\n              if (this.inBounds(bounds)) {\n                if (!length && this.shapes.length < 4) {\n                  this._add(shape, bounds);\n                } else {\n                  if (!length) {\n                    this._initChildren();\n                  }\n\n                  for (var idx = 0; idx < children.length; idx++) {\n                    if (children[idx].insert(shape, bounds)) {\n                      inserted = true;\n                      break;\n                    }\n                  }\n\n                  if (!inserted) {\n                    this._add(shape, bounds);\n                  }\n                }\n\n                inserted = true;\n              }\n\n              return inserted;\n            },\n            _initChildren: function () {\n              var rect = this.rect,\n                  children = this.children,\n                  shapes = this.shapes,\n                  center = rect.center(),\n                  halfWidth = rect.width / 2,\n                  halfHeight = rect.height / 2,\n                  childIdx,\n                  shapeIdx;\n              children.push(new QuadNode(new Rect(rect.x, rect.y, halfWidth, halfHeight)), new QuadNode(new Rect(center.x, rect.y, halfWidth, halfHeight)), new QuadNode(new Rect(rect.x, center.y, halfWidth, halfHeight)), new QuadNode(new Rect(center.x, center.y, halfWidth, halfHeight)));\n\n              for (shapeIdx = shapes.length - 1; shapeIdx >= 0; shapeIdx--) {\n                for (childIdx = 0; childIdx < children.length; childIdx++) {\n                  if (children[childIdx].insert(shapes[shapeIdx].shape, shapes[shapeIdx].bounds)) {\n                    shapes.splice(shapeIdx, 1);\n                    break;\n                  }\n                }\n              }\n            },\n            hitTestRect: function (rect, exclude) {\n              var idx;\n              var children = this.children;\n              var length = children.length;\n              var hit = false;\n\n              if (this.overlapsBounds(rect)) {\n                if (QuadRoot.fn.hitTestRect.call(this, rect, exclude)) {\n                  hit = true;\n                } else {\n                  for (idx = 0; idx < length; idx++) {\n                    if (children[idx].hitTestRect(rect, exclude)) {\n                      hit = true;\n                      break;\n                    }\n                  }\n                }\n              }\n\n              return hit;\n            }\n          });\n          var ShapesQuadTree = Class.extend({\n            ROOT_SIZE: 1000,\n            init: function (diagram) {\n              var boundsChangeHandler = this._boundsChange.bind(this);\n\n              diagram.bind(ITEMBOUNDSCHANGE, boundsChangeHandler);\n              diagram.bind(ITEMROTATE, boundsChangeHandler);\n              this.initRoots();\n            },\n            initRoots: function () {\n              this.rootMap = {};\n              this.root = new QuadRoot();\n            },\n            clear: function () {\n              this.initRoots();\n            },\n            _boundsChange: function (e) {\n              if (e.item._quadNode) {\n                e.item._quadNode.remove(e.item);\n              }\n\n              this.insert(e.item);\n            },\n            insert: function (shape) {\n              var bounds = shape.bounds(ROTATED);\n              var rootSize = this.ROOT_SIZE;\n              var sectors = this.getSectors(bounds);\n              var x = sectors[0][0];\n              var y = sectors[1][0];\n\n              if (this.inRoot(sectors)) {\n                this.root.insert(shape, bounds);\n              } else {\n                if (!this.rootMap[x]) {\n                  this.rootMap[x] = {};\n                }\n\n                if (!this.rootMap[x][y]) {\n                  this.rootMap[x][y] = new QuadNode(new Rect(x * rootSize, y * rootSize, rootSize, rootSize));\n                }\n\n                this.rootMap[x][y].insert(shape, bounds);\n              }\n            },\n            remove: function (shape) {\n              if (shape._quadNode) {\n                shape._quadNode.remove(shape);\n              }\n            },\n            inRoot: function (sectors) {\n              return sectors[0].length > 1 || sectors[1].length > 1;\n            },\n            getSectors: function (rect) {\n              var rootSize = this.ROOT_SIZE;\n              var bottomRight = rect.bottomRight();\n              var bottomX = math.floor(bottomRight.x / rootSize);\n              var bottomY = math.floor(bottomRight.y / rootSize);\n              var sectors = [[], []];\n\n              for (var x = math.floor(rect.x / rootSize); x <= bottomX; x++) {\n                sectors[0].push(x);\n              }\n\n              for (var y = math.floor(rect.y / rootSize); y <= bottomY; y++) {\n                sectors[1].push(y);\n              }\n\n              return sectors;\n            },\n            hitTestRect: function (rect, exclude) {\n              var sectors = this.getSectors(rect);\n              var xIdx, yIdx, x, y;\n              var root;\n\n              if (this.root.hitTestRect(rect, exclude)) {\n                return true;\n              }\n\n              for (xIdx = 0; xIdx < sectors[0].length; xIdx++) {\n                x = sectors[0][xIdx];\n\n                for (yIdx = 0; yIdx < sectors[1].length; yIdx++) {\n                  y = sectors[1][yIdx];\n                  root = (this.rootMap[x] || {})[y];\n\n                  if (root && root.hitTestRect(rect, exclude)) {\n                    return true;\n                  }\n                }\n              }\n\n              return false;\n            }\n          });\n\n          function cloneDataItem(dataItem) {\n            var result = dataItem;\n\n            if (dataItem instanceof kendo.data.Model) {\n              result = dataItem.toJSON();\n              result[dataItem.idField] = dataItem._defaultId;\n            }\n\n            return result;\n          }\n\n          function splitDiagramElements(elements) {\n            var connections = [];\n            var shapes = [];\n            var element, idx;\n\n            for (idx = 0; idx < elements.length; idx++) {\n              element = elements[idx];\n\n              if (element instanceof Shape) {\n                shapes.push(element);\n              } else {\n                connections.push(element);\n              }\n            }\n\n            return {\n              shapes: shapes,\n              connections: connections\n            };\n          }\n\n          function createModel(dataSource, model) {\n            if (dataSource.reader.model) {\n              return new dataSource.reader.model(model);\n            }\n\n            return new kendo.data.ObservableObject(model);\n          }\n\n          function clearField(field, model) {\n            if (defined(model[field])) {\n              model.set(field, null);\n            }\n          }\n\n          function copyDefaultOptions(mainOptions, elementOptions, fields) {\n            var field;\n\n            for (var idx = 0; idx < fields.length; idx++) {\n              field = fields[idx];\n\n              if (elementOptions && !defined(elementOptions[field])) {\n                elementOptions[field] = mainOptions[field];\n              }\n            }\n          }\n\n          function translateToOrigin(visual) {\n            var bbox = visual.drawingContainer().clippedBBox(null);\n\n            if (bbox.origin.x !== 0 || bbox.origin.y !== 0) {\n              visual.position(-bbox.origin.x, -bbox.origin.y);\n            }\n          }\n\n          function preventDefault(e) {\n            e.preventDefault();\n          }\n\n          dataviz.ui.plugin(Diagram);\n          deepExtend(diagram, {\n            Shape: Shape,\n            Connection: Connection,\n            Connector: Connector,\n            DiagramToolBar: DiagramToolBar,\n            QuadNode: QuadNode,\n            QuadRoot: QuadRoot,\n            ShapesQuadTree: ShapesQuadTree,\n            PopupEditor: PopupEditor\n          });\n        })(window.kendo.jQuery);\n      }, __webpack_require__.amdD);\n      /***/\n\n    },\n\n    /***/\n    69089:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.data\");\n      /***/\n    },\n\n    /***/\n    32549:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.dataviz.core\");\n      /***/\n    },\n\n    /***/\n    80396:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.dataviz.themes\");\n      /***/\n    },\n\n    /***/\n    60824:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.draganddrop\");\n      /***/\n    },\n\n    /***/\n    10239:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.dropdownlist\");\n      /***/\n    },\n\n    /***/\n    30006:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.editable\");\n      /***/\n    },\n\n    /***/\n    77261:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.toolbar\");\n      /***/\n    },\n\n    /***/\n    87722:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.window\");\n      /***/\n    },\n\n    /***/\n    39725:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"./layout\");\n      /***/\n    },\n\n    /***/\n    13224:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"./services\");\n      /***/\n    },\n\n    /***/\n    48643:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"./svg\");\n      /***/\n    }\n    /******/\n\n  };\n  /************************************************************************/\n\n  /******/\n  // The module cache\n\n  /******/\n\n  var __webpack_module_cache__ = {};\n  /******/\n\n  /******/\n  // The require function\n\n  /******/\n\n  function __webpack_require__(moduleId) {\n    /******/\n    // Check if module is in cache\n\n    /******/\n    var cachedModule = __webpack_module_cache__[moduleId];\n    /******/\n\n    if (cachedModule !== undefined) {\n      /******/\n      return cachedModule.exports;\n      /******/\n    }\n    /******/\n    // Create a new module (and put it into the cache)\n\n    /******/\n\n\n    var module = __webpack_module_cache__[moduleId] = {\n      /******/\n      // no module.id needed\n\n      /******/\n      // no module.loaded needed\n\n      /******/\n      exports: {}\n      /******/\n\n    };\n    /******/\n\n    /******/\n    // Execute the module function\n\n    /******/\n\n    __webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n    /******/\n\n    /******/\n    // Return the exports of the module\n\n    /******/\n\n\n    return module.exports;\n    /******/\n  }\n  /******/\n\n  /************************************************************************/\n\n  /******/\n\n  /* webpack/runtime/amd define */\n\n  /******/\n\n\n  !function () {\n    /******/\n    __webpack_require__.amdD = function () {\n      /******/\n      throw new Error('define cannot be used indirect');\n      /******/\n    };\n    /******/\n\n  }();\n  /******/\n\n  /************************************************************************/\n\n  /******/\n\n  /******/\n  // startup\n\n  /******/\n  // Load entry module and return exports\n\n  /******/\n  // This entry module used 'module' so it can't be inlined\n\n  /******/\n\n  var __webpack_exports__ = __webpack_require__(92660);\n  /******/\n\n\n  module.exports = __webpack_exports__;\n  /******/\n\n  /******/\n})();","map":{"version":3,"names":["__webpack_modules__","module","exports","__webpack_require__","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","f","define","apply","undefined","$","dataviz","kendo","draw","drawing","geom","geometry","diagram","Widget","ui","Class","deepExtend","outerWidth","_outerWidth","outerHeight","_outerHeight","extend","HierarchicalDataSource","data","Canvas","Group","Rectangle","Circle","CompositeTransform","Rect","Path","DeleteShapeUnit","DeleteConnectionUnit","TextBlock","Image","Point","Intersect","ConnectionEditAdorner","UndoRedoService","ToolService","Selector","ResizingAdorner","ConnectorsAdorner","Cursors","Utils","Observable","ToBackUnit","ToFrontUnit","PolylineRouter","CascadingRouter","isUndefined","isDefined","defined","util","isArray","Array","isFunction","isString","isPlainObject","math","Math","NS","CASCADING","ITEMBOUNDSCHANGE","CHANGE","CLICK","DRAG","DRAG_END","DRAG_START","MOUSE_ENTER","MOUSE_LEAVE","ERROR","AUTO","TOP","RIGHT","LEFT","BOTTOM","MAXINT","SELECT","ITEMROTATE","PAN","ZOOM_START","ZOOM_END","NONE","DEFAULT_CANVAS_WIDTH","DEFAULT_CANVAS_HEIGHT","DEFAULT_SHAPE_TYPE","DEFAULT_SHAPE_WIDTH","DEFAULT_SHAPE_HEIGHT","DEFAULT_SHAPE_MINWIDTH","DEFAULT_SHAPE_MINHEIGHT","DEFAULT_SHAPE_POSITION","DEFAULT_CONNECTION_BACKGROUND","MAX_VALUE","Number","MIN_VALUE","ABSOLUTE","TRANSFORMED","ROTATED","TRANSPARENT","WIDTH","HEIGHT","X","Y","MOUSEWHEEL_NS","MOBILE_ZOOM_RATE","MOBILE_PAN_DISTANCE","BUTTON_TEMPLATE","CONNECTION_CONTENT_OFFSET","DefaultConnectors","name","position","shape","getPosition","defaultButtons","cancel","text","imageClass","className","iconClass","update","shapeDefaults","extra","defaults","type","path","autoSize","visual","x","y","minWidth","minHeight","width","height","hover","editable","connect","tools","connectors","rotation","angle","simpleExtend","mwDelta","e","origEvent","originalEvent","delta","wheelDelta","ceil","floor","detail","isAutoConnector","connector","options","toLowerCase","closestConnector","point","minimumDistance","resCtr","i","length","dist","distanceTo","indicesOfItems","group","visuals","indices","children","drawingContainer","j","push","DiagramElement","init","that","dataItem","fn","call","id","randomId","isSelected","_template","cursor","grip","content","align","selectable","serializable","enable","_getCursor","adorner","visible","value","bounds","refresh","redraw","toString","serialize","json","_content","contentOptions","contentVisual","_contentVisual","_createContentVisual","_updateContentVisual","_includeInBBox","append","_hitTest","contains","template","elementTemplate","paramName","_canSelect","toJSON","Connector","connections","fill","color","shapeId","parse","str","tempStr","split","shapes","getConnector","trim","Shape","updateOptionsFromModel","createShapeVisual","updateBounds","_createConnectors","_setOptionsFromModel","model","modelOptions","filterShapeDataItem","redrawVisual","field","_isEditable","inArray","_redrawVisual","clear","updateModel","syncChanges","_bounds","_suspendModelRefresh","set","_resumeModelRefresh","_syncShapeChanges","_measure","_rotate","_alignContent","result","containerRect","aligner","RectAlign","contentBounds","drawingElement","bbox","contentRect","alignedBounds","topLeft","connectorDefaults","_transformedBounds","pan","_pan","_rotatedBounds","_setBounds","_triggerBoundsChange","_layouting","refreshConnections","rect","max","clone","cloneDataItem","select","selected","deselected","_selectedItems","remove","_internalSelection","_selectionChanged","rotate","center","undoable","undoRedoService","add","RotateUnit","_resizingAdorner","b","sc","deltaAngle","newPosition","minus","_rotationOffset","plus","_connectorsAdorner","trigger","item","con","cons","ctr","source","target","each","nameOrPoint","toLocaleLowerCase","side","fnName","charAt","slice","_transformPoint","shapeOptions","boundsChange","shapeVisual","_visualOptions","_diffNumericOptions","_updateConnectors","connection","idx","diffNumericOptions","stroke","tl","br","bottomRight","fromPoints","modelToView","rotatedBounds","_hover","_showConnectors","rotatedPoint","isEmpty","rects","visualOptions","visualTemplate","translateToOrigin","Connection","from","to","_initRouter","Polyline","_sourcePoint","_targetPoint","_setSource","_setTarget","definers","points","startCap","endCap","fromConnector","toConnector","dataMap","_dataMap","filterConnectionDataItem","fromX","fromY","toX","toY","connectionsDataSource","getByUid","uid","clearField","sourceConnector","targetConnector","_syncConnectionChanges","sourcePoint","_resolvedSourceConnector","shapeSource","defaultConnector","_removeFromSourceConnector","_clearSourceConnector","_setFromOptions","addCompositeItem","ConnectionEditUnit","fromPoint","sourceDefiner","PathDefiner","left","_sourceDefiner","targetPoint","_resolvedTargetConnector","shapeTarget","_removeFromTargetConnector","_clearTargetConnector","_setToOptions","toPoint","targetDefiner","right","_targetDefiner","_updateConnector","instance","getShapeById","connectorName","setNewTarget","inactiveItem","_inactiveShapeItems","_deferredConnectionUpdates","onActivate","offset","allPoints","endIdx","startIdx","equals","endPoint","startPoint","boundingBox","alignToPath","distance","deg","atan2","abs","midIdx","offsetX","offsetY","selection","_adorn","_router","definition","hasOwnProperty","pts","k","_resolveConnectors","_refreshPath","sourceConnectors","targetConnectors","_resolveAutoConnectors","minNonConflict","minDist","minNonConflictSource","minNonConflictTarget","minSource","minTarget","sourceIdx","targetIdx","round","_testRoutePoints","router","passRoute","routePoints","start","end","exclude","_getRouteExclude","unshift","min","_shapesQuadTree","hitTestRect","sourceShape","targetShape","_isPointInsideShape","pointX","pointY","boundsX","boundsY","p","hitTest","_drawPath","getBounds","route","concat","Diagram","element","userOptions","destroy","_initTheme","_initElements","_extendLayoutOptions","_initDefaults","_interactionDefaults","_initCanvas","mainLayer","canvas","ShapesQuadTree","_adorners","adornerLayer","_createHandlers","_initialize","selector","_clipboard","pauseMouseHandlers","_fetchFreshData","_createGlobalToolBar","_createOptionElements","zoom","theme","layout","zoomRate","zoomMin","zoomMax","dataSource","draggable","autoBind","resize","drag","snap","size","pannable","key","tooltip","enabled","format","copy","connectionDefaults","events","items","toolBar","DiagramToolBar","click","_toolBarClick","bind","modal","css","textAlign","prepend","_resize","createShape","editor","view","index","createModel","_createShape","insert","edit","createConnection","_createConnection","_connectionsDataMap","addConnection","editModel","editorType","cancelEdit","editors","shapeEditors","shapeTemplate","connectionSelectorHandler","connectionSelector","connectionEditors","connectionTemplate","PopupEditor","_update","_cancel","_editArgs","_getEditDataSource","cancelChanges","_destroyEditor","saveEdit","sync","container","wrapper","close","empty","attr","addClass","scrollable","appendTo","userShapeDefaults","copyDefaultOptions","mobile","support","mobileOS","multiple","canvasContainer","viewPort","viewport","on","_wheel","_keydown","_userEvents","UserEvents","multiTouch","fastTap","tap","_tap","_dragStart","move","_drag","_dragEnd","gesturestart","_gestureStart","gesturechange","_gestureChange","gestureend","_gestureEnd","doubleTap","_doubleTap","supportDoubleTap","toolService","_mouseover","_mouseout","_mouseMove","_mouseDown","_mouseUp","_syncHandler","_syncChanges","_resizeHandler","onResize","_destroyToolBar","_pauseMouseHandlers","_eventPositions","event","_meta","preventDefault","_createToolBar","_updateHoveredItem","_updateCursor","focused","focus","hoveredItem","meta","ctrlPressed","ctrlKey","addToSelection","deselect","keyDown","keyCode","wheel","metaKey","altKey","shiftKey","touch","pageX","pageY","documentToModel","scroller","disable","initialCenter","eventArgs","_gesture","_initialCenter","previousGesture","documentToView","scaleDelta","_zoom","updateZoom","_getValidZoom","zoomedPoint","times","_panTransform","_updateAdorners","pointPosition","zoomOptions","node","_kendoNode","srcElement","themeName","themes","themeOptions","SASS_THEMES","indexOf","autoTheme","shapesLength","_createShapes","_createConnections","addShape","conn","_findConnectionTarget","unbindResize","off","destroyScroller","_destroyGlobalToolBar","save","is","_activeElement","scrollContainer","containers","offsets","documentElement","document","parentNode","scrollHeight","clientHeight","scrollTop","load","setOptions","connected","c","AddConnectionUnit","added","removed","_addConnection","_parseBounds","AddShapeUnit","_addShape","parseFloat","elements","splitDiagramElements","begin","_removeItem","commit","_removeShapeDataItem","_removeConnectionDataItem","_triggerRemove","toRemove","args","undo","redo","selectAll","selectArea","toFront","_getDiagramItems","unit","_fixOrdering","toBack","bringIntoView","current","original","newPan","animate","_zoomMainLayer","alignShapes","direction","val","undoStates","TransformUnit","staticPoint","viewportVector","raw","_storePan","surface","hideTooltip","_getPan","translate","animatedScrollTo","scrollTo","_copyOffset","cut","paste","copied","mapping","_updateCopiedConnection","sourceConnection","origin","temp","di","union","_containerOffset","containerOffset","top","viewToDocument","viewToModel","_transformWithMatrix","_matrixInvert","_matrix","modelToLayer","_layerMatrix","layerToModel","_layerMatrixInvert","viewPoint","scrollLeft","modelToDocument","matrix","setDataSource","_dataSource","fetch","setConnectionsDataSource","_connectionDataSource","l","TreeLayout","LayeredLayout","SpringLayout","initialState","LayoutState","finalState","LayoutUndoUnit","_redrawConnections","found","first","s","getShapeByModelId","getShapeByModelUid","getConnectionByModelId","getConnectionByModelUid","LayoutBase","defaultOptions","pos","_transformMainLayer","_finishPan","total","NaN","_storeViewMatrix","transform","render","_storeLayerMatrix","canvasTransform","toMatrix","invert","_toIndex","toIndex","shapePos","conPos","removedConnections","_removeShape","_removeConnection","sources","targets","_removeHover","_removeDataItems","recursive","shift","_removeShapeConnections","hasChildren","loaded","_addDataItem","_addDataItemByUid","_addDataItems","parent","parentShape","_refreshSource","action","dataBound","_bindingRoots","_addItem","preventClosing","singleToolBar","padding","popupZIndex","parseInt","closest","popupWidth","_popup","popupHeight","shapeBounds","connectionBounds","showAt","one","_normalizePointZoom","InactiveItemsCollection","undone","redone","_loadingShapes","_loadingConnections","dsOptions","ds","_shapesRefreshHandler","unbind","_shapesRequestStartHandler","_shapesErrorHandler","_refreshShapes","_shapesRequestStart","_error","DataSource","create","_treeDataSource","_connectionsRefreshHandler","_connectionsRequestStartHandler","_connectionsErrorHandler","_refreshConnections","_connectionsRequestStart","_connectionsError","_shouldRefresh","_removeShapes","_updateShapes","_syncShapes","_suspended","_rebindShapesAndConnections","_addShapes","_addConnections","inactiveItems","forEach","isNew","activate","dataItems","_removeConnections","_updateConnections","_addConnectionDataItem","_validateConnector","Error","fields","_refreshHandler","_unbindDataSource","_errorHandler","isActive","show","adorners","refreshBounds","_refresh","hide","exportDOMVisual","viewBox","_viewBox","scrollOffset","viewRect","clipPath","fromRect","wrap","clipWrap","clip","root","exportVisual","scale","when","then","deferredConnectionUpdates","ExportMixin","PDFMixin","_tools","createToolBar","createTools","appendTools","createPopup","kendoPopup","getKendoPopup","tool","buttons","_toolBar","kendoToolBar","resizable","getKendoToolBar","createTool","toolName","attributes","_setAttributes","open","newGroup","editTool","icon","showText","deleteTool","rotateAnticlockwiseTool","_appendGroup","_rotateGroup","step","rotateClockwiseTool","createShapeTool","_createGroup","createConnectionTool","undoTool","_historyGroup","redoTool","prop","_getAttributes","eventData","selectedElements","selectedElemens","rotateClockwise","rotateAnticlockwise","Editor","_getFields","_initContainer","createEditable","Editable","clearContainer","modelFields","find","columns","window","title","formContent","_renderTemplate","_renderFields","_renderButtons","Window","userTriggered","sender","_cancelClick","_attachButtonEvents","unescape","form","_createButton","_cancelClickHandler","_updateClickHandler","_updateClick","_editUpdateClickHandler","reader","textField","idField","kendoDropDownList","dataValueField","dataTextField","optionLabel","valuePrimitive","InactiveItem","callbacks","prototype","callback","deffered","Deferred","deferred","resolve","QuadRoot","_add","_quadNode","splice","_testRect","hit","overlaps","QuadNode","inBounds","nodeRect","nodeBottomRight","overlapsBounds","inserted","_initChildren","halfWidth","halfHeight","childIdx","shapeIdx","ROOT_SIZE","boundsChangeHandler","_boundsChange","initRoots","rootMap","rootSize","sectors","getSectors","inRoot","bottomX","bottomY","xIdx","yIdx","Model","_defaultId","ObservableObject","mainOptions","elementOptions","clippedBBox","plugin","jQuery","amdD","require","__webpack_module_cache__","moduleId","cachedModule","__webpack_exports__"],"sources":["C:/Users/abodean/restapi-nodejs/client/app-router/node_modules/@progress/kendo-ui/js/dataviz/diagram/dom.js"],"sourcesContent":["/******/ (function() { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 92660:\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function(f, define) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(69089), __webpack_require__(60824), __webpack_require__(77261),\n           __webpack_require__(30006),\n           __webpack_require__(87722),\n           __webpack_require__(10239),\n           __webpack_require__(32549),\n           __webpack_require__(80396),\n           __webpack_require__(48643),\n           __webpack_require__(13224),\n           __webpack_require__(39725) ], __WEBPACK_AMD_DEFINE_FACTORY__ = (f),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n})(function() {\n\n    (function($, undefined) {\n        // Imports ================================================================\n        var dataviz = kendo.dataviz,\n            draw = kendo.drawing,\n            geom = kendo.geometry,\n            diagram = dataviz.diagram,\n            Widget = kendo.ui.Widget,\n            Class = kendo.Class,\n            deepExtend = kendo.deepExtend,\n            outerWidth = kendo._outerWidth,\n            outerHeight = kendo._outerHeight,\n            extend = $.extend,\n            HierarchicalDataSource = kendo.data.HierarchicalDataSource,\n            Canvas = diagram.Canvas,\n            Group = diagram.Group,\n            Rectangle = diagram.Rectangle,\n            Circle = diagram.Circle,\n            CompositeTransform = diagram.CompositeTransform,\n            Rect = diagram.Rect,\n            Path = diagram.Path,\n            DeleteShapeUnit = diagram.DeleteShapeUnit,\n            DeleteConnectionUnit = diagram.DeleteConnectionUnit,\n            TextBlock = diagram.TextBlock,\n            Image = diagram.Image,\n            Point = diagram.Point,\n            Intersect = diagram.Intersect,\n            ConnectionEditAdorner = diagram.ConnectionEditAdorner,\n            UndoRedoService = diagram.UndoRedoService,\n            ToolService = diagram.ToolService,\n            Selector = diagram.Selector,\n            ResizingAdorner = diagram.ResizingAdorner,\n            ConnectorsAdorner = diagram.ConnectorsAdorner,\n            Cursors = diagram.Cursors,\n            Utils = diagram.Utils,\n            Observable = kendo.Observable,\n            ToBackUnit = diagram.ToBackUnit,\n            ToFrontUnit = diagram.ToFrontUnit,\n            PolylineRouter = diagram.PolylineRouter,\n            CascadingRouter = diagram.CascadingRouter,\n            isUndefined = Utils.isUndefined,\n            isDefined = Utils.isDefined,\n            defined = draw.util.defined,\n            isArray = Array.isArray,\n            isFunction = kendo.isFunction,\n            isString = Utils.isString,\n            isPlainObject = $.isPlainObject,\n\n            math = Math;\n\n        // Constants ==============================================================\n        var NS = \".kendoDiagram\",\n            CASCADING = \"cascading\",\n            ITEMBOUNDSCHANGE = \"itemBoundsChange\",\n            CHANGE = \"change\",\n            CLICK = \"click\",\n            DRAG = \"drag\",\n            DRAG_END = \"dragEnd\",\n            DRAG_START = \"dragStart\",\n            MOUSE_ENTER = \"mouseEnter\",\n            MOUSE_LEAVE = \"mouseLeave\",\n            ERROR = \"error\",\n            AUTO = \"Auto\",\n            TOP = \"Top\",\n            RIGHT = \"Right\",\n            LEFT = \"Left\",\n            BOTTOM = \"Bottom\",\n            MAXINT = 9007199254740992,\n            SELECT = \"select\",\n            ITEMROTATE = \"itemRotate\",\n            PAN = \"pan\",\n            ZOOM_START = \"zoomStart\",\n            ZOOM_END = \"zoomEnd\",\n            NONE = \"none\",\n            DEFAULT_CANVAS_WIDTH = 600,\n            DEFAULT_CANVAS_HEIGHT = 600,\n            DEFAULT_SHAPE_TYPE = \"rectangle\",\n            DEFAULT_SHAPE_WIDTH = 100,\n            DEFAULT_SHAPE_HEIGHT = 100,\n            DEFAULT_SHAPE_MINWIDTH = 20,\n            DEFAULT_SHAPE_MINHEIGHT = 20,\n            DEFAULT_SHAPE_POSITION = 0,\n            DEFAULT_CONNECTION_BACKGROUND = \"Yellow\",\n            MAX_VALUE = Number.MAX_VALUE,\n            MIN_VALUE = -Number.MAX_VALUE,\n            ABSOLUTE = \"absolute\",\n            TRANSFORMED = \"transformed\",\n            ROTATED = \"rotated\",\n            TRANSPARENT = \"transparent\",\n            WIDTH = \"width\",\n            HEIGHT = \"height\",\n            X = \"x\",\n            Y = \"y\",\n            MOUSEWHEEL_NS = \"DOMMouseScroll\" + NS + \" mousewheel\" + NS,\n            MOBILE_ZOOM_RATE = 0.05,\n            MOBILE_PAN_DISTANCE = 5,\n            BUTTON_TEMPLATE = '<a class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base #=className#\" href=\"\\\\#\">' +\n                '<span class=\"k-button-icon #=iconClass# #=imageClass#\"></span>' +\n                '<span class=\"k-button-text\">#=text#</span>' +\n            '</a>',\n            CONNECTION_CONTENT_OFFSET = 5;\n\n        diagram.DefaultConnectors = [{\n            name: TOP\n        }, {\n            name: BOTTOM\n        }, {\n            name: LEFT\n        }, {\n            name: RIGHT\n        }, {\n            name: AUTO,\n            position: function(shape) {\n                return shape.getPosition(\"center\");\n            }\n        }];\n\n        var defaultButtons = {\n            cancel: {\n                text: \"Cancel\",\n                imageClass: \"k-i-cancel\",\n                className: \"k-diagram-cancel\",\n                iconClass: \"k-icon\"\n            },\n            update: {\n                text: \"Update\",\n                imageClass: \"k-i-checkmark\",\n                className: \"k-diagram-update\",\n                iconClass: \"k-icon\"\n            }\n        };\n\n        diagram.shapeDefaults = function(extra) {\n            var defaults = {\n                type: DEFAULT_SHAPE_TYPE,\n                path: \"\",\n                autoSize: true,\n                visual: null,\n                x: DEFAULT_SHAPE_POSITION,\n                y: DEFAULT_SHAPE_POSITION,\n                minWidth: DEFAULT_SHAPE_MINWIDTH,\n                minHeight: DEFAULT_SHAPE_MINHEIGHT,\n                width: DEFAULT_SHAPE_WIDTH,\n                height: DEFAULT_SHAPE_HEIGHT,\n                hover: {},\n                editable: {\n                    connect: true,\n                    tools: []\n                },\n                connectors: diagram.DefaultConnectors,\n                rotation: {\n                    angle: 0\n                }\n            };\n\n            Utils.simpleExtend(defaults, extra);\n\n            return defaults;\n        };\n\n        function mwDelta(e) {\n            var origEvent = e.originalEvent,\n                delta = 0;\n\n            if (origEvent.wheelDelta) {\n                delta = -origEvent.wheelDelta / 40;\n                delta = delta > 0 ? math.ceil(delta) : math.floor(delta);\n            } else if (origEvent.detail) {\n                delta = origEvent.detail;\n            }\n\n            return delta;\n        }\n\n        function isAutoConnector(connector) {\n            return connector.options.name.toLowerCase() === AUTO.toLowerCase();\n        }\n\n        function closestConnector(point, connectors) {\n            var minimumDistance = MAXINT, resCtr, connector;\n            for (var i = 0; i < connectors.length; i++) {\n                connector = connectors[i];\n                if (!isAutoConnector(connector)) {\n                    var dist = point.distanceTo(connector.position());\n                    if (dist < minimumDistance) {\n                        minimumDistance = dist;\n                        resCtr = connector;\n                    }\n                }\n            }\n            return resCtr;\n        }\n\n        function indicesOfItems(group, visuals) {\n            var i, indices = [], visual;\n            var children = group.drawingContainer().children;\n            var length = children.length;\n            for (i = 0; i < visuals.length; i++) {\n                visual = visuals[i];\n                for (var j = 0; j < length; j++) {\n                    if (children[j] == visual.drawingContainer()) {\n                        indices.push(j);\n                        break;\n                    }\n                }\n            }\n            return indices;\n        }\n\n        var DiagramElement = Observable.extend({\n            init: function(options) {\n                var that = this;\n                that.dataItem = (options || {}).dataItem;\n                Observable.fn.init.call(that);\n                that.options = deepExtend({ id: diagram.randomId() }, that.options, options);\n                that.isSelected = false;\n                that.visual = new Group({\n                    id: that.options.id,\n                    autoSize: that.options.autoSize\n                });\n                that.id = that.options.id;\n                that._template();\n            },\n\n            options: {\n                hover: {},\n                cursor: Cursors.grip,\n                content: {\n                    align: \"center middle\"\n                },\n                selectable: true,\n                serializable: true,\n                enable: true\n            },\n\n            _getCursor: function(point) {\n                if (this.adorner) {\n                    return this.adorner._getCursor(point);\n                }\n                return this.options.cursor;\n            },\n\n            visible: function(value) {\n                if (isUndefined(value)) {\n                    return this.visual.visible();\n                } else {\n                    this.visual.visible(value);\n                }\n            },\n\n            bounds: function() {\n            },\n\n            refresh: function() {\n                this.visual.redraw();\n            },\n\n            position: function(point) {\n                this.options.x = point.x;\n                this.options.y = point.y;\n                this.visual.position(point);\n            },\n\n            toString: function() {\n                return this.options.id;\n            },\n\n            serialize: function() {\n                // the options json object describes the shape perfectly. So this object can serve as shape serialization.\n                var json = deepExtend({}, { options: this.options });\n                if (this.dataItem) {\n                    json.dataItem = this.dataItem.toString();\n                }\n                return json;\n            },\n\n            _content: function(content) {\n                if (content !== undefined) {\n                    var options = this.options;\n\n                    if (diagram.Utils.isString(content)) {\n                        options.content.text = content;\n                    } else {\n                        deepExtend(options.content, content);\n                    }\n\n                    var contentOptions = options.content;\n                    var contentVisual = this._contentVisual;\n\n                    if (!contentVisual) {\n                        this._createContentVisual(contentOptions);\n                    } else {\n                        this._updateContentVisual(contentOptions);\n                    }\n                }\n\n                return this.options.content.text;\n            },\n\n            _createContentVisual: function(options) {\n                if (options.text) {\n                    this._contentVisual = new TextBlock(options);\n                    this._contentVisual._includeInBBox = false;\n                    this.visual.append(this._contentVisual);\n                }\n            },\n\n            _updateContentVisual: function(options) {\n                this._contentVisual.redraw(options);\n            },\n\n            _hitTest: function(point) {\n                var bounds = this.bounds();\n                return this.visible() && bounds.contains(point) && this.options.enable;\n            },\n\n            _template: function() {\n                var that = this;\n                if (that.options.content.template) {\n                    var data = that.dataItem || {},\n                        elementTemplate = kendo.template(that.options.content.template, {\n                            paramName: \"dataItem\"\n                        });\n\n                    that.options.content.text = elementTemplate(data);\n                }\n            },\n\n            _canSelect: function() {\n                return this.options.selectable !== false;\n            },\n\n            toJSON: function() {\n                return {\n                    id: this.options.id\n                };\n            }\n        });\n\n        var Connector = Class.extend({\n            init: function(shape, options) {\n                this.options = deepExtend({}, this.options, options);\n                this.connections = [];\n                this.shape = shape;\n            },\n            options: {\n                width: 7,\n                height: 7,\n                fill: {\n                    color: DEFAULT_CONNECTION_BACKGROUND\n                },\n                hover: {}\n            },\n            position: function() {\n                if (this.options.position) {\n                    return this.options.position(this.shape);\n                } else {\n                    return this.shape.getPosition(this.options.name);\n                }\n            },\n            toJSON: function() {\n                return {\n                    shapeId: this.shape.toString(),\n                    connector: this.options.name\n                };\n            }\n        });\n\n        Connector.parse = function(diagram, str) {\n            var tempStr = str.split(\":\"),\n                id = tempStr[0],\n                name = tempStr[1] || AUTO;\n\n            for (var i = 0; i < diagram.shapes.length; i++) {\n                var shape = diagram.shapes[i];\n                if (shape.options.id == id) {\n                    return shape.getConnector(name.trim());\n                }\n            }\n        };\n\n        var Shape = DiagramElement.extend({\n            init: function(options, diagram) {\n                var that = this;\n                DiagramElement.fn.init.call(that, options);\n                this.diagram = diagram;\n                this.updateOptionsFromModel();\n                options = that.options;\n                that.connectors = [];\n                that.type = options.type;\n                that.createShapeVisual();\n                that.updateBounds();\n                that.content(that.content());\n\n                that._createConnectors();\n            },\n\n            options: diagram.shapeDefaults(),\n\n            _setOptionsFromModel: function(model) {\n                var modelOptions = filterShapeDataItem(model || this.dataItem);\n                this.options = deepExtend({}, this.options, modelOptions);\n\n                this.redrawVisual();\n            },\n\n            updateOptionsFromModel: function(model, field) {\n                if (this.diagram && this.diagram._isEditable) {\n                    var modelOptions = filterShapeDataItem(model || this.dataItem);\n\n                    if (model && field) {\n                        if (!dataviz.inArray(field, [\"x\", \"y\", \"width\", \"height\"])) {\n                            if (this.options.visual) {\n                                this._redrawVisual();\n                            } else if (modelOptions.type) {\n                                this.options = deepExtend({}, this.options, modelOptions);\n                                this._redrawVisual();\n                            }\n\n                            if (this.options.content) {\n                                this._template();\n                                this.content(this.options.content);\n                            }\n                        } else {\n                            var bounds = this.bounds();\n                            bounds[field] = model[field];\n                            this.bounds(bounds);\n                        }\n                    } else {\n                        this.options = deepExtend({}, this.options, modelOptions);\n                    }\n                }\n            },\n\n            _redrawVisual: function() {\n                this.visual.clear();\n                this._contentVisual = null;\n                this.options.dataItem = this.dataItem;\n                this.createShapeVisual();\n                this.updateBounds();\n            },\n\n            redrawVisual: function() {\n                this._redrawVisual();\n                if (this.options.content) {\n                    this._template();\n                    this.content(this.options.content);\n                }\n            },\n\n            updateModel: function(syncChanges) {\n                var diagram = this.diagram;\n                if (diagram && diagram._isEditable) {\n                    var bounds = this._bounds;\n                    var model = this.dataItem;\n\n                    if (model) {\n                        diagram._suspendModelRefresh();\n                        if (defined(model.x) && bounds.x !== model.x) {\n                            model.set(\"x\", bounds.x);\n                        }\n\n                        if (defined(model.y) && bounds.y !== model.y) {\n                            model.set(\"y\", bounds.y);\n                        }\n\n                        if (defined(model.width) && bounds.width !== model.width) {\n                            model.set(\"width\", bounds.width);\n                        }\n\n                        if (defined(model.height) && bounds.height !== model.height) {\n                            model.set(\"height\", bounds.height);\n                        }\n\n                        this.dataItem = model;\n                        diagram._resumeModelRefresh();\n\n                        if (syncChanges) {\n                            diagram._syncShapeChanges();\n                        }\n                    }\n                }\n            },\n\n            updateBounds: function() {\n                var bounds = this.visual._measure(true);\n                var options = this.options;\n                this.bounds(new Rect(options.x, options.y, bounds.width, bounds.height));\n                this._rotate();\n                this._alignContent();\n            },\n\n            content: function(content) {\n                var result = this._content(content);\n\n                this._alignContent();\n\n                return result;\n            },\n\n            _alignContent: function() {\n                var contentOptions = this.options.content || {};\n                var contentVisual = this._contentVisual;\n                if (contentVisual && contentOptions.align) {\n                    var containerRect = this.visual._measure();\n                    var aligner = new diagram.RectAlign(containerRect);\n                    var contentBounds = contentVisual.drawingElement.bbox(null);\n\n                    var contentRect = new Rect(0, 0, contentBounds.width(), contentBounds.height());\n                    var alignedBounds = aligner.align(contentRect, contentOptions.align);\n\n                    contentVisual.position(alignedBounds.topLeft());\n                }\n            },\n\n            _createConnectors: function() {\n                var options = this.options,\n                    length = options.connectors.length,\n                    connectorDefaults = options.connectorDefaults,\n                    connector, i;\n\n                for (i = 0; i < length; i++) {\n                    connector = new Connector(\n                        this, deepExtend({},\n                            connectorDefaults,\n                            options.connectors[i]\n                        )\n                    );\n                    this.connectors.push(connector);\n                }\n            },\n\n            bounds: function(value) {\n                var bounds;\n\n                if (value) {\n                    if (isString(value)) {\n                        switch (value) {\n                            case TRANSFORMED :\n                                bounds = this._transformedBounds();\n                                break;\n                            case ABSOLUTE :\n                                bounds = this._transformedBounds();\n                                var pan = this.diagram._pan;\n                                bounds.x += pan.x;\n                                bounds.y += pan.y;\n                                break;\n                            case ROTATED :\n                                bounds = this._rotatedBounds();\n                                break;\n                            default:\n                                bounds = this._bounds;\n                        }\n                    } else {\n                        this._setBounds(value);\n                        this._triggerBoundsChange();\n                        if (!(this.diagram && this.diagram._layouting)) {\n                            this.refreshConnections();\n                        }\n                    }\n                } else {\n                    bounds = this._bounds;\n                }\n\n                return bounds;\n            },\n\n            _setBounds: function(rect) {\n                var options = this.options;\n                var topLeft = rect.topLeft();\n                var x = options.x = topLeft.x;\n                var y = options.y = topLeft.y;\n                var width = options.width = math.max(rect.width, options.minWidth);\n                var height = options.height = math.max(rect.height, options.minHeight);\n\n                this._bounds = new Rect(x, y, width, height);\n\n                this.visual.redraw({\n                    x: x,\n                    y: y,\n                    width: width,\n                    height: height\n                });\n            },\n\n            position: function(point) {\n                if (point) {\n                    this.bounds(new Rect(point.x, point.y, this._bounds.width, this._bounds.height));\n                } else {\n                    return this._bounds.topLeft();\n                }\n            },\n            /**\n             * Returns a clone of this shape.\n             * @returns {Shape}\n             */\n            clone: function() {\n                var json = this.serialize();\n\n                json.options.id = diagram.randomId();\n\n                if (this.diagram && this.diagram._isEditable && defined(this.dataItem)) {\n                    json.options.dataItem = cloneDataItem(this.dataItem);\n                }\n\n                return new Shape(json.options);\n            },\n\n            select: function(value) {\n                var diagram = this.diagram, selected, deselected;\n                if (isUndefined(value)) {\n                    value = true;\n                }\n\n                if (this._canSelect()) {\n                    if (this.isSelected != value) {\n                        selected = [];\n                        deselected = [];\n                        this.isSelected = value;\n                        if (this.isSelected) {\n                            diagram._selectedItems.push(this);\n                            selected.push(this);\n                        } else {\n                            Utils.remove(diagram._selectedItems, this);\n                            deselected.push(this);\n                        }\n\n                        if (!diagram._internalSelection) {\n                            diagram._selectionChanged(selected, deselected);\n                        }\n\n                        return true;\n                    }\n                }\n            },\n\n            rotate: function(angle, center, undoable) { // we assume the center is always the center of the shape.\n                var rotate = this.visual.rotate();\n                if (angle !== undefined) {\n                    if (undoable !== false && this.diagram && this.diagram.undoRedoService && angle !== rotate.angle) {\n                        this.diagram.undoRedoService.add(\n                            new diagram.RotateUnit(this.diagram._resizingAdorner, [this], [rotate.angle]), false);\n                    }\n\n                    var b = this.bounds(),\n                        sc = new Point(b.width / 2, b.height / 2),\n                        deltaAngle,\n                        newPosition;\n\n                    if (center) {\n                        deltaAngle = angle - rotate.angle;\n                        newPosition = b.center().rotate(center, 360 - deltaAngle).minus(sc);\n                        this._rotationOffset = this._rotationOffset.plus(newPosition.minus(b.topLeft()));\n                        this.position(newPosition);\n                    }\n\n                    this.visual.rotate(angle, sc);\n                    this.options.rotation.angle = angle;\n\n                    if (this.diagram && this.diagram._connectorsAdorner) {\n                        this.diagram._connectorsAdorner.refresh();\n                    }\n\n                    this.refreshConnections();\n\n                    if (this.diagram) {\n                        this.diagram.trigger(ITEMROTATE, { item: this });\n                    }\n                }\n\n                return rotate;\n            },\n\n            connections: function(type) { // in, out, undefined = both\n                var result = [], i, j, con, cons, ctr;\n\n                for (i = 0; i < this.connectors.length; i++) {\n                    ctr = this.connectors[i];\n                    cons = ctr.connections;\n                    for (j = 0, cons; j < cons.length; j++) {\n                        con = cons[j];\n                        if (type == \"out\") {\n                            var source = con.source();\n                            if (source.shape && source.shape == this) {\n                                result.push(con);\n                            }\n                        } else if (type == \"in\") {\n                            var target = con.target();\n                            if (target.shape && target.shape == this) {\n                                result.push(con);\n                            }\n                        } else {\n                            result.push(con);\n                        }\n                    }\n                }\n\n                return result;\n            },\n\n            refreshConnections: function() {\n                $.each(this.connections(), function() {\n                    this.refresh();\n                });\n            },\n            /**\n             * Gets a connector of this shape either by the connector's supposed name or\n             * via a Point in which case the closest connector will be returned.\n             * @param nameOrPoint The name of a Connector or a Point.\n             * @returns {Connector}\n             */\n            getConnector: function(nameOrPoint) {\n                var i, ctr;\n                if (isString(nameOrPoint)) {\n                    nameOrPoint = nameOrPoint.toLocaleLowerCase();\n                    for (i = 0; i < this.connectors.length; i++) {\n                        ctr = this.connectors[i];\n                        if (ctr.options.name.toLocaleLowerCase() == nameOrPoint) {\n                            return ctr;\n                        }\n                    }\n                } else if (nameOrPoint instanceof Point) {\n                    return closestConnector(nameOrPoint, this.connectors);\n                } else {\n                    return this.connectors.length ? this.connectors[0] : null;\n                }\n            },\n\n            getPosition: function(side) {\n                var b = this.bounds(),\n                    fnName = side.charAt(0).toLowerCase() + side.slice(1);\n\n                if (isFunction(b[fnName])) {\n                    return this._transformPoint(b[fnName]());\n                }\n\n                return b.center();\n            },\n\n            redraw: function(options) {\n                if (options) {\n                    var shapeOptions = this.options;\n                    var boundsChange;\n\n                    this.shapeVisual.redraw(this._visualOptions(options));\n\n                    if (this._diffNumericOptions(options, [WIDTH, HEIGHT, X, Y])) {\n                        this.bounds(new Rect(shapeOptions.x, shapeOptions.y, shapeOptions.width, shapeOptions.height));\n                        boundsChange = true;\n                    }\n\n                    if (options.connectors) {\n                        shapeOptions.connectors = options.connectors;\n                        this._updateConnectors();\n                    }\n\n                    shapeOptions = deepExtend(shapeOptions, options);\n\n                    if (options.rotation || boundsChange) {\n                        this._rotate();\n                    }\n\n                    if (shapeOptions.content) {\n                        this.content(shapeOptions.content);\n                    }\n                }\n            },\n\n            _updateConnectors: function() {\n                var connections = this.connections();\n                this.connectors = [];\n                this._createConnectors();\n                var connection;\n                var source;\n                var target;\n\n                for (var idx = 0; idx < connections.length; idx++) {\n                    connection = connections[idx];\n                    source = connection.source();\n                    target = connection.target();\n                    if (source.shape && source.shape === this) {\n                        connection.source(this.getConnector(source.options.name) || null);\n                    } else if (target.shape && target.shape === this) {\n                        connection.target(this.getConnector(target.options.name) || null);\n                    }\n                    connection.updateModel();\n                }\n            },\n\n            _diffNumericOptions: diagram.diffNumericOptions,\n\n            _visualOptions: function(options) {\n                return {\n                    data: options.path,\n                    source: options.source,\n                    hover: options.hover,\n                    fill: options.fill,\n                    stroke: options.stroke\n                };\n            },\n\n            _triggerBoundsChange: function() {\n                if (this.diagram) {\n                    this.diagram.trigger(ITEMBOUNDSCHANGE, { item: this, bounds: this._bounds.clone() }); // the trigger modifies the arguments internally.\n                }\n            },\n\n            _transformPoint: function(point) {\n                var rotate = this.rotate(),\n                    bounds = this.bounds(),\n                    tl = bounds.topLeft();\n\n                if (rotate.angle) {\n                    point.rotate(rotate.center().plus(tl), 360 - rotate.angle);\n                }\n\n                return point;\n            },\n\n            _transformedBounds: function() {\n                var bounds = this.bounds(),\n                    tl = bounds.topLeft(),\n                    br = bounds.bottomRight();\n\n                return Rect.fromPoints(this.diagram.modelToView(tl), this.diagram.modelToView(br));\n            },\n\n            _rotatedBounds: function() {\n                var bounds = this.bounds().rotatedBounds(this.rotate().angle),\n                    tl = bounds.topLeft(),\n                    br = bounds.bottomRight();\n\n                return Rect.fromPoints(tl, br);\n            },\n\n            _rotate: function() {\n                var rotation = this.options.rotation;\n\n                if (rotation && rotation.angle) {\n                    this.rotate(rotation.angle);\n                }\n\n                this._rotationOffset = new Point();\n            },\n\n            _hover: function(value) {\n                var options = this.options,\n                    hover = options.hover,\n                    stroke = options.stroke,\n                    fill = options.fill;\n\n                if (value && isDefined(hover.stroke)) {\n                    stroke = deepExtend({}, stroke, hover.stroke);\n                }\n\n                if (value && isDefined(hover.fill)) {\n                    fill = hover.fill;\n                }\n\n                this.shapeVisual.redraw({\n                    stroke: stroke,\n                    fill: fill\n                });\n\n                if (options.editable && options.editable.connect) {\n                    this.diagram._showConnectors(this, value);\n                }\n            },\n\n            _hitTest: function(value) {\n                if (this.visible()) {\n                    var bounds = this.bounds(), rotatedPoint,\n                        angle = this.rotate().angle;\n\n                    if (value.isEmpty && !value.isEmpty()) { // rect selection\n                        return Intersect.rects(value, bounds, angle ? angle : 0);\n                    } else { // point\n                        rotatedPoint = value.clone().rotate(bounds.center(), angle); // cloning is important because rotate modifies the point inline.\n                        if (bounds.contains(rotatedPoint)) {\n                            return this;\n                        }\n                    }\n                }\n            },\n\n            toJSON: function() {\n                return {\n                    shapeId: this.options.id\n                };\n            },\n\n            createShapeVisual: function() {\n                var options = this.options;\n                var visualOptions = this._visualOptions(options);\n                var visualTemplate = options.visual;\n                var type = (options.type + \"\").toLocaleLowerCase();\n                var shapeVisual;\n\n                visualOptions.width = options.width;\n                visualOptions.height = options.height;\n\n                if (isFunction(visualTemplate)) { // custom template\n                    shapeVisual = visualTemplate.call(this, options);\n                } else if (visualOptions.data) {\n                    shapeVisual = new Path(visualOptions);\n                    translateToOrigin(shapeVisual);\n                } else if (type == \"rectangle\") {\n                    shapeVisual = new Rectangle(visualOptions);\n                } else if (type == \"circle\") {\n                    shapeVisual = new Circle(visualOptions);\n                } else if (type == \"text\") {\n                    shapeVisual = new TextBlock(visualOptions);\n                } else if (type == \"image\") {\n                    shapeVisual = new Image(visualOptions);\n                } else {\n                    shapeVisual = new Path(visualOptions);\n                }\n\n                this.shapeVisual = shapeVisual;\n                this.visual.append(this.shapeVisual);\n            }\n        });\n\n        /**\n         * The visual link between two Shapes through the intermediate of Connectors.\n         */\n        var Connection = DiagramElement.extend({\n            init: function(from, to, options) {\n                var that = this;\n                DiagramElement.fn.init.call(that, options);\n                this.updateOptionsFromModel();\n                this._initRouter();\n                that.path = new diagram.Polyline(that.options);\n                that.path.fill(TRANSPARENT);\n                that.visual.append(that.path);\n                that._sourcePoint = that._targetPoint = new Point();\n                that._setSource(from);\n                that._setTarget(to);\n                that.content(that.options.content);\n                that.definers = [];\n                if (defined(options) && options.points) {\n                    that.points(options.points);\n                }\n            },\n\n            options: {\n                hover: {\n                    stroke: {}\n                },\n                startCap: NONE,\n                endCap: NONE,\n                points: [],\n                selectable: true,\n                fromConnector: AUTO,\n                toConnector: AUTO\n            },\n\n            _setOptionsFromModel: function(model) {\n                this.updateOptionsFromModel(model || this.dataItem);\n            },\n\n            updateOptionsFromModel: function(model) {\n                if (this.diagram && this.diagram._isEditable) {\n                    var dataMap = this.diagram._dataMap;\n                    var options = filterConnectionDataItem(model || this.dataItem);\n\n                    if (model) {\n                        if (defined(options.from)) {\n                            var from = dataMap[options.from];\n                            if (from && defined(options.fromConnector)) {\n                               from = from.getConnector(options.fromConnector);\n                            }\n                            this.source(from);\n                        } else if (defined(options.fromX) && defined(options.fromY)) {\n                            this.source(new Point(options.fromX, options.fromY));\n                        }\n\n                        if (defined(options.to)) {\n                            var to = dataMap[options.to];\n                            if (to && defined(options.toConnector)) {\n                                to = to.getConnector(options.toConnector);\n                            }\n                            this.target(to);\n                        } else if (defined(options.toX) && defined(options.toY)) {\n                            this.target(new Point(options.toX, options.toY));\n                        }\n\n                        if (defined(options.type) && this.type() !== options.type) {\n                            this.points([]);\n                            this.type(options.type);\n                        }\n\n                        this.dataItem = model;\n\n                        this._template();\n                        this.redraw(this.options);\n                    } else {\n                        this.options = deepExtend({}, options, this.options);\n                    }\n                }\n            },\n\n            updateModel: function(syncChanges) {\n                if (this.diagram && this.diagram._isEditable) {\n                    if (this.diagram.connectionsDataSource) {\n                        var model = this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);\n\n                        if (model) {\n                            this.diagram._suspendModelRefresh();\n                            if (defined(this.options.fromX) && this.options.fromX !== null) {\n                                clearField(\"from\", model);\n                                clearField(\"fromConnector\", model);\n                                model.set(\"fromX\", this.options.fromX);\n                                model.set(\"fromY\", this.options.fromY);\n                            } else {\n                                model.set(\"from\", this.options.from);\n                                if (defined(model.fromConnector)) {\n                                    model.set(\"fromConnector\", this.sourceConnector ? this.sourceConnector.options.name : null);\n                                }\n                                clearField(\"fromX\", model);\n                                clearField(\"fromY\", model);\n                            }\n\n                            if (defined(this.options.toX) && this.options.toX !== null) {\n                                clearField(\"to\", model);\n                                clearField(\"toConnector\", model);\n                                model.set(\"toX\", this.options.toX);\n                                model.set(\"toY\", this.options.toY);\n                            } else {\n                                model.set(\"to\", this.options.to);\n                                if (defined(model.toConnector)) {\n                                    model.set(\"toConnector\", this.targetConnector ? this.targetConnector.options.name : null);\n                                }\n                                clearField(\"toX\", model);\n                                clearField(\"toY\", model);\n                            }\n\n                            if (defined(this.options.type) && defined(model.type)) {\n                                model.set(\"type\", this.options.type);\n                            }\n\n                            this.dataItem = model;\n                            this.diagram._resumeModelRefresh();\n\n                            if (syncChanges) {\n                                this.diagram._syncConnectionChanges();\n                            }\n                        }\n                    }\n                }\n            },\n\n            /**\n             * Gets the Point where the source of the connection resides.\n             * If the endpoint in Auto-connector the location of the resolved connector will be returned.\n             * If the endpoint is floating the location of the endpoint is returned.\n             */\n            sourcePoint: function() {\n                return this._resolvedSourceConnector ? this._resolvedSourceConnector.position() : this._sourcePoint;\n            },\n\n            _setSource: function(source) {\n                var shapeSource = source instanceof Shape;\n                var defaultConnector = this.options.fromConnector || AUTO;\n                var dataItem;\n                if (shapeSource && !source.getConnector(defaultConnector)) {\n                    return;\n                }\n\n                if (source !== undefined) {\n                    this.from = source;\n                }\n\n                this._removeFromSourceConnector();\n\n                if (source === null) { // detach\n                    if (this.sourceConnector) {\n                        this._sourcePoint = (this._resolvedSourceConnector || this.sourceConnector).position();\n                        this._clearSourceConnector();\n                        this._setFromOptions(null, this._sourcePoint);\n                    }\n                } else if (source instanceof Connector) {\n                    dataItem = source.shape.dataItem;\n                    if (dataItem) {\n                        this._setFromOptions(dataItem.id);\n                    }\n                    this.sourceConnector = source;\n                    this.sourceConnector.connections.push(this);\n                } else if (source instanceof Point) {\n                    this._setFromOptions(null, source);\n                    this._sourcePoint = source;\n                    if (this.sourceConnector) {\n                        this._clearSourceConnector();\n                    }\n\n                } else if (shapeSource) {\n                    dataItem = source.dataItem;\n                    if (dataItem) {\n                        this._setFromOptions(dataItem.id);\n                    }\n\n                    this.sourceConnector = source.getConnector(defaultConnector);\n                    this.sourceConnector.connections.push(this);\n                }\n            },\n\n            source: function(source, undoable) {\n                if (isDefined(source)) {\n                    if (undoable && this.diagram) {\n                        this.diagram.undoRedoService.addCompositeItem(new diagram.ConnectionEditUnit(this, source));\n                    }\n                    this._setSource(source);\n                    this.refresh();\n                }\n                return this.sourceConnector ? this.sourceConnector : this._sourcePoint;\n            },\n\n            _setFromOptions: function(from, fromPoint) {\n                this.options.from = from;\n                if (fromPoint) {\n                    this.options.fromX = fromPoint.x;\n                    this.options.fromY = fromPoint.y;\n                } else {\n                    this.options.fromX = null;\n                    this.options.fromY = null;\n                }\n            },\n\n            /**\n             * Gets or sets the PathDefiner of the sourcePoint.\n             * The left part of this definer is always null since it defines the source tangent.\n             * @param value\n             * @returns {*}\n             */\n            sourceDefiner: function(value) {\n                if (value) {\n                    if (value instanceof diagram.PathDefiner) {\n                        value.left = null;\n                        this._sourceDefiner = value;\n                        this.source(value.point); // refresh implicit here\n                    } else {\n                        throw \"The sourceDefiner needs to be a PathDefiner.\";\n                    }\n                } else {\n                    if (!this._sourceDefiner) {\n                        this._sourceDefiner = new diagram.PathDefiner(this.sourcePoint(), null, null);\n                    }\n                    return this._sourceDefiner;\n                }\n            },\n\n            /**\n             * Gets  the Point where the target of the connection resides.\n             */\n            targetPoint: function() {\n                return this._resolvedTargetConnector ? this._resolvedTargetConnector.position() : this._targetPoint;\n            },\n\n            _setTarget: function(target) {\n                var shapeTarget = target instanceof Shape;\n                var defaultConnector = this.options.toConnector || AUTO;\n                var dataItem;\n\n                if (shapeTarget && !target.getConnector(defaultConnector)) {\n                    return;\n                }\n\n                if (target !== undefined) {\n                    this.to = target;\n                }\n\n                this._removeFromTargetConnector();\n\n                if (target === null) { // detach\n                    if (this.targetConnector) {\n                        this._targetPoint = (this._resolvedTargetConnector || this.targetConnector).position();\n                        this._clearTargetConnector();\n                        this._setToOptions(null, this._targetPoint);\n                    }\n                } else if (target instanceof Connector) {\n                    dataItem = target.shape.dataItem;\n                    if (dataItem) {\n                        this._setToOptions(dataItem.id);\n                    }\n                    this.targetConnector = target;\n                    this.targetConnector.connections.push(this);\n                } else if (target instanceof Point) {\n                    this._setToOptions(null, target);\n                    this._targetPoint = target;\n                    if (this.targetConnector) {\n                        this._clearTargetConnector();\n                    }\n                } else if (shapeTarget) {\n                    dataItem = target.dataItem;\n                    if (dataItem) {\n                        this._setToOptions(dataItem.id);\n                    }\n                    this.targetConnector = target.getConnector(defaultConnector);\n                    this.targetConnector.connections.push(this);\n                }\n            },\n\n            target: function(target, undoable) {\n                if (isDefined(target)) {\n                    if (undoable && this.diagram) {\n                        this.diagram.undoRedoService.addCompositeItem(new diagram.ConnectionEditUnit(this, undefined, target));\n                    }\n                    this._setTarget(target);\n\n                    this.refresh();\n                }\n                return this.targetConnector ? this.targetConnector : this._targetPoint;\n            },\n\n            _setToOptions: function(to, toPoint) {\n                this.options.to = to;\n                if (toPoint) {\n                    this.options.toX = toPoint.x;\n                    this.options.toY = toPoint.y;\n                } else {\n                    this.options.toX = null;\n                    this.options.toY = null;\n                }\n            },\n\n            /**\n             * Gets or sets the PathDefiner of the targetPoint.\n             * The right part of this definer is always null since it defines the target tangent.\n             * @param value\n             * @returns {*}\n             */\n            targetDefiner: function(value) {\n                if (value) {\n                    if (value instanceof diagram.PathDefiner) {\n                        value.right = null;\n                        this._targetDefiner = value;\n                        this.target(value.point); // refresh implicit here\n                    } else {\n                        throw \"The sourceDefiner needs to be a PathDefiner.\";\n                    }\n                } else {\n                    if (!this._targetDefiner) {\n                        this._targetDefiner = new diagram.PathDefiner(this.targetPoint(), null, null);\n                    }\n                    return this._targetDefiner;\n                }\n            },\n\n            _updateConnectors: function() {\n                this._updateConnector(this.source(), \"source\");\n                this._updateConnector(this.target(), \"target\");\n            },\n\n            _updateConnector: function(instance, name) {\n                var that = this;\n                var diagram = that.diagram;\n                if (instance instanceof Connector && !diagram.getShapeById(instance.shape.id)) {\n                    var dataItem = instance.shape.dataItem;\n                    var connectorName = instance.options.name;\n                    var setNewTarget = function() {\n                        var shape = diagram._dataMap[dataItem.id];\n                        instance = shape.getConnector(connectorName);\n                        that[name](instance, false);\n                        that.updateModel();\n                    };\n                    if (diagram._dataMap[dataItem.id]) {\n                       setNewTarget();\n                    } else {\n                        var inactiveItem = diagram._inactiveShapeItems.getByUid(dataItem.uid);\n                        if (inactiveItem) {\n                            diagram._deferredConnectionUpdates.push(inactiveItem.onActivate(setNewTarget));\n                        }\n                    }\n                } else {\n                    that[name](instance, false);\n                }\n            },\n\n            content: function(content) {\n                var result = this._content(content);\n                if (defined(content)) {\n                    this._alignContent();\n                }\n                return result;\n            },\n\n            _createContentVisual: function(options) {\n                var visual;\n                if (isFunction(options.visual)) {\n                    visual = options.visual.call(this, options);\n                } else if (options.text) {\n                    visual = new TextBlock(options);\n                }\n\n                if (visual) {\n                    this._contentVisual = visual;\n                    visual._includeInBBox = false;\n                    this.visual.append(visual);\n                }\n\n                return visual;\n            },\n\n            _updateContentVisual: function(options) {\n                if (isFunction(options.visual)) {\n                    this.visual.remove(this._contentVisual);\n                    this._createContentVisual(options);\n                } else {\n                    this._contentVisual.redraw(options);\n                }\n            },\n\n            _alignContent: function() {\n                if (this._contentVisual) {\n                    var offset = CONNECTION_CONTENT_OFFSET;\n                    var points = this.allPoints();\n                    var endIdx = math.floor(points.length / 2);\n                    var startIdx = endIdx - 1;\n\n                    while (startIdx > 0 && points[startIdx].equals(points[endIdx])) {\n                        startIdx--;\n                        endIdx++;\n                    }\n\n                    var endPoint = points[endIdx];\n                    var startPoint = points[startIdx];\n\n                    var boundingBox = this._contentVisual._measure();\n                    var width = boundingBox.width;\n                    var height = boundingBox.height;\n                    var alignToPath = points.length % 2 === 0;\n                    var distance = startPoint.distanceTo(endPoint);\n\n                    if (alignToPath && points.length > 2 && distance > 0 &&\n                        ((startPoint.y === endPoint.y && distance < width) || (startPoint.x === endPoint.x && distance < height))) {\n                        alignToPath = false;\n                        offset = 0;\n                    }\n\n                    var point;\n\n                    if (alignToPath) {\n                        var angle = draw.util.deg(math.atan2(endPoint.y - startPoint.y, endPoint.x - startPoint.x));\n                        point = new Point((endPoint.x - startPoint.x) / 2 + startPoint.x, (endPoint.y - startPoint.y) / 2 + startPoint.y);\n\n                        if (math.abs(angle) === 90) {\n                            point.x += offset;\n                            point.y -= height / 2;\n                        } else if (angle % 180 === 0) {\n                            point.x -= width / 2;\n                            point.y -= height + offset;\n                        } else if (angle < -90 || (0 < angle && angle < 90)) {\n                            point.y -= height;\n                        } else if (angle < 0 || angle > 90) {\n                            point.x -= width;\n                            point.y -= height;\n                        }\n                    } else {\n                        var midIdx = math.floor(points.length / 2);\n                        point = points[midIdx].clone();\n                        startPoint = points[midIdx - 1];\n                        endPoint = points[midIdx + 1];\n\n                        var offsetX = startPoint.x <= point.x && endPoint.x <= point.x ? offset : -boundingBox.width - offset;\n                        var offsetY = startPoint.y <= point.y && endPoint.y <= point.y ? offset : -boundingBox.height - offset;\n\n                        point.x += offsetX;\n                        point.y += offsetY;\n                    }\n\n                    this._contentVisual.position(point);\n                }\n            },\n\n            /**\n             * Selects or unselects this connections.\n             * @param value True to select, false to unselect.\n             */\n            select: function(value) {\n                var diagram = this.diagram, selected, deselected;\n                if (this._canSelect()) {\n                    if (this.isSelected !== value) {\n                        this.isSelected = value;\n                        selected = [];\n                        deselected = [];\n                        if (this.isSelected) {\n                            this.adorner = new ConnectionEditAdorner(this, this.options.selection);\n                            diagram._adorn(this.adorner, true);\n                            diagram._selectedItems.push(this);\n                            selected.push(this);\n                        } else {\n                            if (this.adorner) {\n                                diagram._adorn(this.adorner, false);\n                                Utils.remove(diagram._selectedItems, this);\n                                this.adorner = undefined;\n                                deselected.push(this);\n                            }\n                        }\n\n                        if (this.adorner) {\n                            this.adorner.refresh();\n                        }\n\n                        if (!diagram._internalSelection) {\n                            diagram._selectionChanged(selected, deselected);\n                        }\n                        return true;\n                    }\n                }\n            },\n            /**\n             * Gets or sets the bounds of this connection.\n             * @param value A Rect object.\n             * @remark This is automatically set in the refresh().\n             * @returns {Rect}\n             */\n            bounds: function(value) {\n                if (value && !isString(value)) {\n                    this._bounds = value;\n                } else {\n                    return this._bounds;\n                }\n            },\n            /**\n             * Gets or sets the connection type (see ConnectionType enumeration).\n             * @param value A ConnectionType value.\n             * @returns {ConnectionType}\n             */\n            type: function(value) {\n                var options = this.options;\n                if (value) {\n                    if (value !== options.type) {\n                        options.type = value;\n                        this._initRouter();\n                        this.refresh();\n                    }\n                } else {\n                    return options.type;\n                }\n            },\n\n            _initRouter: function() {\n                var type = (this.options.type || \"\").toLowerCase();\n                if (type == CASCADING) {\n                    this._router = new CascadingRouter(this);\n                } else {\n                    this._router = new PolylineRouter(this);\n                }\n            },\n            /**\n             * Gets or sets the collection of *intermediate* points.\n             * The 'allPoints()' property will return all the points.\n             * The 'definers' property returns the definers of the intermediate points.\n             * The 'sourceDefiner' and 'targetDefiner' return the definers of the endpoints.\n             * @param value\n             */\n            points: function(value) {\n                if (value) {\n                    this.definers = [];\n                    for (var i = 0; i < value.length; i++) {\n                        var definition = value[i];\n                        if (definition instanceof diagram.Point) {\n                            this.definers.push(new diagram.PathDefiner(definition));\n                        } else if (definition.hasOwnProperty(\"x\") && definition.hasOwnProperty(\"y\")) { // e.g. Clipboard does not preserve the Point definition and tunred into an Object\n                            this.definers.push(new diagram.PathDefiner(new Point(definition.x, definition.y)));\n                        } else {\n                            throw \"A Connection point needs to be a Point or an object with x and y properties.\";\n                        }\n                    }\n\n                } else {\n                    var pts = [];\n                    if (isDefined(this.definers)) {\n                        for (var k = 0; k < this.definers.length; k++) {\n                            pts.push(this.definers[k].point);\n                        }\n                    }\n                    return pts;\n                }\n            },\n            /**\n             * Gets all the points of this connection. This is the combination of the sourcePoint, the points and the targetPoint.\n             * @returns {Array}\n             */\n            allPoints: function() {\n                var pts = [this.sourcePoint()];\n                if (this.definers) {\n                    for (var k = 0; k < this.definers.length; k++) {\n                        pts.push(this.definers[k].point);\n                    }\n                }\n                pts.push(this.targetPoint());\n                return pts;\n            },\n\n            refresh: function() {\n                this._resolveConnectors();\n                this._refreshPath();\n                this._alignContent();\n\n                if (this.adorner) {\n                    this.adorner.refresh();\n                }\n            },\n\n            _resolveConnectors: function() {\n                var connection = this,\n                    sourcePoint, targetPoint,\n                    sourceConnectors, targetConnectors,\n                    source = connection.source(),\n                    target = connection.target();\n\n                if (source instanceof Point) {\n                    sourcePoint = source;\n                } else if (source instanceof Connector) {\n                    if (isAutoConnector(source)) {\n                        sourceConnectors = source.shape.connectors;\n                    } else {\n                        sourceConnectors = [source];\n                    }\n                }\n\n                if (target instanceof Point) {\n                    targetPoint = target;\n                } else if (target instanceof Connector) {\n                    if (isAutoConnector(target)) {\n                        targetConnectors = target.shape.connectors;\n                    } else {\n                        targetConnectors = [target];\n                    }\n                }\n\n                if (sourcePoint) {\n                    if (targetConnectors) {\n                        connection._resolvedTargetConnector = closestConnector(sourcePoint, targetConnectors);\n                    }\n                } else if (sourceConnectors) {\n                    if (targetPoint) {\n                        connection._resolvedSourceConnector = closestConnector(targetPoint, sourceConnectors);\n                    } else if (targetConnectors) {\n                        this._resolveAutoConnectors(sourceConnectors, targetConnectors);\n                    }\n                }\n            },\n\n            _resolveAutoConnectors: function(sourceConnectors, targetConnectors) {\n                var minNonConflict = MAXINT;\n                var minDist = MAXINT;\n                var minNonConflictSource, minNonConflictTarget;\n                var sourcePoint, targetPoint;\n                var minSource, minTarget;\n                var sourceConnector, targetConnector;\n                var sourceIdx, targetIdx;\n                var dist;\n\n                for (sourceIdx = 0; sourceIdx < sourceConnectors.length; sourceIdx++) {\n                    sourceConnector = sourceConnectors[sourceIdx];\n                    if (!isAutoConnector(sourceConnector)) {\n                        sourcePoint = sourceConnector.position();\n\n                        for (targetIdx = 0; targetIdx < targetConnectors.length; targetIdx++) {\n                            targetConnector = targetConnectors[targetIdx];\n                            if (!isAutoConnector(targetConnector)) {\n                                targetPoint = targetConnector.position();\n                                dist = math.round(sourcePoint.distanceTo(targetPoint));\n\n                                if (dist < minNonConflict && this.diagram && this._testRoutePoints(sourcePoint, targetPoint, sourceConnector, targetConnector)) {\n                                    minNonConflict = dist;\n                                    minNonConflictSource = sourceConnector;\n                                    minNonConflictTarget = targetConnector;\n                                }\n\n                                if (dist < minDist) {\n                                    minSource = sourceConnector;\n                                    minTarget = targetConnector;\n                                    minDist = dist;\n                                }\n                            }\n                        }\n                    }\n                }\n\n                if (minNonConflictSource) {\n                    minSource = minNonConflictSource;\n                    minTarget = minNonConflictTarget;\n                }\n\n                this._resolvedSourceConnector = minSource;\n                this._resolvedTargetConnector = minTarget;\n            },\n\n            _testRoutePoints: function(sourcePoint, targetPoint, sourceConnector, targetConnector) {\n                var router = this._router;\n                var passRoute = true;\n                if (router instanceof CascadingRouter) {\n                    var points = router.routePoints(sourcePoint, targetPoint, sourceConnector, targetConnector),\n                        start, end,\n                         rect, exclude;\n\n                    exclude = this._getRouteExclude(sourcePoint, targetPoint, sourceConnector.shape, targetConnector.shape);\n                    points.unshift(sourcePoint);\n                    points.push(targetPoint);\n\n\n                    for (var idx = 1; idx < points.length; idx++) {\n                        start = points[idx - 1];\n                        end = points[idx];\n                        rect = new Rect(math.min(start.x, end.x), math.min(start.y, end.y),\n                                        math.abs(start.x - end.x), math.abs(start.y - end.y));\n                        if (rect.width > 0) {\n                            rect.x++;\n                            rect.width -= 2;\n                        }\n                        if (rect.height > 0) {\n                            rect.y++;\n                            rect.height -= 2;\n                        }\n\n                        if (!rect.isEmpty() && this.diagram._shapesQuadTree.hitTestRect(rect, exclude)) {\n                            passRoute = false;\n                            break;\n                        }\n                    }\n                }\n                return passRoute;\n            },\n\n            _getRouteExclude: function(sourcePoint, targetPoint, sourceShape, targetShape) {\n                var exclude = [];\n                if (this._isPointInsideShape(sourcePoint, sourceShape)) {\n                    exclude.push(sourceShape);\n                }\n                if (this._isPointInsideShape(targetPoint, targetShape)) {\n                    exclude.push(targetShape);\n                }\n                return exclude;\n            },\n\n            _isPointInsideShape: function(point, shape) {\n                var bounds = shape.bounds(), rotatedPoint,\n                    angle = shape.rotate().angle,\n                    pointX, pointY,\n                    boundsX = bounds.x,\n                    boundsY = bounds.y;\n\n                rotatedPoint = point.clone().rotate(bounds.center(), angle);\n                pointX = rotatedPoint.x;\n                pointY = rotatedPoint.y;\n                return pointX > boundsX && pointX < (boundsX + bounds.width) && pointY > boundsY && pointY < (boundsY + bounds.height);\n            },\n\n            redraw: function(options) {\n                if (options) {\n                    this.options = deepExtend({}, this.options, options);\n\n                    var points = this.options.points;\n\n                    if (defined(points) && points.length > 0) {\n                        this.points(points);\n                        this._refreshPath();\n                    }\n\n                    if ((options && options.content) || options.text) {\n                        this.content(options.content);\n                    }\n\n                    this.path.redraw({\n                        fill: options.fill,\n                        stroke: options.stroke,\n                        startCap: options.startCap,\n                        endCap: options.endCap\n                    });\n                }\n            },\n            /**\n             * Returns a clone of this connection.\n             * @returns {Connection}\n             */\n            clone: function() {\n                var json = this.serialize();\n\n                if (this.diagram && this.diagram._isEditable && defined(this.dataItem)) {\n                    json.options.dataItem = cloneDataItem(this.dataItem);\n                }\n\n                return new Connection(this.from, this.to, json.options);\n            },\n            /**\n             * Returns a serialized connection in json format. Consist of the options and the dataItem.\n             * @returns {Connection}\n             */\n            serialize: function() {\n                var from = this.from.toJSON ? this.from.toJSON : this.from.toString(),\n                    to = this.to.toJSON ? this.to.toJSON : this.to.toString();\n\n                var json = deepExtend({}, {\n                    options: this.options,\n                    from: from,\n                    to: to\n                });\n\n                if (defined(this.dataItem)) {\n                    json.dataItem = this.dataItem.toString();\n                }\n\n                json.options.points = this.points();\n                return json;\n            },\n\n            /**\n             * Returns whether the given Point or Rect hits this connection.\n             * @param value\n             * @returns {Connection}\n             * @private\n             */\n            _hitTest: function(value) {\n                if (this.visible()) {\n                    var p = new Point(value.x, value.y), from = this.sourcePoint(), to = this.targetPoint();\n                    if (value.isEmpty && !value.isEmpty() && value.contains(from) && value.contains(to)) {\n                        return this;\n                    }\n                    if (this._router.hitTest(p)) {\n                        return this;\n                    }\n                }\n            },\n\n            _hover: function(value) {\n                var color = (this.options.stroke || {}).color;\n\n                if (value && isDefined(this.options.hover.stroke.color)) {\n                    color = this.options.hover.stroke.color;\n                }\n\n                this.path.redraw({\n                    stroke: {\n                        color: color\n                    }\n                });\n            },\n\n            _refreshPath: function() {\n                if (!defined(this.path)) {\n                    return;\n                }\n                this._drawPath();\n                this.bounds(this._router.getBounds());\n            },\n\n            _drawPath: function() {\n                if (this._router) {\n                    this._router.route(); // sets the intermediate points\n                }\n                var source = this.sourcePoint();\n                var target = this.targetPoint();\n                var points = this.points();\n\n                this.path.redraw({\n                    points: [source].concat(points, [target])\n                });\n            },\n\n            _clearSourceConnector: function() {\n                this.sourceConnector = undefined;\n                this._resolvedSourceConnector = undefined;\n            },\n\n            _clearTargetConnector: function() {\n                this.targetConnector = undefined;\n                this._resolvedTargetConnector = undefined;\n            },\n\n            _removeFromSourceConnector: function() {\n                if (this.sourceConnector) {\n                    Utils.remove(this.sourceConnector.connections, this);\n                }\n            },\n\n            _removeFromTargetConnector: function() {\n                if (this.targetConnector) {\n                    Utils.remove(this.targetConnector.connections, this);\n                }\n            },\n\n            toJSON: function() {\n                var connection = this;\n                var from, to, point;\n                if (connection.from && connection.from.toJSON) {\n                    from = connection.from.toJSON();\n                } else {\n                    point = connection._sourcePoint;\n                    from = {\n                        x: point.x,\n                        y: point.y\n                    };\n                }\n\n                if (connection.to && connection.to.toJSON) {\n                    to = connection.to.toJSON();\n                } else {\n                    point = connection._targetPoint;\n                    to = {\n                        x: point.x,\n                        y: point.y\n                    };\n                }\n\n                return {\n                    from: from,\n                    to: to\n                };\n            }\n        });\n\n        var Diagram = Widget.extend({\n            init: function(element, userOptions) {\n                var that = this;\n\n                kendo.destroy(element);\n                Widget.fn.init.call(that, element, userOptions);\n\n                that._initTheme();\n\n                that._initElements();\n                that._extendLayoutOptions(that.options);\n                that._initDefaults(userOptions);\n                that._interactionDefaults();\n\n                that._initCanvas();\n\n                that.mainLayer = new Group({\n                    id: \"main-layer\"\n                });\n                that.canvas.append(that.mainLayer);\n\n                that._shapesQuadTree = new ShapesQuadTree(that);\n\n                that._pan = new Point();\n                that._adorners = [];\n                that.adornerLayer = new Group({\n                    id: \"adorner-layer\"\n                });\n                that.canvas.append(that.adornerLayer);\n\n                that._createHandlers();\n\n                that._initialize();\n\n                that._resizingAdorner = new ResizingAdorner(that, { editable: that.options.editable });\n                that._connectorsAdorner = new ConnectorsAdorner(that);\n\n                that._adorn(that._resizingAdorner, true);\n                that._adorn(that._connectorsAdorner, true);\n\n                that.selector = new Selector(that);\n                // TODO: We may consider using real Clipboard API once is supported by the standard.\n                that._clipboard = [];\n\n                that.pauseMouseHandlers = false;\n\n                that._fetchFreshData();\n\n                that._createGlobalToolBar();\n\n                that._createOptionElements();\n\n                that.zoom(that.options.zoom);\n\n                that.canvas.draw();\n            },\n\n            options: {\n                name: \"Diagram\",\n                theme: \"default\",\n                layout: \"\",\n                zoomRate: 0.1,\n                zoom: 1,\n                zoomMin: 0,\n                zoomMax: 2,\n                dataSource: {},\n                draggable: true,\n                template: \"\",\n                autoBind: true,\n                editable: {\n                    rotate: {},\n                    resize: {},\n                    text: true,\n                    tools: [],\n                    drag: {\n                        snap: {\n                            size: 10,\n                            angle: 10\n                        }\n                    },\n                    remove: true\n                },\n                pannable: {},\n                selectable: {\n                    key: \"none\"\n                },\n                tooltip: { enabled: true, format: \"{0}\" },\n                copy: {\n                    enabled: true,\n                    offsetX: 20,\n                    offsetY: 20\n                },\n                shapeDefaults: diagram.shapeDefaults({ undoable: true }),\n                connectionDefaults: {\n                    editable: {\n                        tools: []\n                    },\n                    type: CASCADING\n                },\n                shapes: [],\n                connections: []\n            },\n\n            events: [\n                ZOOM_END,\n                ZOOM_START,\n                PAN, SELECT,\n                ITEMROTATE,\n                ITEMBOUNDSCHANGE,\n                CHANGE,\n                CLICK,\n                MOUSE_ENTER,\n                MOUSE_LEAVE,\n                \"toolBarClick\",\n                \"save\",\n                \"cancel\",\n                \"edit\",\n                \"remove\",\n                \"add\",\n                \"dataBound\",\n                DRAG_START,\n                DRAG,\n                DRAG_END\n            ],\n\n            items: function() {\n                return $();\n            },\n\n            _createGlobalToolBar: function() {\n                var editable = this.options.editable;\n                if (editable) {\n                    var tools = editable.tools;\n                    if (this._isEditable && tools !== false && (!tools || tools.length === 0)) {\n                        tools = [\"createShape\", \"undo\", \"redo\", \"rotateClockwise\", \"rotateAnticlockwise\"];\n                    }\n\n                    if (tools && tools.length) {\n                        this.toolBar = new DiagramToolBar(this, {\n                            tools: tools || {},\n                            click: this._toolBarClick.bind(this),\n                            modal: false\n                        });\n\n                        this.toolBar.element.css({\n                            textAlign: \"left\"\n                        });\n\n                        this.element.prepend(this.toolBar.element);\n                        this._resize();\n                    }\n                }\n            },\n\n            createShape: function() {\n                if ((this.editor && this.editor.end()) || !this.editor) {\n                    var dataSource = this.dataSource;\n                    var view = dataSource.view() || [];\n                    var index = view.length;\n                    var model = createModel(dataSource, {});\n                    var shape = this._createShape(model, {});\n\n                    if (!this.trigger(\"add\", { shape: shape })) {\n                        dataSource.insert(index, model);\n                        var inactiveItem = this._inactiveShapeItems.getByUid(model.uid);\n                        inactiveItem.element = shape;\n                        this.edit(shape);\n                    }\n                }\n            },\n\n            _createShape: function(dataItem, options) {\n                options = deepExtend({}, this.options.shapeDefaults, options);\n                options.dataItem = dataItem;\n                var shape = new Shape(options, this);\n                return shape;\n            },\n\n            createConnection: function() {\n                if (((this.editor && this.editor.end()) || !this.editor)) {\n                    var connectionsDataSource = this.connectionsDataSource;\n                    var view = connectionsDataSource.view() || [];\n                    var index = view.length;\n                    var model = createModel(connectionsDataSource, {});\n                    var connection = this._createConnection(model);\n                    if (!this.trigger(\"add\", { connection: connection })) {\n                        this._connectionsDataMap[model.uid] = connection;\n                        connectionsDataSource.insert(index, model);\n                        this.addConnection(connection, false);\n                        this.edit(connection);\n                    }\n                }\n            },\n\n            _createConnection: function(dataItem, source, target) {\n                var options = deepExtend({}, this.options.connectionDefaults);\n                options.dataItem = dataItem;\n\n                var connection = new Connection(source || new Point(), target || new Point(), options);\n\n                return connection;\n            },\n\n            editModel: function(dataItem, editorType) {\n                this.cancelEdit();\n                var editors, template;\n                var editable = this.options.editable;\n\n                if (editorType == \"shape\") {\n                    editors = editable.shapeEditors;\n                    template = editable.shapeTemplate;\n                } else if (editorType == \"connection\") {\n                    var connectionSelectorHandler = connectionSelector.bind(this);\n                    editors = deepExtend({}, { from: connectionSelectorHandler, to: connectionSelectorHandler }, editable.connectionEditors);\n                    template = editable.connectionTemplate;\n                } else {\n                    return;\n                }\n\n                this.editor = new PopupEditor(this.element, {\n                    update: this._update.bind(this),\n                    cancel: this._cancel.bind(this),\n                    model: dataItem,\n                    type: editorType,\n                    target: this,\n                    editors: editors,\n                    template: template\n                });\n\n                this.trigger(\"edit\", this._editArgs());\n            },\n\n            edit: function(item) {\n                if (item.dataItem) {\n                    var editorType = item instanceof Shape ? \"shape\" : \"connection\";\n                    this.editModel(item.dataItem, editorType);\n                }\n            },\n\n            cancelEdit: function() {\n                if (this.editor) {\n                    this._getEditDataSource().cancelChanges(this.editor.model);\n\n                    this._destroyEditor();\n                }\n            },\n\n            saveEdit: function() {\n                if (this.editor && this.editor.end() &&\n                    !this.trigger(\"save\", this._editArgs())) {\n                    this._getEditDataSource().sync();\n                }\n            },\n\n            _update: function() {\n                if (this.editor && this.editor.end() &&\n                    !this.trigger(\"save\", this._editArgs())) {\n                    this._getEditDataSource().sync();\n                    this._destroyEditor();\n                }\n            },\n\n            _cancel: function() {\n                if (this.editor && !this.trigger(\"cancel\", this._editArgs())) {\n                    var model = this.editor.model;\n                    this._getEditDataSource().cancelChanges(model);\n                    var element = this._connectionsDataMap[model.uid] || this._dataMap[model.id];\n                    if (element) {\n                        element._setOptionsFromModel(model);\n                    }\n                    this._destroyEditor();\n                }\n            },\n\n            _getEditDataSource: function() {\n                return this.editor.options.type === \"shape\" ? this.dataSource : this.connectionsDataSource;\n            },\n\n            _editArgs: function() {\n                var result = { container: this.editor.wrapper };\n                result[this.editor.options.type] = this.editor.model;\n                return result;\n            },\n\n            _destroyEditor: function() {\n                if (this.editor) {\n                    this.editor.close();\n                    this.editor = null;\n                }\n            },\n\n            _initElements: function() {\n                this.wrapper = this.element.empty()\n                    .css(\"position\", \"relative\")\n                    .attr(\"tabindex\", 0)\n                    .addClass(\"k-widget k-diagram\");\n\n                this.scrollable = $(\"<div />\").appendTo(this.element);\n            },\n\n            _initDefaults: function(userOptions) {\n                var options = this.options;\n                var editable = options.editable;\n                var shapeDefaults = options.shapeDefaults;\n                var connectionDefaults = options.connectionDefaults;\n                var userShapeDefaults = (userOptions || {}).shapeDefaults;\n                if (editable === false) {\n                    shapeDefaults.editable = false;\n                    connectionDefaults.editable = false;\n                } else {\n                    copyDefaultOptions(editable, shapeDefaults.editable, [\"drag\", \"remove\", \"connect\"]);\n                    copyDefaultOptions(editable, connectionDefaults.editable, [\"drag\", \"remove\"]);\n                }\n\n                if (userShapeDefaults && userShapeDefaults.connectors) {\n                    options.shapeDefaults.connectors = userShapeDefaults.connectors;\n                }\n            },\n\n            _interactionDefaults: function() {\n                var options = this.options;\n                var selectable = options.selectable;\n                var pannable = options.pannable;\n                var mobile = kendo.support.mobileOS;\n\n                if (selectable && !defined(selectable.multiple)) {\n                    options.selectable = deepExtend({\n                        multiple: mobile ? false : true\n                    }, options.selectable);\n                }\n\n                if (pannable && !defined(pannable.key)) {\n                    options.pannable = deepExtend({\n                        key: mobile ? \"none\" : \"ctrl\"\n                    }, options.pannable);\n                }\n            },\n\n            _initCanvas: function() {\n                var canvasContainer = $(\"<div class='k-layer'></div>\").appendTo(this.scrollable)[0];\n                var viewPort = this.viewport();\n                this.canvas = new Canvas(canvasContainer, {\n                    width: viewPort.width || DEFAULT_CANVAS_WIDTH,\n                    height: viewPort.height || DEFAULT_CANVAS_HEIGHT\n                });\n            },\n\n            _createHandlers: function() {\n                var that = this;\n                var element = that.element;\n\n                element.on(MOUSEWHEEL_NS, that._wheel.bind(that))\n                .on(\"keydown\" + NS, that._keydown.bind(that));\n\n                that._userEvents = new kendo.UserEvents(this.scrollable, {\n                    multiTouch: true,\n                    fastTap: true,\n                    tap: that._tap.bind(that),\n                    start: that._dragStart.bind(that),\n                    move: that._drag.bind(that),\n                    end: that._dragEnd.bind(that),\n                    gesturestart: that._gestureStart.bind(that),\n                    gesturechange: that._gestureChange.bind(that),\n                    gestureend: that._gestureEnd.bind(that),\n                    doubleTap: that._doubleTap.bind(that),\n                    supportDoubleTap: true\n                });\n\n                that.toolService = new ToolService(that);\n\n                this.scrollable\n                    .on(\"mouseover\" + NS, that._mouseover.bind(that))\n                    .on(\"mouseout\" + NS, that._mouseout.bind(that))\n                    .on(\"mousemove\" + NS, that._mouseMove.bind(that))\n                    .on(\"mousedown\" + NS, that._mouseDown.bind(that))\n                    .on(\"mouseup\" + NS, that._mouseUp.bind(that));\n\n                this._syncHandler = that._syncChanges.bind(that);\n\n                that._resizeHandler = that.resize.bind(that, false);\n                kendo.onResize(that._resizeHandler);\n\n                this.bind(ZOOM_START, that._destroyToolBar.bind(that));\n                this.bind(PAN, that._destroyToolBar.bind(that));\n            },\n\n            _dragStart: function(e) {\n                this._pauseMouseHandlers = true;\n                var point = this._eventPositions(e, true);\n\n                var event = e.event;\n                if (this.toolService.start(point, this._meta(event))) {\n                    this._destroyToolBar();\n                    event.preventDefault();\n                }\n            },\n\n            _drag: function(e) {\n                var p = this._eventPositions(e);\n                var event = e.event;\n                if (this.toolService.move(p, this._meta(event))) {\n                    event.preventDefault();\n                }\n            },\n\n            _dragEnd: function(e) {\n                this._pauseMouseHandlers = false;\n                var p = this._eventPositions(e);\n                var event = e.event;\n                if (this.toolService.end(p, this._meta(event))) {\n                    this._createToolBar();\n                    event.preventDefault();\n                }\n            },\n\n            _mouseMove: function(e) {\n                if (!this._pauseMouseHandlers) {\n                    var p = this._eventPositions(e);\n                    this.toolService._updateHoveredItem(p);\n                    this.toolService._updateCursor(p);\n                }\n            },\n\n            _mouseDown: function() {\n                this._pauseMouseHandlers = true;\n            },\n\n            _mouseUp: function() {\n                this._pauseMouseHandlers = false;\n            },\n\n            _tap: function(e) {\n                var toolService = this.toolService;\n                var selectable = this.options.selectable;\n                var point = this._eventPositions(e);\n                var focused = this.focus();\n\n                toolService._updateHoveredItem(point);\n\n                if (toolService.hoveredItem) {\n                    var item = toolService.hoveredItem;\n\n                    this.trigger(\"click\", {\n                        item: item,\n                        point: point,\n                        meta: this._meta(e.event)\n                    });\n\n                    if (selectable && item.options.selectable !== false) {\n                        var multiple = selectable.multiple !== false;\n                        var ctrlPressed = kendo.support.mobileOS || this._meta(e.event).ctrlKey;\n\n                        if (item.isSelected) {\n                            if (ctrlPressed) {\n                                this._destroyToolBar();\n                                item.select(false);\n                            } else {\n                                this._createToolBar(focused);\n                            }\n                        } else {\n                            this._destroyToolBar();\n                            this.select(item, {\n                                addToSelection: multiple && ctrlPressed\n                            });\n                            this._createToolBar(focused);\n                        }\n                    }\n                } else if (selectable) {\n                    this._destroyToolBar();\n                    this.deselect();\n                }\n            },\n\n            _keydown: function(e) {\n                if (this.toolService.keyDown(e.keyCode, this._meta(e))) {\n                    e.preventDefault();\n                }\n            },\n\n            _wheel: function(e) {\n                var delta = mwDelta(e),\n                    p = this._eventPositions(e),\n                    meta = deepExtend(this._meta(e), { delta: delta });\n\n                if (this.toolService.wheel(p, meta)) {\n                    e.preventDefault();\n                }\n            },\n\n            _meta: function(e) {\n                return { ctrlKey: e.ctrlKey, metaKey: e.metaKey, altKey: e.altKey, shiftKey: e.shiftKey, type: e.type };\n            },\n\n            _eventPositions: function(e, start) {\n                var point;\n                if (e.touch) {\n                    var field = start ? \"startLocation\" : \"location\";\n                    point = new Point(e.x[field], e.y[field]);\n                } else {\n                    var event = e.originalEvent;\n                    point = new Point(event.pageX, event.pageY);\n                }\n\n                return this.documentToModel(point);\n            },\n\n            _gestureStart: function(e) {\n                this._destroyToolBar();\n                this.scroller.disable();\n                var initialCenter = this.documentToModel(new Point(e.center.x, e.center.y));\n                var eventArgs = {\n                    point: initialCenter,\n                    zoom: this.zoom()\n                };\n\n                if (this.trigger(ZOOM_START, eventArgs)) {\n                    return;\n                }\n\n                this._gesture = e;\n                this._initialCenter = initialCenter;\n            },\n\n            _gestureChange: function(e) {\n                var previousGesture = this._gesture;\n                var initialCenter = this._initialCenter;\n                var center = this.documentToView(new Point(e.center.x, e.center.y));\n                var scaleDelta = e.distance / previousGesture.distance;\n                var zoom = this._zoom;\n                var updateZoom = false;\n\n                if (math.abs(scaleDelta - 1) >= MOBILE_ZOOM_RATE) {\n                    this._zoom = zoom = this._getValidZoom(zoom * scaleDelta);\n                    this.options.zoom = zoom;\n                    this._gesture = e;\n                    updateZoom = true;\n                }\n\n                var zoomedPoint = initialCenter.times(zoom);\n                var pan = center.minus(zoomedPoint);\n                if (updateZoom || this._pan.distanceTo(pan) >= MOBILE_PAN_DISTANCE) {\n                    this._panTransform(pan);\n                    this._updateAdorners();\n                }\n\n                e.preventDefault();\n            },\n\n            _doubleTap: function(e) {\n                var diagram = this;\n                var pointPosition = this._eventPositions(e);\n                var options = diagram.options;\n                var zoomRate = options.zoomRate;\n                var zoom = diagram.zoom() + zoomRate;\n                var meta = this._meta(e);\n                var zoomOptions = { point: pointPosition, meta: meta, zoom: zoom };\n\n\n                if (diagram.trigger(ZOOM_START, zoomOptions)) {\n                    return;\n                }\n\n                zoom = kendo.dataviz.round(Math.max(options.zoomMin, Math.min(options.zoomMax, zoom)), 2);\n                zoomOptions.zoom = zoom;\n\n                diagram.zoom(zoom, zoomOptions);\n                diagram.trigger(ZOOM_END, zoomOptions);\n            },\n\n            _gestureEnd: function() {\n                if (this.options.pannable !== false) {\n                    this.scroller.enable();\n                }\n                this.trigger(ZOOM_END, {\n                    point: this._initialCenter,\n                    zoom: this.zoom()\n                });\n            },\n\n            _resize: function() {\n                var viewport = this.viewport();\n                if (this.canvas) {\n                    this.canvas.size(viewport);\n                }\n\n                if (this.scrollable && this.toolBar) {\n                    this.scrollable.height(viewport.height);\n                }\n            },\n\n            _mouseover: function(e) {\n                var node = e.target._kendoNode;\n                if (node && node.srcElement._hover) {\n                    node.srcElement._hover(true, node.srcElement);\n                }\n            },\n\n            _mouseout: function(e) {\n                var node = e.target._kendoNode;\n                if (node && node.srcElement._hover) {\n                    node.srcElement._hover(false, node.srcElement);\n                }\n            },\n\n            _initTheme: function() {\n                var that = this;\n                var themeName = ((that.options || {}).theme || \"\").toLowerCase();\n                var themes = dataviz.ui.themes || {};\n                var themeOptions;\n\n                if (dataviz.SASS_THEMES.indexOf(themeName) != -1) {\n                    themeOptions = dataviz.autoTheme().diagram;\n                }\n                else {\n                    themeOptions = (themes[themeName] || {}).diagram;\n                }\n\n                that.options = deepExtend({}, themeOptions, that.options);\n                if (that.options.editable === true) {\n                    deepExtend(that.options, {\n                        editable: (themeOptions || {}).editable\n                    });\n                }\n            },\n\n            _createOptionElements: function() {\n                var options = this.options;\n                var shapesLength = options.shapes.length;\n\n                if (shapesLength) {\n                    this._createShapes();\n                }\n\n                if (options.connections.length) {\n                    this._createConnections();\n                }\n\n                if (shapesLength && options.layout) {\n                    this.layout(options.layout);\n                }\n            },\n\n            _createShapes: function() {\n                var that = this,\n                    options = that.options,\n                    shapes = options.shapes,\n                    shape, i;\n\n                for (i = 0; i < shapes.length; i++) {\n                    shape = shapes[i];\n                    that.addShape(shape);\n                }\n            },\n\n            _createConnections: function() {\n                var diagram = this,\n                    options = diagram.options,\n                    defaults = options.connectionDefaults,\n                    connections = options.connections,\n                    conn, source, target, i;\n\n                for (i = 0; i < connections.length; i++) {\n                    conn = connections[i];\n                    source = diagram._findConnectionTarget(conn.from);\n                    target = diagram._findConnectionTarget(conn.to);\n\n                    diagram.connect(source, target, deepExtend({}, defaults, conn));\n                }\n            },\n\n            _findConnectionTarget: function(options) {\n                options = options || {};\n                var diagram = this;\n                var shapeId = isString(options) ? options : options.shapeId || options.id;\n                var target;\n                if (shapeId) {\n                    target = diagram.getShapeById(shapeId);\n                    if (options.connector) {\n                        target = target.getConnector(options.connector);\n                    }\n                } else {\n                    target = new Point(options.x || 0, options.y || 0);\n                }\n\n                return target;\n            },\n\n            destroy: function() {\n                var that = this;\n                Widget.fn.destroy.call(that);\n\n                if (this._userEvents) {\n                    this._userEvents.destroy();\n                }\n\n                kendo.unbindResize(that._resizeHandler);\n\n                that.clear();\n                that.element.off(NS);\n                that.scroller.wrapper.off(NS);\n                that.canvas.destroy(true);\n                that.canvas = undefined;\n\n                that._destroyEditor();\n                that.destroyScroller();\n                that._destroyGlobalToolBar();\n                that._destroyToolBar();\n            },\n\n            destroyScroller: function() {\n                var scroller = this.scroller;\n\n                if (!scroller) {\n                    return;\n                }\n\n                scroller.destroy();\n                scroller.element.remove();\n                this.scroller = null;\n            },\n\n            save: function() {\n                var json = {\n                    shapes: [],\n                    connections: []\n                };\n                var i, connection, shape;\n\n                for (i = 0; i < this.shapes.length; i++) {\n                    shape = this.shapes[i];\n                    if (shape.options.serializable) {\n                        json.shapes.push(shape.options);\n                    }\n                }\n\n                for (i = 0; i < this.connections.length; i++) {\n                    connection = this.connections[i];\n\n                    json.connections.push(deepExtend({}, connection.options, connection.toJSON()));\n                }\n\n                return json;\n            },\n\n            focus: function() {\n                if (!this.element.is(kendo._activeElement())) {\n                    var element = this.element,\n                        scrollContainer = element[0],\n                        containers = [],\n                        offsets = [],\n                        documentElement = document.documentElement,\n                        i;\n\n                    do {\n                        scrollContainer = scrollContainer.parentNode;\n\n                        if (scrollContainer.scrollHeight > scrollContainer.clientHeight) {\n                            containers.push(scrollContainer);\n                            offsets.push(scrollContainer.scrollTop);\n                        }\n                    } while (scrollContainer != documentElement);\n\n                    element.trigger(\"focus\");\n\n                    for (i = 0; i < containers.length; i++) {\n                        containers[i].scrollTop = offsets[i];\n                    }\n                    return true;\n                }\n            },\n\n            load: function(options) {\n                this.clear();\n\n                this.setOptions(options);\n                this._createShapes();\n                this._createConnections();\n            },\n\n            setOptions: function(options) {\n                deepExtend(this.options, options);\n            },\n\n            clear: function() {\n                var that = this;\n\n                that.select(false);\n                that.mainLayer.clear();\n                that._shapesQuadTree.clear();\n                that._initialize();\n            },\n            /**\n             * Connects two items.\n             * @param source Shape, Connector, Point.\n             * @param target Shape, Connector, Point.\n             * @param options Connection options that will be passed to the newly created connection.\n             * @returns The newly created connection.\n             */\n            connect: function(source, target, options) {\n                var connection;\n                if (this.connectionsDataSource && this._isEditable) {\n                    var dataItem = this.connectionsDataSource.add({});\n                    connection = this._connectionsDataMap[dataItem.uid];\n                    connection.source(source);\n                    connection.target(target);\n                    connection.redraw(options);\n                    connection.updateModel();\n                } else {\n                    connection = new Connection(source, target,\n                        deepExtend({ }, this.options.connectionDefaults, options));\n\n                    this.addConnection(connection);\n                }\n\n                return connection;\n            },\n            /**\n             * Determines whether the the two items are connected.\n             * @param source Shape, Connector, Point.\n             * @param target Shape, Connector, Point.\n             * @returns true if the two items are connected.\n             */\n            connected: function(source, target) {\n                for (var i = 0; i < this.connections.length; i++) {\n                    var c = this.connections[i];\n                    if (c.from == source && c.to == target) {\n                        return true;\n                    }\n                }\n\n                return false;\n            },\n            /**\n             * Adds connection to the diagram.\n             * @param connection Connection.\n             * @param undoable Boolean.\n             * @returns The newly created connection.\n             */\n            addConnection: function(connection, undoable) {\n                if (undoable !== false) {\n                    this.undoRedoService.add(\n                        new diagram.AddConnectionUnit(connection, this), false);\n                }\n\n                connection.diagram = this;\n                connection._setOptionsFromModel();\n                connection.refresh();\n                this.mainLayer.append(connection.visual);\n                this.connections.push(connection);\n\n                this.trigger(CHANGE, {\n                    added: [connection],\n                    removed: []\n                });\n\n                return connection;\n            },\n\n            _addConnection: function(connection, undoable) {\n                var connectionsDataSource = this.connectionsDataSource;\n                var dataItem;\n                if (connectionsDataSource && this._isEditable) {\n                    dataItem = createModel(connectionsDataSource, cloneDataItem(connection.dataItem));\n                    connection.dataItem = dataItem;\n                    connection.updateModel();\n\n                    if (!this.trigger(\"add\", { connection: connection })) {\n                        this._connectionsDataMap[dataItem.uid] = connection;\n\n                        connectionsDataSource.add(dataItem);\n                        this.addConnection(connection, undoable);\n                        connection._updateConnectors();\n\n                        return connection;\n                    }\n                } else if (!this.trigger(\"add\", { connection: connection })) {\n                    this.addConnection(connection, undoable);\n                    connection._updateConnectors();\n                    return connection;\n                }\n            },\n\n            /**\n             * Adds shape to the diagram.\n             * @param item Shape, Point. If point is passed it will be created new Shape and positioned at that point.\n             * @param options. The options to be passed to the newly created Shape.\n             * @returns The newly created shape.\n             */\n            addShape: function(item, undoable) {\n                var shape,\n                    shapeDefaults = this.options.shapeDefaults;\n\n                if (item instanceof Shape) {\n                    shape = item;\n                    this._parseBounds(shape.bounds());\n                } else if (!(item instanceof kendo.Class)) {\n                    shapeDefaults = deepExtend({}, shapeDefaults, item || {});\n                    shape = new Shape(shapeDefaults, this);\n                    this._parseBounds(shape.bounds());\n                } else {\n                    return;\n                }\n\n                if (undoable !== false) {\n                    this.undoRedoService.add(new diagram.AddShapeUnit(shape, this), false);\n                }\n\n                this.shapes.push(shape);\n                if (shape.diagram !== this) {\n                    this._shapesQuadTree.insert(shape);\n                    shape.diagram = this;\n                }\n                this.mainLayer.append(shape.visual);\n\n                this.trigger(CHANGE, {\n                    added: [shape],\n                    removed: []\n                });\n\n                return shape;\n            },\n\n            _addShape: function(shape, undoable) {\n                var that = this;\n                var dataSource = that.dataSource;\n                var dataItem;\n                if (dataSource && this._isEditable) {\n                    dataItem = createModel(dataSource, cloneDataItem(shape.dataItem));\n                    shape.dataItem = dataItem;\n                    shape.updateModel();\n\n                    if (!this.trigger(\"add\", { shape: shape })) {\n                        this.dataSource.add(dataItem);\n                        var inactiveItem = this._inactiveShapeItems.getByUid(dataItem.uid);\n                        inactiveItem.element = shape;\n                        inactiveItem.undoable = undoable;\n                        return shape;\n                    }\n                } else if (!this.trigger(\"add\", { shape: shape })) {\n                    return this.addShape(shape, undoable);\n                }\n            },\n\n            _parseBounds: function(bounds) {\n                bounds.x = typeof(bounds.x) == \"string\" ? parseFloat(bounds.x) : bounds.x;\n                bounds.y = typeof(bounds.y) == \"string\" ? parseFloat(bounds.y) : bounds.y;\n            },\n            /**\n             * Removes items (or single item) from the diagram.\n             * @param items DiagramElement, Array of Items.\n             * @param undoable.\n             */\n\n           remove: function(items, undoable) {\n                items = isArray(items) ? items.slice(0) : [items];\n                var elements = splitDiagramElements(items);\n                var shapes = elements.shapes;\n                var connections = elements.connections;\n                var i;\n\n                if (!defined(undoable)) {\n                    undoable = true;\n                }\n\n                if (undoable) {\n                    this.undoRedoService.begin();\n                }\n\n                this._suspendModelRefresh();\n                for (i = shapes.length - 1; i >= 0; i--) {\n                   this._removeItem(shapes[i], undoable, connections);\n                }\n\n                for (i = connections.length - 1; i >= 0; i--) {\n                    this._removeItem(connections[i], undoable);\n                }\n\n                this._resumeModelRefresh();\n\n                if (undoable) {\n                    this.undoRedoService.commit(false);\n                }\n\n                this.trigger(CHANGE, {\n                    added: [],\n                    removed: items\n                });\n            },\n\n            _removeShapeDataItem: function(item) {\n                if (this._isEditable) {\n                    this.dataSource.remove(item.dataItem);\n                    delete this._dataMap[item.dataItem.id];\n                }\n            },\n\n            _removeConnectionDataItem: function(item) {\n                if (this._isEditable) {\n                    this.connectionsDataSource.remove(item.dataItem);\n                    delete this._connectionsDataMap[item.dataItem.uid];\n                }\n            },\n\n            _triggerRemove: function(items) {\n                var toRemove = [];\n                var item, args, editable;\n\n                for (var idx = 0; idx < items.length; idx++) {\n                    item = items[idx];\n                    editable = item.options.editable;\n                    if (item instanceof Shape) {\n                        args = { shape: item };\n                    } else {\n                        args = { connection: item };\n                    }\n                    if (editable && editable.remove !== false && !this.trigger(\"remove\", args)) {\n                        toRemove.push(item);\n                    }\n                }\n                return toRemove;\n            },\n\n            /**\n             * Executes the next undoable action on top of the undo stack if any.\n             */\n            undo: function() {\n                this.undoRedoService.undo();\n            },\n            /**\n             * Executes the previous undoable action on top of the redo stack if any.\n             */\n            redo: function() {\n                this.undoRedoService.redo();\n            },\n            /**\n             * Selects items on the basis of the given input or returns the current selection if none.\n             * @param itemsOrRect DiagramElement, Array of elements, \"All\", false or Rect. A value 'false' will deselect everything.\n             * @param options\n             * @returns {Array}\n             */\n            select: function(item, options) {\n                if (isDefined(item)) {\n                    options = deepExtend({ addToSelection: false }, options);\n\n                    var addToSelection = options.addToSelection,\n                        items = [],\n                        selected = [],\n                        i, element;\n\n                    if (!addToSelection) {\n                        this.deselect();\n                    }\n\n                    this._internalSelection = true;\n\n                    if (item instanceof Array) {\n                        items = item;\n                    } else if (item instanceof DiagramElement) {\n                        items = [ item ];\n                    }\n\n                    for (i = 0; i < items.length; i++) {\n                        element = items[i];\n                        if (element.select(true)) {\n                            selected.push(element);\n                        }\n                    }\n\n                    this._selectionChanged(selected, []);\n\n                    this._internalSelection = false;\n                } else {\n                    return this._selectedItems;\n                }\n            },\n\n            selectAll: function() {\n                this.select(this.shapes.concat(this.connections));\n            },\n\n            selectArea: function(rect) {\n                var i, items, item;\n                this._internalSelection = true;\n                var selected = [];\n                if (rect instanceof Rect) {\n                    items = this.shapes.concat(this.connections);\n                    for (i = 0; i < items.length; i++) {\n                        item = items[i];\n                        if ((!rect || item._hitTest(rect)) && item.options.enable) {\n                            if (item.select(true)) {\n                                selected.push(item);\n                            }\n                        }\n                    }\n                }\n\n                this._selectionChanged(selected, []);\n                this._internalSelection = false;\n            },\n\n            deselect: function(item) {\n                this._internalSelection = true;\n                var deselected = [],\n                    items = [],\n                    element, i;\n\n                if (item instanceof Array) {\n                    items = item;\n                } else if (item instanceof DiagramElement) {\n                    items.push(item);\n                } else if (!isDefined(item)) {\n                    items = this._selectedItems.slice(0);\n                }\n\n                for (i = 0; i < items.length; i++) {\n                    element = items[i];\n                    if (element.select(false)) {\n                        deselected.push(element);\n                    }\n                }\n\n                this._selectionChanged([], deselected);\n                this._internalSelection = false;\n            },\n            /**\n             * Brings to front the passed items.\n             * @param items DiagramElement, Array of Items.\n             * @param undoable. By default the action is undoable.\n             */\n            toFront: function(items, undoable) {\n                if (!items) {\n                    items = this._selectedItems.slice();\n                }\n\n                var result = this._getDiagramItems(items), indices;\n                if (!defined(undoable) || undoable) {\n                    indices = indicesOfItems(this.mainLayer, result.visuals);\n                    var unit = new ToFrontUnit(this, items, indices);\n                    this.undoRedoService.add(unit);\n                } else {\n                    this.mainLayer.toFront(result.visuals);\n                    this._fixOrdering(result, true);\n                }\n            },\n            /**\n             * Sends to back the passed items.\n             * @param items DiagramElement, Array of Items.\n             * @param undoable. By default the action is undoable.\n             */\n            toBack: function(items, undoable) {\n                if (!items) {\n                    items = this._selectedItems.slice();\n                }\n\n                var result = this._getDiagramItems(items), indices;\n                if (!defined(undoable) || undoable) {\n                    indices = indicesOfItems(this.mainLayer, result.visuals);\n                    var unit = new ToBackUnit(this, items, indices);\n                    this.undoRedoService.add(unit);\n                } else {\n                    this.mainLayer.toBack(result.visuals);\n                    this._fixOrdering(result, false);\n                }\n            },\n            /**\n             * Bring into view the passed item(s) or rectangle.\n             * @param items DiagramElement, Array of Items, Rect.\n             * @param options. align - controls the position of the calculated rectangle relative to the viewport.\n             * \"Center middle\" will position the items in the center. animate - controls if the pan should be animated.\n             */\n            bringIntoView: function(item, options) { // jQuery|Item|Array|Rect\n                var viewport = this.viewport();\n                var aligner = new diagram.RectAlign(viewport);\n                var current, rect, original, newPan;\n\n                if (viewport.width === 0 || viewport.height === 0) {\n                    return;\n                }\n\n                options = deepExtend({ animate: false, align: \"center middle\" }, options);\n                if (options.align == \"none\") {\n                    options.align = \"center middle\";\n                }\n\n                if (item instanceof DiagramElement) {\n                    rect = item.bounds(TRANSFORMED);\n                } else if (isArray(item)) {\n                    rect = this.boundingBox(item);\n                } else if (item instanceof Rect) {\n                    rect = item.clone();\n                }\n\n                original = rect.clone();\n\n                rect.zoom(this._zoom);\n\n                if (rect.width > viewport.width || rect.height > viewport.height) {\n                    this._zoom = this._getValidZoom(math.min(viewport.width / original.width, viewport.height / original.height));\n                    rect = original.clone().zoom(this._zoom);\n                }\n\n                this._zoomMainLayer();\n\n                current = rect.clone();\n                aligner.align(rect, options.align);\n\n                newPan = rect.topLeft().minus(current.topLeft());\n                this.pan(newPan.times(-1), options.animate);\n            },\n\n            alignShapes: function(direction) {\n                if (isUndefined(direction)) {\n                    direction = \"Left\";\n                }\n                var items = this.select(),\n                    val,\n                    item,\n                    i;\n\n                if (items.length === 0) {\n                    return;\n                }\n\n                switch (direction.toLowerCase()) {\n                    case \"left\":\n                    case \"top\":\n                        val = MAX_VALUE;\n                        break;\n                    case \"right\":\n                    case \"bottom\":\n                        val = MIN_VALUE;\n                        break;\n                }\n\n                for (i = 0; i < items.length; i++) {\n                    item = items[i];\n                    if (item instanceof Shape) {\n                        switch (direction.toLowerCase()) {\n                            case \"left\":\n                                val = math.min(val, item.options.x);\n                                break;\n                            case \"top\":\n                                val = math.min(val, item.options.y);\n                                break;\n                            case \"right\":\n                                val = math.max(val, item.options.x);\n                                break;\n                            case \"bottom\":\n                                val = math.max(val, item.options.y);\n                                break;\n                        }\n                    }\n                }\n                var undoStates = [];\n                var shapes = [];\n                for (i = 0; i < items.length; i++) {\n                    item = items[i];\n                    if (item instanceof Shape) {\n                        shapes.push(item);\n                        undoStates.push(item.bounds());\n                        switch (direction.toLowerCase()) {\n                            case \"left\":\n                            case \"right\":\n                                item.position(new Point(val, item.options.y));\n                                break;\n                            case \"top\":\n                            case \"bottom\":\n                                item.position(new Point(item.options.x, val));\n                                break;\n                        }\n                    }\n                }\n                var unit = new diagram.TransformUnit(shapes, undoStates);\n                this.undoRedoService.add(unit, false);\n            },\n\n            zoom: function(zoom, options) {\n                if (zoom) {\n                    var staticPoint = options ? options.point : new diagram.Point(0, 0);\n                    // var meta = options ? options.meta : 0;\n                    zoom = this._zoom = this._getValidZoom(zoom);\n\n                    if (!isUndefined(staticPoint)) {//Viewpoint vector is constant\n                        staticPoint = new diagram.Point(math.round(staticPoint.x), math.round(staticPoint.y));\n                        var zoomedPoint = staticPoint.times(zoom);\n                        var viewportVector = this.modelToView(staticPoint);\n                        var raw = viewportVector.minus(zoomedPoint);//pan + zoomed point = viewpoint vector\n                        this._storePan(new diagram.Point(math.round(raw.x), math.round(raw.y)));\n                    }\n\n                    if (options) {\n                        options.zoom = zoom;\n                    }\n\n                    this._panTransform();\n\n                    this.canvas.surface.hideTooltip();\n\n                    this._updateAdorners();\n                }\n\n                return this._zoom;\n            },\n\n            _getPan: function(pan) {\n                var canvas = this.canvas;\n                if (!canvas.translate) {\n                    pan = pan.plus(this._pan);\n                }\n                return pan;\n            },\n\n            pan: function(pan, animate) {\n                if (pan instanceof Point) {\n                    var that = this;\n                    var scroller = that.scroller;\n                    pan = that._getPan(pan);\n                    pan = pan.times(-1);\n\n                    if (animate) {\n                        scroller.animatedScrollTo(pan.x, pan.y, function() {\n                            that._updateAdorners();\n                        });\n                    } else {\n                        scroller.scrollTo(pan.x, pan.y);\n                        that._updateAdorners();\n                    }\n                } else {\n                    return this._pan.times(-1);\n                }\n            },\n\n            viewport: function() {\n                var element = this.element;\n                var width = element.width();\n                var height = element.height();\n\n                if (this.toolBar) {\n                    height -= outerHeight(this.toolBar.element);\n                }\n\n                return new Rect(0, 0, width, height);\n            },\n            copy: function() {\n                if (this.options.copy.enabled) {\n                    this._clipboard = [];\n                    this._copyOffset = 1;\n                    for (var i = 0; i < this._selectedItems.length; i++) {\n                        var item = this._selectedItems[i];\n                        this._clipboard.push(item);\n                    }\n                }\n            },\n            cut: function() {\n                if (this.options.copy.enabled) {\n                    this._clipboard = [];\n                    this._copyOffset = 0;\n                    for (var i = 0; i < this._selectedItems.length; i++) {\n                        var item = this._selectedItems[i];\n                        this._clipboard.push(item);\n                    }\n                    this.remove(this._clipboard, true);\n                }\n            },\n\n            paste: function() {\n                if (this._clipboard.length > 0) {\n                    var item, copied, i;\n                    var mapping = {};\n                    var elements = splitDiagramElements(this._clipboard);\n                    var connections = elements.connections;\n                    var shapes = elements.shapes;\n                    var offset = {\n                        x: this._copyOffset * this.options.copy.offsetX,\n                        y: this._copyOffset * this.options.copy.offsetY\n                    };\n                    this.deselect();\n                    // first the shapes\n                    for (i = 0; i < shapes.length; i++) {\n                        item = shapes[i];\n                        copied = item.clone();\n                        mapping[item.id] = copied;\n                        copied.position(new Point(item.options.x + offset.x, item.options.y + offset.y));\n                        copied.diagram = this;\n                        copied = this._addShape(copied);\n                        if (copied) {\n                            copied.select();\n                        }\n                    }\n                    // then the connections\n                    for (i = 0; i < connections.length; i++) {\n                        item = connections[i];\n                        copied = this._addConnection(item.clone());\n                        if (copied) {\n                            this._updateCopiedConnection(copied, item, \"source\", mapping, offset);\n                            this._updateCopiedConnection(copied, item, \"target\", mapping, offset);\n\n                            copied.select(true);\n                            copied.updateModel();\n                        }\n                    }\n\n                    this._syncChanges();\n\n                    this._copyOffset += 1;\n                }\n            },\n\n            _updateCopiedConnection: function(connection, sourceConnection, connectorName, mapping, offset) {\n                var onActivate, inactiveItem, targetShape;\n                var target = sourceConnection[connectorName]();\n                var diagram = this;\n                if (target instanceof Connector && mapping[target.shape.id]) {\n                    targetShape = mapping[target.shape.id];\n                    if (diagram.getShapeById(targetShape.id)) {\n                        connection[connectorName](targetShape.getConnector(target.options.name));\n                    } else {\n                        inactiveItem = diagram._inactiveShapeItems.getByUid(targetShape.dataItem.uid);\n                        if (inactiveItem) {\n                            onActivate = function(item) {\n                                targetShape = diagram._dataMap[item.id];\n                                connection[connectorName](targetShape.getConnector(target.options.name));\n                                connection.updateModel();\n                            };\n                            diagram._deferredConnectionUpdates.push(inactiveItem.onActivate(onActivate));\n                        }\n                    }\n                } else {\n                    connection[connectorName](new Point(sourceConnection[connectorName + \"Point\"]().x + offset.x, sourceConnection[connectorName + \"Point\"]().y + offset.y));\n                }\n            },\n            /**\n             * Gets the bounding rectangle of the given items.\n             * @param items DiagramElement, Array of elements.\n             * @param origin Boolean. Pass 'true' if you need to get the bounding box of the shapes without their rotation offset.\n             * @returns {Rect}\n             */\n            boundingBox: function(items, origin) {\n                var rect = Rect.empty(), temp,\n                    di = isDefined(items) ? this._getDiagramItems(items) : { shapes: this.shapes };\n                if (di.shapes.length > 0) {\n                    var item = di.shapes[0];\n                    rect = item.bounds(ROTATED);\n                    for (var i = 1; i < di.shapes.length; i++) {\n                        item = di.shapes[i];\n                        temp = item.bounds(ROTATED);\n                        if (origin === true) {\n                            temp.x -= item._rotationOffset.x;\n                            temp.y -= item._rotationOffset.y;\n                        }\n                        rect = rect.union(temp);\n                    }\n                }\n                return rect;\n            },\n\n            _containerOffset: function() {\n                var containerOffset = this.element.offset();\n                if (this.toolBar) {\n                    containerOffset.top += outerHeight(this.toolBar.element);\n                }\n                return containerOffset;\n            },\n\n            documentToView: function(point) {\n                var containerOffset = this._containerOffset();\n\n                return new Point(point.x - containerOffset.left, point.y - containerOffset.top);\n            },\n            viewToDocument: function(point) {\n                var containerOffset = this._containerOffset();\n\n                return new Point(point.x + containerOffset.left, point.y + containerOffset.top);\n            },\n            viewToModel: function(point) {\n                return this._transformWithMatrix(point, this._matrixInvert);\n            },\n            modelToView: function(point) {\n                return this._transformWithMatrix(point, this._matrix);\n            },\n            modelToLayer: function(point) {\n                return this._transformWithMatrix(point, this._layerMatrix);\n            },\n            layerToModel: function(point) {\n                return this._transformWithMatrix(point, this._layerMatrixInvert);\n            },\n            documentToModel: function(point) {\n                var viewPoint = this.documentToView(point);\n                if (!this.canvas.translate) {\n                    viewPoint.x = viewPoint.x + this.scroller.scrollLeft;\n                    viewPoint.y = viewPoint.y + this.scroller.scrollTop;\n                }\n                return this.viewToModel(viewPoint);\n            },\n            modelToDocument: function(point) {\n                return this.viewToDocument(this.modelToView(point));\n            },\n            _transformWithMatrix: function(point, matrix) {\n                var result = point;\n                if (point instanceof Point) {\n                    if (matrix) {\n                        result = matrix.apply(point);\n                    }\n                }\n                else {\n                    var tl = this._transformWithMatrix(point.topLeft(), matrix),\n                        br = this._transformWithMatrix(point.bottomRight(), matrix);\n                    result = Rect.fromPoints(tl, br);\n                }\n                return result;\n            },\n\n            setDataSource: function(dataSource) {\n                this.options.dataSource = dataSource;\n                this._dataSource();\n                if (this.options.autoBind) {\n                    this.dataSource.fetch();\n                }\n            },\n\n            setConnectionsDataSource: function(dataSource) {\n                this.options.connectionsDataSource = dataSource;\n                this._connectionDataSource();\n                if (this.options.autoBind) {\n                    this.connectionsDataSource.fetch();\n                }\n            },\n\n            /**\n             * Performs a diagram layout of the given type.\n             * @param layoutType The layout algorithm to be applied (TreeLayout, LayeredLayout, SpringLayout).\n             * @param options Layout-specific options.\n             */\n            layout: function(options) {\n                this._layouting = true;\n                // TODO: raise layout event?\n                var type;\n                if (isUndefined(options)) {\n                    options = this.options.layout;\n                }\n                if (isUndefined(options) || isUndefined(options.type)) {\n                    type = \"Tree\";\n                }\n                else {\n                    type = options.type;\n                }\n                var l;\n                switch (type.toLowerCase()) {\n                    case \"tree\":\n                        l = new diagram.TreeLayout(this);\n                        break;\n\n                    case \"layered\":\n                        l = new diagram.LayeredLayout(this);\n                        break;\n\n                    case \"forcedirected\":\n                    case \"force\":\n                    case \"spring\":\n                    case \"springembedder\":\n                        l = new diagram.SpringLayout(this);\n                        break;\n                    default:\n                        throw \"Layout algorithm '\" + type + \"' is not supported.\";\n                }\n                var initialState = new diagram.LayoutState(this);\n                var finalState = l.layout(options);\n                if (finalState) {\n                    var unit = new diagram.LayoutUndoUnit(initialState, finalState, options ? options.animate : null);\n                    this.undoRedoService.add(unit);\n                }\n                this._layouting = false;\n                this._redrawConnections();\n            },\n            /**\n             * Gets a shape on the basis of its identifier.\n             * @param id (string) the identifier of a shape.\n             * @returns {Shape}\n             */\n            getShapeById: function(id) {\n                var found;\n                found = Utils.first(this.shapes, function(s) {\n                    return s.visual.id === id;\n                });\n                if (found) {\n                    return found;\n                }\n                found = Utils.first(this.connections, function(c) {\n                    return c.visual.id === id;\n                });\n                return found;\n            },\n\n            getShapeByModelId: function(id) {\n                var shape;\n                if (this._isEditable) {\n                    shape = this._dataMap[id];\n                } else {\n                    shape = Utils.first(this.shapes, function(shape) {\n                        return (shape.dataItem || {}).id === id;\n                    });\n                }\n                return shape;\n            },\n\n            getShapeByModelUid: function(uid) {\n                var shape;\n                if (this._isEditable) {\n                    shape = Utils.first(this.shapes, function(shape) {\n                        return (shape.dataItem || {}).uid === uid;\n                    });\n                } else {\n                    shape = this._dataMap[uid];\n                }\n                return shape;\n            },\n\n            getConnectionByModelId: function(id) {\n                var connection;\n                if (this.connectionsDataSource) {\n                    connection = Utils.first(this.connections, function(connection) {\n                        return (connection.dataItem || {}).id === id;\n                    });\n                }\n                return connection;\n            },\n\n            getConnectionByModelUid: function(uid) {\n                var connection;\n                if (this.connectionsDataSource) {\n                    connection = this._connectionsDataMap[uid];\n                }\n                return connection;\n            },\n\n            _extendLayoutOptions: function(options) {\n                if (options.layout) {\n                    options.layout = deepExtend({}, diagram.LayoutBase.fn.defaultOptions || {}, options.layout);\n                }\n            },\n\n            _selectionChanged: function(selected, deselected) {\n                if (selected.length || deselected.length) {\n                    this.trigger(SELECT, { selected: selected, deselected: deselected });\n                }\n            },\n            _getValidZoom: function(zoom) {\n                return math.min(math.max(zoom, this.options.zoomMin), this.options.zoomMax);\n            },\n            _panTransform: function(pos) {\n                var diagram = this,\n                    pan = pos || diagram._pan;\n\n                if (diagram.canvas.translate) {\n                    diagram.scroller.scrollTo(pan.x, pan.y);\n                    diagram._zoomMainLayer();\n                } else {\n                    diagram._storePan(pan);\n                    diagram._transformMainLayer();\n                }\n            },\n\n            _finishPan: function() {\n                this.trigger(PAN, { total: this._pan, delta: Number.NaN });\n            },\n            _storePan: function(pan) {\n                this._pan = pan;\n                this._storeViewMatrix();\n            },\n            _zoomMainLayer: function() {\n                var zoom = this._zoom;\n\n                var transform = new CompositeTransform(0, 0, zoom, zoom);\n                transform.render(this.mainLayer);\n                this._storeLayerMatrix(transform);\n                this._storeViewMatrix();\n            },\n            _transformMainLayer: function() {\n                var pan = this._pan,\n                    zoom = this._zoom;\n\n                var transform = new CompositeTransform(pan.x, pan.y, zoom, zoom);\n                transform.render(this.mainLayer);\n                this._storeLayerMatrix(transform);\n                this._storeViewMatrix();\n            },\n            _storeLayerMatrix: function(canvasTransform) {\n                this._layerMatrix = canvasTransform.toMatrix();\n                this._layerMatrixInvert = canvasTransform.invert().toMatrix();\n            },\n            _storeViewMatrix: function() {\n                var pan = this._pan,\n                    zoom = this._zoom;\n\n                var transform = new CompositeTransform(pan.x, pan.y, zoom, zoom);\n                this._matrix = transform.toMatrix();\n                this._matrixInvert = transform.invert().toMatrix();\n            },\n            _toIndex: function(items, indices) {\n                var result = this._getDiagramItems(items);\n                this.mainLayer.toIndex(result.visuals, indices);\n                this._fixOrdering(result, false);\n            },\n            _fixOrdering: function(result, toFront) {\n                var shapePos = toFront ? this.shapes.length - 1 : 0,\n                    conPos = toFront ? this.connections.length - 1 : 0,\n                    i, item;\n                for (i = 0; i < result.shapes.length; i++) {\n                    item = result.shapes[i];\n                    Utils.remove(this.shapes, item);\n                    Utils.insert(this.shapes, item, shapePos);\n                }\n                for (i = 0; i < result.cons.length; i++) {\n                    item = result.cons[i];\n                    Utils.remove(this.connections, item);\n                    Utils.insert(this.connections, item, conPos);\n                }\n            },\n            _getDiagramItems: function(items) {\n                var i, result = {}, args = items;\n                result.visuals = [];\n                result.shapes = [];\n                result.cons = [];\n\n                if (!items) {\n                    args = this._selectedItems.slice();\n                } else if (!isArray(items)) {\n                    args = [items];\n                }\n\n                for (i = 0; i < args.length; i++) {\n                    var item = args[i];\n                    if (item instanceof Shape) {\n                        result.shapes.push(item);\n                        result.visuals.push(item.visual);\n                    } else if (item instanceof Connection) {\n                        result.cons.push(item);\n                        result.visuals.push(item.visual);\n                    }\n                }\n\n                return result;\n            },\n\n            _removeItem: function(item, undoable, removedConnections) {\n                item.select(false);\n                if (item instanceof Shape) {\n                    this._removeShapeDataItem(item);\n                    this._removeShape(item, undoable, removedConnections);\n                } else if (item instanceof Connection) {\n                    this._removeConnectionDataItem(item);\n                    this._removeConnection(item, undoable);\n                }\n\n                this.mainLayer.remove(item.visual);\n            },\n\n            _removeShape: function(shape, undoable, removedConnections) {\n                var i, connection, connector,\n                    sources = [], targets = [];\n                this.toolService._removeHover();\n\n                if (undoable) {\n                    this.undoRedoService.addCompositeItem(new DeleteShapeUnit(shape));\n                }\n                Utils.remove(this.shapes, shape);\n                this._shapesQuadTree.remove(shape);\n\n                for (i = 0; i < shape.connectors.length; i++) {\n                    connector = shape.connectors[i];\n                    for (var j = 0; j < connector.connections.length; j++) {\n                        connection = connector.connections[j];\n                        if (!removedConnections || !dataviz.inArray(connection, removedConnections)) {\n                            if (connection.sourceConnector == connector) {\n                                sources.push(connection);\n                            } else if (connection.targetConnector == connector) {\n                                targets.push(connection);\n                            }\n                        }\n                    }\n                }\n\n                for (i = 0; i < sources.length; i++) {\n                    sources[i].source(null, undoable);\n                    sources[i].updateModel();\n                }\n                for (i = 0; i < targets.length; i++) {\n                    targets[i].target(null, undoable);\n                    targets[i].updateModel();\n                }\n            },\n\n            _removeConnection: function(connection, undoable) {\n                if (connection.sourceConnector) {\n                    Utils.remove(connection.sourceConnector.connections, connection);\n                }\n                if (connection.targetConnector) {\n                    Utils.remove(connection.targetConnector.connections, connection);\n                }\n                if (undoable) {\n                    this.undoRedoService.addCompositeItem(new DeleteConnectionUnit(connection));\n                }\n\n                Utils.remove(this.connections, connection);\n            },\n\n            _removeDataItems: function(items, recursive) {\n                var item, children, shape, idx;\n                items = isArray(items) ? items : [items];\n\n                while (items.length) {\n                    item = items.shift();\n                    shape = this._dataMap[item.uid];\n                    if (shape) {\n                        this._removeShapeConnections(shape);\n                        this._removeItem(shape, false);\n                        delete this._dataMap[item.uid];\n                        if (recursive && item.hasChildren && item.loaded()) {\n                            children = item.children.data();\n                            for (idx = 0; idx < children.length; idx++) {\n                                items.push(children[idx]);\n                            }\n                        }\n                    }\n                }\n            },\n\n            _removeShapeConnections: function(shape) {\n                var connections = shape.connections();\n                var idx;\n\n                if (connections) {\n                    for (idx = 0; idx < connections.length; idx++) {\n                        this._removeItem(connections[idx], false);\n                    }\n                }\n            },\n\n            _addDataItem: function(dataItem, undoable) {\n                if (!defined(dataItem)) {\n                    return;\n                }\n\n                var shape = this._dataMap[dataItem.id];\n                if (shape) {\n                    return shape;\n                }\n\n                var options = deepExtend({}, this.options.shapeDefaults);\n                options.dataItem = dataItem;\n                shape = new Shape(options, this);\n                this.addShape(shape, undoable !== false);\n                this._dataMap[dataItem.id] = shape;\n                return shape;\n            },\n\n            _addDataItemByUid: function(dataItem) {\n                if (!defined(dataItem)) {\n                    return;\n                }\n\n                var shape = this._dataMap[dataItem.uid];\n                if (shape) {\n                    return shape;\n                }\n\n                var options = deepExtend({}, this.options.shapeDefaults);\n                options.dataItem = dataItem;\n                shape = new Shape(options, this);\n                this.addShape(shape);\n                this._dataMap[dataItem.uid] = shape;\n                return shape;\n            },\n\n            _addDataItems: function(items, parent) {\n                var item, idx, shape, parentShape, connection;\n                for (idx = 0; idx < items.length; idx++) {\n                    item = items[idx];\n                    shape = this._addDataItemByUid(item);\n                    parentShape = this._addDataItemByUid(parent);\n                    if (parentShape && !this.connected(parentShape, shape)) { // check if connected to not duplicate connections.\n                        connection = this.connect(parentShape, shape);\n                    }\n                }\n            },\n\n            _refreshSource: function(e) {\n                var that = this,\n                    node = e.node,\n                    action = e.action,\n                    items = e.items,\n                    options = that.options,\n                    idx,\n                    dataBound;\n\n                if (e.field) {\n                    for (idx = 0; idx < items.length; idx++) {\n                        if (this._dataMap[items[idx].uid]) {\n                            this._dataMap[items[idx].uid].redrawVisual();\n                        }\n                    }\n                    return;\n                }\n\n                if (action == \"remove\") {\n                    this._removeDataItems(e.items, true);\n                } else {\n\n                    if ((!action || action === \"itemloaded\") && !this._bindingRoots) {\n                        this._bindingRoots = true;\n                        dataBound = true;\n                    }\n\n                    if (!action && !node) {\n                        that.clear();\n                    }\n\n                    this._addDataItems(items, node);\n\n                    for (idx = 0; idx < items.length; idx++) {\n                        items[idx].load();\n                    }\n                }\n\n                if (options.layout && (dataBound || action == \"remove\" || action == \"add\")) {\n                    that.layout(options.layout);\n                }\n\n                if (dataBound) {\n                    this.trigger(\"dataBound\");\n                    this._bindingRoots = false;\n                }\n            },\n\n            _addItem: function(item) {\n                if (item instanceof Shape) {\n                    this.addShape(item);\n                } else if (item instanceof Connection) {\n                    this.addConnection(item);\n                }\n            },\n\n            _createToolBar: function(preventClosing) {\n                var diagram = this.toolService.diagram;\n\n                if (!this.singleToolBar && diagram.select().length === 1) {\n                    var element = diagram.select()[0];\n                    if (element && element.options.editable !== false) {\n                        var editable = element.options.editable;\n                        var tools = editable.tools;\n                        if (this._isEditable && tools.length === 0) {\n                            if (element instanceof Shape) {\n                                tools = [\"edit\", \"rotateClockwise\", \"rotateAnticlockwise\"];\n                            } else if (element instanceof Connection) {\n                                tools = [\"edit\"];\n                            }\n\n                            if (editable && editable.remove !== false) {\n                                tools.push(\"delete\");\n                            }\n                        }\n\n                        if (tools && tools.length) {\n                            var padding = 20;\n                            var point;\n                            this.singleToolBar = new DiagramToolBar(diagram, {\n                                tools: tools,\n                                click: this._toolBarClick.bind(this),\n                                modal: true,\n                                popupZIndex: parseInt(diagram.element.closest(\".k-window\").css(\"zIndex\"), 10) + 10\n                            });\n                            var popupWidth = outerWidth(this.singleToolBar._popup.element);\n                            var popupHeight = outerHeight(this.singleToolBar._popup.element);\n                            if (element instanceof Shape) {\n                                var shapeBounds = this.modelToView(element.bounds(ROTATED));\n                                point = new Point(shapeBounds.x, shapeBounds.y).minus(new Point(\n                                    (popupWidth - shapeBounds.width) / 2,\n                                    popupHeight + padding));\n                            } else if (element instanceof Connection) {\n                                var connectionBounds = this.modelToView(element.bounds());\n\n                                point = new Point(connectionBounds.x, connectionBounds.y)\n                                    .minus(new Point(\n                                        (popupWidth - connectionBounds.width - 20) / 2,\n                                        popupHeight + padding\n                                    ));\n                            }\n\n                            if (point) {\n                                if (!this.canvas.translate) {\n                                    point = point.minus(new Point(this.scroller.scrollLeft, this.scroller.scrollTop));\n                                }\n                                point = this.viewToDocument(point);\n                                point = new Point(math.max(point.x, 0), math.max(point.y, 0));\n                                this.singleToolBar.showAt(point);\n                                if (preventClosing) {\n                                    this.singleToolBar._popup.one(\"close\", preventDefault);\n                                }\n                            } else {\n                                this._destroyToolBar();\n                            }\n                        }\n                    }\n                }\n            },\n\n            _toolBarClick: function(e) {\n                this.trigger(\"toolBarClick\", e);\n                this._destroyToolBar();\n            },\n\n            _normalizePointZoom: function(point) {\n                return point.times(1 / this.zoom());\n            },\n\n            _initialize: function() {\n                this.shapes = [];\n                this._selectedItems = [];\n                this.connections = [];\n                this._dataMap = {};\n                this._connectionsDataMap = {};\n                this._inactiveShapeItems = new InactiveItemsCollection();\n                this._deferredConnectionUpdates = [];\n                this.undoRedoService = new UndoRedoService({\n                    undone: this._syncHandler,\n                    redone: this._syncHandler\n                });\n                this.id = diagram.randomId();\n            },\n\n            _fetchFreshData: function() {\n                var that = this;\n                that._dataSource();\n\n                if (that._isEditable) {\n                    that._connectionDataSource();\n                }\n\n                if (that.options.autoBind) {\n                    if (that._isEditable) {\n                        this._loadingShapes = true;\n                        this._loadingConnections = true;\n                        that.dataSource.fetch();\n                        that.connectionsDataSource.fetch();\n                    } else {\n                        that.dataSource.fetch();\n                    }\n                }\n            },\n\n            _dataSource: function() {\n                if (defined(this.options.connectionsDataSource)) {\n                    this._isEditable = true;\n                    var dsOptions = this.options.dataSource || {};\n                    var ds = isArray(dsOptions) ? { data: dsOptions } : dsOptions;\n\n                    if (this.dataSource && this._shapesRefreshHandler) {\n                        this.dataSource\n                            .unbind(\"change\", this._shapesRefreshHandler)\n                            .unbind(\"requestStart\", this._shapesRequestStartHandler)\n                            .unbind(\"error\", this._shapesErrorHandler);\n                    } else {\n                        this._shapesRefreshHandler = this._refreshShapes.bind(this);\n                        this._shapesRequestStartHandler = this._shapesRequestStart.bind(this);\n                        this._shapesErrorHandler = this._error.bind(this);\n                    }\n\n                    this.dataSource = kendo.data.DataSource.create(ds)\n                        .bind(\"change\", this._shapesRefreshHandler)\n                        .bind(\"requestStart\", this._shapesRequestStartHandler)\n                        .bind(\"error\", this._shapesErrorHandler);\n                } else {\n                    this._treeDataSource();\n                    this._isEditable = false;\n                }\n            },\n\n            _connectionDataSource: function() {\n                var dsOptions = this.options.connectionsDataSource;\n                if (dsOptions) {\n                    var ds = isArray(dsOptions) ? { data: dsOptions } : dsOptions;\n\n                    if (this.connectionsDataSource && this._connectionsRefreshHandler) {\n                        this.connectionsDataSource\n                            .unbind(\"change\", this._connectionsRefreshHandler)\n                            .unbind(\"requestStart\", this._connectionsRequestStartHandler)\n                            .unbind(\"error\", this._connectionsErrorHandler);\n                    } else {\n                        this._connectionsRefreshHandler = this._refreshConnections.bind(this);\n                        this._connectionsRequestStartHandler = this._connectionsRequestStart.bind(this);\n                        this._connectionsErrorHandler = this._connectionsError.bind(this);\n                    }\n\n                    this.connectionsDataSource = kendo.data.DataSource.create(ds)\n                        .bind(\"change\", this._connectionsRefreshHandler)\n                        .bind(\"requestStart\", this._connectionsRequestStartHandler)\n                        .bind(\"error\", this._connectionsErrorHandler);\n                }\n            },\n\n            _shapesRequestStart: function(e) {\n                if (e.type == \"read\") {\n                    this._loadingShapes = true;\n                }\n            },\n\n            _connectionsRequestStart: function(e) {\n                if (e.type == \"read\") {\n                    this._loadingConnections = true;\n                }\n            },\n\n            _error: function() {\n                this._loadingShapes = false;\n            },\n\n            _connectionsError: function() {\n                this._loadingConnections = false;\n            },\n\n            _refreshShapes: function(e) {\n                if (e.action === \"remove\") {\n                    if (this._shouldRefresh()) {\n                        this._removeShapes(e.items);\n                    }\n                } else if (e.action === \"itemchange\") {\n                    if (this._shouldRefresh()) {\n                        this._updateShapes(e.items, e.field);\n                    }\n                } else if (e.action === \"add\") {\n                    this._inactiveShapeItems.add(e.items);\n                } else if (e.action === \"sync\") {\n                    this._syncShapes(e.items);\n                } else {\n                    this.refresh();\n                }\n            },\n\n            _shouldRefresh: function() {\n                return !this._suspended;\n            },\n\n            _suspendModelRefresh: function() {\n                this._suspended = (this._suspended || 0) + 1;\n            },\n\n            _resumeModelRefresh: function() {\n                this._suspended = math.max((this._suspended || 0) - 1, 0);\n            },\n\n            refresh: function() {\n                this._loadingShapes = false;\n                if (!this._loadingConnections) {\n                    this._rebindShapesAndConnections();\n                }\n            },\n\n            _rebindShapesAndConnections: function() {\n                this.clear();\n                this._addShapes(this.dataSource.view());\n                if (this.connectionsDataSource) {\n                    this._addConnections(this.connectionsDataSource.view(), false);\n                }\n\n                if (this.options.layout) {\n                    this.layout(this.options.layout);\n                } else {\n                    this._redrawConnections();\n                }\n                this.trigger(\"dataBound\");\n            },\n\n            refreshConnections: function() {\n                this._loadingConnections = false;\n                if (!this._loadingShapes) {\n                    this._rebindShapesAndConnections();\n                }\n            },\n\n            _redrawConnections: function() {\n                var connections = this.connections;\n                for (var idx = 0; idx < connections.length; idx++) {\n                    connections[idx].refresh();\n                }\n            },\n\n            _removeShapes: function(items) {\n                var dataMap = this._dataMap;\n                var item, i;\n                for (i = 0; i < items.length; i++) {\n                    item = items[i];\n                    if (dataMap[item.id]) {\n                        this.remove(dataMap[item.id], false);\n                        dataMap[item.id] = null;\n                    }\n                }\n            },\n\n            _syncShapes: function() {\n                var diagram = this;\n                var inactiveItems = diagram._inactiveShapeItems;\n                inactiveItems.forEach(function(inactiveItem) {\n                    var dataItem = inactiveItem.dataItem;\n                    var shape = inactiveItem.element;\n                    if (!dataItem.isNew()) {\n                        if (shape) {\n                            shape._setOptionsFromModel();\n                            diagram.addShape(shape, inactiveItem.undoable);\n                            diagram._dataMap[dataItem.id] = shape;\n                        } else {\n                            diagram._addDataItem(dataItem);\n                        }\n                        inactiveItem.activate();\n                        inactiveItems.remove(dataItem);\n                    }\n                });\n            },\n\n            _updateShapes: function(items, field) {\n                for (var i = 0; i < items.length; i++) {\n                    var dataItem = items[i];\n\n                    var shape = this._dataMap[dataItem.id];\n                    if (shape) {\n                        shape.updateOptionsFromModel(dataItem, field);\n                    }\n                }\n            },\n\n            _addShapes: function(dataItems) {\n                for (var i = 0; i < dataItems.length; i++) {\n                    this._addDataItem(dataItems[i], false);\n                }\n            },\n\n            _refreshConnections: function(e) {\n                if (e.action === \"remove\") {\n                    if (this._shouldRefresh()) {\n                        this._removeConnections(e.items);\n                    }\n                } else if (e.action === \"add\") {\n                    this._addConnections(e.items);\n                } else if (e.action === \"sync\") {\n                    //TO DO: include logic to update the connections with different values returned from the server.\n                } else if (e.action === \"itemchange\") {\n                    if (this._shouldRefresh()) {\n                        this._updateConnections(e.items);\n                    }\n                } else {\n                    this.refreshConnections();\n                }\n            },\n\n            _removeConnections: function(items) {\n                for (var i = 0; i < items.length; i++) {\n                    this.remove(this._connectionsDataMap[items[i].uid], false);\n                    this._connectionsDataMap[items[i].uid] = null;\n                }\n            },\n\n            _updateConnections: function(items) {\n                for (var i = 0; i < items.length; i++) {\n                    var dataItem = items[i];\n\n                    var connection = this._connectionsDataMap[dataItem.uid];\n                    connection.updateOptionsFromModel(dataItem);\n                }\n            },\n\n            _addConnections: function(connections, undoable) {\n                var length = connections.length;\n\n                for (var i = 0; i < length; i++) {\n                    var dataItem = connections[i];\n                    this._addConnectionDataItem(dataItem, undoable);\n                }\n            },\n\n            _addConnectionDataItem: function(dataItem, undoable) {\n                if (!this._connectionsDataMap[dataItem.uid]) {\n                    var from = this._validateConnector(dataItem.from);\n                    if (!defined(from) || from === null) {\n                        from = new Point(dataItem.fromX, dataItem.fromY);\n                    }\n\n                    var to = this._validateConnector(dataItem.to);\n                    if (!defined(to) || to === null) {\n                        to = new Point(dataItem.toX, dataItem.toY);\n                    }\n\n                    if (defined(from) && defined(to)) {\n                        var options = deepExtend({}, this.options.connectionDefaults);\n                        options.dataItem = dataItem;\n                        var connection = new Connection(from, to, options);\n\n                        this._connectionsDataMap[dataItem.uid] = connection;\n                        this.addConnection(connection, undoable);\n                    }\n                }\n            },\n\n            _validateConnector: function(value) {\n                var connector;\n\n                if (defined(value) && value !== null) {\n                    connector = this._dataMap[value];\n                }\n\n                return connector;\n            },\n\n            _treeDataSource: function() {\n                var that = this,\n                    options = that.options,\n                    dataSource = options.dataSource;\n\n                dataSource = isArray(dataSource) ? { data: dataSource } : dataSource;\n\n                if (dataSource instanceof kendo.data.DataSource && !(dataSource instanceof kendo.data.HierarchicalDataSource)) {\n                    throw new Error(\"Incorrect DataSource type. If a single dataSource instance is set to the diagram then it should be a HierarchicalDataSource. You should set only the options instead of an instance or a HierarchicalDataSource instance or supply connectionsDataSource as well.\");\n                }\n\n                if (!dataSource.fields) {\n                    dataSource.fields = [\n                        { field: \"text\" },\n                        { field: \"url\" },\n                        { field: \"spriteCssClass\" },\n                        { field: \"imageUrl\" }\n                    ];\n                }\n                if (that.dataSource && that._refreshHandler) {\n                    that._unbindDataSource();\n                }\n\n                that._refreshHandler = that._refreshSource.bind(that);\n                that._errorHandler = that._error.bind(that);\n\n                that.dataSource = HierarchicalDataSource.create(dataSource)\n                    .bind(CHANGE, that._refreshHandler)\n                    .bind(ERROR, that._errorHandler);\n            },\n\n            _unbindDataSource: function() {\n                var that = this;\n\n                that.dataSource.unbind(CHANGE, that._refreshHandler).unbind(ERROR, that._errorHandler);\n            },\n\n            _adorn: function(adorner, isActive) {\n                if (isActive !== undefined && adorner) {\n                    if (isActive) {\n                        this._adorners.push(adorner);\n                        this.adornerLayer.append(adorner.visual);\n                    }\n                    else {\n                        Utils.remove(this._adorners, adorner);\n                        this.adornerLayer.remove(adorner.visual);\n                    }\n                }\n            },\n\n            _showConnectors: function(shape, value) {\n                if (value) {\n                    this._connectorsAdorner.show(shape);\n                } else {\n                    this._connectorsAdorner.destroy();\n                }\n            },\n\n            _updateAdorners: function() {\n                var adorners = this._adorners;\n\n                for (var i = 0; i < adorners.length; i++) {\n                    var adorner = adorners[i];\n\n                    if (adorner.refreshBounds) {\n                        adorner.refreshBounds();\n                    }\n                    adorner.refresh();\n                }\n            },\n\n            _refresh: function() {\n                for (var i = 0; i < this.connections.length; i++) {\n                    this.connections[i].refresh();\n                }\n            },\n\n            _destroyToolBar: function() {\n                if (this.singleToolBar) {\n                    this.singleToolBar.hide();\n                    this.singleToolBar.destroy();\n                    this.singleToolBar = null;\n                }\n            },\n\n            _destroyGlobalToolBar: function() {\n                if (this.toolBar) {\n                    this.toolBar.hide();\n                    this.toolBar.destroy();\n                    this.toolBar = null;\n                }\n            },\n\n            exportDOMVisual: function() {\n                var viewBox = this.canvas._viewBox;\n                var scrollOffset = geom.transform()\n                                       .translate(-viewBox.x, -viewBox.y);\n\n                var viewRect = new geom.Rect([0, 0], [viewBox.width, viewBox.height]);\n                var clipPath = draw.Path.fromRect(viewRect);\n                var wrap = new draw.Group({ transform: scrollOffset });\n                var clipWrap = new draw.Group({ clip: clipPath });\n                var root = this.canvas.drawingElement.children[0];\n\n                clipWrap.append(wrap);\n\n                // Don't reparent the root\n                wrap.children.push(root);\n\n                return clipWrap;\n            },\n\n            exportVisual: function() {\n                var scale = geom.transform().scale(1 / this._zoom);\n                var wrap = new draw.Group({\n                    transform: scale\n                });\n\n                var root = this.mainLayer.drawingElement;\n                wrap.children.push(root);\n\n                return wrap;\n            },\n\n            _syncChanges: function() {\n                this._syncShapeChanges();\n                this._syncConnectionChanges();\n            },\n\n            _syncShapeChanges: function() {\n                if (this.dataSource && this._isEditable) {\n                    this.dataSource.sync();\n                }\n            },\n\n            _syncConnectionChanges: function() {\n                var that = this;\n                if (that.connectionsDataSource && that._isEditable) {\n                    $.when.apply($, that._deferredConnectionUpdates).then(function() {\n                        that.connectionsDataSource.sync();\n                    });\n                    that.deferredConnectionUpdates = [];\n                }\n            }\n        });\n\n        dataviz.ExportMixin.extend(Diagram.fn, true);\n\n        if (kendo.PDFMixin) {\n            kendo.PDFMixin.extend(Diagram.fn);\n        }\n\n        function filterShapeDataItem(dataItem) {\n            var result = {};\n\n            dataItem = dataItem || {};\n\n            if (defined(dataItem.text) && dataItem.text !== null) {\n                result.text = dataItem.text;\n            }\n\n            if (defined(dataItem.x) && dataItem.x !== null) {\n                result.x = dataItem.x;\n            }\n\n            if (defined(dataItem.y) && dataItem.y !== null) {\n                result.y = dataItem.y;\n            }\n\n            if (defined(dataItem.width) && dataItem.width !== null) {\n                result.width = dataItem.width;\n            }\n\n            if (defined(dataItem.height) && dataItem.height !== null) {\n                result.height = dataItem.height;\n            }\n\n            if (defined(dataItem.type) && dataItem.type !== null) {\n                result.type = dataItem.type;\n            }\n\n            return result;\n        }\n\n        function filterConnectionDataItem(dataItem) {\n            var result = {};\n\n            dataItem = dataItem || {};\n\n            if (defined(dataItem.text) && dataItem.text !== null) {\n                result.content = dataItem.text;\n            }\n\n            if (defined(dataItem.type) && dataItem.type !== null) {\n                result.type = dataItem.type;\n            }\n\n            if (defined(dataItem.from) && dataItem.from !== null) {\n                result.from = dataItem.from;\n            }\n\n            if (defined(dataItem.fromConnector) && dataItem.fromConnector !== null) {\n                result.fromConnector = dataItem.fromConnector;\n            }\n\n            if (defined(dataItem.fromX) && dataItem.fromX !== null) {\n                result.fromX = dataItem.fromX;\n            }\n\n            if (defined(dataItem.fromY) && dataItem.fromY !== null) {\n                result.fromY = dataItem.fromY;\n            }\n\n            if (defined(dataItem.to) && dataItem.to !== null) {\n                result.to = dataItem.to;\n            }\n\n            if (defined(dataItem.toConnector) && dataItem.toConnector !== null) {\n                result.toConnector = dataItem.toConnector;\n            }\n\n            if (defined(dataItem.toX) && dataItem.toX !== null) {\n                result.toX = dataItem.toX;\n            }\n\n            if (defined(dataItem.toY) && dataItem.toY !== null) {\n                result.toY = dataItem.toY;\n            }\n\n            return result;\n        }\n\n\n        var DiagramToolBar = kendo.Observable.extend({\n            init: function(diagram, options) {\n                kendo.Observable.fn.init.call(this);\n                this.diagram = diagram;\n                this.options = deepExtend({}, this.options, options);\n                this._tools = [];\n                this.createToolBar();\n                this.createTools();\n                this.appendTools();\n\n                if (this.options.modal) {\n                    this.createPopup();\n                }\n\n                this.bind(this.events, options);\n            },\n\n            events: [\"click\"],\n\n            createPopup: function() {\n                this.container = $(\"<div/>\").append(this.element);\n                this._popup = this.container.kendoPopup({}).getKendoPopup();\n            },\n\n            appendTools: function() {\n                for (var i = 0; i < this._tools.length; i++) {\n                    var tool = this._tools[i];\n                    if (tool.buttons && tool.buttons.length || !defined(tool.buttons)) {\n                        this._toolBar.add(tool);\n                    }\n                }\n            },\n\n            createToolBar: function() {\n                this.element = $(\"<div/>\");\n                this._toolBar = this.element\n                    .kendoToolBar({\n                        click: this.click.bind(this),\n                        resizable: false\n                    }).getKendoToolBar();\n\n                this.element.css(\"border\", \"none\");\n            },\n\n            createTools: function() {\n                for (var i = 0; i < this.options.tools.length; i++) {\n                    this.createTool(this.options.tools[i]);\n                }\n            },\n\n            createTool: function(tool) {\n                if (!isPlainObject(tool)) {\n                    tool = {\n                        name: tool\n                    };\n                }\n                var toolName = tool.name + \"Tool\";\n                if (this[toolName]) {\n                    this[toolName](tool);\n                } else {\n                    this._tools.push(deepExtend({}, tool, {\n                        attributes: this._setAttributes({ action: tool.name })\n                    }));\n                }\n            },\n\n            showAt: function(point) {\n                var popupZIndex = parseInt(this.options.popupZIndex, 10);\n\n                if (this._popup) {\n                    this._popup.open(point.x, point.y);\n\n                    if (popupZIndex) {\n                        this._popup.wrapper.css(\"zIndex\", popupZIndex);\n                    }\n                }\n            },\n\n            hide: function() {\n                if (this._popup) {\n                    this._popup.close();\n                }\n            },\n\n            newGroup: function() {\n                return {\n                    type: \"buttonGroup\",\n                    buttons: []\n                };\n            },\n\n            editTool: function() {\n                this._tools.push({\n                    icon: \"edit\",\n                    showText: \"overflow\",\n                    type: \"button\",\n                    text: \"Edit\",\n                    attributes: this._setAttributes({ action: \"edit\" })\n                });\n            },\n\n            deleteTool: function() {\n                this._tools.push({\n                    icon: \"close\",\n                    showText: \"overflow\",\n                    type: \"button\",\n                    text: \"Delete\",\n                    attributes: this._setAttributes({ action: \"delete\" })\n                });\n            },\n\n            rotateAnticlockwiseTool: function(options) {\n                this._appendGroup(\"rotate\");\n                this._rotateGroup.buttons.push({\n                    icon: \"rotate-left\",\n                    showText: \"overflow\",\n                    text: \"RotateAnticlockwise\",\n                    group: \"rotate\",\n                    attributes: this._setAttributes({ action: \"rotateAnticlockwise\", step: options.step })\n                });\n            },\n\n            rotateClockwiseTool: function(options) {\n                this._appendGroup(\"rotate\");\n                this._rotateGroup.buttons.push({\n                    icon: \"rotate-right\",\n                    attributes: this._setAttributes({ action: \"rotateClockwise\", step: options.step }),\n                    showText: \"overflow\",\n                    text: \"RotateClockwise\",\n                    group: \"rotate\"\n                });\n            },\n\n            createShapeTool: function() {\n                this._appendGroup(\"create\");\n                this._createGroup.buttons.push({\n                    icon: \"shape\",\n                    showText: \"overflow\",\n                    text: \"CreateShape\",\n                    group: \"create\",\n                    attributes: this._setAttributes({ action: \"createShape\" })\n                });\n            },\n\n            createConnectionTool: function() {\n                this._appendGroup(\"create\");\n                this._createGroup.buttons.push({\n                    icon: \"connector\",\n                    showText: \"overflow\",\n                    text: \"CreateConnection\",\n                    group: \"create\",\n                    attributes: this._setAttributes({ action: \"createConnection\" })\n                });\n            },\n\n            undoTool: function() {\n                this._appendGroup(\"history\");\n                this._historyGroup.buttons.push({\n                    icon: \"undo\",\n                    showText: \"overflow\",\n                    text: \"Undo\",\n                    group: \"history\",\n                    attributes: this._setAttributes({ action: \"undo\" })\n                });\n            },\n\n            redoTool: function() {\n                this._appendGroup(\"history\");\n                this._historyGroup.buttons.push({\n                    icon: \"redo\",\n                    showText: \"overflow\",\n                    text: \"Redo\",\n                    group: \"history\",\n                    attributes: this._setAttributes({ action: \"redo\" })\n                });\n            },\n\n            _appendGroup: function(name) {\n                var prop = \"_\" + name + \"Group\";\n                if (!this[prop]) {\n                    this[prop] = this.newGroup();\n                    this._tools.push(this[prop]);\n                }\n            },\n\n            _setAttributes: function(attributes) {\n                var attr = {};\n\n                if (attributes.action) {\n                    attr[kendo.attr(\"action\")] = attributes.action;\n                }\n\n                if (attributes.step) {\n                    attr[kendo.attr(\"step\")] = attributes.step;\n                }\n\n                return attr;\n            },\n\n            _getAttributes: function(element) {\n                var attr = {};\n\n                var action = element.attr(kendo.attr(\"action\"));\n                if (action) {\n                    attr.action = action;\n                }\n\n                var step = element.attr(kendo.attr(\"step\"));\n                if (step) {\n                    attr.step = step;\n                }\n\n                return attr;\n            },\n\n            click: function(e) {\n                var attributes = this._getAttributes($(e.target));\n                var action = attributes.action;\n\n                if (action && this[action]) {\n                    this[action](attributes);\n                }\n\n                this.trigger(\"click\", this.eventData(action, e.target));\n            },\n\n            eventData: function(action, target) {\n                var elements = this.selectedElements(),\n                    length = elements.length,\n                    shapes = [], connections = [], element;\n\n                for (var idx = 0; idx < length; idx++) {\n                    element = elements[idx];\n                    if (element instanceof Shape) {\n                        shapes.push(element);\n                    } else {\n                        connections.push(element);\n                    }\n                }\n\n                return {\n                    shapes: shapes,\n                    connections: connections,\n                    action: action,\n                    target: target\n                };\n            },\n\n            \"delete\": function() {\n                var diagram = this.diagram;\n                var toRemove = diagram._triggerRemove(this.selectedElements());\n                if (toRemove.length) {\n                    this.diagram.remove(toRemove, true);\n                    this.diagram._syncChanges();\n                }\n            },\n\n            edit: function() {\n                var selectedElemens = this.selectedElements();\n                if (selectedElemens.length === 1) {\n                    this.diagram.edit(selectedElemens[0]);\n                }\n            },\n\n            rotateClockwise: function(options) {\n                var angle = parseFloat(options.step || 90);\n                this._rotate(angle);\n            },\n\n            rotateAnticlockwise: function(options) {\n                var angle = parseFloat(options.step || 90);\n                this._rotate(-angle);\n            },\n\n            _rotate: function(angle) {\n                var adorner = this.diagram._resizingAdorner;\n                adorner.angle(adorner.angle() + angle);\n                adorner.rotate();\n            },\n\n            selectedElements: function() {\n                return this.diagram.select();\n            },\n\n            createShape: function() {\n                this.diagram.createShape();\n            },\n\n            createConnection: function() {\n                this.diagram.createConnection();\n            },\n\n            undo: function() {\n                this.diagram.undo();\n            },\n\n            redo: function() {\n                this.diagram.redo();\n            },\n\n            destroy: function() {\n                this.diagram = null;\n                this.element = null;\n                this.options = null;\n\n                if (this._toolBar) {\n                    this._toolBar.destroy();\n                }\n\n                if (this._popup) {\n                    this._popup.destroy();\n                }\n            }\n        });\n\n        var Editor = kendo.Observable.extend({\n            init: function(element, options) {\n                kendo.Observable.fn.init.call(this);\n\n                this.options = extend(true, {}, this.options, options);\n                this.element = element;\n                this.model = this.options.model;\n                this.fields = this._getFields();\n                this._initContainer();\n                this.createEditable();\n            },\n\n            options: {\n                editors: {}\n            },\n\n            _initContainer: function() {\n                this.wrapper = this.element;\n            },\n\n            createEditable: function() {\n                var options = this.options;\n\n                this.editable = new kendo.ui.Editable(this.wrapper, {\n                    fields: this.fields,\n                    target: options.target,\n                    clearContainer: false,\n                    model: this.model\n                });\n            },\n\n            _isEditable: function(field) {\n                return this.model.editable && this.model.editable(field);\n            },\n\n            _getFields: function() {\n                var fields = [];\n                var modelFields = this.model.fields;\n\n                for (var field in modelFields) {\n                    var result = {};\n                    if (this._isEditable(field)) {\n                        var editor = this.options.editors[field];\n                        if (editor) {\n                            result.editor = editor;\n                        }\n                        result.field = field;\n                        fields.push(result);\n                    }\n                }\n\n                return fields;\n            },\n\n            end: function() {\n                return this.editable.end();\n            },\n\n            destroy: function() {\n                this.editable.destroy();\n                this.editable.element.find(\"[\" + kendo.attr(\"container-for\") + \"]\").empty();\n                this.model = this.wrapper = this.element = this.columns = this.editable = null;\n            }\n        });\n\n        var PopupEditor = Editor.extend({\n            init: function(element, options) {\n                Editor.fn.init.call(this, element, options);\n                this.bind(this.events, this.options);\n\n                this.open();\n            },\n\n            events: [ \"update\", \"cancel\" ],\n\n            options: {\n                window: {\n                    modal: true,\n                    resizable: false,\n                    draggable: true,\n                    title: \"Edit\",\n                    visible: false\n                }\n            },\n\n            _initContainer: function() {\n                var that = this;\n                this.wrapper = $('<div class=\"k-popup-edit-form\"/>')\n                    .attr(kendo.attr(\"uid\"), this.model.uid);\n\n                var formContent = \"\";\n\n                if (this.options.template) {\n                    formContent += this._renderTemplate();\n                    this.fields = [];\n                } else {\n                    formContent += this._renderFields();\n                }\n\n                formContent += this._renderButtons();\n\n                this.wrapper.append(\n                    $('<div class=\"k-edit-form-container\"/>').append(formContent));\n\n                this.window = new kendo.ui.Window(this.wrapper.appendTo(this.element), this.options.window);\n                this.window.bind(\"close\", function(e) {\n                    //The bellow line is required due to: draggable window in IE, change event will be triggered while the window is closing\n                    if (e.userTriggered) {\n                        e.sender.element.trigger(\"focus\");\n                        that._cancelClick(e);\n                    }\n                });\n\n                this._attachButtonEvents();\n            },\n\n            _renderTemplate: function() {\n                var template = this.options.template;\n\n                if (typeof template === \"string\") {\n                    template = kendo.unescape(template);\n                }\n\n                template = kendo.template(template)(this.model);\n\n                return template;\n            },\n\n            _renderFields: function() {\n                var form = \"\";\n                for (var i = 0; i < this.fields.length; i++) {\n                    var field = this.fields[i];\n\n                    form += '<div class=\"k-edit-label\"><label for=\"' + field.field + '\">' + (field.field || \"\") + '</label></div>';\n\n                    if (this._isEditable(field.field)) {\n                        form += '<div ' + kendo.attr(\"container-for\") + '=\"' + field.field +\n                        '\" class=\"k-edit-field\"></div>';\n                    }\n                }\n\n                return form;\n            },\n\n            _renderButtons: function() {\n                var form = '<div class=\"k-edit-buttons\">';\n                form += this._createButton(\"update\");\n                form += this._createButton(\"cancel\");\n                form += '</div>';\n                return form;\n            },\n\n            _createButton: function(name) {\n                return kendo.template(BUTTON_TEMPLATE)(defaultButtons[name]);\n            },\n\n            _attachButtonEvents: function() {\n                this._cancelClickHandler = this._cancelClick.bind(this);\n                this.window.element.on(CLICK + NS, \"a.k-diagram-cancel\", this._cancelClickHandler);\n\n                this._updateClickHandler = this._updateClick.bind(this);\n                this.window.element.on(CLICK + NS, \"a.k-diagram-update\", this._updateClickHandler);\n            },\n\n            _updateClick: function(e) {\n                e.preventDefault();\n                this.trigger(\"update\");\n            },\n\n            _cancelClick: function(e) {\n                e.preventDefault();\n                this.trigger(\"cancel\");\n            },\n\n            open: function() {\n                this.window.center().open();\n            },\n\n            close: function() {\n                this.window.bind(\"deactivate\", this.destroy.bind(this)).close();\n            },\n\n            destroy: function() {\n                this.window.close().destroy();\n                this.window.element.off(CLICK + NS, \"a.k-diagram-cancel\", this._cancelClickHandler);\n                this.window.element.off(CLICK + NS, \"a.k-diagram-update\", this._updateClickHandler);\n                this._cancelClickHandler = null;\n                this._editUpdateClickHandler = null;\n                this.window = null;\n                Editor.fn.destroy.call(this);\n            }\n        });\n\n        function connectionSelector(container, options) {\n            var model = this.dataSource.reader.model;\n            if (model) {\n                var textField = model.fn.fields.text ? \"text\" : model.idField;\n                $(\"<input name='\" + options.field + \"' />\")\n                    .appendTo(container).kendoDropDownList({\n                        dataValueField: model.idField,\n                        dataTextField: textField,\n                        dataSource: this.dataSource.data().toJSON(),\n                        optionLabel: \" \",\n                        valuePrimitive: true\n                    });\n            }\n        }\n\n        function InactiveItem(dataItem) {\n            this.dataItem = dataItem;\n            this.callbacks = [];\n        }\n\n        InactiveItem.fn = InactiveItem.prototype = {\n            onActivate: function(callback) {\n                var deffered = $.Deferred();\n                this.callbacks.push({\n                    callback: callback,\n                    deferred: deffered\n                });\n                return deffered;\n            },\n\n            activate: function() {\n                var callbacks = this.callbacks;\n                var item;\n                for (var idx = 0; idx < callbacks.length; idx++) {\n                    item = this.callbacks[idx];\n                    item.callback(this.dataItem);\n                    item.deferred.resolve();\n                }\n                this.callbacks = [];\n            }\n        };\n\n        function InactiveItemsCollection() {\n            this.items = {};\n        }\n\n        InactiveItemsCollection.fn = InactiveItemsCollection.prototype = {\n            add: function(items) {\n                for (var idx = 0; idx < items.length; idx++) {\n                    this.items[items[idx].uid] = new InactiveItem(items[idx]);\n                }\n            },\n\n            forEach: function(callback) {\n                for (var uid in this.items) {\n                    callback(this.items[uid]);\n                }\n            },\n\n            getByUid: function(uid) {\n                return this.items[uid];\n            },\n\n            remove: function(item) {\n                delete this.items[item.uid];\n            }\n        };\n\n        var QuadRoot = Class.extend({\n            init: function() {\n                this.shapes = [];\n            },\n\n            _add: function(shape, bounds) {\n                this.shapes.push({\n                    bounds: bounds,\n                    shape: shape\n                });\n                shape._quadNode = this;\n            },\n\n            insert: function(shape, bounds) {\n                this._add(shape, bounds);\n            },\n\n            remove: function(shape) {\n                var shapes = this.shapes;\n                var length = shapes.length;\n\n                for (var idx = 0; idx < length; idx++) {\n                    if (shapes[idx].shape === shape) {\n                        shapes.splice(idx, 1);\n                        break;\n                    }\n                }\n            },\n\n            hitTestRect: function(rect, exclude) {\n                var shapes = this.shapes;\n                var length = shapes.length;\n\n                for (var i = 0; i < length; i++) {\n                    if (this._testRect(shapes[i].shape, rect) && !dataviz.inArray(shapes[i].shape, exclude)) {\n                        return true;\n                    }\n                }\n            },\n\n            _testRect: function(shape, rect) {\n                var angle = shape.rotate().angle;\n                var bounds = shape.bounds();\n                var hit;\n                if (!angle) {\n                    hit = bounds.overlaps(rect);\n                } else {\n                    hit = Intersect.rects(rect, bounds, -angle);\n                }\n                return hit;\n            }\n        });\n\n        var QuadNode = QuadRoot.extend({\n            init: function(rect) {\n                QuadRoot.fn.init.call(this);\n                this.children = [];\n                this.rect = rect;\n            },\n\n            inBounds: function(rect) {\n                var nodeRect = this.rect;\n                var nodeBottomRight = nodeRect.bottomRight();\n                var bottomRight = rect.bottomRight();\n                var inBounds = nodeRect.x <= rect.x && nodeRect.y <= rect.y && bottomRight.x <= nodeBottomRight.x &&\n                    bottomRight.y <= nodeBottomRight.y;\n                return inBounds;\n            },\n\n            overlapsBounds: function(rect) {\n                return this.rect.overlaps(rect);\n            },\n\n            insert: function(shape, bounds) {\n                var inserted = false;\n                var children = this.children;\n                var length = children.length;\n                if (this.inBounds(bounds)) {\n                    if (!length && this.shapes.length < 4) {\n                        this._add(shape, bounds);\n                    } else {\n                        if (!length) {\n                            this._initChildren();\n                        }\n\n                        for (var idx = 0; idx < children.length; idx++) {\n                            if (children[idx].insert(shape, bounds)) {\n                                inserted = true;\n                                break;\n                            }\n                        }\n\n                        if (!inserted) {\n                            this._add(shape, bounds);\n                        }\n                    }\n                    inserted = true;\n                }\n\n                return inserted;\n            },\n\n            _initChildren: function() {\n                var rect = this.rect,\n                    children = this.children,\n                    shapes = this.shapes,\n                    center = rect.center(),\n                    halfWidth = rect.width / 2,\n                    halfHeight = rect.height / 2,\n                    childIdx, shapeIdx;\n\n                children.push(\n                    new QuadNode(new Rect(rect.x, rect.y, halfWidth, halfHeight)),\n                    new QuadNode(new Rect(center.x, rect.y, halfWidth, halfHeight)),\n                    new QuadNode(new Rect(rect.x, center.y, halfWidth, halfHeight)),\n                    new QuadNode(new Rect(center.x, center.y, halfWidth, halfHeight))\n                );\n                for (shapeIdx = shapes.length - 1; shapeIdx >= 0; shapeIdx--) {\n                    for (childIdx = 0; childIdx < children.length; childIdx++) {\n                        if (children[childIdx].insert(shapes[shapeIdx].shape, shapes[shapeIdx].bounds)) {\n                            shapes.splice(shapeIdx, 1);\n                            break;\n                        }\n                    }\n                }\n            },\n\n            hitTestRect: function(rect, exclude) {\n                var idx;\n                var children = this.children;\n                var length = children.length;\n                var hit = false;\n\n                if (this.overlapsBounds(rect)) {\n                    if (QuadRoot.fn.hitTestRect.call(this, rect, exclude)) {\n                        hit = true;\n                    } else {\n                         for (idx = 0; idx < length; idx++) {\n                            if (children[idx].hitTestRect(rect, exclude)) {\n                               hit = true;\n                               break;\n                            }\n                        }\n                    }\n                }\n\n                return hit;\n            }\n        });\n\n        var ShapesQuadTree = Class.extend({\n            ROOT_SIZE: 1000,\n\n            init: function(diagram) {\n                var boundsChangeHandler = this._boundsChange.bind(this);\n                diagram.bind(ITEMBOUNDSCHANGE, boundsChangeHandler);\n                diagram.bind(ITEMROTATE, boundsChangeHandler);\n                this.initRoots();\n            },\n\n            initRoots: function() {\n                this.rootMap = {};\n                this.root = new QuadRoot();\n            },\n\n            clear: function() {\n                this.initRoots();\n            },\n\n            _boundsChange: function(e) {\n                if (e.item._quadNode) {\n                    e.item._quadNode.remove(e.item);\n                }\n                this.insert(e.item);\n            },\n\n            insert: function(shape) {\n                var bounds = shape.bounds(ROTATED);\n                var rootSize = this.ROOT_SIZE;\n                var sectors = this.getSectors(bounds);\n                var x = sectors[0][0];\n                var y = sectors[1][0];\n\n                if (this.inRoot(sectors)) {\n                    this.root.insert(shape, bounds);\n                } else {\n                    if (!this.rootMap[x]) {\n                        this.rootMap[x] = {};\n                    }\n\n                    if (!this.rootMap[x][y]) {\n                        this.rootMap[x][y] = new QuadNode(\n                            new Rect(x * rootSize, y * rootSize, rootSize, rootSize)\n                        );\n                    }\n\n                    this.rootMap[x][y].insert(shape, bounds);\n                }\n            },\n\n            remove: function(shape) {\n                if (shape._quadNode) {\n                    shape._quadNode.remove(shape);\n                }\n            },\n\n            inRoot: function(sectors) {\n                return sectors[0].length > 1 || sectors[1].length > 1;\n            },\n\n            getSectors: function(rect) {\n                var rootSize = this.ROOT_SIZE;\n                var bottomRight = rect.bottomRight();\n                var bottomX = math.floor(bottomRight.x / rootSize);\n                var bottomY = math.floor(bottomRight.y / rootSize);\n                var sectors = [[],[]];\n                for (var x = math.floor(rect.x / rootSize); x <= bottomX; x++) {\n                    sectors[0].push(x);\n                }\n                for (var y = math.floor(rect.y / rootSize); y <= bottomY; y++) {\n                    sectors[1].push(y);\n                }\n                return sectors;\n            },\n\n            hitTestRect: function(rect, exclude) {\n                var sectors = this.getSectors(rect);\n                var xIdx, yIdx, x, y;\n                var root;\n\n                if (this.root.hitTestRect(rect, exclude)) {\n                    return true;\n                }\n\n                for (xIdx = 0; xIdx < sectors[0].length; xIdx++) {\n                    x = sectors[0][xIdx];\n                    for (yIdx = 0; yIdx < sectors[1].length; yIdx++) {\n                        y = sectors[1][yIdx];\n                        root = (this.rootMap[x] || {})[y];\n                        if (root && root.hitTestRect(rect, exclude)) {\n                            return true;\n                        }\n                    }\n                }\n\n                return false;\n            }\n        });\n\n        function cloneDataItem(dataItem) {\n            var result = dataItem;\n            if (dataItem instanceof kendo.data.Model) {\n                result = dataItem.toJSON();\n                result[dataItem.idField] = dataItem._defaultId;\n            }\n            return result;\n        }\n\n        function splitDiagramElements(elements) {\n            var connections = [];\n            var shapes = [];\n            var element, idx;\n            for (idx = 0; idx < elements.length; idx++) {\n                element = elements[idx];\n                if (element instanceof Shape) {\n                    shapes.push(element);\n                } else {\n                    connections.push(element);\n                }\n            }\n            return {\n                shapes: shapes,\n                connections: connections\n            };\n        }\n\n        function createModel(dataSource, model) {\n            if (dataSource.reader.model) {\n                return new dataSource.reader.model(model);\n            }\n\n            return new kendo.data.ObservableObject(model);\n        }\n\n        function clearField(field, model) {\n            if (defined(model[field])) {\n                model.set(field, null);\n            }\n        }\n\n        function copyDefaultOptions(mainOptions, elementOptions, fields) {\n            var field;\n            for (var idx = 0; idx < fields.length; idx++) {\n                field = fields[idx];\n                if (elementOptions && !defined(elementOptions[field])) {\n                    elementOptions[field] = mainOptions[field];\n                }\n            }\n        }\n\n        function translateToOrigin(visual) {\n            var bbox = visual.drawingContainer().clippedBBox(null);\n            if (bbox.origin.x !== 0 || bbox.origin.y !== 0) {\n                visual.position(-bbox.origin.x, -bbox.origin.y);\n            }\n        }\n\n        function preventDefault(e) {\n            e.preventDefault();\n        }\n\n        dataviz.ui.plugin(Diagram);\n\n        deepExtend(diagram, {\n            Shape: Shape,\n            Connection: Connection,\n            Connector: Connector,\n            DiagramToolBar: DiagramToolBar,\n            QuadNode: QuadNode,\n            QuadRoot: QuadRoot,\n            ShapesQuadTree: ShapesQuadTree,\n            PopupEditor: PopupEditor\n        });\n})(window.kendo.jQuery);\n\n}, __webpack_require__.amdD);\n\n\n/***/ }),\n\n/***/ 69089:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.data\");\n\n/***/ }),\n\n/***/ 32549:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.dataviz.core\");\n\n/***/ }),\n\n/***/ 80396:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.dataviz.themes\");\n\n/***/ }),\n\n/***/ 60824:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.draganddrop\");\n\n/***/ }),\n\n/***/ 10239:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.dropdownlist\");\n\n/***/ }),\n\n/***/ 30006:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.editable\");\n\n/***/ }),\n\n/***/ 77261:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.toolbar\");\n\n/***/ }),\n\n/***/ 87722:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.window\");\n\n/***/ }),\n\n/***/ 39725:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"./layout\");\n\n/***/ }),\n\n/***/ 13224:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"./services\");\n\n/***/ }),\n\n/***/ 48643:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"./svg\");\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/amd define */\n/******/ \t!function() {\n/******/ \t\t__webpack_require__.amdD = function () {\n/******/ \t\t\tthrow new Error('define cannot be used indirect');\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/************************************************************************/\n/******/ \t\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \t// This entry module used 'module' so it can't be inlined\n/******/ \tvar __webpack_exports__ = __webpack_require__(92660);\n/******/ \tmodule.exports = __webpack_exports__;\n/******/ \t\n/******/ })()\n;"],"mappings":"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"},"metadata":{},"sourceType":"script"}