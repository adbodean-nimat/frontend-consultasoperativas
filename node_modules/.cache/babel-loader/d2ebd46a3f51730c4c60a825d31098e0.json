{"ast":null,"code":"require(\"core-js/modules/es.error.cause.js\");\n\n/******/\n(function () {\n  // webpackBootstrap\n\n  /******/\n  var __webpack_modules__ = {\n    /***/\n    31545:\n    /***/\n    function (module, exports, __webpack_require__) {\n      var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\n      (function (f, define) {\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(79174), __webpack_require__(48643)], __WEBPACK_AMD_DEFINE_FACTORY__ = f, __WEBPACK_AMD_DEFINE_RESULT__ = typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? __WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__) : __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n      })(function () {\n        (function ($, undefined) {\n          // Imports ================================================================\n          var kendo = window.kendo,\n              dataviz = kendo.dataviz,\n              diagram = dataviz.diagram,\n              Class = kendo.Class,\n              Group = diagram.Group,\n              Rect = diagram.Rect,\n              Rectangle = diagram.Rectangle,\n              Utils = diagram.Utils,\n              isUndefined = Utils.isUndefined,\n              Point = diagram.Point,\n              Circle = diagram.Circle,\n              Ticker = diagram.Ticker,\n              deepExtend = kendo.deepExtend,\n              Movable = kendo.ui.Movable,\n              util = kendo.drawing.util,\n              defined = util.defined,\n              inArray = $.inArray; // Constants ==============================================================\n\n          var Cursors = {\n            arrow: \"default\",\n            grip: \"pointer\",\n            cross: \"pointer\",\n            add: \"pointer\",\n            move: \"move\",\n            select: \"pointer\",\n            south: \"s-resize\",\n            east: \"e-resize\",\n            west: \"w-resize\",\n            north: \"n-resize\",\n            rowresize: \"row-resize\",\n            colresize: \"col-resize\"\n          },\n              HIT_TEST_DISTANCE = 10,\n              AUTO = \"Auto\",\n              TOP = \"Top\",\n              RIGHT = \"Right\",\n              LEFT = \"Left\",\n              BOTTOM = \"Bottom\",\n              DEFAULT_SNAP_SIZE = 10,\n              DEFAULT_SNAP_ANGLE = 10,\n              DRAG_START = \"dragStart\",\n              DRAG = \"drag\",\n              DRAG_END = \"dragEnd\",\n              ITEMROTATE = \"itemRotate\",\n              ITEMBOUNDSCHANGE = \"itemBoundsChange\",\n              MIN_SNAP_SIZE = 5,\n              MIN_SNAP_ANGLE = 5,\n              MOUSE_ENTER = \"mouseEnter\",\n              MOUSE_LEAVE = \"mouseLeave\",\n              ZOOM_START = \"zoomStart\",\n              ZOOM_END = \"zoomEnd\",\n              SCROLL_MIN = -20000,\n              SCROLL_MAX = 20000,\n              FRICTION = 0.90,\n              FRICTION_MOBILE = 0.93,\n              VELOCITY_MULTIPLIER = 5,\n              TRANSPARENT = \"transparent\",\n              PAN = \"pan\",\n              ROTATED = \"rotated\",\n              SOURCE = \"source\",\n              TARGET = \"target\",\n              HANDLE_NAMES = {\n            \"-1\": SOURCE,\n            \"1\": TARGET\n          };\n          diagram.Cursors = Cursors;\n          var PositionAdapter = kendo.Class.extend({\n            init: function (layoutState) {\n              this.layoutState = layoutState;\n              this.diagram = layoutState.diagram;\n            },\n            initState: function () {\n              this.froms = [];\n              this.tos = [];\n              this.subjects = [];\n\n              function pusher(id, bounds) {\n                var shape = this.diagram.getShapeById(id);\n\n                if (shape) {\n                  this.subjects.push(shape);\n                  this.froms.push(shape.bounds().topLeft());\n                  this.tos.push(bounds.topLeft());\n                }\n              }\n\n              this.layoutState.nodeMap.forEach(pusher, this);\n            },\n            update: function (tick) {\n              if (this.subjects.length <= 0) {\n                return;\n              }\n\n              for (var i = 0; i < this.subjects.length; i++) {\n                //todo: define a Lerp function instead\n                this.subjects[i].position(new Point(this.froms[i].x + (this.tos[i].x - this.froms[i].x) * tick, this.froms[i].y + (this.tos[i].y - this.froms[i].y) * tick));\n              }\n            }\n          });\n          var LayoutUndoUnit = Class.extend({\n            init: function (initialState, finalState, animate) {\n              if (isUndefined(animate)) {\n                this.animate = false;\n              } else {\n                this.animate = animate;\n              }\n\n              this._initialState = initialState;\n              this._finalState = finalState;\n              this.title = \"Diagram layout\";\n            },\n            undo: function () {\n              this.setState(this._initialState);\n            },\n            redo: function () {\n              this.setState(this._finalState);\n            },\n            setState: function (state) {\n              var diagram = state.diagram;\n\n              if (this.animate) {\n                state.linkMap.forEach(function (id, points) {\n                  var conn = diagram.getShapeById(id);\n                  conn.visible(false);\n\n                  if (conn) {\n                    conn.points(points);\n                  }\n                });\n                var ticker = new Ticker();\n                ticker.addAdapter(new PositionAdapter(state));\n                ticker.onComplete(function () {\n                  state.linkMap.forEach(function (id) {\n                    var conn = diagram.getShapeById(id);\n                    conn.visible(true);\n                  });\n                });\n                ticker.play();\n              } else {\n                state.nodeMap.forEach(function (id, bounds) {\n                  var shape = diagram.getShapeById(id);\n\n                  if (shape) {\n                    shape.position(bounds.topLeft());\n                  }\n                });\n                state.linkMap.forEach(function (id, points) {\n                  var conn = diagram.getShapeById(id);\n\n                  if (conn) {\n                    conn.points(points);\n                  }\n                });\n              }\n            }\n          });\n          var CompositeUnit = Class.extend({\n            init: function (unit) {\n              this.units = [];\n              this.title = \"Composite unit\";\n\n              if (unit !== undefined) {\n                this.units.push(unit);\n              }\n            },\n            add: function (undoUnit) {\n              this.units.push(undoUnit);\n            },\n            undo: function () {\n              for (var i = 0; i < this.units.length; i++) {\n                this.units[i].undo();\n              }\n            },\n            redo: function () {\n              for (var i = 0; i < this.units.length; i++) {\n                this.units[i].redo();\n              }\n            }\n          });\n          var ConnectionEditUnit = Class.extend({\n            init: function (item, redoSource, redoTarget) {\n              this.item = item;\n              this._redoSource = redoSource;\n              this._redoTarget = redoTarget;\n\n              if (defined(redoSource)) {\n                this._undoSource = item.source();\n              }\n\n              if (defined(redoTarget)) {\n                this._undoTarget = item.target();\n              }\n\n              this.title = \"Connection Editing\";\n            },\n            undo: function () {\n              if (this._undoSource !== undefined) {\n                this.item._updateConnector(this._undoSource, \"source\");\n              }\n\n              if (this._undoTarget !== undefined) {\n                this.item._updateConnector(this._undoTarget, \"target\");\n              }\n\n              this.item.updateModel();\n            },\n            redo: function () {\n              if (this._redoSource !== undefined) {\n                this.item._updateConnector(this._redoSource, \"source\");\n              }\n\n              if (this._redoTarget !== undefined) {\n                this.item._updateConnector(this._redoTarget, \"target\");\n              }\n\n              this.item.updateModel();\n            }\n          });\n          var ConnectionEditUndoUnit = Class.extend({\n            init: function (item, undoSource, undoTarget) {\n              this.item = item;\n              this._undoSource = undoSource;\n              this._undoTarget = undoTarget;\n              this._redoSource = item.source();\n              this._redoTarget = item.target();\n              this.title = \"Connection Editing\";\n            },\n            undo: function () {\n              this.item._updateConnector(this._undoSource, \"source\");\n\n              this.item._updateConnector(this._undoTarget, \"target\");\n\n              this.item.updateModel();\n            },\n            redo: function () {\n              this.item._updateConnector(this._redoSource, \"source\");\n\n              this.item._updateConnector(this._redoTarget, \"target\");\n\n              this.item.updateModel();\n            }\n          });\n          var DeleteConnectionUnit = Class.extend({\n            init: function (connection) {\n              this.connection = connection;\n              this.diagram = connection.diagram;\n              this.targetConnector = connection.targetConnector;\n              this.title = \"Delete connection\";\n            },\n            undo: function () {\n              this.diagram._addConnection(this.connection, false);\n            },\n            redo: function () {\n              this.diagram.remove(this.connection, false);\n            }\n          });\n          var DeleteShapeUnit = Class.extend({\n            init: function (shape) {\n              this.shape = shape;\n              this.diagram = shape.diagram;\n              this.title = \"Deletion\";\n            },\n            undo: function () {\n              this.diagram._addShape(this.shape, false);\n\n              this.shape.select(false);\n            },\n            redo: function () {\n              this.shape.select(false);\n              this.diagram.remove(this.shape, false);\n            }\n          });\n          /**\n           * Holds the undoredo state when performing a rotation, translation or scaling. The adorner is optional.\n           * @type {*}\n           */\n\n          var TransformUnit = Class.extend({\n            init: function (shapes, undoStates, adorner) {\n              this.shapes = shapes;\n              this.undoStates = undoStates;\n              this.title = \"Transformation\";\n              this.redoStates = [];\n              this.adorner = adorner;\n\n              for (var i = 0; i < this.shapes.length; i++) {\n                var shape = this.shapes[i];\n                this.redoStates.push(shape.bounds());\n              }\n            },\n            undo: function () {\n              for (var i = 0; i < this.shapes.length; i++) {\n                var shape = this.shapes[i];\n                shape.bounds(this.undoStates[i]);\n\n                if (shape.hasOwnProperty(\"layout\")) {\n                  shape.layout(shape, this.redoStates[i], this.undoStates[i]);\n                }\n\n                shape.updateModel();\n              }\n\n              if (this.adorner) {\n                this.adorner.refreshBounds();\n                this.adorner.refresh();\n              }\n            },\n            redo: function () {\n              for (var i = 0; i < this.shapes.length; i++) {\n                var shape = this.shapes[i];\n                shape.bounds(this.redoStates[i]); // the 'layout' property, if implemented, lets the shape itself work out what to do with the new bounds\n\n                if (shape.hasOwnProperty(\"layout\")) {\n                  shape.layout(shape, this.undoStates[i], this.redoStates[i]);\n                }\n\n                shape.updateModel();\n              }\n\n              if (this.adorner) {\n                this.adorner.refreshBounds();\n                this.adorner.refresh();\n              }\n            }\n          });\n          var AddConnectionUnit = Class.extend({\n            init: function (connection, diagram) {\n              this.connection = connection;\n              this.diagram = diagram;\n              this.title = \"New connection\";\n            },\n            undo: function () {\n              this.diagram.remove(this.connection, false);\n            },\n            redo: function () {\n              this.diagram._addConnection(this.connection, false);\n            }\n          });\n          var AddShapeUnit = Class.extend({\n            init: function (shape, diagram) {\n              this.shape = shape;\n              this.diagram = diagram;\n              this.title = \"New shape\";\n            },\n            undo: function () {\n              this.diagram.deselect();\n              this.diagram.remove(this.shape, false);\n            },\n            redo: function () {\n              this.diagram._addShape(this.shape, false);\n            }\n          });\n          var PanUndoUnit = Class.extend({\n            init: function (initialPosition, finalPosition, diagram) {\n              this.initial = initialPosition;\n              this.finalPos = finalPosition;\n              this.diagram = diagram;\n              this.title = \"Pan Unit\";\n            },\n            undo: function () {\n              this.diagram.pan(this.initial);\n            },\n            redo: function () {\n              this.diagram.pan(this.finalPos);\n            }\n          });\n          var RotateUnit = Class.extend({\n            init: function (adorner, shapes, undoRotates) {\n              this.shapes = shapes;\n              this.undoRotates = undoRotates;\n              this.title = \"Rotation\";\n              this.redoRotates = [];\n              this.redoAngle = adorner._angle;\n              this.adorner = adorner;\n              this.center = adorner._innerBounds.center();\n\n              for (var i = 0; i < this.shapes.length; i++) {\n                var shape = this.shapes[i];\n                this.redoRotates.push(shape.rotate().angle);\n              }\n            },\n            undo: function () {\n              var i, shape;\n\n              for (i = 0; i < this.shapes.length; i++) {\n                shape = this.shapes[i];\n                shape.rotate(this.undoRotates[i], this.center, false);\n\n                if (shape.hasOwnProperty(\"layout\")) {\n                  shape.layout(shape);\n                }\n\n                shape.updateModel();\n              }\n\n              if (this.adorner) {\n                this.adorner._initialize();\n\n                this.adorner.refresh();\n              }\n            },\n            redo: function () {\n              var i, shape;\n\n              for (i = 0; i < this.shapes.length; i++) {\n                shape = this.shapes[i];\n                shape.rotate(this.redoRotates[i], this.center, false);\n\n                if (shape.hasOwnProperty(\"layout\")) {\n                  shape.layout(shape);\n                }\n\n                shape.updateModel();\n              }\n\n              if (this.adorner) {\n                this.adorner._initialize();\n\n                this.adorner.refresh();\n              }\n            }\n          });\n          var ToFrontUnit = Class.extend({\n            init: function (diagram, items, initialIndices) {\n              this.diagram = diagram;\n              this.indices = initialIndices;\n              this.items = items;\n              this.title = \"Rotate Unit\";\n            },\n            undo: function () {\n              this.diagram._toIndex(this.items, this.indices);\n            },\n            redo: function () {\n              this.diagram.toFront(this.items, false);\n            }\n          });\n          var ToBackUnit = Class.extend({\n            init: function (diagram, items, initialIndices) {\n              this.diagram = diagram;\n              this.indices = initialIndices;\n              this.items = items;\n              this.title = \"Rotate Unit\";\n            },\n            undo: function () {\n              this.diagram._toIndex(this.items, this.indices);\n            },\n            redo: function () {\n              this.diagram.toBack(this.items, false);\n            }\n          });\n          /**\n           * Undo-redo service.\n           */\n\n          var UndoRedoService = kendo.Observable.extend({\n            init: function (options) {\n              kendo.Observable.fn.init.call(this, options);\n              this.bind(this.events, options);\n              this.stack = [];\n              this.index = 0;\n              this.capacity = 100;\n            },\n            events: [\"undone\", \"redone\"],\n\n            /**\n             * Starts the collection of units. Add those with\n             * the addCompositeItem method and call commit. Or cancel to forget about it.\n             */\n            begin: function () {\n              this.composite = new CompositeUnit();\n            },\n\n            /**\n             * Cancels the collection process of unit started with 'begin'.\n             */\n            cancel: function () {\n              this.composite = undefined;\n            },\n\n            /**\n             * Commits a batch of units.\n             */\n            commit: function (execute) {\n              if (this.composite.units.length > 0) {\n                this._restart(this.composite, execute);\n              }\n\n              this.composite = undefined;\n            },\n\n            /**\n             * Adds a unit as part of the begin-commit batch.\n             * @param undoUnit\n             */\n            addCompositeItem: function (undoUnit) {\n              if (this.composite) {\n                this.composite.add(undoUnit);\n              } else {\n                this.add(undoUnit);\n              }\n            },\n\n            /**\n             * Standard addition of a unit. See also the batch version; begin-addCompositeUnit-commit methods.\n             * @param undoUnit The unit to be added.\n             * @param execute If false, the unit will be added but not executed.\n             */\n            add: function (undoUnit, execute) {\n              this._restart(undoUnit, execute);\n            },\n\n            /**\n             * Returns the number of undoable unit in the stack.\n             * @returns {Number}\n             */\n            pop: function () {\n              if (this.index > 0) {\n                this.stack.pop();\n                this.index--;\n              }\n            },\n            count: function () {\n              return this.stack.length;\n            },\n\n            /**\n             * Rollback of the unit on top of the stack.\n             */\n            undo: function () {\n              if (this.index > 0) {\n                this.index--;\n                this.stack[this.index].undo();\n                this.trigger(\"undone\");\n              }\n            },\n\n            /**\n             * Redo of the last undone action.\n             */\n            redo: function () {\n              if (this.stack.length > 0 && this.index < this.stack.length) {\n                this.stack[this.index].redo();\n                this.index++;\n                this.trigger(\"redone\");\n              }\n            },\n            _restart: function (composite, execute) {\n              // throw away anything beyond this point if this is a new branch\n              this.stack.splice(this.index, this.stack.length - this.index);\n              this.stack.push(composite);\n\n              if (execute !== false) {\n                this.redo();\n              } else {\n                this.index++;\n              } // check the capacity\n\n\n              if (this.stack.length > this.capacity) {\n                this.stack.splice(0, this.stack.length - this.capacity);\n                this.index = this.capacity; //points to the end of the stack\n              }\n            },\n\n            /**\n             * Clears the stack.\n             */\n            clear: function () {\n              this.stack = [];\n              this.index = 0;\n            }\n          }); // Tools =========================================\n\n          var EmptyTool = Class.extend({\n            init: function (toolService) {\n              this.toolService = toolService;\n            },\n            start: function () {},\n            move: function () {},\n            end: function () {},\n            tryActivate: function () {\n              return false;\n            },\n            getCursor: function () {\n              return Cursors.arrow;\n            }\n          });\n          var ScrollerTool = EmptyTool.extend({\n            init: function (toolService) {\n              var tool = this;\n              var friction = kendo.support.mobileOS ? FRICTION_MOBILE : FRICTION;\n              EmptyTool.fn.init.call(tool, toolService);\n              var diagram = tool.toolService.diagram,\n                  canvas = diagram.canvas;\n              var scroller = diagram.scroller = tool.scroller = $(diagram.scrollable).kendoMobileScroller({\n                friction: friction,\n                velocityMultiplier: VELOCITY_MULTIPLIER,\n                mousewheelScrolling: false,\n                zoom: false,\n                scroll: tool._move.bind(tool)\n              }).data(\"kendoMobileScroller\");\n\n              if (canvas.translate) {\n                tool.movableCanvas = new Movable(canvas.element);\n              }\n\n              var virtualScroll = function (dimension, min, max) {\n                dimension.makeVirtual();\n                dimension.virtualSize(min || SCROLL_MIN, max || SCROLL_MAX);\n              };\n\n              virtualScroll(scroller.dimensions.x);\n              virtualScroll(scroller.dimensions.y);\n              scroller.disable();\n            },\n            tryActivate: function (p, meta) {\n              var toolService = this.toolService;\n              var options = toolService.diagram.options.pannable;\n              var enabled = meta.ctrlKey;\n\n              if (defined(options.key)) {\n                if (!options.key || options.key == \"none\") {\n                  enabled = noMeta(meta) && !defined(toolService.hoveredItem);\n                } else {\n                  enabled = meta[options.key + \"Key\"];\n                }\n              }\n\n              return options !== false && enabled && !defined(toolService.hoveredAdorner) && !defined(toolService._hoveredConnector);\n            },\n            start: function () {\n              this.scroller.enable();\n            },\n            move: function () {},\n            //the tool itself should not handle the scrolling. Let kendo scroller take care of this part. Check _move\n            _move: function (args) {\n              var tool = this,\n                  diagram = tool.toolService.diagram,\n                  canvas = diagram.canvas,\n                  scrollPos = new Point(args.scrollLeft, args.scrollTop);\n\n              if (canvas.translate) {\n                diagram._storePan(scrollPos.times(-1));\n\n                tool.movableCanvas.moveTo(scrollPos);\n                canvas.translate(scrollPos.x, scrollPos.y);\n              } else {\n                scrollPos = scrollPos.plus(diagram._pan.times(-1));\n              }\n\n              diagram.trigger(PAN, {\n                pan: scrollPos\n              });\n            },\n            end: function () {\n              this.scroller.disable();\n            },\n            getCursor: function () {\n              return Cursors.move;\n            }\n          });\n          /**\n           * The tool handling the transformations via the adorner.\n           * @type {*}\n           */\n\n          var PointerTool = Class.extend({\n            init: function (toolService) {\n              this.toolService = toolService;\n            },\n            tryActivate: function () {\n              return true; // the pointer tool is last and handles all others requests.\n            },\n            start: function (p, meta) {\n              var toolService = this.toolService,\n                  diagram = toolService.diagram,\n                  hoveredItem = toolService.hoveredItem;\n\n              if (hoveredItem) {\n                toolService.selectSingle(hoveredItem, meta);\n\n                if (hoveredItem.adorner) {\n                  //connection\n                  this.adorner = hoveredItem.adorner;\n                  this.handle = this.adorner._hitTest(p);\n                }\n              }\n\n              if (!this.handle) {\n                this.handle = diagram._resizingAdorner._hitTest(p);\n\n                if (this.handle) {\n                  this.adorner = diagram._resizingAdorner;\n                }\n              }\n\n              if (this.adorner) {\n                if (!this.adorner.isDragHandle(this.handle) || !diagram.trigger(DRAG_START, {\n                  shapes: this.adorner.shapes,\n                  connections: []\n                })) {\n                  this.adorner.start(p);\n                } else {\n                  toolService.startPoint = p;\n                  toolService.end(p);\n                }\n              }\n            },\n            move: function (p) {\n              if (this.adorner) {\n                this.adorner.move(this.handle, p);\n\n                if (this.adorner.isDragHandle(this.handle)) {\n                  this.toolService.diagram.trigger(DRAG, {\n                    shapes: this.adorner.shapes,\n                    connections: []\n                  });\n                }\n              }\n            },\n            end: function () {\n              var diagram = this.toolService.diagram,\n                  adorner = this.adorner,\n                  unit;\n\n              if (adorner) {\n                if (!adorner.isDragHandle(this.handle) || !diagram.trigger(DRAG_END, {\n                  shapes: adorner.shapes,\n                  connections: []\n                })) {\n                  unit = adorner.stop();\n\n                  if (unit) {\n                    diagram.undoRedoService.add(unit, false);\n                  }\n                } else {\n                  adorner.cancel();\n                }\n              }\n\n              this.adorner = undefined;\n              this.handle = undefined;\n            },\n            getCursor: function (p) {\n              return this.toolService.hoveredItem ? this.toolService.hoveredItem._getCursor(p) : Cursors.arrow;\n            }\n          });\n          var SelectionTool = Class.extend({\n            init: function (toolService) {\n              this.toolService = toolService;\n            },\n            tryActivate: function (p, meta) {\n              var toolService = this.toolService;\n              var selectable = toolService.diagram.options.selectable;\n              var enabled = selectable && selectable.multiple !== false;\n\n              if (enabled) {\n                if (selectable.key && selectable.key != \"none\") {\n                  enabled = meta[selectable.key + \"Key\"];\n                } else {\n                  enabled = noMeta(meta);\n                }\n              }\n\n              return enabled && !defined(toolService.hoveredItem) && !defined(toolService.hoveredAdorner);\n            },\n            start: function (p) {\n              var diagram = this.toolService.diagram;\n              diagram.deselect();\n              diagram.selector.start(p);\n            },\n            move: function (p) {\n              var diagram = this.toolService.diagram;\n              diagram.selector.move(p);\n            },\n            end: function (p, meta) {\n              var diagram = this.toolService.diagram,\n                  hoveredItem = this.toolService.hoveredItem;\n              var rect = diagram.selector.bounds();\n\n              if ((!hoveredItem || !hoveredItem.isSelected) && !meta.ctrlKey) {\n                diagram.deselect();\n              }\n\n              if (!rect.isEmpty()) {\n                diagram.selectArea(rect);\n              }\n\n              diagram.selector.end();\n            },\n            getCursor: function () {\n              return Cursors.arrow;\n            }\n          });\n          var ConnectionTool = Class.extend({\n            init: function (toolService) {\n              this.toolService = toolService;\n              this.type = \"ConnectionTool\";\n            },\n            tryActivate: function () {\n              return this.toolService._hoveredConnector;\n            },\n            start: function (p, meta) {\n              var toolService = this.toolService,\n                  diagram = toolService.diagram,\n                  connector = toolService._hoveredConnector,\n                  connection = diagram._createConnection({}, connector._c, p);\n\n              if (canDrag(connection) && !diagram.trigger(DRAG_START, {\n                shapes: [],\n                connections: [connection],\n                connectionHandle: TARGET\n              }) && diagram._addConnection(connection)) {\n                toolService._connectionManipulation(connection, connector._c.shape, true);\n\n                toolService._removeHover();\n\n                toolService.selectSingle(toolService.activeConnection, meta);\n\n                if (meta.type == \"touchmove\") {\n                  diagram._cachedTouchTarget = connector.visual;\n                }\n              } else {\n                connection.source(null);\n                toolService.end(p);\n              }\n            },\n            move: function (p) {\n              var toolService = this.toolService;\n              var connection = toolService.activeConnection;\n              connection.target(p);\n              toolService.diagram.trigger(DRAG, {\n                shapes: [],\n                connections: [connection],\n                connectionHandle: TARGET\n              });\n              return true;\n            },\n            end: function (p) {\n              var toolService = this.toolService,\n                  d = toolService.diagram,\n                  connection = toolService.activeConnection,\n                  hoveredItem = toolService.hoveredItem,\n                  connector = toolService._hoveredConnector,\n                  target,\n                  cachedTouchTarget = d._cachedTouchTarget;\n\n              if (!connection) {\n                return;\n              }\n\n              if (connector && connector._c != connection.sourceConnector) {\n                target = connector._c;\n              } else if (hoveredItem && hoveredItem instanceof diagram.Shape) {\n                target = hoveredItem.getConnector(AUTO) || hoveredItem.getConnector(p);\n              } else {\n                target = p;\n              }\n\n              connection.target(target);\n\n              if (!d.trigger(DRAG_END, {\n                shapes: [],\n                connections: [connection],\n                connectionHandle: TARGET\n              })) {\n                connection.updateModel();\n\n                d._syncConnectionChanges();\n              } else {\n                d.remove(connection, false);\n                d.undoRedoService.pop();\n              }\n\n              toolService._connectionManipulation();\n\n              if (cachedTouchTarget) {\n                d._connectorsAdorner.visual.remove(cachedTouchTarget);\n\n                d._cachedTouchTarget = null;\n              }\n            },\n            getCursor: function () {\n              return Cursors.arrow;\n            }\n          });\n          var ConnectionEditTool = Class.extend({\n            init: function (toolService) {\n              this.toolService = toolService;\n              this.type = \"ConnectionTool\";\n            },\n            tryActivate: function (p, meta) {\n              var toolService = this.toolService,\n                  diagram = toolService.diagram,\n                  selectable = diagram.options.selectable,\n                  item = toolService.hoveredItem,\n                  isActive = selectable !== false && item && item.path && !(item.isSelected && meta.ctrlKey);\n\n              if (isActive) {\n                this._c = item;\n              }\n\n              return isActive;\n            },\n            start: function (p, meta) {\n              var toolService = this.toolService;\n              var connection = this._c;\n              toolService.selectSingle(connection, meta);\n              var adorner = connection.adorner;\n              var handle, name;\n\n              if (adorner) {\n                handle = adorner._hitTest(p);\n                name = HANDLE_NAMES[handle];\n              }\n\n              if (canDrag(connection) && adorner && !toolService.diagram.trigger(DRAG_START, {\n                shapes: [],\n                connections: [connection],\n                connectionHandle: name\n              })) {\n                this.handle = handle;\n                this.handleName = name;\n                adorner.start(p);\n              } else {\n                toolService.startPoint = p;\n                toolService.end(p);\n              }\n            },\n            move: function (p) {\n              var adorner = this._c.adorner;\n\n              if (canDrag(this._c) && adorner) {\n                adorner.move(this.handle, p);\n                this.toolService.diagram.trigger(DRAG, {\n                  shapes: [],\n                  connections: [this._c],\n                  connectionHandle: this.handleName\n                });\n                return true;\n              }\n            },\n            end: function (p) {\n              var connection = this._c;\n              var adorner = connection.adorner;\n              var toolService = this.toolService;\n              var diagram = toolService.diagram;\n\n              if (adorner) {\n                if (canDrag(connection)) {\n                  var unit = adorner.stop(p);\n\n                  if (!diagram.trigger(DRAG_END, {\n                    shapes: [],\n                    connections: [connection],\n                    connectionHandle: this.handleName\n                  })) {\n                    diagram.undoRedoService.add(unit, false);\n                    connection.updateModel();\n\n                    diagram._syncConnectionChanges();\n                  } else {\n                    unit.undo();\n                  }\n                }\n              }\n            },\n            getCursor: function () {\n              return Cursors.move;\n            }\n          });\n\n          function testKey(key, str) {\n            return str.charCodeAt(0) == key || str.toUpperCase().charCodeAt(0) == key;\n          }\n          /**\n           * The service managing the tools.\n           * @type {*}\n           */\n\n\n          var ToolService = Class.extend({\n            init: function (diagram) {\n              this.diagram = diagram;\n              this.tools = [new ScrollerTool(this), new ConnectionEditTool(this), new ConnectionTool(this), new SelectionTool(this), new PointerTool(this)]; // the order matters.\n\n              this.activeTool = undefined;\n            },\n            start: function (p, meta) {\n              meta = deepExtend({}, meta);\n\n              if (this.activeTool) {\n                this.activeTool.end(p, meta);\n              }\n\n              this._updateHoveredItem(p);\n\n              this._activateTool(p, meta);\n\n              this.activeTool.start(p, meta);\n\n              this._updateCursor(p);\n\n              this.diagram.focus();\n              this.diagram.canvas.surface.suspendTracking();\n              this.startPoint = p;\n              return true;\n            },\n            move: function (p, meta) {\n              meta = deepExtend({}, meta);\n              var updateHovered = true;\n\n              if (this.activeTool) {\n                updateHovered = this.activeTool.move(p, meta);\n              }\n\n              if (updateHovered) {\n                this._updateHoveredItem(p);\n              }\n\n              this._updateCursor(p);\n\n              return true;\n            },\n            end: function (p, meta) {\n              meta = deepExtend({}, meta);\n\n              if (this.activeTool) {\n                this.activeTool.end(p, meta);\n              }\n\n              this.diagram.canvas.surface.resumeTracking();\n              this.activeTool = undefined;\n\n              this._updateCursor(p);\n\n              return true;\n            },\n            keyDown: function (key, meta) {\n              var diagram = this.diagram;\n              meta = deepExtend({\n                ctrlKey: false,\n                metaKey: false,\n                altKey: false\n              }, meta);\n\n              if ((meta.ctrlKey || meta.metaKey) && !meta.altKey) {\n                // ctrl or option\n                if (testKey(key, \"a\")) {\n                  // A: select all\n                  diagram.selectAll();\n\n                  diagram._destroyToolBar();\n\n                  return true;\n                } else if (testKey(key, \"z\")) {\n                  // Z: undo\n                  diagram.undo();\n\n                  diagram._destroyToolBar();\n\n                  return true;\n                } else if (testKey(key, \"y\")) {\n                  // y: redo\n                  diagram.redo();\n\n                  diagram._destroyToolBar();\n\n                  return true;\n                } else if (testKey(key, \"c\")) {\n                  diagram.copy();\n\n                  diagram._destroyToolBar();\n                } else if (testKey(key, \"x\")) {\n                  diagram.cut();\n\n                  diagram._destroyToolBar();\n                } else if (testKey(key, \"v\")) {\n                  diagram.paste();\n\n                  diagram._destroyToolBar();\n                } else if (testKey(key, \"l\")) {\n                  diagram.layout();\n\n                  diagram._destroyToolBar();\n                } else if (testKey(key, \"d\")) {\n                  diagram._destroyToolBar();\n\n                  diagram.copy();\n                  diagram.paste();\n                }\n              } else if (key === 46 || key === 8) {\n                // del: deletion\n                var toRemove = this.diagram._triggerRemove(diagram.select());\n\n                if (toRemove.length) {\n                  this.diagram.remove(toRemove, true);\n\n                  this.diagram._syncChanges();\n\n                  this.diagram._destroyToolBar();\n                }\n\n                return true;\n              } else if (key === 27) {\n                // ESC: stop any action\n                this._discardNewConnection();\n\n                diagram.deselect();\n\n                diagram._destroyToolBar();\n\n                return true;\n              }\n            },\n            wheel: function (p, meta) {\n              var diagram = this.diagram,\n                  delta = meta.delta,\n                  z = diagram.zoom(),\n                  options = diagram.options,\n                  zoomRate = options.zoomRate,\n                  zoomOptions = {\n                point: p,\n                meta: meta,\n                zoom: z\n              };\n\n              if (diagram.trigger(ZOOM_START, zoomOptions)) {\n                return;\n              }\n\n              if (delta < 0) {\n                z += zoomRate;\n              } else {\n                z -= zoomRate;\n              }\n\n              z = kendo.dataviz.round(Math.max(options.zoomMin, Math.min(options.zoomMax, z)), 2);\n              zoomOptions.zoom = z;\n              diagram.zoom(z, zoomOptions);\n              diagram.trigger(ZOOM_END, zoomOptions);\n              return true;\n            },\n            setTool: function (tool, index) {\n              tool.toolService = this;\n              this.tools[index] = tool;\n            },\n            selectSingle: function (item, meta) {\n              var diagram = this.diagram;\n              var selectable = diagram.options.selectable;\n\n              if (selectable && !item.isSelected && item.options.selectable !== false) {\n                var addToSelection = meta.ctrlKey && selectable.multiple !== false;\n                diagram.select(item, {\n                  addToSelection: addToSelection\n                });\n              }\n            },\n            _discardNewConnection: function () {\n              if (this.newConnection) {\n                this.diagram.remove(this.newConnection);\n                this.newConnection = undefined;\n              }\n            },\n            _activateTool: function (p, meta) {\n              for (var i = 0; i < this.tools.length; i++) {\n                var tool = this.tools[i];\n\n                if (tool.tryActivate(p, meta)) {\n                  this.activeTool = tool;\n                  break; // activating the first available tool in the loop.\n                }\n              }\n            },\n            _updateCursor: function (p) {\n              var element = this.diagram.element;\n              var cursor = this.activeTool ? this.activeTool.getCursor(p) : this.hoveredAdorner ? this.hoveredAdorner._getCursor(p) : this.hoveredItem ? this.hoveredItem._getCursor(p) : Cursors.arrow;\n              element.css({\n                cursor: cursor\n              });\n            },\n            _connectionManipulation: function (connection, disabledShape, isNew) {\n              this.activeConnection = connection;\n              this.disabledShape = disabledShape;\n\n              if (isNew) {\n                this.newConnection = this.activeConnection;\n              } else {\n                this.newConnection = undefined;\n              }\n            },\n            _updateHoveredItem: function (p) {\n              var hit = this._hitTest(p);\n\n              var diagram = this.diagram;\n\n              if (hit != this.hoveredItem && (!this.disabledShape || hit != this.disabledShape)) {\n                if (this.hoveredItem) {\n                  diagram.trigger(MOUSE_LEAVE, {\n                    item: this.hoveredItem\n                  });\n\n                  this.hoveredItem._hover(false);\n                }\n\n                if (hit && hit.options.enable) {\n                  diagram.trigger(MOUSE_ENTER, {\n                    item: hit\n                  });\n                  this.hoveredItem = hit; // Shape, connection or connector\n\n                  this.hoveredItem._hover(true);\n                } else {\n                  this.hoveredItem = undefined;\n                }\n              }\n            },\n            _removeHover: function () {\n              if (this.hoveredItem) {\n                this.hoveredItem._hover(false);\n\n                this.hoveredItem = undefined;\n              }\n            },\n            _hitTest: function (point) {\n              var hit,\n                  d = this.diagram,\n                  item,\n                  i; // connectors\n\n              if (this._hoveredConnector) {\n                this._hoveredConnector._hover(false);\n\n                this._hoveredConnector = undefined;\n              }\n\n              if (d._connectorsAdorner._visible) {\n                hit = d._connectorsAdorner._hitTest(point);\n\n                if (hit) {\n                  return hit;\n                }\n              }\n\n              hit = this.diagram._resizingAdorner._hitTest(point);\n\n              if (hit) {\n                this.hoveredAdorner = d._resizingAdorner;\n\n                if (hit.x !== 0 || hit.y !== 0) {\n                  // hit testing for resizers or rotator, otherwise if (0,0) than pass through.\n                  return;\n                }\n\n                hit = undefined;\n              } else {\n                this.hoveredAdorner = undefined;\n              }\n\n              if (!this.activeTool || this.activeTool.type !== \"ConnectionTool\") {\n                var selectedConnections = []; // only the connections should have higher presence because the connection edit point is on top of connector.\n                // TODO: This should be reworked. The connection adorner should be one for all selected connections and should be hit tested prior the connections and shapes itself.\n\n                for (i = 0; i < d._selectedItems.length; i++) {\n                  item = d._selectedItems[i];\n\n                  if (item instanceof diagram.Connection) {\n                    selectedConnections.push(item);\n                  }\n                }\n\n                hit = this._hitTestItems(selectedConnections, point);\n              }\n\n              return hit || this._hitTestElements(point);\n            },\n            _hitTestElements: function (point) {\n              var diagram = this.diagram;\n\n              var shapeHit = this._hitTestItems(diagram.shapes, point);\n\n              var connectionHit = this._hitTestItems(diagram.connections, point);\n\n              var hit;\n\n              if ((!this.activeTool || this.activeTool.type != \"ConnectionTool\") && shapeHit && connectionHit && !hitTestShapeConnectors(shapeHit, point)) {\n                var mainLayer = diagram.mainLayer;\n                var shapeIdx = inArray(shapeHit.visual, mainLayer.children);\n                var connectionIdx = inArray(connectionHit.visual, mainLayer.children);\n                hit = shapeIdx > connectionIdx ? shapeHit : connectionHit;\n              }\n\n              return hit || shapeHit || connectionHit;\n            },\n            _hitTestItems: function (array, point) {\n              var i, item, hit;\n\n              for (i = array.length - 1; i >= 0; i--) {\n                item = array[i];\n                hit = item._hitTest(point);\n\n                if (hit) {\n                  return hit;\n                }\n              }\n            }\n          }); // Routing =========================================\n\n          /**\n           * Base class for connection routers.\n           */\n\n          var ConnectionRouterBase = kendo.Class.extend({\n            init: function () {}\n            /*route: function (connection) {\n             },\n             hitTest: function (p) {\n              },\n             getBounds: function () {\n              }*/\n\n          });\n          /**\n           * Base class for polyline and cascading routing.\n           */\n\n          var LinearConnectionRouter = ConnectionRouterBase.extend({\n            init: function (connection) {\n              var that = this;\n              ConnectionRouterBase.fn.init.call(that);\n              this.connection = connection;\n            },\n\n            /**\n             * Hit testing for polyline paths.\n             */\n            hitTest: function (p) {\n              var rec = this.getBounds().inflate(HIT_TEST_DISTANCE);\n\n              if (!rec.contains(p)) {\n                return false;\n              }\n\n              return diagram.Geometry.distanceToPolyline(p, this.connection.allPoints()) < HIT_TEST_DISTANCE;\n            },\n\n            /**\n             * Bounds of a polyline.\n             * @returns {kendo.dataviz.diagram.Rect}\n             */\n            getBounds: function () {\n              var points = this.connection.allPoints(),\n                  s = points[0],\n                  e = points[points.length - 1],\n                  right = Math.max(s.x, e.x),\n                  left = Math.min(s.x, e.x),\n                  top = Math.min(s.y, e.y),\n                  bottom = Math.max(s.y, e.y);\n\n              for (var i = 1; i < points.length - 1; ++i) {\n                right = Math.max(right, points[i].x);\n                left = Math.min(left, points[i].x);\n                top = Math.min(top, points[i].y);\n                bottom = Math.max(bottom, points[i].y);\n              }\n\n              return new Rect(left, top, right - left, bottom - top);\n            }\n          });\n          /**\n           * A simple poly-linear routing which does not alter the intermediate points.\n           * Does hold the underlying hit, bounds....logic.\n           * @type {*|Object|void|extend|Zepto.extend|b.extend}\n           */\n\n          var PolylineRouter = LinearConnectionRouter.extend({\n            init: function (connection) {\n              var that = this;\n              LinearConnectionRouter.fn.init.call(that);\n              this.connection = connection;\n            },\n            route: function () {// just keep the points as is\n            }\n          });\n          var CascadingRouter = LinearConnectionRouter.extend({\n            SAME_SIDE_DISTANCE_RATIO: 5,\n            init: function (connection) {\n              var that = this;\n              LinearConnectionRouter.fn.init.call(that);\n              this.connection = connection;\n            },\n            routePoints: function (start, end, sourceConnector, targetConnector) {\n              var result;\n\n              if (sourceConnector && targetConnector) {\n                result = this._connectorPoints(start, end, sourceConnector, targetConnector);\n              } else {\n                result = this._floatingPoints(start, end, sourceConnector);\n              }\n\n              return result;\n            },\n            route: function () {\n              var sourceConnector = this.connection._resolvedSourceConnector;\n              var targetConnector = this.connection._resolvedTargetConnector;\n              var start = this.connection.sourcePoint();\n              var end = this.connection.targetPoint();\n              var points = this.routePoints(start, end, sourceConnector, targetConnector);\n              this.connection.points(points);\n            },\n            _connectorSides: [{\n              name: \"Top\",\n              axis: \"y\",\n              boundsPoint: \"topLeft\",\n              secondarySign: 1\n            }, {\n              name: \"Left\",\n              axis: \"x\",\n              boundsPoint: \"topLeft\",\n              secondarySign: 1\n            }, {\n              name: \"Bottom\",\n              axis: \"y\",\n              boundsPoint: \"bottomRight\",\n              secondarySign: -1\n            }, {\n              name: \"Right\",\n              axis: \"x\",\n              boundsPoint: \"bottomRight\",\n              secondarySign: -1\n            }],\n            _connectorSide: function (connector, targetPoint) {\n              var position = connector.position();\n              var shapeBounds = connector.shape.bounds(ROTATED);\n              var bounds = {\n                topLeft: shapeBounds.topLeft(),\n                bottomRight: shapeBounds.bottomRight()\n              };\n              var sides = this._connectorSides;\n              var min = util.MAX_NUM;\n              var sideDistance;\n              var minSide;\n              var axis;\n              var side;\n\n              for (var idx = 0; idx < sides.length; idx++) {\n                side = sides[idx];\n                axis = side.axis;\n                sideDistance = Math.round(Math.abs(position[axis] - bounds[side.boundsPoint][axis]));\n\n                if (sideDistance < min) {\n                  min = sideDistance;\n                  minSide = side;\n                } else if (sideDistance === min && (position[axis] - targetPoint[axis]) * side.secondarySign > (position[minSide.axis] - targetPoint[minSide.axis]) * minSide.secondarySign) {\n                  minSide = side;\n                }\n              }\n\n              return minSide.name;\n            },\n            _sameSideDistance: function (connector) {\n              var bounds = connector.shape.bounds(ROTATED);\n              return Math.min(bounds.width, bounds.height) / this.SAME_SIDE_DISTANCE_RATIO;\n            },\n            _connectorPoints: function (start, end, sourceConnector, targetConnector) {\n              var sourceConnectorSide = this._connectorSide(sourceConnector, end);\n\n              var targetConnectorSide = this._connectorSide(targetConnector, start);\n\n              var deltaX = end.x - start.x;\n              var deltaY = end.y - start.y;\n\n              var sameSideDistance = this._sameSideDistance(sourceConnector);\n\n              var result = [];\n              var pointX, pointY;\n\n              if (sourceConnectorSide === TOP || sourceConnectorSide == BOTTOM) {\n                if (targetConnectorSide == TOP || targetConnectorSide == BOTTOM) {\n                  if (sourceConnectorSide == targetConnectorSide) {\n                    if (sourceConnectorSide == TOP) {\n                      pointY = Math.min(start.y, end.y) - sameSideDistance;\n                    } else {\n                      pointY = Math.max(start.y, end.y) + sameSideDistance;\n                    }\n\n                    result = [new Point(start.x, pointY), new Point(end.x, pointY)];\n                  } else {\n                    result = [new Point(start.x, start.y + deltaY / 2), new Point(end.x, start.y + deltaY / 2)];\n                  }\n                } else {\n                  result = [new Point(start.x, end.y)];\n                }\n              } else {\n                if (targetConnectorSide == LEFT || targetConnectorSide == RIGHT) {\n                  if (sourceConnectorSide == targetConnectorSide) {\n                    if (sourceConnectorSide == LEFT) {\n                      pointX = Math.min(start.x, end.x) - sameSideDistance;\n                    } else {\n                      pointX = Math.max(start.x, end.x) + sameSideDistance;\n                    }\n\n                    result = [new Point(pointX, start.y), new Point(pointX, end.y)];\n                  } else {\n                    result = [new Point(start.x + deltaX / 2, start.y), new Point(start.x + deltaX / 2, start.y + deltaY)];\n                  }\n                } else {\n                  result = [new Point(end.x, start.y)];\n                }\n              }\n\n              return result;\n            },\n            _floatingPoints: function (start, end, sourceConnector) {\n              var sourceConnectorSide = sourceConnector ? this._connectorSide(sourceConnector, end) : null;\n\n              var cascadeStartHorizontal = this._startHorizontal(start, end, sourceConnectorSide);\n\n              var points = [start, start, end, end];\n              var deltaX = end.x - start.x;\n              var deltaY = end.y - start.y;\n              var length = points.length;\n              var shiftX;\n              var shiftY; // note that this is more generic than needed for only two intermediate points.\n\n              for (var idx = 1; idx < length - 1; ++idx) {\n                if (cascadeStartHorizontal) {\n                  if (idx % 2 !== 0) {\n                    shiftX = deltaX / (length / 2);\n                    shiftY = 0;\n                  } else {\n                    shiftX = 0;\n                    shiftY = deltaY / ((length - 1) / 2);\n                  }\n                } else {\n                  if (idx % 2 !== 0) {\n                    shiftX = 0;\n                    shiftY = deltaY / (length / 2);\n                  } else {\n                    shiftX = deltaX / ((length - 1) / 2);\n                    shiftY = 0;\n                  }\n                }\n\n                points[idx] = new Point(points[idx - 1].x + shiftX, points[idx - 1].y + shiftY);\n              } // need to fix the wrong 1.5 factor of the last intermediate point\n\n\n              idx--;\n\n              if (cascadeStartHorizontal && idx % 2 !== 0 || !cascadeStartHorizontal && idx % 2 === 0) {\n                points[length - 2] = new Point(points[length - 1].x, points[length - 2].y);\n              } else {\n                points[length - 2] = new Point(points[length - 2].x, points[length - 1].y);\n              }\n\n              return [points[1], points[2]];\n            },\n            _startHorizontal: function (start, end, sourceSide) {\n              var horizontal;\n\n              if (sourceSide !== null && (sourceSide === RIGHT || sourceSide === LEFT)) {\n                horizontal = true;\n              } else {\n                horizontal = Math.abs(start.x - end.x) > Math.abs(start.y - end.y);\n              }\n\n              return horizontal;\n            }\n          }); // Adorners =========================================\n\n          var AdornerBase = Class.extend({\n            init: function (diagram, options) {\n              var that = this;\n              that.diagram = diagram;\n              that.options = deepExtend({}, that.options, options);\n              that.visual = new Group();\n\n              that.diagram._adorners.push(that);\n            },\n            refresh: function () {}\n          });\n          var ConnectionEditAdorner = AdornerBase.extend({\n            init: function (connection, options) {\n              var that = this,\n                  diagram;\n              that.connection = connection;\n              diagram = that.connection.diagram;\n              that._ts = diagram.toolService;\n              AdornerBase.fn.init.call(that, diagram, options);\n              var sp = that.connection.sourcePoint();\n              var tp = that.connection.targetPoint();\n              that.spVisual = new Circle(deepExtend(that.options.handles, {\n                center: sp\n              }));\n              that.epVisual = new Circle(deepExtend(that.options.handles, {\n                center: tp\n              }));\n              that.visual.append(that.spVisual);\n              that.visual.append(that.epVisual);\n            },\n            options: {\n              handles: {}\n            },\n            _getCursor: function () {\n              return Cursors.move;\n            },\n            start: function (p) {\n              this.handle = this._hitTest(p);\n              this.startPoint = p;\n              this._initialSource = this.connection.source();\n              this._initialTarget = this.connection.target();\n\n              switch (this.handle) {\n                case -1:\n                  if (this.connection.targetConnector) {\n                    this._ts._connectionManipulation(this.connection, this.connection.targetConnector.shape);\n                  }\n\n                  break;\n\n                case 1:\n                  if (this.connection.sourceConnector) {\n                    this._ts._connectionManipulation(this.connection, this.connection.sourceConnector.shape);\n                  }\n\n                  break;\n              }\n            },\n            move: function (handle, p) {\n              switch (handle) {\n                case -1:\n                  this.connection.source(p);\n                  break;\n\n                case 1:\n                  this.connection.target(p);\n                  break;\n\n                default:\n                  var delta = p.minus(this.startPoint);\n                  this.startPoint = p;\n\n                  if (!this.connection.sourceConnector) {\n                    this.connection.source(this.connection.sourcePoint().plus(delta));\n                  }\n\n                  if (!this.connection.targetConnector) {\n                    this.connection.target(this.connection.targetPoint().plus(delta));\n                  }\n\n                  break;\n              }\n\n              this.refresh();\n              return true;\n            },\n            stop: function (p) {\n              var ts = this.diagram.toolService,\n                  item = ts.hoveredItem,\n                  target;\n\n              if (ts._hoveredConnector) {\n                target = ts._hoveredConnector._c;\n              } else if (item && item instanceof diagram.Shape) {\n                target = item.getConnector(AUTO) || item.getConnector(p);\n              } else {\n                target = p;\n              }\n\n              if (this.handle === -1) {\n                this.connection.source(target);\n              } else if (this.handle === 1) {\n                this.connection.target(target);\n              }\n\n              this.handle = undefined;\n\n              this._ts._connectionManipulation();\n\n              return new ConnectionEditUndoUnit(this.connection, this._initialSource, this._initialTarget);\n            },\n            _hitTest: function (point) {\n              var sourcePoint = this.connection.sourcePoint();\n              var targetPoint = this.connection.targetPoint();\n              var radiusX = this.options.handles.width / 2 + HIT_TEST_DISTANCE;\n              var radiusY = this.options.handles.height / 2 + HIT_TEST_DISTANCE;\n              var sourcePointDistance = sourcePoint.distanceTo(point);\n              var targetPointDistance = targetPoint.distanceTo(point);\n              var sourceHandle = new Rect(sourcePoint.x, sourcePoint.y).inflate(radiusX, radiusY).contains(point);\n              var targetHandle = new Rect(targetPoint.x, targetPoint.y).inflate(radiusX, radiusY).contains(point);\n              var handle = 0;\n\n              if (sourceHandle && (!targetHandle || sourcePointDistance < targetPointDistance)) {\n                handle = -1;\n              } else if (targetHandle && (!sourceHandle || targetPointDistance < sourcePointDistance)) {\n                handle = 1;\n              }\n\n              return handle;\n            },\n            refresh: function () {\n              this.spVisual.redraw({\n                center: this.diagram.modelToLayer(this.connection.sourcePoint())\n              });\n              this.epVisual.redraw({\n                center: this.diagram.modelToLayer(this.connection.targetPoint())\n              });\n            }\n          });\n          var ConnectorsAdorner = AdornerBase.extend({\n            init: function (diagram, options) {\n              var that = this;\n              AdornerBase.fn.init.call(that, diagram, options);\n\n              that._refreshHandler = function (e) {\n                if (e.item == that.shape) {\n                  that.refresh();\n                }\n              };\n            },\n            show: function (shape) {\n              var that = this,\n                  len,\n                  i,\n                  ctr;\n              that._visible = true;\n              that.shape = shape;\n              that.diagram.bind(ITEMBOUNDSCHANGE, that._refreshHandler);\n              len = shape.connectors.length;\n              that.connectors = [];\n\n              that._clearVisual();\n\n              for (i = 0; i < len; i++) {\n                ctr = new ConnectorVisual(shape.connectors[i]);\n                that.connectors.push(ctr);\n                that.visual.append(ctr.visual);\n              }\n\n              that.visual.visible(true);\n              that.refresh();\n            },\n            _clearVisual: function () {\n              var that = this;\n\n              if (that.diagram._cachedTouchTarget) {\n                that._keepCachedTouchTarget();\n              } else {\n                that.visual.clear();\n              }\n            },\n            _keepCachedTouchTarget: function () {\n              var that = this,\n                  visualChildren = that.visual.children;\n              var childrenCount = visualChildren.length;\n              var index = inArray(that.diagram._cachedTouchTarget, visualChildren);\n\n              for (var i = childrenCount - 1; i >= 0; i--) {\n                if (i == index) {\n                  continue;\n                }\n\n                that.visual.remove(visualChildren[i]);\n              }\n            },\n            destroy: function () {\n              var that = this;\n              that.diagram.unbind(ITEMBOUNDSCHANGE, that._refreshHandler);\n              that.shape = undefined;\n              that._visible = undefined;\n              that.visual.visible(false);\n            },\n            _hitTest: function (p) {\n              var ctr, i;\n\n              for (i = 0; i < this.connectors.length; i++) {\n                ctr = this.connectors[i];\n\n                if (ctr._hitTest(p)) {\n                  ctr._hover(true);\n\n                  this.diagram.toolService._hoveredConnector = ctr;\n                  break;\n                }\n              }\n            },\n            refresh: function () {\n              if (this.shape) {\n                var bounds = this.shape.bounds();\n                bounds = this.diagram.modelToLayer(bounds);\n                this.visual.position(bounds.topLeft());\n                $.each(this.connectors, function () {\n                  this.refresh();\n                });\n              }\n            }\n          });\n\n          function hitToOppositeSide(hit, bounds) {\n            var result;\n\n            if (hit.x == -1 && hit.y == -1) {\n              result = bounds.bottomRight();\n            } else if (hit.x == 1 && hit.y == 1) {\n              result = bounds.topLeft();\n            } else if (hit.x == -1 && hit.y == 1) {\n              result = bounds.topRight();\n            } else if (hit.x == 1 && hit.y == -1) {\n              result = bounds.bottomLeft();\n            } else if (hit.x === 0 && hit.y == -1) {\n              result = bounds.bottom();\n            } else if (hit.x === 0 && hit.y == 1) {\n              result = bounds.top();\n            } else if (hit.x == 1 && hit.y === 0) {\n              result = bounds.left();\n            } else if (hit.x == -1 && hit.y === 0) {\n              result = bounds.right();\n            }\n\n            return result;\n          }\n\n          var ResizingAdorner = AdornerBase.extend({\n            init: function (diagram, options) {\n              var that = this;\n              AdornerBase.fn.init.call(that, diagram, options);\n              that._manipulating = false;\n              that.map = [];\n              that.shapes = [];\n\n              that._initSelection();\n\n              that._createHandles();\n\n              that.redraw();\n              that.diagram.bind(\"select\", function (e) {\n                that._initialize(e.selected);\n              });\n\n              that._refreshHandler = function () {\n                if (!that._internalChange) {\n                  that.refreshBounds();\n                  that.refresh();\n                }\n              };\n\n              that._rotatedHandler = function () {\n                if (that.shapes.length == 1) {\n                  that._angle = that.shapes[0].rotate().angle;\n                }\n\n                that._refreshHandler();\n              };\n\n              that.diagram.bind(ITEMBOUNDSCHANGE, that._refreshHandler).bind(ITEMROTATE, that._rotatedHandler);\n              that.refreshBounds();\n              that.refresh();\n            },\n            options: {\n              handles: {\n                fill: {\n                  color: \"#fff\"\n                },\n                stroke: {\n                  color: \"#282828\"\n                },\n                height: 7,\n                width: 7,\n                hover: {\n                  fill: {\n                    color: \"#282828\"\n                  },\n                  stroke: {\n                    color: \"#282828\"\n                  }\n                }\n              },\n              selectable: {\n                stroke: {\n                  color: \"#778899\",\n                  width: 1,\n                  dashType: \"dash\"\n                },\n                fill: {\n                  color: TRANSPARENT\n                }\n              },\n              offset: 10\n            },\n            _initSelection: function () {\n              var that = this;\n              var diagram = that.diagram;\n              var selectable = diagram.options.selectable;\n              var options = deepExtend({}, that.options.selectable, selectable);\n              that.rect = new Rectangle(options);\n              that.visual.append(that.rect);\n            },\n            _resizable: function () {\n              return this.options.editable && this.options.editable.resize !== false;\n            },\n            _handleOptions: function () {\n              return (this.options.editable.resize || {}).handles || this.options.handles;\n            },\n            _createHandles: function () {\n              var handles, item, y, x;\n\n              if (this._resizable()) {\n                handles = this._handleOptions();\n\n                for (x = -1; x <= 1; x++) {\n                  for (y = -1; y <= 1; y++) {\n                    if (x !== 0 || y !== 0) {\n                      // (0, 0) element, (-1, -1) top-left, (+1, +1) bottom-right\n                      item = new Rectangle(handles);\n                      item.drawingElement._hover = this._hover.bind(this);\n                      this.map.push({\n                        x: x,\n                        y: y,\n                        visual: item\n                      });\n                      this.visual.append(item);\n                    }\n                  }\n                }\n              }\n            },\n            bounds: function (value) {\n              if (value) {\n                this._innerBounds = value.clone();\n                this._bounds = this.diagram.modelToLayer(value).inflate(this.options.offset, this.options.offset);\n              } else {\n                return this._bounds;\n              }\n            },\n            _hitTest: function (p) {\n              var tp = this.diagram.modelToLayer(p),\n                  i,\n                  hit,\n                  handleBounds,\n                  handlesCount = this.map.length,\n                  handle;\n\n              if (this._angle) {\n                tp = tp.clone().rotate(this._bounds.center(), this._angle);\n              }\n\n              if (this._resizable()) {\n                for (i = 0; i < handlesCount; i++) {\n                  handle = this.map[i];\n                  hit = new Point(handle.x, handle.y);\n                  handleBounds = this._getHandleBounds(hit); //local coordinates\n\n                  handleBounds.offset(this._bounds.x, this._bounds.y);\n\n                  if (handleBounds.contains(tp)) {\n                    return hit;\n                  }\n                }\n              }\n\n              if (this._bounds.contains(tp)) {\n                return new Point(0, 0);\n              }\n            },\n            _getHandleBounds: function (p) {\n              if (this._resizable()) {\n                var handles = this._handleOptions(),\n                    w = handles.width,\n                    h = handles.height,\n                    r = new Rect(0, 0, w, h);\n\n                if (p.x < 0) {\n                  r.x = -w / 2;\n                } else if (p.x === 0) {\n                  r.x = Math.floor(this._bounds.width / 2) - w / 2;\n                } else if (p.x > 0) {\n                  r.x = this._bounds.width + 1.0 - w / 2;\n                }\n\n                if (p.y < 0) {\n                  r.y = -h / 2;\n                } else if (p.y === 0) {\n                  r.y = Math.floor(this._bounds.height / 2) - h / 2;\n                } else if (p.y > 0) {\n                  r.y = this._bounds.height + 1.0 - h / 2;\n                }\n\n                return r;\n              }\n            },\n            _getCursor: function (point) {\n              var hit = this._hitTest(point);\n\n              if (hit && hit.x >= -1 && hit.x <= 1 && hit.y >= -1 && hit.y <= 1 && this._resizable()) {\n                var angle = this._angle;\n\n                if (angle) {\n                  angle = 360 - angle;\n                  hit.rotate(new Point(0, 0), angle);\n                  hit = new Point(Math.round(hit.x), Math.round(hit.y));\n                }\n\n                if (hit.x == -1 && hit.y == -1) {\n                  return \"nw-resize\";\n                }\n\n                if (hit.x == 1 && hit.y == 1) {\n                  return \"se-resize\";\n                }\n\n                if (hit.x == -1 && hit.y == 1) {\n                  return \"sw-resize\";\n                }\n\n                if (hit.x == 1 && hit.y == -1) {\n                  return \"ne-resize\";\n                }\n\n                if (hit.x === 0 && hit.y == -1) {\n                  return \"n-resize\";\n                }\n\n                if (hit.x === 0 && hit.y == 1) {\n                  return \"s-resize\";\n                }\n\n                if (hit.x == 1 && hit.y === 0) {\n                  return \"e-resize\";\n                }\n\n                if (hit.x == -1 && hit.y === 0) {\n                  return \"w-resize\";\n                }\n              }\n\n              return this._manipulating ? Cursors.move : Cursors.select;\n            },\n            _initialize: function () {\n              var that = this,\n                  i,\n                  item,\n                  items = that.diagram.select();\n              that.shapes = [];\n\n              for (i = 0; i < items.length; i++) {\n                item = items[i];\n\n                if (item instanceof diagram.Shape) {\n                  that.shapes.push(item);\n                  item._rotationOffset = new Point();\n                }\n              }\n\n              that._angle = that.shapes.length == 1 ? that.shapes[0].rotate().angle : 0;\n              that._startAngle = that._angle;\n\n              that._rotates();\n\n              that._positions();\n\n              that.refreshBounds();\n              that.refresh();\n              that.redraw();\n            },\n            _rotates: function () {\n              var that = this,\n                  i,\n                  shape;\n              that.initialRotates = [];\n\n              for (i = 0; i < that.shapes.length; i++) {\n                shape = that.shapes[i];\n                that.initialRotates.push(shape.rotate().angle);\n              }\n            },\n            _positions: function () {\n              var that = this,\n                  i,\n                  shape;\n              that.initialStates = [];\n\n              for (i = 0; i < that.shapes.length; i++) {\n                shape = that.shapes[i];\n                that.initialStates.push(shape.bounds());\n              }\n            },\n            _hover: function (value, element) {\n              if (this._resizable()) {\n                var handleOptions = this._handleOptions(),\n                    hover = handleOptions.hover,\n                    stroke = handleOptions.stroke,\n                    fill = handleOptions.fill;\n\n                if (value && Utils.isDefined(hover.stroke)) {\n                  stroke = deepExtend({}, stroke, hover.stroke);\n                }\n\n                if (value && Utils.isDefined(hover.fill)) {\n                  fill = hover.fill;\n                }\n\n                element.stroke(stroke.color, stroke.width, stroke.opacity);\n                element.fill(fill.color, fill.opacity);\n              }\n            },\n            start: function (p) {\n              this._sp = p;\n              this._cp = p;\n              this._lp = p;\n              this._manipulating = true;\n              this._internalChange = true;\n              this.shapeStates = [];\n\n              for (var i = 0; i < this.shapes.length; i++) {\n                var shape = this.shapes[i];\n                this.shapeStates.push(shape.bounds());\n              }\n            },\n            redraw: function () {\n              var i,\n                  handle,\n                  visibleHandles = this._resizable();\n\n              for (i = 0; i < this.map.length; i++) {\n                handle = this.map[i];\n                handle.visual.visible(visibleHandles);\n              }\n            },\n            angle: function (value) {\n              if (defined(value)) {\n                this._angle = value;\n              }\n\n              return this._angle;\n            },\n            rotate: function () {\n              var center = this._innerBounds.center();\n\n              var currentAngle = this.angle();\n              this._internalChange = true;\n\n              for (var i = 0; i < this.shapes.length; i++) {\n                var shape = this.shapes[i];\n                currentAngle = (currentAngle + this.initialRotates[i] - this._startAngle) % 360;\n                shape.rotate(currentAngle, center);\n              }\n\n              this.refresh();\n            },\n            move: function (handle, p) {\n              var delta,\n                  dragging,\n                  dtl = new Point(),\n                  dbr = new Point(),\n                  bounds,\n                  center,\n                  shape,\n                  i,\n                  angle,\n                  newBounds,\n                  changed = 0,\n                  staticPoint,\n                  scaleX,\n                  scaleY;\n\n              if (handle.y === -2 && handle.x === -1) {\n                center = this._innerBounds.center();\n                this._angle = this._truncateAngle(Utils.findAngle(center, p));\n\n                for (i = 0; i < this.shapes.length; i++) {\n                  shape = this.shapes[i];\n                  angle = (this._angle + this.initialRotates[i] - this._startAngle) % 360;\n                  shape.rotate(angle, center);\n\n                  if (shape.hasOwnProperty(\"layout\")) {\n                    shape.layout(shape);\n                  }\n\n                  this._rotating = true;\n                }\n\n                this.refresh();\n              } else {\n                if (this.shouldSnap()) {\n                  var thr = this._truncateDistance(p.minus(this._lp)); // threshold\n\n\n                  if (thr.x === 0 && thr.y === 0) {\n                    this._cp = p;\n                    return;\n                  }\n\n                  delta = thr;\n                  this._lp = new Point(this._lp.x + thr.x, this._lp.y + thr.y);\n                } else {\n                  delta = p.minus(this._cp);\n                }\n\n                if (this.isDragHandle(handle)) {\n                  dbr = dtl = delta; // dragging\n\n                  dragging = true;\n                } else {\n                  if (this._angle) {\n                    // adjust the delta so that resizers resize in the correct direction after rotation.\n                    delta.rotate(new Point(0, 0), this._angle);\n                  }\n\n                  if (handle.x == -1) {\n                    dtl.x = delta.x;\n                  } else if (handle.x == 1) {\n                    dbr.x = delta.x;\n                  }\n\n                  if (handle.y == -1) {\n                    dtl.y = delta.y;\n                  } else if (handle.y == 1) {\n                    dbr.y = delta.y;\n                  }\n                }\n\n                if (!dragging) {\n                  staticPoint = hitToOppositeSide(handle, this._innerBounds);\n                  scaleX = (this._innerBounds.width + delta.x * handle.x) / this._innerBounds.width;\n                  scaleY = (this._innerBounds.height + delta.y * handle.y) / this._innerBounds.height;\n                }\n\n                for (i = 0; i < this.shapes.length; i++) {\n                  shape = this.shapes[i];\n                  bounds = shape.bounds();\n\n                  if (dragging) {\n                    if (!canDrag(shape)) {\n                      continue;\n                    }\n\n                    newBounds = this._displaceBounds(bounds, dtl, dbr, dragging);\n                  } else {\n                    newBounds = bounds.clone();\n                    newBounds.scale(scaleX, scaleY, staticPoint, this._innerBounds.center(), shape.rotate().angle);\n                    var newCenter = newBounds.center(); // fixes the new rotation center.\n\n                    newCenter.rotate(bounds.center(), -this._angle);\n                    newBounds = new Rect(newCenter.x - newBounds.width / 2, newCenter.y - newBounds.height / 2, newBounds.width, newBounds.height);\n                  }\n\n                  if (newBounds.width >= shape.options.minWidth && newBounds.height >= shape.options.minHeight) {\n                    // if we up-size very small shape\n                    var oldBounds = bounds;\n                    shape.bounds(newBounds);\n\n                    if (shape.hasOwnProperty(\"layout\")) {\n                      shape.layout(shape, oldBounds, newBounds);\n                    }\n\n                    if (oldBounds.width !== newBounds.width || oldBounds.height !== newBounds.height) {\n                      shape.rotate(shape.rotate().angle); // forces the rotation to update it's rotation center\n                    }\n\n                    changed += 1;\n                  }\n                }\n\n                if (changed) {\n                  if (changed == i) {\n                    newBounds = this._displaceBounds(this._innerBounds, dtl, dbr, dragging);\n                    this.bounds(newBounds);\n                  } else {\n                    this.refreshBounds();\n                  }\n\n                  this.refresh();\n                }\n\n                this._positions();\n              }\n\n              this._cp = p;\n            },\n            isDragHandle: function (handle) {\n              return handle.x === 0 && handle.y === 0;\n            },\n            cancel: function () {\n              var shapes = this.shapes;\n              var states = this.shapeStates;\n\n              for (var idx = 0; idx < shapes.length; idx++) {\n                shapes[idx].bounds(states[idx]);\n              }\n\n              this.refreshBounds();\n              this.refresh();\n              this._manipulating = undefined;\n              this._internalChange = undefined;\n              this._rotating = undefined;\n            },\n            _truncatePositionToGuides: function (bounds) {\n              if (this.diagram.ruler) {\n                return this.diagram.ruler.truncatePositionToGuides(bounds);\n              }\n\n              return bounds;\n            },\n            _truncateSizeToGuides: function (bounds) {\n              if (this.diagram.ruler) {\n                return this.diagram.ruler.truncateSizeToGuides(bounds);\n              }\n\n              return bounds;\n            },\n            _truncateAngle: function (a) {\n              var snap = this.snapOptions();\n              var snapAngle = Math.max(snap.angle || DEFAULT_SNAP_ANGLE, MIN_SNAP_ANGLE);\n              return snap ? Math.floor(a % 360 / snapAngle) * snapAngle : a % 360;\n            },\n            _truncateDistance: function (d) {\n              if (d instanceof diagram.Point) {\n                return new diagram.Point(this._truncateDistance(d.x), this._truncateDistance(d.y));\n              } else {\n                var snap = this.snapOptions() || {};\n                var snapSize = Math.max(snap.size || DEFAULT_SNAP_SIZE, MIN_SNAP_SIZE);\n                return snap ? Math.floor(d / snapSize) * snapSize : d;\n              }\n            },\n            snapOptions: function () {\n              var editable = this.diagram.options.editable;\n              var snap = ((editable || {}).drag || {}).snap || {};\n              return snap;\n            },\n            shouldSnap: function () {\n              var editable = this.diagram.options.editable;\n              var drag = (editable || {}).drag;\n              var snap = (drag || {}).snap;\n              return editable !== false && drag !== false && snap !== false;\n            },\n            _displaceBounds: function (bounds, dtl, dbr, dragging) {\n              var tl = bounds.topLeft().plus(dtl),\n                  br = bounds.bottomRight().plus(dbr),\n                  newBounds = Rect.fromPoints(tl, br),\n                  newCenter;\n\n              if (!dragging) {\n                newCenter = newBounds.center();\n                newCenter.rotate(bounds.center(), -this._angle);\n                newBounds = new Rect(newCenter.x - newBounds.width / 2, newCenter.y - newBounds.height / 2, newBounds.width, newBounds.height);\n              }\n\n              return newBounds;\n            },\n            stop: function () {\n              var unit, i, shape;\n\n              if (this._cp != this._sp) {\n                if (this._rotating) {\n                  unit = new RotateUnit(this, this.shapes, this.initialRotates);\n                  this._rotating = false;\n                } else if (this._diffStates()) {\n                  if (this.diagram.ruler) {\n                    for (i = 0; i < this.shapes.length; i++) {\n                      shape = this.shapes[i];\n                      var bounds = shape.bounds();\n                      bounds = this._truncateSizeToGuides(this._truncatePositionToGuides(bounds));\n                      shape.bounds(bounds);\n                      this.refreshBounds();\n                      this.refresh();\n                    }\n                  }\n\n                  for (i = 0; i < this.shapes.length; i++) {\n                    shape = this.shapes[i];\n                    shape.updateModel();\n                  }\n\n                  unit = new TransformUnit(this.shapes, this.shapeStates, this);\n\n                  this.diagram._syncShapeChanges();\n                }\n              }\n\n              this._manipulating = undefined;\n              this._internalChange = undefined;\n              this._rotating = undefined;\n              return unit;\n            },\n            _diffStates: function () {\n              var shapes = this.shapes;\n              var states = this.shapeStates;\n\n              for (var idx = 0; idx < shapes.length; idx++) {\n                if (!shapes[idx].bounds().equals(states[idx])) {\n                  return true;\n                }\n              }\n\n              return false;\n            },\n            refreshBounds: function () {\n              var bounds = this.shapes.length == 1 ? this.shapes[0].bounds().clone() : this.diagram.boundingBox(this.shapes, true);\n              this.bounds(bounds);\n            },\n            refresh: function () {\n              var that = this,\n                  b,\n                  bounds;\n\n              if (this.shapes.length > 0) {\n                bounds = this.bounds();\n                this.visual.visible(true);\n                this.visual.position(bounds.topLeft());\n                $.each(this.map, function () {\n                  b = that._getHandleBounds(new Point(this.x, this.y));\n                  this.visual.position(b.topLeft());\n                });\n                this.visual.position(bounds.topLeft());\n                var center = new Point(bounds.width / 2, bounds.height / 2);\n                this.visual.rotate(this._angle, center);\n                this.rect.redraw({\n                  width: bounds.width,\n                  height: bounds.height\n                });\n\n                if (this.rotationThumb) {\n                  var thumb = this.options.editable.rotate.thumb;\n                  this._rotationThumbBounds = new Rect(bounds.center().x, bounds.y + thumb.y, 0, 0).inflate(thumb.width);\n                  this.rotationThumb.redraw({\n                    x: bounds.width / 2 - thumb.width / 2\n                  });\n                }\n              } else {\n                this.visual.visible(false);\n              }\n            }\n          });\n          var Selector = Class.extend({\n            init: function (diagram) {\n              var selectable = diagram.options.selectable;\n              this.options = deepExtend({}, this.options, selectable);\n              this.visual = new Rectangle(this.options);\n              this.diagram = diagram;\n            },\n            options: {\n              stroke: {\n                color: \"#778899\",\n                width: 1,\n                dashType: \"dash\"\n              },\n              fill: {\n                color: TRANSPARENT\n              }\n            },\n            start: function (p) {\n              this._sp = this._ep = p;\n              this.refresh();\n\n              this.diagram._adorn(this, true);\n            },\n            end: function () {\n              this._sp = this._ep = undefined;\n\n              this.diagram._adorn(this, false);\n            },\n            bounds: function (value) {\n              if (value) {\n                this._bounds = value;\n              }\n\n              return this._bounds;\n            },\n            move: function (p) {\n              this._ep = p;\n              this.refresh();\n            },\n            refresh: function () {\n              if (this._sp) {\n                var visualBounds = Rect.fromPoints(this.diagram.modelToLayer(this._sp), this.diagram.modelToLayer(this._ep));\n                this.bounds(Rect.fromPoints(this._sp, this._ep));\n                this.visual.position(visualBounds.topLeft());\n                this.visual.redraw({\n                  height: visualBounds.height + 1,\n                  width: visualBounds.width + 1\n                });\n              }\n            }\n          });\n          var ConnectorVisual = Class.extend({\n            init: function (connector) {\n              this.options = deepExtend({}, connector.options);\n              this._c = connector;\n              this.visual = new Circle(this.options);\n              this.refresh();\n            },\n            _hover: function (value) {\n              var options = this.options,\n                  hover = options.hover,\n                  stroke = options.stroke,\n                  fill = options.fill;\n\n              if (value && Utils.isDefined(hover.stroke)) {\n                stroke = deepExtend({}, stroke, hover.stroke);\n              }\n\n              if (value && Utils.isDefined(hover.fill)) {\n                fill = hover.fill;\n              }\n\n              this.visual.redraw({\n                stroke: stroke,\n                fill: fill\n              });\n            },\n            refresh: function () {\n              var p = this._c.shape.diagram.modelToView(this._c.position()),\n                  relative = p.minus(this._c.shape.bounds(\"transformed\").topLeft()),\n                  value = new Rect(p.x, p.y, 0, 0);\n\n              value.inflate(this.options.width / 2, this.options.height / 2);\n              this._visualBounds = value;\n              this.visual.redraw({\n                center: new Point(relative.x, relative.y)\n              });\n            },\n            _hitTest: function (p) {\n              var tp = this._c.shape.diagram.modelToView(p);\n\n              return this._visualBounds.contains(tp);\n            }\n          });\n\n          function canDrag(element) {\n            var editable = element.options.editable;\n            return editable && editable.drag !== false;\n          }\n\n          function hitTestShapeConnectors(shape, point) {\n            var connector, position, rect;\n\n            for (var idx = 0; idx < shape.connectors.length; idx++) {\n              connector = shape.connectors[idx];\n              position = connector.position();\n              rect = new Rect(position.x, position.y);\n              rect.inflate(HIT_TEST_DISTANCE, HIT_TEST_DISTANCE);\n\n              if (rect.contains(point)) {\n                return connector;\n              }\n            }\n          }\n\n          function noMeta(meta) {\n            return meta.ctrlKey === false && meta.altKey === false && meta.shiftKey === false;\n          }\n\n          deepExtend(diagram, {\n            CompositeUnit: CompositeUnit,\n            TransformUnit: TransformUnit,\n            PanUndoUnit: PanUndoUnit,\n            AddShapeUnit: AddShapeUnit,\n            AddConnectionUnit: AddConnectionUnit,\n            DeleteShapeUnit: DeleteShapeUnit,\n            DeleteConnectionUnit: DeleteConnectionUnit,\n            ConnectionEditAdorner: ConnectionEditAdorner,\n            ConnectionTool: ConnectionTool,\n            ConnectorVisual: ConnectorVisual,\n            UndoRedoService: UndoRedoService,\n            ResizingAdorner: ResizingAdorner,\n            Selector: Selector,\n            ToolService: ToolService,\n            ConnectorsAdorner: ConnectorsAdorner,\n            LayoutUndoUnit: LayoutUndoUnit,\n            ConnectionEditUnit: ConnectionEditUnit,\n            ToFrontUnit: ToFrontUnit,\n            ToBackUnit: ToBackUnit,\n            ConnectionRouterBase: ConnectionRouterBase,\n            PolylineRouter: PolylineRouter,\n            CascadingRouter: CascadingRouter,\n            SelectionTool: SelectionTool,\n            ScrollerTool: ScrollerTool,\n            PointerTool: PointerTool,\n            ConnectionEditTool: ConnectionEditTool,\n            RotateUnit: RotateUnit\n          });\n        })(window.kendo.jQuery);\n      }, __webpack_require__.amdD);\n      /***/\n\n    },\n\n    /***/\n    79174:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"../../kendo.drawing\");\n      /***/\n    },\n\n    /***/\n    48643:\n    /***/\n    function (module) {\n      \"use strict\";\n\n      module.exports = require(\"./svg\");\n      /***/\n    }\n    /******/\n\n  };\n  /************************************************************************/\n\n  /******/\n  // The module cache\n\n  /******/\n\n  var __webpack_module_cache__ = {};\n  /******/\n\n  /******/\n  // The require function\n\n  /******/\n\n  function __webpack_require__(moduleId) {\n    /******/\n    // Check if module is in cache\n\n    /******/\n    var cachedModule = __webpack_module_cache__[moduleId];\n    /******/\n\n    if (cachedModule !== undefined) {\n      /******/\n      return cachedModule.exports;\n      /******/\n    }\n    /******/\n    // Create a new module (and put it into the cache)\n\n    /******/\n\n\n    var module = __webpack_module_cache__[moduleId] = {\n      /******/\n      // no module.id needed\n\n      /******/\n      // no module.loaded needed\n\n      /******/\n      exports: {}\n      /******/\n\n    };\n    /******/\n\n    /******/\n    // Execute the module function\n\n    /******/\n\n    __webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n    /******/\n\n    /******/\n    // Return the exports of the module\n\n    /******/\n\n\n    return module.exports;\n    /******/\n  }\n  /******/\n\n  /************************************************************************/\n\n  /******/\n\n  /* webpack/runtime/amd define */\n\n  /******/\n\n\n  !function () {\n    /******/\n    __webpack_require__.amdD = function () {\n      /******/\n      throw new Error('define cannot be used indirect');\n      /******/\n    };\n    /******/\n\n  }();\n  /******/\n\n  /************************************************************************/\n\n  /******/\n\n  /******/\n  // startup\n\n  /******/\n  // Load entry module and return exports\n\n  /******/\n  // This entry module used 'module' so it can't be inlined\n\n  /******/\n\n  var __webpack_exports__ = __webpack_require__(31545);\n  /******/\n\n\n  module.exports = __webpack_exports__;\n  /******/\n\n  /******/\n})();","map":{"version":3,"names":["__webpack_modules__","module","exports","__webpack_require__","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","f","define","apply","undefined","$","kendo","window","dataviz","diagram","Class","Group","Rect","Rectangle","Utils","isUndefined","Point","Circle","Ticker","deepExtend","Movable","ui","util","drawing","defined","inArray","Cursors","arrow","grip","cross","add","move","select","south","east","west","north","rowresize","colresize","HIT_TEST_DISTANCE","AUTO","TOP","RIGHT","LEFT","BOTTOM","DEFAULT_SNAP_SIZE","DEFAULT_SNAP_ANGLE","DRAG_START","DRAG","DRAG_END","ITEMROTATE","ITEMBOUNDSCHANGE","MIN_SNAP_SIZE","MIN_SNAP_ANGLE","MOUSE_ENTER","MOUSE_LEAVE","ZOOM_START","ZOOM_END","SCROLL_MIN","SCROLL_MAX","FRICTION","FRICTION_MOBILE","VELOCITY_MULTIPLIER","TRANSPARENT","PAN","ROTATED","SOURCE","TARGET","HANDLE_NAMES","PositionAdapter","extend","init","layoutState","initState","froms","tos","subjects","pusher","id","bounds","shape","getShapeById","push","topLeft","nodeMap","forEach","update","tick","length","i","position","x","y","LayoutUndoUnit","initialState","finalState","animate","_initialState","_finalState","title","undo","setState","redo","state","linkMap","points","conn","visible","ticker","addAdapter","onComplete","play","CompositeUnit","unit","units","undoUnit","ConnectionEditUnit","item","redoSource","redoTarget","_redoSource","_redoTarget","_undoSource","source","_undoTarget","target","_updateConnector","updateModel","ConnectionEditUndoUnit","undoSource","undoTarget","DeleteConnectionUnit","connection","targetConnector","_addConnection","remove","DeleteShapeUnit","_addShape","TransformUnit","shapes","undoStates","adorner","redoStates","hasOwnProperty","layout","refreshBounds","refresh","AddConnectionUnit","AddShapeUnit","deselect","PanUndoUnit","initialPosition","finalPosition","initial","finalPos","pan","RotateUnit","undoRotates","redoRotates","redoAngle","_angle","center","_innerBounds","rotate","angle","_initialize","ToFrontUnit","items","initialIndices","indices","_toIndex","toFront","ToBackUnit","toBack","UndoRedoService","Observable","options","fn","call","bind","events","stack","index","capacity","begin","composite","cancel","commit","execute","_restart","addCompositeItem","pop","count","trigger","splice","clear","EmptyTool","toolService","start","end","tryActivate","getCursor","ScrollerTool","tool","friction","support","mobileOS","canvas","scroller","scrollable","kendoMobileScroller","velocityMultiplier","mousewheelScrolling","zoom","scroll","_move","data","translate","movableCanvas","element","virtualScroll","dimension","min","max","makeVirtual","virtualSize","dimensions","disable","p","meta","pannable","enabled","ctrlKey","key","noMeta","hoveredItem","hoveredAdorner","_hoveredConnector","enable","args","scrollPos","scrollLeft","scrollTop","_storePan","times","moveTo","plus","_pan","PointerTool","selectSingle","handle","_hitTest","_resizingAdorner","isDragHandle","connections","startPoint","stop","undoRedoService","_getCursor","SelectionTool","selectable","multiple","selector","rect","isSelected","isEmpty","selectArea","ConnectionTool","type","connector","_createConnection","_c","canDrag","connectionHandle","_connectionManipulation","_removeHover","activeConnection","_cachedTouchTarget","visual","d","cachedTouchTarget","sourceConnector","Shape","getConnector","_syncConnectionChanges","_connectorsAdorner","ConnectionEditTool","isActive","path","name","handleName","testKey","str","charCodeAt","toUpperCase","ToolService","tools","activeTool","_updateHoveredItem","_activateTool","_updateCursor","focus","surface","suspendTracking","updateHovered","resumeTracking","keyDown","metaKey","altKey","selectAll","_destroyToolBar","copy","cut","paste","toRemove","_triggerRemove","_syncChanges","_discardNewConnection","wheel","delta","z","zoomRate","zoomOptions","point","round","Math","zoomMin","zoomMax","setTool","addToSelection","newConnection","cursor","css","disabledShape","isNew","hit","_hover","_visible","selectedConnections","_selectedItems","Connection","_hitTestItems","_hitTestElements","shapeHit","connectionHit","hitTestShapeConnectors","mainLayer","shapeIdx","children","connectionIdx","array","ConnectionRouterBase","LinearConnectionRouter","that","hitTest","rec","getBounds","inflate","contains","Geometry","distanceToPolyline","allPoints","s","e","right","left","top","bottom","PolylineRouter","route","CascadingRouter","SAME_SIDE_DISTANCE_RATIO","routePoints","result","_connectorPoints","_floatingPoints","_resolvedSourceConnector","_resolvedTargetConnector","sourcePoint","targetPoint","_connectorSides","axis","boundsPoint","secondarySign","_connectorSide","shapeBounds","bottomRight","sides","MAX_NUM","sideDistance","minSide","side","idx","abs","_sameSideDistance","width","height","sourceConnectorSide","targetConnectorSide","deltaX","deltaY","sameSideDistance","pointX","pointY","cascadeStartHorizontal","_startHorizontal","shiftX","shiftY","sourceSide","horizontal","AdornerBase","_adorners","ConnectionEditAdorner","_ts","sp","tp","spVisual","handles","epVisual","append","_initialSource","_initialTarget","minus","ts","radiusX","radiusY","sourcePointDistance","distanceTo","targetPointDistance","sourceHandle","targetHandle","redraw","modelToLayer","ConnectorsAdorner","_refreshHandler","show","len","ctr","connectors","_clearVisual","ConnectorVisual","_keepCachedTouchTarget","visualChildren","childrenCount","destroy","unbind","each","hitToOppositeSide","topRight","bottomLeft","ResizingAdorner","_manipulating","map","_initSelection","_createHandles","selected","_internalChange","_rotatedHandler","fill","color","stroke","hover","dashType","offset","_resizable","editable","resize","_handleOptions","drawingElement","value","clone","_bounds","handleBounds","handlesCount","_getHandleBounds","w","h","r","floor","_rotationOffset","_startAngle","_rotates","_positions","initialRotates","initialStates","handleOptions","isDefined","opacity","_sp","_cp","_lp","shapeStates","visibleHandles","currentAngle","dragging","dtl","dbr","newBounds","changed","staticPoint","scaleX","scaleY","_truncateAngle","findAngle","_rotating","shouldSnap","thr","_truncateDistance","_displaceBounds","scale","newCenter","minWidth","minHeight","oldBounds","states","_truncatePositionToGuides","ruler","truncatePositionToGuides","_truncateSizeToGuides","truncateSizeToGuides","a","snap","snapOptions","snapAngle","snapSize","size","drag","tl","br","fromPoints","_diffStates","_syncShapeChanges","equals","boundingBox","b","rotationThumb","thumb","_rotationThumbBounds","Selector","_ep","_adorn","visualBounds","modelToView","relative","_visualBounds","shiftKey","jQuery","amdD","require","__webpack_module_cache__","moduleId","cachedModule","Error","__webpack_exports__"],"sources":["C:/Users/abodean/restapi-nodejs/vuejs/app-router/node_modules/@progress/kendo-ui/js/dataviz/diagram/services.js"],"sourcesContent":["/******/ (function() { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 31545:\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function(f, define) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [ __webpack_require__(79174), __webpack_require__(48643) ], __WEBPACK_AMD_DEFINE_FACTORY__ = (f),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n})(function() {\n\n    (function($, undefined) {\n        // Imports ================================================================\n        var kendo = window.kendo,\n            dataviz = kendo.dataviz,\n            diagram = dataviz.diagram,\n            Class = kendo.Class,\n            Group = diagram.Group,\n            Rect = diagram.Rect,\n            Rectangle = diagram.Rectangle,\n            Utils = diagram.Utils,\n            isUndefined = Utils.isUndefined,\n            Point = diagram.Point,\n            Circle = diagram.Circle,\n            Ticker = diagram.Ticker,\n            deepExtend = kendo.deepExtend,\n            Movable = kendo.ui.Movable,\n            util = kendo.drawing.util,\n            defined = util.defined,\n            inArray = $.inArray;\n\n        // Constants ==============================================================\n        var Cursors = {\n                arrow: \"default\",\n                grip: \"pointer\",\n                cross: \"pointer\",\n                add: \"pointer\",\n                move: \"move\",\n                select: \"pointer\",\n                south: \"s-resize\",\n                east: \"e-resize\",\n                west: \"w-resize\",\n                north: \"n-resize\",\n                rowresize: \"row-resize\",\n                colresize: \"col-resize\"\n            },\n            HIT_TEST_DISTANCE = 10,\n            AUTO = \"Auto\",\n            TOP = \"Top\",\n            RIGHT = \"Right\",\n            LEFT = \"Left\",\n            BOTTOM = \"Bottom\",\n            DEFAULT_SNAP_SIZE = 10,\n            DEFAULT_SNAP_ANGLE = 10,\n            DRAG_START = \"dragStart\",\n            DRAG = \"drag\",\n            DRAG_END = \"dragEnd\",\n            ITEMROTATE = \"itemRotate\",\n            ITEMBOUNDSCHANGE = \"itemBoundsChange\",\n            MIN_SNAP_SIZE = 5,\n            MIN_SNAP_ANGLE = 5,\n            MOUSE_ENTER = \"mouseEnter\",\n            MOUSE_LEAVE = \"mouseLeave\",\n            ZOOM_START = \"zoomStart\",\n            ZOOM_END = \"zoomEnd\",\n            SCROLL_MIN = -20000,\n            SCROLL_MAX = 20000,\n            FRICTION = 0.90,\n            FRICTION_MOBILE = 0.93,\n            VELOCITY_MULTIPLIER = 5,\n            TRANSPARENT = \"transparent\",\n            PAN = \"pan\",\n            ROTATED = \"rotated\",\n            SOURCE = \"source\",\n            TARGET = \"target\",\n            HANDLE_NAMES = {\n                \"-1\": SOURCE,\n                \"1\": TARGET\n            };\n\n        diagram.Cursors = Cursors;\n\n        var PositionAdapter = kendo.Class.extend({\n            init: function(layoutState) {\n                this.layoutState = layoutState;\n                this.diagram = layoutState.diagram;\n            },\n            initState: function() {\n                this.froms = [];\n                this.tos = [];\n                this.subjects = [];\n                function pusher(id, bounds) {\n                    var shape = this.diagram.getShapeById(id);\n                    if (shape) {\n                        this.subjects.push(shape);\n                        this.froms.push(shape.bounds().topLeft());\n                        this.tos.push(bounds.topLeft());\n                    }\n                }\n\n                this.layoutState.nodeMap.forEach(pusher, this);\n            },\n            update: function(tick) {\n                if (this.subjects.length <= 0) {\n                    return;\n                }\n                for (var i = 0; i < this.subjects.length; i++) {\n                    //todo: define a Lerp function instead\n                    this.subjects[i].position(\n                        new Point(this.froms[i].x + (this.tos[i].x - this.froms[i].x) * tick, this.froms[i].y + (this.tos[i].y - this.froms[i].y) * tick)\n                    );\n                }\n            }\n        });\n\n        var LayoutUndoUnit = Class.extend({\n            init: function(initialState, finalState, animate) {\n                if (isUndefined(animate)) {\n                    this.animate = false;\n                }\n                else {\n                    this.animate = animate;\n                }\n                this._initialState = initialState;\n                this._finalState = finalState;\n                this.title = \"Diagram layout\";\n            },\n            undo: function() {\n                this.setState(this._initialState);\n            },\n            redo: function() {\n                this.setState(this._finalState);\n            },\n            setState: function(state) {\n                var diagram = state.diagram;\n                if (this.animate) {\n                    state.linkMap.forEach(\n                        function(id, points) {\n                            var conn = diagram.getShapeById(id);\n                            conn.visible(false);\n                            if (conn) {\n                                conn.points(points);\n                            }\n                        }\n                    );\n                    var ticker = new Ticker();\n                    ticker.addAdapter(new PositionAdapter(state));\n                    ticker.onComplete(function() {\n                        state.linkMap.forEach(\n                            function(id) {\n                                var conn = diagram.getShapeById(id);\n                                conn.visible(true);\n                            }\n                        );\n                    });\n                    ticker.play();\n                }\n                else {\n                    state.nodeMap.forEach(function(id, bounds) {\n                        var shape = diagram.getShapeById(id);\n                        if (shape) {\n                            shape.position(bounds.topLeft());\n                        }\n                    });\n                    state.linkMap.forEach(\n                        function(id, points) {\n                            var conn = diagram.getShapeById(id);\n                            if (conn) {\n                                conn.points(points);\n                            }\n                        }\n                    );\n                }\n            }\n        });\n\n        var CompositeUnit = Class.extend({\n            init: function(unit) {\n                this.units = [];\n                this.title = \"Composite unit\";\n                if (unit !== undefined) {\n                    this.units.push(unit);\n                }\n            },\n            add: function(undoUnit) {\n                this.units.push(undoUnit);\n            },\n            undo: function() {\n                for (var i = 0; i < this.units.length; i++) {\n                    this.units[i].undo();\n                }\n            },\n            redo: function() {\n                for (var i = 0; i < this.units.length; i++) {\n                    this.units[i].redo();\n                }\n            }\n        });\n\n        var ConnectionEditUnit = Class.extend({\n            init: function(item, redoSource, redoTarget) {\n                this.item = item;\n                this._redoSource = redoSource;\n                this._redoTarget = redoTarget;\n                if (defined(redoSource)) {\n                    this._undoSource = item.source();\n                }\n\n                if (defined(redoTarget)) {\n                    this._undoTarget = item.target();\n                }\n                this.title = \"Connection Editing\";\n            },\n            undo: function() {\n                if (this._undoSource !== undefined) {\n                    this.item._updateConnector(this._undoSource, \"source\");\n                }\n\n                if (this._undoTarget !== undefined) {\n                    this.item._updateConnector(this._undoTarget, \"target\");\n                }\n\n                this.item.updateModel();\n            },\n            redo: function() {\n                if (this._redoSource !== undefined) {\n                    this.item._updateConnector(this._redoSource, \"source\");\n                }\n\n                if (this._redoTarget !== undefined) {\n                    this.item._updateConnector(this._redoTarget, \"target\");\n                }\n\n                this.item.updateModel();\n            }\n        });\n\n        var ConnectionEditUndoUnit = Class.extend({\n            init: function(item, undoSource, undoTarget) {\n                this.item = item;\n                this._undoSource = undoSource;\n                this._undoTarget = undoTarget;\n                this._redoSource = item.source();\n                this._redoTarget = item.target();\n                this.title = \"Connection Editing\";\n            },\n            undo: function() {\n                this.item._updateConnector(this._undoSource, \"source\");\n                this.item._updateConnector(this._undoTarget, \"target\");\n                this.item.updateModel();\n            },\n            redo: function() {\n                this.item._updateConnector(this._redoSource, \"source\");\n                this.item._updateConnector(this._redoTarget, \"target\");\n                this.item.updateModel();\n            }\n        });\n\n        var DeleteConnectionUnit = Class.extend({\n            init: function(connection) {\n                this.connection = connection;\n                this.diagram = connection.diagram;\n                this.targetConnector = connection.targetConnector;\n                this.title = \"Delete connection\";\n            },\n            undo: function() {\n                this.diagram._addConnection(this.connection, false);\n            },\n            redo: function() {\n                this.diagram.remove(this.connection, false);\n            }\n        });\n\n        var DeleteShapeUnit = Class.extend({\n            init: function(shape) {\n                this.shape = shape;\n                this.diagram = shape.diagram;\n                this.title = \"Deletion\";\n            },\n            undo: function() {\n                this.diagram._addShape(this.shape, false);\n                this.shape.select(false);\n            },\n            redo: function() {\n                this.shape.select(false);\n                this.diagram.remove(this.shape, false);\n            }\n        });\n        /**\n         * Holds the undoredo state when performing a rotation, translation or scaling. The adorner is optional.\n         * @type {*}\n         */\n        var TransformUnit = Class.extend({\n            init: function(shapes, undoStates, adorner) {\n                this.shapes = shapes;\n                this.undoStates = undoStates;\n                this.title = \"Transformation\";\n                this.redoStates = [];\n                this.adorner = adorner;\n                for (var i = 0; i < this.shapes.length; i++) {\n                    var shape = this.shapes[i];\n                    this.redoStates.push(shape.bounds());\n                }\n            },\n            undo: function() {\n                for (var i = 0; i < this.shapes.length; i++) {\n                    var shape = this.shapes[i];\n                    shape.bounds(this.undoStates[i]);\n                    if (shape.hasOwnProperty(\"layout\")) {\n                        shape.layout(shape, this.redoStates[i], this.undoStates[i]);\n                    }\n                    shape.updateModel();\n                }\n                if (this.adorner) {\n                    this.adorner.refreshBounds();\n                    this.adorner.refresh();\n                }\n            },\n            redo: function() {\n                for (var i = 0; i < this.shapes.length; i++) {\n                    var shape = this.shapes[i];\n                    shape.bounds(this.redoStates[i]);\n                    // the 'layout' property, if implemented, lets the shape itself work out what to do with the new bounds\n                    if (shape.hasOwnProperty(\"layout\")) {\n                        shape.layout(shape, this.undoStates[i], this.redoStates[i]);\n                    }\n                    shape.updateModel();\n                }\n\n                if (this.adorner) {\n                    this.adorner.refreshBounds();\n                    this.adorner.refresh();\n                }\n            }\n        });\n\n        var AddConnectionUnit = Class.extend({\n            init: function(connection, diagram) {\n                this.connection = connection;\n                this.diagram = diagram;\n                this.title = \"New connection\";\n            },\n\n            undo: function() {\n                this.diagram.remove(this.connection, false);\n            },\n\n            redo: function() {\n                this.diagram._addConnection(this.connection, false);\n            }\n        });\n\n        var AddShapeUnit = Class.extend({\n            init: function(shape, diagram) {\n                this.shape = shape;\n                this.diagram = diagram;\n                this.title = \"New shape\";\n            },\n\n            undo: function() {\n                this.diagram.deselect();\n                this.diagram.remove(this.shape, false);\n            },\n\n            redo: function() {\n                this.diagram._addShape(this.shape, false);\n            }\n        });\n\n        var PanUndoUnit = Class.extend({\n            init: function(initialPosition, finalPosition, diagram) {\n                this.initial = initialPosition;\n                this.finalPos = finalPosition;\n                this.diagram = diagram;\n                this.title = \"Pan Unit\";\n            },\n            undo: function() {\n                this.diagram.pan(this.initial);\n            },\n            redo: function() {\n                this.diagram.pan(this.finalPos);\n            }\n        });\n\n        var RotateUnit = Class.extend({\n            init: function(adorner, shapes, undoRotates) {\n                this.shapes = shapes;\n                this.undoRotates = undoRotates;\n                this.title = \"Rotation\";\n                this.redoRotates = [];\n                this.redoAngle = adorner._angle;\n                this.adorner = adorner;\n                this.center = adorner._innerBounds.center();\n                for (var i = 0; i < this.shapes.length; i++) {\n                    var shape = this.shapes[i];\n                    this.redoRotates.push(shape.rotate().angle);\n                }\n            },\n            undo: function() {\n                var i, shape;\n                for (i = 0; i < this.shapes.length; i++) {\n                    shape = this.shapes[i];\n                    shape.rotate(this.undoRotates[i], this.center, false);\n                    if (shape.hasOwnProperty(\"layout\")) {\n                        shape.layout(shape);\n                    }\n                    shape.updateModel();\n                }\n                if (this.adorner) {\n                    this.adorner._initialize();\n                    this.adorner.refresh();\n                }\n            },\n            redo: function() {\n                var i, shape;\n                for (i = 0; i < this.shapes.length; i++) {\n                    shape = this.shapes[i];\n                    shape.rotate(this.redoRotates[i], this.center, false);\n                    if (shape.hasOwnProperty(\"layout\")) {\n                        shape.layout(shape);\n                    }\n                    shape.updateModel();\n                }\n                if (this.adorner) {\n                    this.adorner._initialize();\n                    this.adorner.refresh();\n                }\n            }\n        });\n\n        var ToFrontUnit = Class.extend({\n            init: function(diagram, items, initialIndices) {\n                this.diagram = diagram;\n                this.indices = initialIndices;\n                this.items = items;\n                this.title = \"Rotate Unit\";\n            },\n            undo: function() {\n                this.diagram._toIndex(this.items, this.indices);\n            },\n            redo: function() {\n                this.diagram.toFront(this.items, false);\n            }\n        });\n\n        var ToBackUnit = Class.extend({\n            init: function(diagram, items, initialIndices) {\n                this.diagram = diagram;\n                this.indices = initialIndices;\n                this.items = items;\n                this.title = \"Rotate Unit\";\n            },\n            undo: function() {\n                this.diagram._toIndex(this.items, this.indices);\n            },\n            redo: function() {\n                this.diagram.toBack(this.items, false);\n            }\n        });\n\n        /**\n         * Undo-redo service.\n         */\n        var UndoRedoService = kendo.Observable.extend({\n            init: function(options) {\n                kendo.Observable.fn.init.call(this, options);\n                this.bind(this.events, options);\n                this.stack = [];\n                this.index = 0;\n                this.capacity = 100;\n            },\n\n            events: [\"undone\", \"redone\"],\n\n            /**\n             * Starts the collection of units. Add those with\n             * the addCompositeItem method and call commit. Or cancel to forget about it.\n             */\n            begin: function() {\n                this.composite = new CompositeUnit();\n            },\n\n            /**\n             * Cancels the collection process of unit started with 'begin'.\n             */\n            cancel: function() {\n                this.composite = undefined;\n            },\n\n            /**\n             * Commits a batch of units.\n             */\n            commit: function(execute) {\n                if (this.composite.units.length > 0) {\n                    this._restart(this.composite, execute);\n                }\n                this.composite = undefined;\n            },\n\n            /**\n             * Adds a unit as part of the begin-commit batch.\n             * @param undoUnit\n             */\n            addCompositeItem: function(undoUnit) {\n                if (this.composite) {\n                    this.composite.add(undoUnit);\n                } else {\n                    this.add(undoUnit);\n                }\n            },\n\n            /**\n             * Standard addition of a unit. See also the batch version; begin-addCompositeUnit-commit methods.\n             * @param undoUnit The unit to be added.\n             * @param execute If false, the unit will be added but not executed.\n             */\n            add: function(undoUnit, execute) {\n                this._restart(undoUnit, execute);\n            },\n\n            /**\n             * Returns the number of undoable unit in the stack.\n             * @returns {Number}\n             */\n\n            pop: function() {\n                if (this.index > 0) {\n                    this.stack.pop();\n                    this.index--;\n                }\n            },\n\n            count: function() {\n                return this.stack.length;\n            },\n\n            /**\n             * Rollback of the unit on top of the stack.\n             */\n            undo: function() {\n                if (this.index > 0) {\n                    this.index--;\n                    this.stack[this.index].undo();\n                    this.trigger(\"undone\");\n                }\n            },\n\n            /**\n             * Redo of the last undone action.\n             */\n            redo: function() {\n                if (this.stack.length > 0 && this.index < this.stack.length) {\n                    this.stack[this.index].redo();\n                    this.index++;\n                    this.trigger(\"redone\");\n                }\n            },\n\n            _restart: function(composite, execute) {\n                // throw away anything beyond this point if this is a new branch\n                this.stack.splice(this.index, this.stack.length - this.index);\n                this.stack.push(composite);\n                if (execute !== false) {\n                    this.redo();\n                } else {\n                    this.index++;\n                }\n                // check the capacity\n                if (this.stack.length > this.capacity) {\n                    this.stack.splice(0, this.stack.length - this.capacity);\n                    this.index = this.capacity; //points to the end of the stack\n                }\n            },\n\n            /**\n             * Clears the stack.\n             */\n            clear: function() {\n                this.stack = [];\n                this.index = 0;\n            }\n        });\n\n// Tools =========================================\n\n        var EmptyTool = Class.extend({\n            init: function(toolService) {\n                this.toolService = toolService;\n            },\n            start: function() {\n            },\n            move: function() {\n            },\n            end: function() {\n            },\n            tryActivate: function() {\n                return false;\n            },\n            getCursor: function() {\n                return Cursors.arrow;\n            }\n        });\n\n        var ScrollerTool = EmptyTool.extend({\n            init: function(toolService) {\n                var tool = this;\n                var friction = kendo.support.mobileOS ? FRICTION_MOBILE : FRICTION;\n                EmptyTool.fn.init.call(tool, toolService);\n\n                var diagram = tool.toolService.diagram,\n                    canvas = diagram.canvas;\n\n                var scroller = diagram.scroller = tool.scroller = $(diagram.scrollable).kendoMobileScroller({\n                    friction: friction,\n                    velocityMultiplier: VELOCITY_MULTIPLIER,\n                    mousewheelScrolling: false,\n                    zoom: false,\n                    scroll: tool._move.bind(tool)\n                }).data(\"kendoMobileScroller\");\n\n                if (canvas.translate) {\n                    tool.movableCanvas = new Movable(canvas.element);\n                }\n\n                var virtualScroll = function(dimension, min, max) {\n                    dimension.makeVirtual();\n                    dimension.virtualSize(min || SCROLL_MIN, max || SCROLL_MAX);\n                };\n\n                virtualScroll(scroller.dimensions.x);\n                virtualScroll(scroller.dimensions.y);\n                scroller.disable();\n            },\n\n            tryActivate: function(p, meta) {\n                var toolService = this.toolService;\n                var options = toolService.diagram.options.pannable;\n                var enabled = meta.ctrlKey;\n\n                if (defined(options.key)) {\n                    if (!options.key || options.key == \"none\") {\n                        enabled = noMeta(meta) && !defined(toolService.hoveredItem);\n                    } else {\n                        enabled = meta[options.key + \"Key\"];\n                    }\n                }\n\n                return options !== false && enabled && !defined(toolService.hoveredAdorner) && !defined(toolService._hoveredConnector);\n            },\n\n            start: function() {\n                this.scroller.enable();\n            },\n            move: function() {\n            },//the tool itself should not handle the scrolling. Let kendo scroller take care of this part. Check _move\n            _move: function(args) {\n                var tool = this,\n                    diagram = tool.toolService.diagram,\n                    canvas = diagram.canvas,\n                    scrollPos = new Point(args.scrollLeft, args.scrollTop);\n\n                if (canvas.translate) {\n                    diagram._storePan(scrollPos.times(-1));\n                    tool.movableCanvas.moveTo(scrollPos);\n                    canvas.translate(scrollPos.x, scrollPos.y);\n                } else {\n                    scrollPos = scrollPos.plus(diagram._pan.times(-1));\n                }\n\n                diagram.trigger(PAN, { pan: scrollPos });\n            },\n            end: function() {\n                this.scroller.disable();\n            },\n            getCursor: function() {\n                return Cursors.move;\n            }\n        });\n\n        /**\n         * The tool handling the transformations via the adorner.\n         * @type {*}\n         */\n        var PointerTool = Class.extend({\n            init: function(toolService) {\n                this.toolService = toolService;\n            },\n            tryActivate: function() {\n                return true; // the pointer tool is last and handles all others requests.\n            },\n            start: function(p, meta) {\n                var toolService = this.toolService,\n                    diagram = toolService.diagram,\n                    hoveredItem = toolService.hoveredItem;\n\n                if (hoveredItem) {\n                    toolService.selectSingle(hoveredItem, meta);\n                    if (hoveredItem.adorner) { //connection\n                        this.adorner = hoveredItem.adorner;\n                        this.handle = this.adorner._hitTest(p);\n                    }\n                }\n\n                if (!this.handle) {\n                    this.handle = diagram._resizingAdorner._hitTest(p);\n                    if (this.handle) {\n                        this.adorner = diagram._resizingAdorner;\n                    }\n                }\n\n                if (this.adorner) {\n                    if (!this.adorner.isDragHandle(this.handle) || !diagram.trigger(DRAG_START, { shapes: this.adorner.shapes, connections: [] })) {\n                        this.adorner.start(p);\n                    } else {\n                        toolService.startPoint = p;\n                        toolService.end(p);\n                    }\n                }\n            },\n\n            move: function(p) {\n                if (this.adorner) {\n                    this.adorner.move(this.handle, p);\n                    if (this.adorner.isDragHandle(this.handle)) {\n                        this.toolService.diagram.trigger(DRAG, { shapes: this.adorner.shapes, connections: [] });\n                    }\n                }\n            },\n\n            end: function() {\n                var diagram = this.toolService.diagram,\n                    adorner = this.adorner,\n                    unit;\n\n                if (adorner) {\n                    if (!adorner.isDragHandle(this.handle) || !diagram.trigger(DRAG_END, { shapes: adorner.shapes, connections: [] })) {\n                        unit = adorner.stop();\n                        if (unit) {\n                            diagram.undoRedoService.add(unit, false);\n                        }\n                    } else {\n                        adorner.cancel();\n                    }\n                }\n\n                this.adorner = undefined;\n                this.handle = undefined;\n            },\n            getCursor: function(p) {\n                return this.toolService.hoveredItem ? this.toolService.hoveredItem._getCursor(p) : Cursors.arrow;\n            }\n        });\n\n        var SelectionTool = Class.extend({\n            init: function(toolService) {\n                this.toolService = toolService;\n            },\n            tryActivate: function(p, meta) {\n                var toolService = this.toolService;\n                var selectable = toolService.diagram.options.selectable;\n                var enabled = selectable && selectable.multiple !== false;\n\n                if (enabled) {\n                    if (selectable.key && selectable.key != \"none\") {\n                        enabled = meta[selectable.key + \"Key\"];\n                    } else {\n                        enabled = noMeta(meta);\n                    }\n                }\n\n                return enabled && !defined(toolService.hoveredItem) && !defined(toolService.hoveredAdorner);\n            },\n            start: function(p) {\n                var diagram = this.toolService.diagram;\n                diagram.deselect();\n                diagram.selector.start(p);\n            },\n            move: function(p) {\n                var diagram = this.toolService.diagram;\n                diagram.selector.move(p);\n            },\n            end: function(p, meta) {\n                var diagram = this.toolService.diagram, hoveredItem = this.toolService.hoveredItem;\n                var rect = diagram.selector.bounds();\n                if ((!hoveredItem || !hoveredItem.isSelected) && !meta.ctrlKey) {\n                    diagram.deselect();\n                }\n                if (!rect.isEmpty()) {\n                    diagram.selectArea(rect);\n                }\n                diagram.selector.end();\n            },\n            getCursor: function() {\n                return Cursors.arrow;\n            }\n        });\n\n        var ConnectionTool = Class.extend({\n            init: function(toolService) {\n                this.toolService = toolService;\n                this.type = \"ConnectionTool\";\n            },\n            tryActivate: function() {\n                return this.toolService._hoveredConnector;\n            },\n            start: function(p, meta) {\n                var toolService = this.toolService,\n                    diagram = toolService.diagram,\n                    connector = toolService._hoveredConnector,\n                    connection = diagram._createConnection({}, connector._c, p);\n\n                if (canDrag(connection) && !diagram.trigger(DRAG_START, { shapes: [], connections: [connection], connectionHandle: TARGET }) && diagram._addConnection(connection)) {\n                    toolService._connectionManipulation(connection, connector._c.shape, true);\n                    toolService._removeHover();\n                    toolService.selectSingle(toolService.activeConnection, meta);\n                    if (meta.type == \"touchmove\") {\n                        diagram._cachedTouchTarget = connector.visual;\n                    }\n                } else {\n                    connection.source(null);\n                    toolService.end(p);\n                }\n            },\n\n            move: function(p) {\n                var toolService = this.toolService;\n                var connection = toolService.activeConnection;\n\n                connection.target(p);\n                toolService.diagram.trigger(DRAG, { shapes: [], connections: [connection], connectionHandle: TARGET });\n                return true;\n            },\n\n            end: function(p) {\n                var toolService = this.toolService,\n                    d = toolService.diagram,\n                    connection = toolService.activeConnection,\n                    hoveredItem = toolService.hoveredItem,\n                    connector = toolService._hoveredConnector,\n                    target,\n                    cachedTouchTarget = d._cachedTouchTarget;\n\n                if (!connection) {\n                    return;\n                }\n\n                if (connector && connector._c != connection.sourceConnector) {\n                    target = connector._c;\n                } else if (hoveredItem && hoveredItem instanceof diagram.Shape) {\n                    target = hoveredItem.getConnector(AUTO) || hoveredItem.getConnector(p);\n                } else {\n                    target = p;\n                }\n\n                connection.target(target);\n\n                if (!d.trigger(DRAG_END, { shapes: [], connections: [connection], connectionHandle: TARGET })) {\n                    connection.updateModel();\n                    d._syncConnectionChanges();\n                } else {\n                    d.remove(connection, false);\n                    d.undoRedoService.pop();\n                }\n                toolService._connectionManipulation();\n\n                if (cachedTouchTarget) {\n                    d._connectorsAdorner.visual.remove(cachedTouchTarget);\n                    d._cachedTouchTarget = null;\n                }\n            },\n\n            getCursor: function() {\n                return Cursors.arrow;\n            }\n        });\n\n        var ConnectionEditTool = Class.extend({\n            init: function(toolService) {\n                this.toolService = toolService;\n                this.type = \"ConnectionTool\";\n            },\n\n            tryActivate: function(p, meta) {\n                var toolService = this.toolService,\n                    diagram = toolService.diagram,\n                    selectable = diagram.options.selectable,\n                    item = toolService.hoveredItem,\n                    isActive = selectable !== false &&\n                               item && item.path && !(item.isSelected && meta.ctrlKey);\n\n                if (isActive) {\n                    this._c = item;\n                }\n\n                return isActive;\n            },\n\n            start: function(p, meta) {\n                var toolService = this.toolService;\n                var connection = this._c;\n\n                toolService.selectSingle(connection, meta);\n\n                var adorner = connection.adorner;\n\n                var handle, name;\n                if (adorner) {\n                    handle = adorner._hitTest(p);\n                    name = HANDLE_NAMES[handle];\n                }\n\n                if (canDrag(connection) && adorner && !toolService.diagram.trigger(DRAG_START, { shapes: [], connections: [connection], connectionHandle: name })) {\n                    this.handle = handle;\n                    this.handleName = name;\n                    adorner.start(p);\n                } else {\n                    toolService.startPoint = p;\n                    toolService.end(p);\n                }\n            },\n\n            move: function(p) {\n                var adorner = this._c.adorner;\n                if (canDrag(this._c) && adorner) {\n                    adorner.move(this.handle, p);\n                    this.toolService.diagram.trigger(DRAG, { shapes: [], connections: [this._c], connectionHandle: this.handleName });\n\n                    return true;\n                }\n            },\n\n            end: function(p) {\n                var connection = this._c;\n                var adorner = connection.adorner;\n                var toolService = this.toolService;\n                var diagram = toolService.diagram;\n\n                if (adorner) {\n                    if (canDrag(connection)) {\n                        var unit = adorner.stop(p);\n                        if (!diagram.trigger(DRAG_END, { shapes: [], connections: [connection], connectionHandle: this.handleName })) {\n                            diagram.undoRedoService.add(unit, false);\n                            connection.updateModel();\n                            diagram._syncConnectionChanges();\n                        } else {\n                            unit.undo();\n                        }\n                    }\n                }\n            },\n\n            getCursor: function() {\n                return Cursors.move;\n            }\n        });\n\n        function testKey(key, str) {\n            return str.charCodeAt(0) == key || str.toUpperCase().charCodeAt(0) == key;\n        }\n\n        /**\n         * The service managing the tools.\n         * @type {*}\n         */\n        var ToolService = Class.extend({\n            init: function(diagram) {\n                this.diagram = diagram;\n                this.tools = [\n                    new ScrollerTool(this),\n                    new ConnectionEditTool(this),\n                    new ConnectionTool(this),\n                    new SelectionTool(this),\n                    new PointerTool(this)\n                ]; // the order matters.\n\n                this.activeTool = undefined;\n            },\n\n            start: function(p, meta) {\n                meta = deepExtend({}, meta);\n                if (this.activeTool) {\n                    this.activeTool.end(p, meta);\n                }\n                this._updateHoveredItem(p);\n                this._activateTool(p, meta);\n                this.activeTool.start(p, meta);\n                this._updateCursor(p);\n                this.diagram.focus();\n                this.diagram.canvas.surface.suspendTracking();\n                this.startPoint = p;\n                return true;\n            },\n\n            move: function(p, meta) {\n                meta = deepExtend({}, meta);\n                var updateHovered = true;\n                if (this.activeTool) {\n                    updateHovered = this.activeTool.move(p, meta);\n                }\n                if (updateHovered) {\n                    this._updateHoveredItem(p);\n                }\n                this._updateCursor(p);\n                return true;\n            },\n\n            end: function(p, meta) {\n                meta = deepExtend({}, meta);\n                if (this.activeTool) {\n                    this.activeTool.end(p, meta);\n                }\n                this.diagram.canvas.surface.resumeTracking();\n                this.activeTool = undefined;\n                this._updateCursor(p);\n                return true;\n            },\n\n            keyDown: function(key, meta) {\n                var diagram = this.diagram;\n                meta = deepExtend({ ctrlKey: false, metaKey: false, altKey: false }, meta);\n                if ((meta.ctrlKey || meta.metaKey) && !meta.altKey) {// ctrl or option\n                    if (testKey(key, \"a\")) {// A: select all\n                        diagram.selectAll();\n                        diagram._destroyToolBar();\n                        return true;\n                    } else if (testKey(key, \"z\")) {// Z: undo\n                        diagram.undo();\n                        diagram._destroyToolBar();\n                        return true;\n                    } else if (testKey(key, \"y\")) {// y: redo\n                        diagram.redo();\n                        diagram._destroyToolBar();\n                        return true;\n                    } else if (testKey(key, \"c\")) {\n                        diagram.copy();\n                        diagram._destroyToolBar();\n                    } else if (testKey(key, \"x\")) {\n                        diagram.cut();\n                        diagram._destroyToolBar();\n                    } else if (testKey(key, \"v\")) {\n                        diagram.paste();\n                        diagram._destroyToolBar();\n                    } else if (testKey(key, \"l\")) {\n                        diagram.layout();\n                        diagram._destroyToolBar();\n                    } else if (testKey(key, \"d\")) {\n                        diagram._destroyToolBar();\n                        diagram.copy();\n                        diagram.paste();\n                    }\n                } else if (key === 46 || key === 8) {// del: deletion\n                    var toRemove = this.diagram._triggerRemove(diagram.select());\n                    if (toRemove.length) {\n                        this.diagram.remove(toRemove, true);\n                        this.diagram._syncChanges();\n                        this.diagram._destroyToolBar();\n                    }\n\n                    return true;\n                } else if (key === 27) {// ESC: stop any action\n                    this._discardNewConnection();\n                    diagram.deselect();\n                    diagram._destroyToolBar();\n                    return true;\n                }\n\n            },\n            wheel: function(p, meta) {\n                var diagram = this.diagram,\n                    delta = meta.delta,\n                    z = diagram.zoom(),\n                    options = diagram.options,\n                    zoomRate = options.zoomRate,\n                    zoomOptions = { point: p, meta: meta, zoom: z };\n\n                if (diagram.trigger(ZOOM_START, zoomOptions)) {\n                    return;\n                }\n\n                if (delta < 0) {\n                    z += zoomRate;\n                } else {\n                    z -= zoomRate;\n                }\n\n                z = kendo.dataviz.round(Math.max(options.zoomMin, Math.min(options.zoomMax, z)), 2);\n                zoomOptions.zoom = z;\n\n                diagram.zoom(z, zoomOptions);\n                diagram.trigger(ZOOM_END, zoomOptions);\n\n                return true;\n            },\n            setTool: function(tool, index) {\n                tool.toolService = this;\n                this.tools[index] = tool;\n            },\n\n            selectSingle: function(item, meta) {\n                var diagram = this.diagram;\n                var selectable = diagram.options.selectable;\n                if (selectable && !item.isSelected && item.options.selectable !== false) {\n                    var addToSelection = meta.ctrlKey && selectable.multiple !== false;\n                    diagram.select(item, { addToSelection: addToSelection });\n                }\n            },\n\n            _discardNewConnection: function() {\n                if (this.newConnection) {\n                    this.diagram.remove(this.newConnection);\n                    this.newConnection = undefined;\n                }\n            },\n            _activateTool: function(p, meta) {\n                for (var i = 0; i < this.tools.length; i++) {\n                    var tool = this.tools[i];\n                    if (tool.tryActivate(p, meta)) {\n                        this.activeTool = tool;\n                        break; // activating the first available tool in the loop.\n                    }\n                }\n            },\n            _updateCursor: function(p) {\n                var element = this.diagram.element;\n                var cursor = this.activeTool ? this.activeTool.getCursor(p) : (this.hoveredAdorner ? this.hoveredAdorner._getCursor(p) : (this.hoveredItem ? this.hoveredItem._getCursor(p) : Cursors.arrow));\n\n                element.css({ cursor: cursor });\n            },\n            _connectionManipulation: function(connection, disabledShape, isNew) {\n                this.activeConnection = connection;\n                this.disabledShape = disabledShape;\n                if (isNew) {\n                    this.newConnection = this.activeConnection;\n                } else {\n                    this.newConnection = undefined;\n                }\n            },\n            _updateHoveredItem: function(p) {\n                var hit = this._hitTest(p);\n                var diagram = this.diagram;\n\n                if (hit != this.hoveredItem && (!this.disabledShape || hit != this.disabledShape)) {\n                    if (this.hoveredItem) {\n                        diagram.trigger(MOUSE_LEAVE, { item: this.hoveredItem });\n                        this.hoveredItem._hover(false);\n                    }\n\n                    if (hit && hit.options.enable) {\n                        diagram.trigger(MOUSE_ENTER, { item: hit });\n\n                        this.hoveredItem = hit; // Shape, connection or connector\n                        this.hoveredItem._hover(true);\n                    } else {\n                        this.hoveredItem = undefined;\n                    }\n                }\n            },\n            _removeHover: function() {\n                if (this.hoveredItem) {\n                    this.hoveredItem._hover(false);\n                    this.hoveredItem = undefined;\n                }\n            },\n            _hitTest: function(point) {\n                var hit, d = this.diagram, item, i;\n\n                // connectors\n                if (this._hoveredConnector) {\n                    this._hoveredConnector._hover(false);\n                    this._hoveredConnector = undefined;\n                }\n                if (d._connectorsAdorner._visible) {\n                    hit = d._connectorsAdorner._hitTest(point);\n                    if (hit) {\n                        return hit;\n                    }\n                }\n\n                hit = this.diagram._resizingAdorner._hitTest(point);\n                if (hit) {\n                    this.hoveredAdorner = d._resizingAdorner;\n                    if (hit.x !== 0 || hit.y !== 0) { // hit testing for resizers or rotator, otherwise if (0,0) than pass through.\n                        return;\n                    }\n                    hit = undefined;\n                } else {\n                    this.hoveredAdorner = undefined;\n                }\n\n                if (!this.activeTool || this.activeTool.type !== \"ConnectionTool\") {\n                    var selectedConnections = []; // only the connections should have higher presence because the connection edit point is on top of connector.\n                    // TODO: This should be reworked. The connection adorner should be one for all selected connections and should be hit tested prior the connections and shapes itself.\n                    for (i = 0; i < d._selectedItems.length; i++) {\n                        item = d._selectedItems[i];\n                        if (item instanceof diagram.Connection) {\n                            selectedConnections.push(item);\n                        }\n                    }\n                    hit = this._hitTestItems(selectedConnections, point);\n                }\n\n                return hit || this._hitTestElements(point);\n            },\n\n            _hitTestElements: function(point) {\n                var diagram = this.diagram;\n                var shapeHit = this._hitTestItems(diagram.shapes, point);\n                var connectionHit = this._hitTestItems(diagram.connections, point);\n                var hit;\n\n                if ((!this.activeTool || this.activeTool.type != \"ConnectionTool\") && shapeHit && connectionHit && !hitTestShapeConnectors(shapeHit, point)) {\n                    var mainLayer = diagram.mainLayer;\n                    var shapeIdx = inArray(shapeHit.visual, mainLayer.children);\n                    var connectionIdx = inArray(connectionHit.visual, mainLayer.children);\n                    hit = shapeIdx > connectionIdx ? shapeHit : connectionHit;\n                }\n                return hit || shapeHit || connectionHit;\n            },\n\n            _hitTestItems: function(array, point) {\n                var i, item, hit;\n                for (i = array.length - 1; i >= 0; i--) {\n                    item = array[i];\n                    hit = item._hitTest(point);\n                    if (hit) {\n                        return hit;\n                    }\n                }\n            }\n        });\n\n// Routing =========================================\n\n        /**\n         * Base class for connection routers.\n         */\n        var ConnectionRouterBase = kendo.Class.extend({\n            init: function() {\n            }\n            /*route: function (connection) {\n             },\n             hitTest: function (p) {\n\n             },\n             getBounds: function () {\n\n             }*/\n        });\n\n        /**\n         * Base class for polyline and cascading routing.\n         */\n        var LinearConnectionRouter = ConnectionRouterBase.extend({\n            init: function(connection) {\n                var that = this;\n                ConnectionRouterBase.fn.init.call(that);\n                this.connection = connection;\n            },\n            /**\n             * Hit testing for polyline paths.\n             */\n            hitTest: function(p) {\n                var rec = this.getBounds().inflate(HIT_TEST_DISTANCE);\n                if (!rec.contains(p)) {\n                    return false;\n                }\n                return diagram.Geometry.distanceToPolyline(p, this.connection.allPoints()) < HIT_TEST_DISTANCE;\n            },\n\n            /**\n             * Bounds of a polyline.\n             * @returns {kendo.dataviz.diagram.Rect}\n             */\n            getBounds: function() {\n                var points = this.connection.allPoints(),\n                    s = points[0],\n                    e = points[points.length - 1],\n                    right = Math.max(s.x, e.x),\n                    left = Math.min(s.x, e.x),\n                    top = Math.min(s.y, e.y),\n                    bottom = Math.max(s.y, e.y);\n\n                for (var i = 1; i < points.length - 1; ++i) {\n                    right = Math.max(right, points[i].x);\n                    left = Math.min(left, points[i].x);\n                    top = Math.min(top, points[i].y);\n                    bottom = Math.max(bottom, points[i].y);\n                }\n\n                return new Rect(left, top, right - left, bottom - top);\n            }\n        });\n\n        /**\n         * A simple poly-linear routing which does not alter the intermediate points.\n         * Does hold the underlying hit, bounds....logic.\n         * @type {*|Object|void|extend|Zepto.extend|b.extend}\n         */\n        var PolylineRouter = LinearConnectionRouter.extend({\n            init: function(connection) {\n                var that = this;\n                LinearConnectionRouter.fn.init.call(that);\n                this.connection = connection;\n            },\n            route: function() {\n                // just keep the points as is\n            }\n        });\n\n        var CascadingRouter = LinearConnectionRouter.extend({\n            SAME_SIDE_DISTANCE_RATIO: 5,\n\n            init: function(connection) {\n                var that = this;\n                LinearConnectionRouter.fn.init.call(that);\n                this.connection = connection;\n            },\n\n            routePoints: function(start, end, sourceConnector, targetConnector) {\n                var result;\n\n                if (sourceConnector && targetConnector) {\n                    result = this._connectorPoints(start, end, sourceConnector, targetConnector);\n                } else {\n                    result = this._floatingPoints(start, end, sourceConnector);\n                }\n                return result;\n            },\n\n            route: function() {\n                var sourceConnector = this.connection._resolvedSourceConnector;\n                var targetConnector = this.connection._resolvedTargetConnector;\n                var start = this.connection.sourcePoint();\n                var end = this.connection.targetPoint();\n                var points = this.routePoints(start, end, sourceConnector, targetConnector);\n                this.connection.points(points);\n            },\n\n            _connectorSides: [{\n                name: \"Top\",\n                axis: \"y\",\n                boundsPoint: \"topLeft\",\n                secondarySign: 1\n            }, {\n                name: \"Left\",\n                axis: \"x\",\n                boundsPoint: \"topLeft\",\n                secondarySign: 1\n            }, {\n                name: \"Bottom\",\n                axis: \"y\",\n                boundsPoint: \"bottomRight\",\n                secondarySign: -1\n            }, {\n                name: \"Right\",\n                axis: \"x\",\n                boundsPoint: \"bottomRight\",\n                secondarySign: -1\n            }],\n\n            _connectorSide: function(connector, targetPoint) {\n                var position = connector.position();\n                var shapeBounds = connector.shape.bounds(ROTATED);\n                var bounds = {\n                    topLeft: shapeBounds.topLeft(),\n                    bottomRight: shapeBounds.bottomRight()\n                };\n                var sides = this._connectorSides;\n                var min = util.MAX_NUM;\n                var sideDistance;\n                var minSide;\n                var axis;\n                var side;\n                for (var idx = 0; idx < sides.length; idx++) {\n                    side = sides[idx];\n                    axis = side.axis;\n                    sideDistance = Math.round(Math.abs(position[axis] - bounds[side.boundsPoint][axis]));\n                    if (sideDistance < min) {\n                        min = sideDistance;\n                        minSide = side;\n                    } else if (sideDistance === min &&\n                        (position[axis] - targetPoint[axis]) * side.secondarySign > (position[minSide.axis] - targetPoint[minSide.axis]) * minSide.secondarySign) {\n                        minSide = side;\n                    }\n                }\n                return minSide.name;\n            },\n\n            _sameSideDistance: function(connector) {\n                var bounds = connector.shape.bounds(ROTATED);\n                return Math.min(bounds.width, bounds.height) / this.SAME_SIDE_DISTANCE_RATIO;\n            },\n\n            _connectorPoints: function(start, end, sourceConnector, targetConnector) {\n                var sourceConnectorSide = this._connectorSide(sourceConnector, end);\n                var targetConnectorSide = this._connectorSide(targetConnector, start);\n                var deltaX = end.x - start.x;\n                var deltaY = end.y - start.y;\n                var sameSideDistance = this._sameSideDistance(sourceConnector);\n                var result = [];\n                var pointX, pointY;\n\n                if (sourceConnectorSide === TOP || sourceConnectorSide == BOTTOM) {\n                    if (targetConnectorSide == TOP || targetConnectorSide == BOTTOM) {\n                        if (sourceConnectorSide == targetConnectorSide) {\n                            if (sourceConnectorSide == TOP) {\n                                pointY = Math.min(start.y, end.y) - sameSideDistance;\n                            } else {\n                                pointY = Math.max(start.y, end.y) + sameSideDistance;\n                            }\n                            result = [new Point(start.x, pointY), new Point(end.x, pointY)];\n                        } else {\n                            result = [new Point(start.x, start.y + deltaY / 2), new Point(end.x, start.y + deltaY / 2)];\n                        }\n                    } else {\n                        result = [new Point(start.x, end.y)];\n                    }\n                } else {\n                    if (targetConnectorSide == LEFT || targetConnectorSide == RIGHT) {\n                        if (sourceConnectorSide == targetConnectorSide) {\n                            if (sourceConnectorSide == LEFT) {\n                                pointX = Math.min(start.x, end.x) - sameSideDistance;\n                            } else {\n                                pointX = Math.max(start.x, end.x) + sameSideDistance;\n                            }\n                            result = [new Point(pointX, start.y), new Point(pointX, end.y)];\n                        } else {\n                            result = [new Point(start.x + deltaX / 2, start.y), new Point(start.x + deltaX / 2, start.y + deltaY)];\n                        }\n                    } else {\n                        result = [new Point(end.x, start.y)];\n                    }\n                }\n                return result;\n            },\n\n            _floatingPoints: function(start, end, sourceConnector) {\n                var sourceConnectorSide = sourceConnector ? this._connectorSide(sourceConnector, end) : null;\n                var cascadeStartHorizontal = this._startHorizontal(start, end, sourceConnectorSide);\n                var points = [start, start, end, end];\n                var deltaX = end.x - start.x;\n                var deltaY = end.y - start.y;\n                var length = points.length;\n                var shiftX;\n                var shiftY;\n\n                // note that this is more generic than needed for only two intermediate points.\n                for (var idx = 1; idx < length - 1; ++idx) {\n                    if (cascadeStartHorizontal) {\n                        if (idx % 2 !== 0) {\n                            shiftX = deltaX / (length / 2);\n                            shiftY = 0;\n                        }\n                        else {\n                            shiftX = 0;\n                            shiftY = deltaY / ((length - 1) / 2);\n                        }\n                    }\n                    else {\n                        if (idx % 2 !== 0) {\n                            shiftX = 0;\n                            shiftY = deltaY / (length / 2);\n                        }\n                        else {\n                            shiftX = deltaX / ((length - 1) / 2);\n                            shiftY = 0;\n                        }\n                    }\n                    points[idx] = new Point(points[idx - 1].x + shiftX, points[idx - 1].y + shiftY);\n                }\n                // need to fix the wrong 1.5 factor of the last intermediate point\n                idx--;\n                if ((cascadeStartHorizontal && (idx % 2 !== 0)) || (!cascadeStartHorizontal && (idx % 2 === 0))) {\n                    points[length - 2] = new Point(points[length - 1].x, points[length - 2].y);\n                } else {\n                    points[length - 2] = new Point(points[length - 2].x, points[length - 1].y);\n                }\n\n                return [points[1], points[2]];\n            },\n\n            _startHorizontal: function(start, end, sourceSide) {\n                var horizontal;\n                if (sourceSide !== null && (sourceSide === RIGHT || sourceSide === LEFT)) {\n                    horizontal = true;\n                } else {\n                    horizontal = Math.abs(start.x - end.x) > Math.abs(start.y - end.y);\n                }\n\n                return horizontal;\n            }\n        });\n\n// Adorners =========================================\n\n        var AdornerBase = Class.extend({\n            init: function(diagram, options) {\n                var that = this;\n                that.diagram = diagram;\n                that.options = deepExtend({}, that.options, options);\n                that.visual = new Group();\n                that.diagram._adorners.push(that);\n            },\n            refresh: function() {\n\n            }\n        });\n\n        var ConnectionEditAdorner = AdornerBase.extend({\n            init: function(connection, options) {\n                var that = this, diagram;\n                that.connection = connection;\n                diagram = that.connection.diagram;\n                that._ts = diagram.toolService;\n                AdornerBase.fn.init.call(that, diagram, options);\n                var sp = that.connection.sourcePoint();\n                var tp = that.connection.targetPoint();\n                that.spVisual = new Circle(deepExtend(that.options.handles, { center: sp }));\n                that.epVisual = new Circle(deepExtend(that.options.handles, { center: tp }));\n                that.visual.append(that.spVisual);\n                that.visual.append(that.epVisual);\n            },\n\n            options: {\n                handles: {}\n            },\n\n            _getCursor: function() {\n                return Cursors.move;\n            },\n\n            start: function(p) {\n                this.handle = this._hitTest(p);\n                this.startPoint = p;\n                this._initialSource = this.connection.source();\n                this._initialTarget = this.connection.target();\n                switch (this.handle) {\n                    case -1:\n                        if (this.connection.targetConnector) {\n                            this._ts._connectionManipulation(this.connection, this.connection.targetConnector.shape);\n                        }\n                        break;\n                    case 1:\n                        if (this.connection.sourceConnector) {\n                            this._ts._connectionManipulation(this.connection, this.connection.sourceConnector.shape);\n                        }\n                        break;\n                }\n            },\n\n            move: function(handle, p) {\n                switch (handle) {\n                    case -1:\n                        this.connection.source(p);\n                        break;\n                    case 1:\n                        this.connection.target(p);\n                        break;\n                    default:\n                        var delta = p.minus(this.startPoint);\n                        this.startPoint = p;\n                        if (!this.connection.sourceConnector) {\n                            this.connection.source(this.connection.sourcePoint().plus(delta));\n                        }\n                        if (!this.connection.targetConnector) {\n                            this.connection.target(this.connection.targetPoint().plus(delta));\n                        }\n                        break;\n                }\n                this.refresh();\n                return true;\n            },\n\n            stop: function(p) {\n                var ts = this.diagram.toolService, item = ts.hoveredItem, target;\n                if (ts._hoveredConnector) {\n                    target = ts._hoveredConnector._c;\n                } else if (item && item instanceof diagram.Shape) {\n                    target = item.getConnector(AUTO) || item.getConnector(p);\n                } else {\n                    target = p;\n                }\n\n                if (this.handle === -1) {\n                    this.connection.source(target);\n                } else if (this.handle === 1) {\n                    this.connection.target(target);\n                }\n\n                this.handle = undefined;\n                this._ts._connectionManipulation();\n                return new ConnectionEditUndoUnit(this.connection, this._initialSource, this._initialTarget);\n            },\n\n            _hitTest: function(point) {\n                var sourcePoint = this.connection.sourcePoint();\n                var targetPoint = this.connection.targetPoint();\n                var radiusX = this.options.handles.width / 2 + HIT_TEST_DISTANCE;\n                var radiusY = this.options.handles.height / 2 + HIT_TEST_DISTANCE;\n                var sourcePointDistance = sourcePoint.distanceTo(point);\n                var targetPointDistance = targetPoint.distanceTo(point);\n                var sourceHandle = new Rect(sourcePoint.x, sourcePoint.y).inflate(radiusX, radiusY).contains(point);\n                var targetHandle = new Rect(targetPoint.x, targetPoint.y).inflate(radiusX, radiusY).contains(point);\n                var handle = 0;\n\n                if (sourceHandle && (!targetHandle || sourcePointDistance < targetPointDistance)) {\n                    handle = -1;\n                } else if (targetHandle && (!sourceHandle || targetPointDistance < sourcePointDistance)) {\n                    handle = 1;\n                }\n\n                return handle;\n            },\n\n            refresh: function() {\n                this.spVisual.redraw({ center: this.diagram.modelToLayer(this.connection.sourcePoint()) });\n                this.epVisual.redraw({ center: this.diagram.modelToLayer(this.connection.targetPoint()) });\n            }\n        });\n\n        var ConnectorsAdorner = AdornerBase.extend({\n            init: function(diagram, options) {\n                var that = this;\n                AdornerBase.fn.init.call(that, diagram, options);\n                that._refreshHandler = function(e) {\n                    if (e.item == that.shape) {\n                        that.refresh();\n                    }\n                };\n            },\n\n            show: function(shape) {\n                var that = this, len, i, ctr;\n                that._visible = true;\n                that.shape = shape;\n                that.diagram.bind(ITEMBOUNDSCHANGE, that._refreshHandler);\n                len = shape.connectors.length;\n                that.connectors = [];\n                that._clearVisual();\n                for (i = 0; i < len; i++) {\n                    ctr = new ConnectorVisual(shape.connectors[i]);\n                    that.connectors.push(ctr);\n                    that.visual.append(ctr.visual);\n                }\n                that.visual.visible(true);\n                that.refresh();\n            },\n\n            _clearVisual: function() {\n                var that = this;\n                if (that.diagram._cachedTouchTarget) {\n                    that._keepCachedTouchTarget();\n                } else {\n                    that.visual.clear();\n                }\n            },\n\n            _keepCachedTouchTarget: function() {\n                var that = this,\n                    visualChildren = that.visual.children;\n                var childrenCount = visualChildren.length;\n                var index = inArray(that.diagram._cachedTouchTarget, visualChildren);\n                for (var i = childrenCount - 1; i >= 0; i--) {\n                    if (i == index) {\n                        continue;\n                    }\n                    that.visual.remove(visualChildren[i]);\n                }\n            },\n\n            destroy: function() {\n                var that = this;\n                that.diagram.unbind(ITEMBOUNDSCHANGE, that._refreshHandler);\n                that.shape = undefined;\n                that._visible = undefined;\n                that.visual.visible(false);\n            },\n\n            _hitTest: function(p) {\n                var ctr, i;\n                for (i = 0; i < this.connectors.length; i++) {\n                    ctr = this.connectors[i];\n                    if (ctr._hitTest(p)) {\n                        ctr._hover(true);\n                        this.diagram.toolService._hoveredConnector = ctr;\n                        break;\n                    }\n                }\n            },\n\n            refresh: function() {\n                if (this.shape) {\n                    var bounds = this.shape.bounds();\n                        bounds = this.diagram.modelToLayer(bounds);\n                    this.visual.position(bounds.topLeft());\n                    $.each(this.connectors, function() {\n                        this.refresh();\n                    });\n                }\n            }\n        });\n\n        function hitToOppositeSide(hit, bounds) {\n            var result;\n\n            if (hit.x == -1 && hit.y == -1) {\n                result = bounds.bottomRight();\n            } else if (hit.x == 1 && hit.y == 1) {\n                result = bounds.topLeft();\n            } else if (hit.x == -1 && hit.y == 1) {\n                result = bounds.topRight();\n            } else if (hit.x == 1 && hit.y == -1) {\n                result = bounds.bottomLeft();\n            } else if (hit.x === 0 && hit.y == -1) {\n                result = bounds.bottom();\n            } else if (hit.x === 0 && hit.y == 1) {\n                result = bounds.top();\n            } else if (hit.x == 1 && hit.y === 0) {\n                result = bounds.left();\n            } else if (hit.x == -1 && hit.y === 0) {\n                result = bounds.right();\n            }\n\n            return result;\n        }\n\n        var ResizingAdorner = AdornerBase.extend({\n            init: function(diagram, options) {\n                var that = this;\n                AdornerBase.fn.init.call(that, diagram, options);\n                that._manipulating = false;\n                that.map = [];\n                that.shapes = [];\n\n                that._initSelection();\n                that._createHandles();\n                that.redraw();\n                that.diagram.bind(\"select\", function(e) {\n                    that._initialize(e.selected);\n                });\n\n                that._refreshHandler = function() {\n                    if (!that._internalChange) {\n                        that.refreshBounds();\n                        that.refresh();\n                    }\n                };\n\n                that._rotatedHandler = function() {\n                    if (that.shapes.length == 1) {\n                        that._angle = that.shapes[0].rotate().angle;\n                    }\n                    that._refreshHandler();\n                };\n\n                that.diagram.bind(ITEMBOUNDSCHANGE, that._refreshHandler).bind(ITEMROTATE, that._rotatedHandler);\n                that.refreshBounds();\n                that.refresh();\n            },\n\n            options: {\n                handles: {\n                    fill: {\n                        color: \"#fff\"\n                    },\n                    stroke: {\n                        color: \"#282828\"\n                    },\n                    height: 7,\n                    width: 7,\n                    hover: {\n                        fill: {\n                            color: \"#282828\"\n                        },\n                        stroke: {\n                            color: \"#282828\"\n                        }\n                    }\n                },\n                selectable: {\n                    stroke: {\n                        color: \"#778899\",\n                        width: 1,\n                        dashType: \"dash\"\n                    },\n                    fill: {\n                        color: TRANSPARENT\n                    }\n                },\n                offset: 10\n            },\n\n            _initSelection: function() {\n                var that = this;\n                var diagram = that.diagram;\n                var selectable = diagram.options.selectable;\n                var options = deepExtend({}, that.options.selectable, selectable);\n                that.rect = new Rectangle(options);\n                that.visual.append(that.rect);\n            },\n\n            _resizable: function() {\n                return this.options.editable && this.options.editable.resize !== false;\n            },\n\n            _handleOptions: function() {\n                return (this.options.editable.resize || {}).handles || this.options.handles;\n            },\n\n            _createHandles: function() {\n                var handles, item, y, x;\n\n                if (this._resizable()) {\n                    handles = this._handleOptions();\n                    for (x = -1; x <= 1; x++) {\n                        for (y = -1; y <= 1; y++) {\n                            if ((x !== 0) || (y !== 0)) { // (0, 0) element, (-1, -1) top-left, (+1, +1) bottom-right\n                                item = new Rectangle(handles);\n                                item.drawingElement._hover = this._hover.bind(this);\n                                this.map.push({ x: x, y: y, visual: item });\n                                this.visual.append(item);\n                            }\n                        }\n                    }\n                }\n            },\n\n            bounds: function(value) {\n                if (value) {\n                    this._innerBounds = value.clone();\n                    this._bounds = this.diagram.modelToLayer(value).inflate(this.options.offset, this.options.offset);\n                } else {\n                    return this._bounds;\n                }\n            },\n\n            _hitTest: function(p) {\n                var tp = this.diagram.modelToLayer(p),\n                    i, hit, handleBounds, handlesCount = this.map.length, handle;\n\n                if (this._angle) {\n                    tp = tp.clone().rotate(this._bounds.center(), this._angle);\n                }\n\n                if (this._resizable()) {\n                    for (i = 0; i < handlesCount; i++) {\n                        handle = this.map[i];\n                        hit = new Point(handle.x, handle.y);\n                        handleBounds = this._getHandleBounds(hit); //local coordinates\n                        handleBounds.offset(this._bounds.x, this._bounds.y);\n                        if (handleBounds.contains(tp)) {\n                            return hit;\n                        }\n                    }\n                }\n\n                if (this._bounds.contains(tp)) {\n                    return new Point(0, 0);\n                }\n            },\n\n            _getHandleBounds: function(p) {\n                if (this._resizable()) {\n                    var handles = this._handleOptions(),\n                        w = handles.width,\n                        h = handles.height,\n                        r = new Rect(0, 0, w, h);\n\n                    if (p.x < 0) {\n                        r.x = - w / 2;\n                    } else if (p.x === 0) {\n                        r.x = Math.floor(this._bounds.width / 2) - w / 2;\n                    } else if (p.x > 0) {\n                        r.x = this._bounds.width + 1.0 - w / 2;\n                    } if (p.y < 0) {\n                        r.y = - h / 2;\n                    } else if (p.y === 0) {\n                        r.y = Math.floor(this._bounds.height / 2) - h / 2;\n                    } else if (p.y > 0) {\n                        r.y = this._bounds.height + 1.0 - h / 2;\n                    }\n\n                    return r;\n                }\n            },\n\n            _getCursor: function(point) {\n                var hit = this._hitTest(point);\n                if (hit && (hit.x >= -1) && (hit.x <= 1) && (hit.y >= -1) && (hit.y <= 1) && this._resizable()) {\n                    var angle = this._angle;\n                    if (angle) {\n                        angle = 360 - angle;\n                        hit.rotate(new Point(0, 0), angle);\n                        hit = new Point(Math.round(hit.x), Math.round(hit.y));\n                    }\n\n                    if (hit.x == -1 && hit.y == -1) {\n                        return \"nw-resize\";\n                    }\n                    if (hit.x == 1 && hit.y == 1) {\n                        return \"se-resize\";\n                    }\n                    if (hit.x == -1 && hit.y == 1) {\n                        return \"sw-resize\";\n                    }\n                    if (hit.x == 1 && hit.y == -1) {\n                        return \"ne-resize\";\n                    }\n                    if (hit.x === 0 && hit.y == -1) {\n                        return \"n-resize\";\n                    }\n                    if (hit.x === 0 && hit.y == 1) {\n                        return \"s-resize\";\n                    }\n                    if (hit.x == 1 && hit.y === 0) {\n                        return \"e-resize\";\n                    }\n                    if (hit.x == -1 && hit.y === 0) {\n                        return \"w-resize\";\n                    }\n                }\n                return this._manipulating ? Cursors.move : Cursors.select;\n            },\n\n            _initialize: function() {\n                var that = this, i, item,\n                    items = that.diagram.select();\n\n                that.shapes = [];\n                for (i = 0; i < items.length; i++) {\n                    item = items[i];\n                    if (item instanceof diagram.Shape) {\n                        that.shapes.push(item);\n                        item._rotationOffset = new Point();\n                    }\n                }\n\n                that._angle = that.shapes.length == 1 ? that.shapes[0].rotate().angle : 0;\n                that._startAngle = that._angle;\n                that._rotates();\n                that._positions();\n                that.refreshBounds();\n                that.refresh();\n                that.redraw();\n            },\n\n            _rotates: function() {\n                var that = this, i, shape;\n                that.initialRotates = [];\n                for (i = 0; i < that.shapes.length; i++) {\n                    shape = that.shapes[i];\n                    that.initialRotates.push(shape.rotate().angle);\n                }\n            },\n\n            _positions: function() {\n                var that = this, i, shape;\n                that.initialStates = [];\n                for (i = 0; i < that.shapes.length; i++) {\n                    shape = that.shapes[i];\n                    that.initialStates.push(shape.bounds());\n                }\n            },\n\n            _hover: function(value, element) {\n                if (this._resizable()) {\n                    var handleOptions = this._handleOptions(),\n                        hover = handleOptions.hover,\n                        stroke = handleOptions.stroke,\n                        fill = handleOptions.fill;\n\n                    if (value && Utils.isDefined(hover.stroke)) {\n                        stroke = deepExtend({}, stroke, hover.stroke);\n                    }\n\n                    if (value && Utils.isDefined(hover.fill)) {\n                        fill = hover.fill;\n                    }\n                    element.stroke(stroke.color, stroke.width, stroke.opacity);\n                    element.fill(fill.color, fill.opacity);\n                }\n            },\n\n            start: function(p) {\n                this._sp = p;\n                this._cp = p;\n                this._lp = p;\n                this._manipulating = true;\n                this._internalChange = true;\n                this.shapeStates = [];\n                for (var i = 0; i < this.shapes.length; i++) {\n                    var shape = this.shapes[i];\n                    this.shapeStates.push(shape.bounds());\n                }\n            },\n\n            redraw: function() {\n                var i, handle,\n                    visibleHandles = this._resizable();\n\n                for (i = 0; i < this.map.length; i++) {\n                    handle = this.map[i];\n                    handle.visual.visible(visibleHandles);\n                }\n            },\n\n            angle: function(value) {\n                if (defined(value)) {\n                    this._angle = value;\n                }\n\n                return this._angle;\n            },\n\n            rotate: function() {\n                var center = this._innerBounds.center();\n                var currentAngle = this.angle();\n                this._internalChange = true;\n                for (var i = 0; i < this.shapes.length; i++) {\n                    var shape = this.shapes[i];\n                    currentAngle = (currentAngle + this.initialRotates[i] - this._startAngle) % 360;\n                    shape.rotate(currentAngle, center);\n                }\n                this.refresh();\n            },\n\n            move: function(handle, p) {\n                var delta, dragging,\n                    dtl = new Point(),\n                    dbr = new Point(),\n                    bounds, center, shape,\n                    i, angle, newBounds,\n                    changed = 0, staticPoint,\n                    scaleX, scaleY;\n\n                if (handle.y === -2 && handle.x === -1) {\n                    center = this._innerBounds.center();\n                    this._angle = this._truncateAngle(Utils.findAngle(center, p));\n                    for (i = 0; i < this.shapes.length; i++) {\n                        shape = this.shapes[i];\n                        angle = (this._angle + this.initialRotates[i] - this._startAngle) % 360;\n                        shape.rotate(angle, center);\n                        if (shape.hasOwnProperty(\"layout\")) {\n                            shape.layout(shape);\n                        }\n                        this._rotating = true;\n                    }\n                    this.refresh();\n                } else {\n                    if (this.shouldSnap()) {\n                        var thr = this._truncateDistance(p.minus(this._lp));\n                        // threshold\n                        if (thr.x === 0 && thr.y === 0) {\n                            this._cp = p;\n                            return;\n                        }\n                        delta = thr;\n                        this._lp = new Point(this._lp.x + thr.x, this._lp.y + thr.y);\n                    } else {\n                        delta = p.minus(this._cp);\n                    }\n\n                    if (this.isDragHandle(handle)) {\n                        dbr = dtl = delta; // dragging\n                        dragging = true;\n                    } else {\n                        if (this._angle) { // adjust the delta so that resizers resize in the correct direction after rotation.\n                            delta.rotate(new Point(0, 0), this._angle);\n                        }\n                        if (handle.x == -1) {\n                            dtl.x = delta.x;\n                        } else if (handle.x == 1) {\n                            dbr.x = delta.x;\n                        }\n                        if (handle.y == -1) {\n                            dtl.y = delta.y;\n                        } else if (handle.y == 1) {\n                            dbr.y = delta.y;\n                        }\n                    }\n\n                    if (!dragging) {\n                        staticPoint = hitToOppositeSide(handle, this._innerBounds);\n                        scaleX = (this._innerBounds.width + delta.x * handle.x) / this._innerBounds.width;\n                        scaleY = (this._innerBounds.height + delta.y * handle.y) / this._innerBounds.height;\n                    }\n\n                    for (i = 0; i < this.shapes.length; i++) {\n                        shape = this.shapes[i];\n                        bounds = shape.bounds();\n                        if (dragging) {\n                            if (!canDrag(shape)) {\n                                continue;\n                            }\n                            newBounds = this._displaceBounds(bounds, dtl, dbr, dragging);\n                        } else {\n                            newBounds = bounds.clone();\n                            newBounds.scale(scaleX, scaleY, staticPoint, this._innerBounds.center(), shape.rotate().angle);\n                            var newCenter = newBounds.center(); // fixes the new rotation center.\n                            newCenter.rotate(bounds.center(), -this._angle);\n                            newBounds = new Rect(newCenter.x - newBounds.width / 2, newCenter.y - newBounds.height / 2, newBounds.width, newBounds.height);\n                        }\n                        if (newBounds.width >= shape.options.minWidth && newBounds.height >= shape.options.minHeight) { // if we up-size very small shape\n                            var oldBounds = bounds;\n                            shape.bounds(newBounds);\n                            if (shape.hasOwnProperty(\"layout\")) {\n                                shape.layout(shape, oldBounds, newBounds);\n                            }\n                            if (oldBounds.width !== newBounds.width || oldBounds.height !== newBounds.height) {\n                                shape.rotate(shape.rotate().angle); // forces the rotation to update it's rotation center\n                            }\n                            changed += 1;\n                        }\n                    }\n\n                    if (changed) {\n                        if (changed == i) {\n                            newBounds = this._displaceBounds(this._innerBounds, dtl, dbr, dragging);\n                            this.bounds(newBounds);\n                        } else {\n                            this.refreshBounds();\n                        }\n                        this.refresh();\n                    }\n\n                    this._positions();\n                }\n\n                this._cp = p;\n            },\n\n            isDragHandle: function(handle) {\n                return handle.x === 0 && handle.y === 0;\n            },\n\n            cancel: function() {\n                var shapes = this.shapes;\n                var states = this.shapeStates;\n                for (var idx = 0; idx < shapes.length; idx++) {\n                    shapes[idx].bounds(states[idx]);\n                }\n                this.refreshBounds();\n                this.refresh();\n                this._manipulating = undefined;\n                this._internalChange = undefined;\n                this._rotating = undefined;\n            },\n\n            _truncatePositionToGuides: function(bounds) {\n                if (this.diagram.ruler) {\n                    return this.diagram.ruler.truncatePositionToGuides(bounds);\n                }\n                return bounds;\n            },\n\n            _truncateSizeToGuides: function(bounds) {\n                if (this.diagram.ruler) {\n                    return this.diagram.ruler.truncateSizeToGuides(bounds);\n                }\n                return bounds;\n            },\n\n            _truncateAngle: function(a) {\n                var snap = this.snapOptions();\n                var snapAngle = Math.max(snap.angle || DEFAULT_SNAP_ANGLE, MIN_SNAP_ANGLE);\n                return snap ? Math.floor((a % 360) / snapAngle) * snapAngle : (a % 360);\n            },\n\n            _truncateDistance: function(d) {\n                if (d instanceof diagram.Point) {\n                    return new diagram.Point(this._truncateDistance(d.x), this._truncateDistance(d.y));\n                } else {\n                    var snap = this.snapOptions() || {};\n                    var snapSize = Math.max(snap.size || DEFAULT_SNAP_SIZE, MIN_SNAP_SIZE);\n                    return snap ? Math.floor(d / snapSize) * snapSize : d;\n                }\n            },\n\n            snapOptions: function() {\n                var editable = this.diagram.options.editable;\n                var snap = ((editable || {}).drag || {}).snap || {};\n                return snap;\n            },\n\n            shouldSnap: function() {\n                var editable = this.diagram.options.editable;\n                var drag = (editable || {}).drag;\n                var snap = (drag || {}).snap;\n                return editable !== false && drag !== false && snap !== false;\n            },\n\n            _displaceBounds: function(bounds, dtl, dbr, dragging) {\n                var tl = bounds.topLeft().plus(dtl),\n                    br = bounds.bottomRight().plus(dbr),\n                    newBounds = Rect.fromPoints(tl, br),\n                    newCenter;\n                if (!dragging) {\n                    newCenter = newBounds.center();\n                    newCenter.rotate(bounds.center(), -this._angle);\n                    newBounds = new Rect(newCenter.x - newBounds.width / 2, newCenter.y - newBounds.height / 2, newBounds.width, newBounds.height);\n                }\n                return newBounds;\n            },\n\n            stop: function() {\n                var unit, i, shape;\n                if (this._cp != this._sp) {\n                    if (this._rotating) {\n                        unit = new RotateUnit(this, this.shapes, this.initialRotates);\n                        this._rotating = false;\n                    } else if (this._diffStates()) {\n                        if (this.diagram.ruler) {\n                            for (i = 0; i < this.shapes.length; i++) {\n                                shape = this.shapes[i];\n                                var bounds = shape.bounds();\n                                bounds = this._truncateSizeToGuides(this._truncatePositionToGuides(bounds));\n                                shape.bounds(bounds);\n                                this.refreshBounds();\n                                this.refresh();\n                            }\n                        }\n                        for (i = 0; i < this.shapes.length; i++) {\n                            shape = this.shapes[i];\n                            shape.updateModel();\n                        }\n                        unit = new TransformUnit(this.shapes, this.shapeStates, this);\n                        this.diagram._syncShapeChanges();\n                    }\n                }\n\n                this._manipulating = undefined;\n                this._internalChange = undefined;\n                this._rotating = undefined;\n                return unit;\n            },\n\n            _diffStates: function() {\n                var shapes = this.shapes;\n                var states = this.shapeStates;\n                for (var idx = 0; idx < shapes.length; idx++) {\n                    if (!shapes[idx].bounds().equals(states[idx])) {\n                        return true;\n                    }\n                }\n                return false;\n            },\n\n            refreshBounds: function() {\n                var bounds = this.shapes.length == 1 ?\n                    this.shapes[0].bounds().clone() :\n                    this.diagram.boundingBox(this.shapes, true);\n\n                this.bounds(bounds);\n            },\n\n            refresh: function() {\n                var that = this, b, bounds;\n                if (this.shapes.length > 0) {\n                    bounds = this.bounds();\n                    this.visual.visible(true);\n                    this.visual.position(bounds.topLeft());\n                    $.each(this.map, function() {\n                        b = that._getHandleBounds(new Point(this.x, this.y));\n                        this.visual.position(b.topLeft());\n                    });\n                    this.visual.position(bounds.topLeft());\n\n                    var center = new Point(bounds.width / 2, bounds.height / 2);\n                    this.visual.rotate(this._angle, center);\n                    this.rect.redraw({ width: bounds.width, height: bounds.height });\n                    if (this.rotationThumb) {\n                        var thumb = this.options.editable.rotate.thumb;\n                        this._rotationThumbBounds = new Rect(bounds.center().x, bounds.y + thumb.y, 0, 0).inflate(thumb.width);\n                        this.rotationThumb.redraw({ x: bounds.width / 2 - thumb.width / 2 });\n                    }\n                } else {\n                    this.visual.visible(false);\n                }\n            }\n        });\n\n        var Selector = Class.extend({\n            init: function(diagram) {\n                var selectable = diagram.options.selectable;\n                this.options = deepExtend({}, this.options, selectable);\n\n                this.visual = new Rectangle(this.options);\n                this.diagram = diagram;\n            },\n            options: {\n                stroke: {\n                    color: \"#778899\",\n                    width: 1,\n                    dashType: \"dash\"\n                },\n                fill: {\n                    color: TRANSPARENT\n                }\n            },\n            start: function(p) {\n                this._sp = this._ep = p;\n                this.refresh();\n                this.diagram._adorn(this, true);\n            },\n            end: function() {\n                this._sp = this._ep = undefined;\n                this.diagram._adorn(this, false);\n            },\n            bounds: function(value) {\n                if (value) {\n                    this._bounds = value;\n                }\n                return this._bounds;\n            },\n            move: function(p) {\n                this._ep = p;\n                this.refresh();\n            },\n            refresh: function() {\n                if (this._sp) {\n                    var visualBounds = Rect.fromPoints(this.diagram.modelToLayer(this._sp), this.diagram.modelToLayer(this._ep));\n                    this.bounds(Rect.fromPoints(this._sp, this._ep));\n                    this.visual.position(visualBounds.topLeft());\n                    this.visual.redraw({ height: visualBounds.height + 1, width: visualBounds.width + 1 });\n                }\n            }\n        });\n\n        var ConnectorVisual = Class.extend({\n            init: function(connector) {\n                this.options = deepExtend({}, connector.options);\n                this._c = connector;\n                this.visual = new Circle(this.options);\n                this.refresh();\n            },\n            _hover: function(value) {\n                var options = this.options,\n                    hover = options.hover,\n                    stroke = options.stroke,\n                    fill = options.fill;\n\n                if (value && Utils.isDefined(hover.stroke)) {\n                    stroke = deepExtend({}, stroke, hover.stroke);\n                }\n\n                if (value && Utils.isDefined(hover.fill)) {\n                    fill = hover.fill;\n                }\n\n                this.visual.redraw({\n                    stroke: stroke,\n                    fill: fill\n                });\n            },\n            refresh: function() {\n                var p = this._c.shape.diagram.modelToView(this._c.position()),\n                    relative = p.minus(this._c.shape.bounds(\"transformed\").topLeft()),\n                    value = new Rect(p.x, p.y, 0, 0);\n                value.inflate(this.options.width / 2, this.options.height / 2);\n                this._visualBounds = value;\n                this.visual.redraw({ center: new Point(relative.x, relative.y) });\n            },\n            _hitTest: function(p) {\n                var tp = this._c.shape.diagram.modelToView(p);\n                return this._visualBounds.contains(tp);\n            }\n        });\n\n        function canDrag(element) {\n            var editable = element.options.editable;\n            return editable && editable.drag !== false;\n        }\n\n        function hitTestShapeConnectors(shape, point) {\n            var connector, position, rect;\n            for (var idx = 0; idx < shape.connectors.length; idx++) {\n                connector = shape.connectors[idx];\n                position = connector.position();\n                rect = new Rect(position.x, position.y);\n                rect.inflate(HIT_TEST_DISTANCE, HIT_TEST_DISTANCE);\n                if (rect.contains(point)) {\n                    return connector;\n                }\n            }\n        }\n\n        function noMeta(meta) {\n            return meta.ctrlKey === false && meta.altKey === false && meta.shiftKey === false;\n        }\n\n        deepExtend(diagram, {\n            CompositeUnit: CompositeUnit,\n            TransformUnit: TransformUnit,\n            PanUndoUnit: PanUndoUnit,\n            AddShapeUnit: AddShapeUnit,\n            AddConnectionUnit: AddConnectionUnit,\n            DeleteShapeUnit: DeleteShapeUnit,\n            DeleteConnectionUnit: DeleteConnectionUnit,\n            ConnectionEditAdorner: ConnectionEditAdorner,\n            ConnectionTool: ConnectionTool,\n            ConnectorVisual: ConnectorVisual,\n            UndoRedoService: UndoRedoService,\n            ResizingAdorner: ResizingAdorner,\n            Selector: Selector,\n            ToolService: ToolService,\n            ConnectorsAdorner: ConnectorsAdorner,\n            LayoutUndoUnit: LayoutUndoUnit,\n            ConnectionEditUnit: ConnectionEditUnit,\n            ToFrontUnit: ToFrontUnit,\n            ToBackUnit: ToBackUnit,\n            ConnectionRouterBase: ConnectionRouterBase,\n            PolylineRouter: PolylineRouter,\n            CascadingRouter: CascadingRouter,\n            SelectionTool: SelectionTool,\n            ScrollerTool: ScrollerTool,\n            PointerTool: PointerTool,\n            ConnectionEditTool: ConnectionEditTool,\n            RotateUnit: RotateUnit\n        });\n})(window.kendo.jQuery);\n\n}, __webpack_require__.amdD);\n\n\n/***/ }),\n\n/***/ 79174:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"../../kendo.drawing\");\n\n/***/ }),\n\n/***/ 48643:\n/***/ (function(module) {\n\n\"use strict\";\nmodule.exports = require(\"./svg\");\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/amd define */\n/******/ \t!function() {\n/******/ \t\t__webpack_require__.amdD = function () {\n/******/ \t\t\tthrow new Error('define cannot be used indirect');\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/************************************************************************/\n/******/ \t\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \t// This entry module used 'module' so it can't be inlined\n/******/ \tvar __webpack_exports__ = __webpack_require__(31545);\n/******/ \tmodule.exports = __webpack_exports__;\n/******/ \t\n/******/ })()\n;"],"mappings":"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"},"metadata":{},"sourceType":"script"}